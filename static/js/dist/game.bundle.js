/*! For license information please see game.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t={812:(e,t,n)=>{function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,c=[],l=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(c.push(r.value),c.length!==t);l=!0);}catch(e){s=!0,o=e}finally{try{if(!l&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return c}}(e,t)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Cs:()=>l,Mx:()=>c,Ve:()=>a,rf:()=>i});var a={h:{direction:"h",description:"LEFT ←"},j:{direction:"j",description:"DOWN ↓"},k:{direction:"k",description:"UP ↑"},l:{direction:"l",description:"RIGHT →"},ArrowLeft:{direction:"ArrowLeft",description:"NOOB: LEFT ←"},ArrowDown:{direction:"ArrowDown",description:"NOOB: DOWN ↓"},ArrowUp:{direction:"ArrowUp",description:"NOOB: UP ↑"},ArrowRight:{direction:"ArrowRight",description:"NOOB: RIGHT →"},w:{direction:"w",description:"WORD FORWARD →"},W:{direction:"W",description:"WORD FORWARD (space-separated) →"},b:{direction:"b",description:"WORD BACK ←"},B:{direction:"B",description:"WORD BACK (space-separated) ←"},e:{direction:"e",description:"END WORD →"},E:{direction:"E",description:"END WORD (space-separated) →"},ge:{direction:"ge",description:"END PREV WORD ←"},gE:{direction:"gE",description:"END PREV WORD (non-blank sequence) ←"},0:{direction:"0",description:"LINE START ←"},$:{direction:"$",description:"LINE END →"},"^":{direction:"^",description:"FIRST NON-BLANK CHAR ←"},g_:{direction:"g_",description:"LAST NON-BLANK CHAR →"},H:{direction:"H",description:"TOP OF SCREEN"},M:{direction:"M",description:"MIDDLE OF SCREEN"},L:{direction:"L",description:"BOTTOM OF SCREEN"},"{":{direction:"{",description:"PREV PARAGRAPH ←"},"}":{direction:"}",description:"NEXT PARAGRAPH →"},"(":{direction:"(",description:"PREV SENTENCE ←"},")":{direction:")",description:"NEXT SENTENCE →"},g:{direction:"g",description:"g combination pressed"},gg:{direction:"gg",description:"TOP OF FILE"},G:{direction:"G",description:"END OF FILE"},f:{direction:"f<char>",description:"FIND CHAR →"},F:{direction:"F<char>",description:"FIND CHAR ←"},t:{direction:"t<char>",description:"TILL CHAR →"},T:{direction:"T<char>",description:"TILL CHAR ←"},";":{direction:";",description:"REPEAT SEARCH"},",":{direction:",",description:"REVERSE REPEAT SEARCH"},"%":{direction:"%",description:"MATCHING BRACKET"}},i=Object.fromEntries(Object.entries(a).map(function(e){var t=r(e,2),n=t[0],o=t[1];return[n,"You pressed ".concat(n," to go ").concat(o.description)]})),c=Object.fromEntries(Object.entries(a).map(function(e){var t=r(e,2),n=t[0],o=t[1];return[n,"You pressed ".concat(n," to go ").concat(o.description," - BLOCKED!")]})),l=Object.keys(a)},993:(e,t,n)=>{var r={};n.r(r),n.d(r,{resetGameBanner:()=>He,showBlockedBanner:()=>Ye,showCorrectMoveBanner:()=>ze,showErrorBanner:()=>Ke,showGameBanner:()=>Ve,showNormalBanner:()=>We,showPearlBanner:()=>qe});var o={};n.r(o),n.d(o,{applyVisibilityToElement:()=>Bt,areSpritesHidden:()=>Rt,hideSprites:()=>Ft,setSpritesHidden:()=>Dt,showSprites:()=>Ut,toggleSpriteVisibility:()=>Gt});var a={};n.r(a),n.d(a,{handleMapToggle:()=>zt,initializeMapToggle:()=>Kt,isMapVisible:()=>Ht,toggleMap:()=>Wt});var i={};n.r(i),n.d(i,{applyScaling:()=>bn,disableScaling:()=>gn,enableScaling:()=>mn,forceScaling:()=>yn,initializeResponsiveScaling:()=>fn,isScalingEnabled:()=>an,triggerScaling:()=>wn,updateScalingAfterMapChange:()=>vn});var c={};n.r(c),n.d(c,{animateHelpText:()=>Gn,initializeVimManual:()=>jn,isBookAnimationActive:()=>Un,startInfiniteBookAnimation:()=>Bn,stopBookAnimation:()=>Fn});var l={};n.r(l),n.d(l,{generateRandomTutorialCommand:()=>sr,handleTutorialMovement:()=>ur,initializeTutorialMode:()=>Vt,toggleTutorialMode:()=>gr});var s={};n.r(s),n.d(s,{clearNumberPrefix:()=>yr,resetHeaderInfo:()=>br,showMovementFeedback:()=>vr,showNumberPrefix:()=>wr});var u={};n.r(u),n.d(u,{cleanupOrphanedPlayerSprites:()=>Sr,updateGameDisplay:()=>Or,updateScore:()=>Pr});var d={};n.r(d),n.d(d,{areLineNumbersVisible:()=>Br,hideLineNumbers:()=>Gr,initializeLineNumbers:()=>Vr,showLineNumbers:()=>Dr,toggleLineNumbers:()=>Ur,updateLineNumbersOnResize:()=>jr,updateLineNumbersScaling:()=>Fr});var p={};n.r(p),n.d(p,{areRelativeLineNumbersVisible:()=>Xr,hideRelativeLineNumbers:()=>Wr,initializeRelativeLineNumbers:()=>Qr,showRelativeLineNumbers:()=>Kr,toggleRelativeLineNumbers:()=>Zr,updateRelativeLineNumbersOnResize:()=>$r,updateRelativeLineNumbersScaling:()=>Jr});var g={};n.r(g),n.d(g,{hideSpaceHighlight:()=>Ir,initializeSpaceHighlight:()=>ro,isSpaceHighlightActive:()=>Ar,showSpaceHighlight:()=>_r,toggleSpaceHighlight:()=>to,updateSpaceHighlightOnResize:()=>no});var m={};n.r(m),n.d(m,{applyFullscreenPreference:()=>so,isFullscreenActive:()=>lo,toggleFullscreen:()=>ao});var f={};n.r(f),n.d(f,{applySavedPreferences:()=>So,clearPreferences:()=>Eo,getUserPreferences:()=>wo,saveUserPreferences:()=>yo,togglePreference:()=>ho,updatePreference:()=>bo});var v={};n.r(v),n.d(v,{TUTORIAL_HINTS:()=>Mo,getHintText:()=>ra,initializeTutorialHints:()=>Qo,removeTutorialHints:()=>ta,toggleHint:()=>Xo,triggerLowScoreMessage:()=>oa,updateHintText:()=>na});var w={};n.r(w),n.d(w,{initializeScoreAnimations:()=>ga,isLowScoreTriggered:()=>wa,resetLowScoreTrigger:()=>va,startScoreMonitoring:()=>fa,triggerPearlAnimation:()=>da,triggerPenaltyAnimation:()=>ua,updateScoreWithAnimation:()=>ma});var y={};n.r(y),n.d(y,{forceGameStateRefresh:()=>Ga,initializeRealTimeUpdates:()=>Da,isPollingActive:()=>Fa,notifyMovementActivity:()=>Ca,startGameStatePolling:()=>Pa,stopGameStatePolling:()=>Ra});var b={};n.r(b),n.d(b,{applyParagraphSeparation:()=>Ha,initializeParagraphSeparation:()=>Va,toggleVisibleEmptyRows:()=>qa,updateParagraphSeparationAfterMapChange:()=>Ya});function h(){logger.debug("Boba.vim Text Adventure loaded"),function(){var e=document.querySelector(".game-board");if(!e)return;var t=localStorage.getItem("boba_vim_selected_character")||"boba";["game-board-boba","game-board-pinky","game-board-golden","game-board-black","game-board-boba_diamond"].forEach(function(t){return e.classList.remove(t)}),e.classList.add("game-board-".concat(t)),logger.debug("Applied game board styling for character: ".concat(t))}()}var E=n(597),S=n(630);function M(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return A(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(A(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,A(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,A(d,"constructor",s),A(s,"constructor",l),l.displayName="GeneratorFunction",A(s,o,"GeneratorFunction"),A(d),A(d,o,"Generator"),A(d,r,function(){return this}),A(d,"toString",function(){return"[object Generator]"}),(M=function(){return{w:a,m:p}})()}function A(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}A=function(e,t,n,r){function a(t,n){A(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},A(e,t,n,r)}function T(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){T(a,r,o,i,c,"next",e)}function c(e){T(a,r,o,i,c,"throw",e)}i(void 0)})}}var I=new Set,L=!1,P=!1,x=!1;function O(){return N.apply(this,arguments)}function N(){return(N=_(M().m(function e(){return M().w(function(e){for(;;)switch(e.n){case 0:if(!x){e.n=1;break}return e.a(2);case 1:return e.n=2,k();case 2:return e.n=3,V();case 3:x=!0;case 4:return e.a(2)}},e)}))).apply(this,arguments)}function k(){return C.apply(this,arguments)}function C(){return(C=_(M().m(function e(){var t,n,r;return M().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.user){e.n=4;break}return L=!0,P=n.user.email_confirmed||!1,n.user,e.n=3,D();case 3:e.n=5;break;case 4:L=!1,P=!1,R();case 5:e.n=7;break;case 6:e.p=6,r=e.v,logger.error("Error checking authentication:",r),L=!1,P=!1,R();case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}function R(){try{var e=localStorage.getItem("boba_vim_completed_maps");if(e){var t=JSON.parse(e);I=new Set(t)}}catch(e){logger.error("Error loading completed maps from localStorage:",e),I=new Set}}function D(){return G.apply(this,arguments)}function G(){return(G=_(M().m(function e(){var t,n,r;return M().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/completed-maps",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:n=e.v,I=n.success?new Set(n.completed_maps||[]):new Set,e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Error loading completed maps from server:",r),I=new Set;case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function B(e){return e<=6||e>=7&&(L&&P)}function F(e){return U.apply(this,arguments)}function U(){return(U=_(M().m(function e(t){return M().w(function(e){for(;;)switch(e.n){case 0:if(x){e.n=1;break}return e.n=1,O();case 1:logger.debug("Marking map as completed:",t),logger.debug("Current completed maps before:",Array.from(I)),I.has(t)?logger.debug("Map",t,"was already completed"):(I.add(t),logger.debug("Current completed maps after:",Array.from(I)),L?logger.debug("User is authenticated, not saving to localStorage"):(logger.debug("User is guest, saving to localStorage"),j()));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function j(){try{var e=Array.from(I);logger.debug("Saving completed maps to localStorage:",e),localStorage.setItem("boba_vim_completed_maps",JSON.stringify(e)),logger.debug("Successfully saved to localStorage")}catch(e){logger.error("Error saving completed maps to localStorage:",e)}}function V(){return H.apply(this,arguments)}function H(){return(H=_(M().m(function e(){var t,n;return M().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:n=e.v,(L=n.success&&n.user)?(P=n.user.email_confirmed||!1,n.user):(P=!1,null),e.n=4;break;case 3:e.p=3,e.v,L=!1,P=!1;case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Y(e){return e<=6?null:e>=7?L&&P?null:"Create and confirm your account to access all maps":null}var q=n(282),z=0,K=!1,W=[],X=[{selector:'[data-action="leaderboard"]',column:1,row:0,type:"button"},{selector:'[data-action="previous-map"]',column:0,row:1,type:"button"},{selector:'[data-action="play-same-map"]',column:1,row:1,type:"button"},{selector:'[data-action="next-map"]',column:2,row:1,type:"button"},{selector:'[data-action="back-to-menu"]',column:1,row:2,type:"button"}];X.findIndex(function(e){return'[data-action="play-same-map"]'===e.selector});function J(){logger.debug("Initializing game completion vim navigation..."),W=X.filter(function(e){var t=document.querySelector(e.selector);return t&&function(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden")}catch(e){return!1}}(t)}),logger.debug("Available completion elements:",W.length),z=function(){for(var e=0;e<W.length;e++)if('[data-action="play-same-map"]'===W[e].selector)return e;return 0}(),K=!0,logger.debug("Game completion vim starting at element index: ".concat(z)),ee(),document.addEventListener("keydown",Q),logger.debug("Game completion vim navigation initialized")}function Z(){K=!1,te(),document.removeEventListener("keydown",Q),logger.debug("Game completion vim navigation disabled")}function $(){if(z<0||z>=W.length)return null;var e=W[z];if(!e)return null;try{return document.querySelector(e.selector)}catch(e){return null}}function Q(e){if(K&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable)switch(e.key.toLowerCase()){case"h":e.preventDefault(),function(){var e=W[z];if(!e)return;if('[data-action="play-same-map"]'===e.selector){var t=W.findIndex(function(e){return'[data-action="previous-map"]'===e.selector});if(t>=0)return z=t,void ee()}else if('[data-action="next-map"]'===e.selector){var n=W.findIndex(function(e){return'[data-action="previous-map"]'===e.selector});if(n>=0)return z=n,void ee()}else if('[data-action="previous-map"]'===e.selector){var r=W.findIndex(function(e){return'[data-action="next-map"]'===e.selector});if(r>=0)return z=r,void ee()}for(var o=e.column-1,a=o<0?2:o,i=-1,c=1/0,l=0;l<W.length;l++){var s=W[l];if(s.column===a){var u=Math.abs(s.row-e.row);u<c&&(c=u,i=l)}}i>=0&&(z=i,ee())}();break;case"j":e.preventDefault(),function(){var e=W[z];if(!e)return;if('[data-action="leaderboard"]'===e.selector){var t=W.findIndex(function(e){return'[data-action="play-same-map"]'===e.selector});if(t>=0)return z=t,void ee()}else if('[data-action="play-same-map"]'===e.selector){var n=W.findIndex(function(e){return'[data-action="next-map"]'===e.selector});if(n>=0)return z=n,void ee();var r=W.findIndex(function(e){return'[data-action="back-to-menu"]'===e.selector});if(r>=0)return z=r,void ee()}else if('[data-action="previous-map"]'===e.selector||'[data-action="next-map"]'===e.selector){var o=W.findIndex(function(e){return'[data-action="back-to-menu"]'===e.selector});if(o>=0)return z=o,void ee()}for(var a=-1,i=1/0,c=0;c<W.length;c++){var l=W[c];l.column===e.column&&l.row>e.row&&l.row<i&&(i=l.row,a=c)}a>=0&&(z=a,ee())}();break;case"k":e.preventDefault(),function(){var e=W[z];if(!e)return;if('[data-action="play-same-map"]'===e.selector){var t=W.findIndex(function(e){return'[data-action="leaderboard"]'===e.selector});if(t>=0)return z=t,void ee()}else if('[data-action="next-map"]'===e.selector){var n=W.findIndex(function(e){return'[data-action="play-same-map"]'===e.selector});if(n>=0)return z=n,void ee()}else if('[data-action="previous-map"]'===e.selector){var r=W.findIndex(function(e){return'[data-action="play-same-map"]'===e.selector});if(r>=0)return z=r,void ee()}else if('[data-action="back-to-menu"]'===e.selector){var o=W.findIndex(function(e){return'[data-action="next-map"]'===e.selector});if(o>=0)return z=o,void ee();var a=W.findIndex(function(e){return'[data-action="play-same-map"]'===e.selector});if(a>=0)return z=a,void ee()}for(var i=-1,c=-1,l=0;l<W.length;l++){var s=W[l];s.column===e.column&&s.row<e.row&&s.row>c&&(c=s.row,i=l)}i>=0&&(z=i,ee())}();break;case"l":e.preventDefault(),function(){var e=W[z];if(!e)return;if('[data-action="previous-map"]'===e.selector){var t=W.findIndex(function(e){return'[data-action="next-map"]'===e.selector});if(t>=0)return z=t,void ee()}else if('[data-action="play-same-map"]'===e.selector){var n=W.findIndex(function(e){return'[data-action="next-map"]'===e.selector});if(n>=0)return z=n,void ee()}else if('[data-action="next-map"]'===e.selector){var r=W.findIndex(function(e){return'[data-action="previous-map"]'===e.selector});if(r>=0)return z=r,void ee()}for(var o=e.column+1,a=o>2?0:o,i=-1,c=1/0,l=0;l<W.length;l++){var s=W[l];if(s.column===a){var u=Math.abs(s.row-e.row);u<c&&(c=u,i=l)}}i>=0&&(z=i,ee())}();break;case"enter":e.preventDefault(),function(){var e=$();if(logger.debug("Game completion activating element:",e),!e)return void logger.debug("No element to activate in game completion");try{e.click()}catch(e){logger.debug("Error clicking game completion element:",e)}}();break;case"escape":e.preventDefault();var t=document.querySelector('[data-action="back-to-menu"]');t&&t.click()}}function ee(){logger.debug("Game completion updateCursor called"),te();var e=$();logger.debug("Game completion current element for cursor:",e),e?function(e){if(!e)return;var t=document.createElement("div");t.className="game-completion-vim-cursor",t.textContent="🧋",t.style.cssText="\n    position: fixed;\n    font-size: 20px;\n    z-index: 99999;\n    pointer-events: none;\n    animation: completion-vim-cursor-pulse 1s ease-in-out infinite alternate;\n    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n    background: rgba(255, 165, 0, 0.8);\n    border: 2px solid white;\n    border-radius: 50%;\n    width: 35px;\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n  ";var n=e.getBoundingClientRect();if(t.style.top=n.top-10+"px",t.style.left=n.left-10+"px",document.body.appendChild(t),!document.getElementById("game-completion-vim-cursor-styles")){var r=document.createElement("style");r.id="game-completion-vim-cursor-styles",r.textContent="\n      @keyframes completion-vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(r)}}(e):logger.debug("No element found for game completion cursor")}function te(){document.querySelectorAll(".game-completion-vim-cursor").forEach(function(e){e.remove()}),document.querySelectorAll("[data-original-completion-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-completion-text"),e.removeAttribute("data-original-completion-text")})}function ne(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return re(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(re(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,re(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,re(d,"constructor",s),re(s,"constructor",l),l.displayName="GeneratorFunction",re(s,o,"GeneratorFunction"),re(d),re(d,o,"Generator"),re(d,r,function(){return this}),re(d,"toString",function(){return"[object Generator]"}),(ne=function(){return{w:a,m:p}})()}function re(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}re=function(e,t,n,r){function a(t,n){re(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},re(e,t,n,r)}function oe(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function ae(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){oe(a,r,o,i,c,"next",e)}function c(e){oe(a,r,o,i,c,"throw",e)}i(void 0)})}}function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ce(e){if(null==e)return"N/A";logger.debug("formatTime received:",e,"type:",ie(e));var t=Number(e)/1e3;if(logger.debug("Converted to seconds:",t),t<60)return t.toFixed(2);var n=Math.floor(t/60),r=t-60*n;return"".concat(n,":").concat(r.toFixed(2).padStart(5,"0"))}function le(e,t,n){return se.apply(this,arguments)}function se(){return(se=ae(ne().m(function e(t,n,r){var o,a,i,c,l,s,u,d;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t&&n){e.n=1;break}return e.a(2,{bestTimeInfo:null,isNewRecord:!1});case 1:return e.p=1,e.n=2,fetch("/api/auth/me");case 2:return o=e.v,e.n=3,o.json();case 3:if(a=e.v,i=!1,c=null,!a.success||!a.authenticated){e.n=9;break}return e.p=4,e.n=5,fetch("/api/user/best-time",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t,completion_time:n,final_score:r})});case 5:return l=e.v,e.n=6,l.json();case 6:(s=e.v).success&&(i=s.is_new_record,s.fastest_time&&(c=i?'<p style="margin: 0.8rem 0;"><strong>Previous Best:</strong> '.concat(ce(s.fastest_time),"</p>"):'<p style="margin: 0.8rem 0;"><strong>Your Best:</strong> '.concat(ce(s.fastest_time),"</p>"))),e.n=8;break;case 7:return e.p=7,u=e.v,logger.error("Failed to sync best time with database:",u),e.a(2,ue(t,n));case 8:e.n=10;break;case 9:return e.a(2,ue(t,n));case 10:return e.a(2,{bestTimeInfo:c,isNewRecord:i});case 11:return e.p=11,d=e.v,logger.error("Error checking best time:",d),e.a(2,{bestTimeInfo:null,isNewRecord:!1})}},e,null,[[4,7],[1,11]])}))).apply(this,arguments)}function ue(e,t){try{var n=localStorage.getItem("boba-vim-best-times"),r=n?JSON.parse(n):{},o=r[e],a=!1,i=null;return o?t<o?(r[e]=t,localStorage.setItem("boba-vim-best-times",JSON.stringify(r)),a=!0,i='<p style="margin: 0.8rem 0;"><strong>Previous Best:</strong> '.concat(ce(o),"</p>")):i='<p style="margin: 0.8rem 0;"><strong>Your Best:</strong> '.concat(ce(o),"</p>"):(r[e]=t,localStorage.setItem("boba-vim-best-times",JSON.stringify(r)),a=!0),{bestTimeInfo:i,isNewRecord:a}}catch(e){return logger.error("Error with local best time:",e),{bestTimeInfo:null,isNewRecord:!1}}}function de(e){return pe.apply(this,arguments)}function pe(){return(pe=ae(ne().m(function e(t){var n,r,o,a,i,c,l,s,u,d,p,g,m,f;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(logger.debug("showFailureModal called with result:",t),logger.debug("Total moves from result:",t.total_moves),logger.debug("Total moves type:",ie(t.total_moves)),void 0!==t.total_moves&&null!==t.total_moves){e.n=6;break}return e.p=1,e.n=2,fetch(window.API_ENDPOINTS.GAME_STATE);case 2:if(!(n=e.v).ok){e.n=4;break}return e.n=3,n.json();case 3:(r=e.v).success&&void 0!==r.total_moves&&(t.total_moves=r.total_moves,logger.debug("Fetched total_moves from game state:",t.total_moves));case 4:e.n=6;break;case 5:e.p=5,m=e.v,logger.error("Failed to fetch game state for move count:",m);case 6:return o=t.current_map||null,a=[],logger.debug("Current map info (from result):",o),e.p=7,e.n=8,fetch(window.API_ENDPOINTS.MAPS);case 8:if(!(i=e.v).ok){e.n=10;break}return e.n=9,i.json();case 9:(c=e.v).success&&(a=c.maps);case 10:e.n=12;break;case 11:e.p=11,f=e.v,logger.error("Error fetching maps:",f);case 12:return logger.debug("Available maps:",a),e.n=13,le(null==o?void 0:o.id,t.completion_time,t.final_score||t.current_score||0);case 13:l=e.v,s=l.bestTimeInfo,l.isNewRecord,u=Ge()||t.selected_character||"boba",d="timeout"===t.reason?"Time Limit Exceeded (8 minutes)":"Game Failed",p='\n    <div id="completion-modal" style="'.concat(fe(),'">\n      <div style="').concat(ve(),'">\n        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">\n          ').concat((0,q.jZ)(u),'\n          <h2 style="color: #e74c3c; margin: 0;">Map Failed</h2>\n        </div>\n        <div style="margin: 1.5rem 0;">\n          <p style="margin: 0.8rem 0; color: #e74c3c;"><strong>Reason:</strong> ').concat(d,'</p>\n          <p style="margin: 0.8rem 0;"><strong>Final Score:</strong> ').concat(t.final_score||t.current_score||0,'</p>\n          <p style="margin: 0.8rem 0;"><strong>Total Moves:</strong> ').concat(void 0!==t.total_moves&&null!==t.total_moves?t.total_moves:"--",'</p>\n          <p style="margin: 0.8rem 0;"><strong>Time Survived:</strong> ').concat(t.completion_time?ce(t.completion_time):"--:--","</p>\n          ").concat(s||"",'\n        </div>\n        <div style="').concat(we(),'">\n          ').concat(Fe(o,a),"\n          ").concat(he(E.w.ELEMENT_IDS.BACK_TO_MENU,E.w.BUTTONS.BACK_MENU,E.w.GRADIENTS.BACK_MENU),"\n        </div>\n      </div>\n    </div>\n  "),document.body.insertAdjacentHTML("beforeend",p),setTimeout(function(){J()},100),g=[{id:E.w.ELEMENT_IDS.PLAY_SAME_MAP,text:E.w.BUTTONS.PLAY_SAME_MAP},{id:E.w.ELEMENT_IDS.BACK_TO_MENU,text:E.w.BUTTONS.BACK_MENU}],document.getElementById(E.w.ELEMENT_IDS.PREVIOUS_MAP)&&g.push({id:E.w.ELEMENT_IDS.PREVIOUS_MAP,text:E.w.BUTTONS.PREVIOUS_MAP}),document.getElementById(E.w.ELEMENT_IDS.NEXT_MAP)&&g.push({id:E.w.ELEMENT_IDS.NEXT_MAP,text:E.w.BUTTONS.NEXT_MAP}),Me(g),Ae(o,a,t);case 14:return e.a(2)}},e,null,[[7,11],[1,5]])}))).apply(this,arguments)}function ge(e){return me.apply(this,arguments)}function me(){return(me=ae(ne().m(function e(t){var n,r,o,a,i,c,l,s,u,d,p,g,m,f,v;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(logger.debug("showCompletionModal called with result:",t),logger.debug("Total moves from result:",t.total_moves),logger.debug("Total moves type:",ie(t.total_moves)),void 0!==t.total_moves&&null!==t.total_moves){e.n=6;break}return e.p=1,e.n=2,fetch(window.API_ENDPOINTS.GAME_STATE);case 2:if(!(n=e.v).ok){e.n=4;break}return e.n=3,n.json();case 3:(r=e.v).success&&void 0!==r.total_moves&&(t.total_moves=r.total_moves,logger.debug("Fetched total_moves from game state:",t.total_moves));case 4:e.n=6;break;case 5:e.p=5,m=e.v,logger.error("Failed to fetch game state for move count:",m);case 6:if(!t.current_map||!t.current_map.id){e.n=10;break}return e.p=7,e.n=8,F(t.current_map.id);case 8:logger.debug("Marked map as completed:",t.current_map.id),e.n=10;break;case 9:e.p=9,f=e.v,logger.error("Failed to mark map as completed:",f);case 10:return o=t.current_map||null,a=[],e.p=11,e.n=12,fetch(window.API_ENDPOINTS.MAPS);case 12:if(!(i=e.v).ok){e.n=14;break}return e.n=13,i.json();case 13:(c=e.v).success&&(a=c.maps);case 14:e.n=16;break;case 15:e.p=15,v=e.v,logger.error("Error fetching maps:",v);case 16:return logger.debug("Current map info (from result):",o),logger.debug("Available maps:",a),l=Ge()||t.selected_character||"boba",e.n=17,le(null==o?void 0:o.id,t.completion_time,t.final_score);case 17:s=e.v,u=s.bestTimeInfo,d=s.isNewRecord,p='\n    <div id="'.concat(E.w.ELEMENT_IDS.COMPLETION_MODAL,'" style="').concat(fe(),'">\n      <div style="').concat(ve(),'">\n        <div style="text-align: center; margin-bottom: 1rem;">\n          <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 1rem;">\n            <span style="color: rgba(255,255,255,0.8); font-size: 0.9rem; font-weight: 500;">Add this map to favorite:</span>\n            <button class="favorite-star-completion" style="\n              background: rgba(0,0,0,0.3);\n              border: none;\n              font-size: 24px;\n              cursor: pointer;\n              padding: 8px;\n              border-radius: 50%;\n              width: 45px;\n              height: 45px;\n              display: inline-flex;\n              align-items: center;\n              justify-content: center;\n              transition: transform 0.2s ease;\n              color: rgba(255,255,255,0.6);\n            ">☆</button>\n          </div>\n        </div>\n        <div style="display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1.5rem;">\n          ').concat((0,q.jZ)(l),'\n          <h2 style="color: ').concat(E.w.COLORS.TITLE,'; margin: 0;">').concat(E.w.MESSAGES.COMPLETION_TITLE,'</h2>\n        </div>\n        <div style="margin: 1.5rem 0;">\n          <p style="margin: 0.8rem 0;"><strong>').concat(E.w.MESSAGES.FINAL_SCORE,"</strong> ").concat(t.final_score,'</p>\n          <p style="margin: 0.8rem 0;"><strong>').concat(E.w.MESSAGES.COMPLETION_TIME,"</strong> ").concat(t.completion_time?ce(t.completion_time):E.w.MESSAGES.TIME_FALLBACK,'</p>\n          <p style="margin: 0.8rem 0;"><strong>Total Moves:</strong> ').concat(void 0!==t.total_moves&&null!==t.total_moves?t.total_moves:"--","</p>\n          ").concat(u||"","\n          ").concat(d?'<p style="color: #ffd700; font-weight: bold; margin: 0.8rem 0;">🏆 NEW RECORD! 🏆</p>':"",'\n        </div>\n        <div style="').concat(we(),'">\n          ').concat(he(E.w.ELEMENT_IDS.VIEW_LEADERBOARD,E.w.BUTTONS.LEADERBOARD,E.w.GRADIENTS.LEADERBOARD),"\n          ").concat(Be(o,a),"\n          ").concat(he(E.w.ELEMENT_IDS.BACK_TO_MENU,E.w.BUTTONS.BACK_MENU,E.w.GRADIENTS.BACK_MENU),"\n        </div>\n      </div>\n    </div>\n  "),document.body.insertAdjacentHTML("beforeend",p),setTimeout(function(){J()},100),g=[{id:E.w.ELEMENT_IDS.VIEW_LEADERBOARD,text:E.w.BUTTONS.LEADERBOARD},{id:E.w.ELEMENT_IDS.PLAY_SAME_MAP,text:E.w.BUTTONS.PLAY_SAME_MAP},{id:E.w.ELEMENT_IDS.BACK_TO_MENU,text:E.w.BUTTONS.BACK_MENU}],document.getElementById(E.w.ELEMENT_IDS.PREVIOUS_MAP)&&g.push({id:E.w.ELEMENT_IDS.PREVIOUS_MAP,text:E.w.BUTTONS.PREVIOUS_MAP}),document.getElementById(E.w.ELEMENT_IDS.NEXT_MAP)&&g.push({id:E.w.ELEMENT_IDS.NEXT_MAP,text:E.w.BUTTONS.NEXT_MAP}),Me(g),Ae(o,a,t);case 18:return e.a(2)}},e,null,[[11,15],[7,9],[1,5]])}))).apply(this,arguments)}function fe(){return"\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: ".concat(E.w.COLORS.OVERLAY,";\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: ").concat(E.w.MODAL.Z_INDEX,";\n  ")}function ve(){return"\n    background: ".concat(E.w.COLORS.MODAL_BG,";\n    color: white;\n    padding: 2rem;\n    border-radius: 10px;\n    text-align: center;\n    max-width: 600px;\n    width: 95%;\n    max-height: 85vh;\n    overflow: hidden;\n    box-shadow: ").concat(E.w.SHADOWS.MODAL,";\n    margin-top: 8vh;\n  ")}function we(){return"\n    margin: 2rem 0;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    align-items: center;\n  "}function ye(e){return"viewLeaderboard"===e?"leaderboard":"backToMenu"===e?"menu":"nextMap"===e||"previousMap"===e?"navigation":""}function be(e){return{viewLeaderboard:'data-action="leaderboard"',playSameMap:'data-action="play-same-map"',previousMap:'data-action="previous-map"',nextMap:'data-action="next-map"',backToMenu:'data-action="back-to-menu"'}[e]||""}function he(e,t,n){var r=ye(e),o=be(e);return'<button id="'.concat(e,'" class="eightbit-completion-btn ').concat(r,'" ').concat(o,">").concat(t,"</button>")}function Ee(e,t,n){var r=ye(e),o=be(e);return'<button id="'.concat(e,'" class="eightbit-completion-btn ').concat(r,'" ').concat(o,">").concat(t,"</button>")}function Se(e,t,n){var r=be(e);return'\n    <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">\n      <button id="'.concat(e,'" disabled class="eightbit-completion-btn navigation" ').concat(r,' style="\n        background: #6c757d !important;\n        color: #adb5bd !important;\n        cursor: not-allowed !important;\n        opacity: 0.6;\n      ">').concat(t,'</button>\n      <span style="\n        font-size: 11px;\n        color: #e74c3c;\n        text-align: center;\n        max-width: 200px;\n        line-height: 1.2;\n        font-weight: bold;\n      ">').concat(n,"</span>\n    </div>\n  ")}function Me(e){e.forEach(function(e){var t=e.id,n=e.text,r=document.getElementById(t);if(r){var o=t===E.w.ELEMENT_IDS.PREVIOUS_MAP||t===E.w.ELEMENT_IDS.NEXT_MAP||t===E.w.ELEMENT_IDS.PLAY_SAME_MAP;r.addEventListener("mouseenter",function(){o?(r.style.transform="translateY(-2px) scale(1.03)",r.style.boxShadow="0 8px 25px rgba(0, 0, 0, 0.3), 0 4px 8px rgba(0, 0, 0, 0.15)",r.style.filter="brightness(1.1)"):(r.textContent=E.w.BUTTONS.HOVER_ICON,r.style.transform="translateY(-3px) scale(1.05)")}),r.addEventListener("mouseleave",function(){o?(r.style.transform="translateY(0) scale(1)",r.style.boxShadow="0 4px 15px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1)",r.style.filter="brightness(1)"):(r.textContent=n,r.style.transform="translateY(0) scale(1)")})}})}function Ae(e,t,n){var r=Ge()||n.selected_character||"boba";logger.debug("Current character for navigation:",r),logger.debug("Character from localStorage:",Ge()),logger.debug("Character from result:",n.selected_character);var o=document.querySelector(".favorite-star-completion");o&&e&&(Re(o,e.id),o.addEventListener("click",ae(ne().m(function t(){return ne().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Oe(e.id);case 1:Re(o,e.id);case 2:return t.a(2)}},t)}))));var a=document.getElementById(E.w.ELEMENT_IDS.VIEW_LEADERBOARD);a&&a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),function(e){De.apply(this,arguments)}(e)},{passive:!1});var i=document.getElementById(E.w.ELEMENT_IDS.PLAY_SAME_MAP);i&&i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e?Ue(e.id,r):window.location.href=E.w.NAVIGATION.PLAY_URL},{passive:!1});var c=document.getElementById(E.w.ELEMENT_IDS.PREVIOUS_MAP);c&&c.addEventListener("click",function(n){if(n.preventDefault(),n.stopPropagation(),!c.disabled){var o=function(e,t){if(!e||!t.length)return null;var n=t.findIndex(function(t){return t.id===e.id});if(-1===n)return logger.warn("Current map not found in available maps",e.id),null;var r=n>0?t[n-1]:null;if(r&&(!r.id||r.id<1||r.id>19))return logger.warn("Previous map has invalid ID:",r.id),null;return r}(e,t);o&&B(o.id)&&Ue(o.id,r)}},{passive:!1});var l=document.getElementById(E.w.ELEMENT_IDS.NEXT_MAP);l&&l.addEventListener("click",function(n){if(n.preventDefault(),n.stopPropagation(),!l.disabled){var o=function(e,t){if(!e||!t.length)return null;var n=t.findIndex(function(t){return t.id===e.id});if(-1===n)return logger.warn("Current map not found in available maps",e.id),null;var r=n<t.length-1?t[n+1]:null;if(r&&(!r.id||r.id<1||r.id>19))return logger.warn("Next map has invalid ID:",r.id),null;return r}(e,t);o&&B(o.id)&&Ue(o.id,r)}},{passive:!1});var s=document.getElementById(E.w.ELEMENT_IDS.BACK_TO_MENU);s&&s.addEventListener("click",function(e){window.location.href=E.w.NAVIGATION.MENU_URL})}function Te(){var e=localStorage.getItem("boba-vim-favorites");return e?JSON.parse(e):[]}function _e(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=ae(ne().m(function e(t){var n;return ne().w(function(e){for(;;)switch(e.n){case 0:if((n=Te()).includes(t)){e.n=1;break}return n.push(t),localStorage.setItem("boba-vim-favorites",JSON.stringify(n)),e.n=1,ke(t,"add");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function Le(e){return Pe.apply(this,arguments)}function Pe(){return(Pe=ae(ne().m(function e(t){var n,r;return ne().w(function(e){for(;;)switch(e.n){case 0:if(n=Te(),!((r=n.indexOf(t))>-1)){e.n=1;break}return n.splice(r,1),localStorage.setItem("boba-vim-favorites",JSON.stringify(n)),e.n=1,ke(t,"remove");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function xe(e){return Te().includes(e)}function Oe(e){return Ne.apply(this,arguments)}function Ne(){return(Ne=ae(ne().m(function e(t){return ne().w(function(e){for(;;)switch(e.n){case 0:if(!xe(t)){e.n=2;break}return e.n=1,Le(t);case 1:e.n=3;break;case 2:return e.n=3,_e(t);case 3:return e.a(2)}},e)}))).apply(this,arguments)}function ke(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=ae(ne().m(function e(t,n){var r,o,a;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me");case 1:return r=e.v,e.n=2,r.json();case 2:if((o=e.v).success&&o.authenticated){e.n=3;break}return e.a(2);case 3:if("add"!==n){e.n=5;break}return e.n=4,fetch("/api/user/favorites",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t})});case 4:e.n=6;break;case 5:if("remove"!==n){e.n=6;break}return e.n=6,fetch("/api/user/favorites",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t})});case 6:e.n=8;break;case 7:e.p=7,a=e.v,logger.error("Failed to sync favorite to database:",a);case 8:return e.a(2)}},e,null,[[0,7]])}))).apply(this,arguments)}function Re(e,t){var n=xe(t);e.textContent=n?"★":"☆",e.style.color=n?"rgba(255, 215, 0, 0.9)":"rgba(255, 255, 255, 0.6)"}function De(){return(De=ae(ne().m(function e(t){var n,r;return ne().w(function(e){for(;;)switch(e.n){case 0:return logger.debug("showLeaderboard called for map:",t),Z(),(n=document.getElementById("completionModal"))&&(n.style.display="none"),r=new S.H,e.n=1,r.show({currentMapInfo:t,availableMaps:[],showMapNavigation:!1,showModeToggle:!1,onClose:function(){var e=document.getElementById("completionModal");e&&(e.style.display="flex",setTimeout(function(){J()},100))}});case 1:return e.a(2)}},e)}))).apply(this,arguments)}function Ge(){try{var e=localStorage.getItem("boba_vim_selected_character");if(e&&["boba","pinky","golden","black","boba_diamond"].includes(e))return logger.debug("Loaded character from localStorage: ".concat(e)),e}catch(e){logger.warn("Failed to load character from localStorage:",e)}return null}function Be(e,t){if(logger.debug("getNavigationButtonsOrdered called with:"),logger.debug("- currentMapInfo:",e),logger.debug("- availableMaps:",t),!e||!t.length)return logger.debug("No currentMapInfo or availableMaps, returning only play same map"),'\n      <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%;">\n        '.concat(Ee(E.w.ELEMENT_IDS.PLAY_SAME_MAP,E.w.BUTTONS.PLAY_SAME_MAP,E.w.GRADIENTS.PLAY_SAME_MAP),"\n      </div>\n    ");var n=t.findIndex(function(t){return t.id===e.id});logger.debug("Current map ID:",e.id),logger.debug("Found current map at index:",n),logger.debug("Total available maps:",t.length);var r=Ee(E.w.ELEMENT_IDS.PLAY_SAME_MAP,E.w.BUTTONS.PLAY_SAME_MAP,E.w.GRADIENTS.PLAY_SAME_MAP),o="";if(n>0){var a=t[n-1];if(a){var i=Y(a.id);null!==i?o+=Se(E.w.ELEMENT_IDS.PREVIOUS_MAP,E.w.BUTTONS.PREVIOUS_MAP,i):(logger.debug("Adding Previous Map button (index > 0)"),o+=Ee(E.w.ELEMENT_IDS.PREVIOUS_MAP,E.w.BUTTONS.PREVIOUS_MAP,E.w.GRADIENTS.PREVIOUS_MAP))}}if(n<t.length-1){var c=t[n+1];if(c){var l=Y(c.id);null!==l?o+=Se(E.w.ELEMENT_IDS.NEXT_MAP,E.w.BUTTONS.NEXT_MAP,l):(logger.debug("Adding Next Map button (index < length-1)"),o+=Ee(E.w.ELEMENT_IDS.NEXT_MAP,E.w.BUTTONS.NEXT_MAP,E.w.GRADIENTS.NEXT_MAP))}}var s='\n    <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%;">\n      <div style="display: flex; justify-content: center;">\n        '.concat(r,"\n      </div>\n  ");return o&&(s+='\n      <div style="display: flex; justify-content: center; gap: 20px; align-items: center;">\n        '.concat(o,"\n      </div>\n    ")),s+="</div>",logger.debug("Generated ordered navigation buttons HTML:",s),s}function Fe(e,t){if(logger.debug("getNavigationButtonsOrderedForFailure called with:"),logger.debug("- currentMapInfo:",e),logger.debug("- availableMaps:",t),!e||!t.length)return logger.debug("No currentMapInfo or availableMaps, returning only play same map"),'\n      <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%;">\n        '.concat(Ee(E.w.ELEMENT_IDS.PLAY_SAME_MAP,E.w.BUTTONS.PLAY_SAME_MAP,E.w.GRADIENTS.PLAY_SAME_MAP),"\n      </div>\n    ");var n=t.findIndex(function(t){return t.id===e.id}),r=Ee(E.w.ELEMENT_IDS.PLAY_SAME_MAP,E.w.BUTTONS.PLAY_SAME_MAP,E.w.GRADIENTS.PLAY_SAME_MAP),o="";if(n>0&&(o+=Ee(E.w.ELEMENT_IDS.PREVIOUS_MAP,E.w.BUTTONS.PREVIOUS_MAP,E.w.GRADIENTS.PREVIOUS_MAP)),n<t.length-1){var a=t[n+1];a&&(!(a.id>=7)||L&&P)&&(o+=Ee(E.w.ELEMENT_IDS.NEXT_MAP,E.w.BUTTONS.NEXT_MAP,E.w.GRADIENTS.NEXT_MAP))}var i='\n    <div style="display: flex; flex-direction: column; gap: 15px; align-items: center; width: 100%;">\n      <div style="display: flex; justify-content: center;">\n        '.concat(r,"\n      </div>\n  ");return o&&(i+='\n      <div style="display: flex; justify-content: center; gap: 20px; align-items: center;">\n        '.concat(o,"\n      </div>\n    ")),i+="</div>"}function Ue(e){return je.apply(this,arguments)}function je(){return je=ae(ne().m(function e(t){var n,r,o,a,i,c,l=arguments;return ne().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:"boba",logger.debug("startGameWithMap called with mapId:",t,"character:",n),!(!t||t<1||t>19)){e.n=1;break}return logger.error("Invalid map ID:",t),window.location.href=E.w.NAVIGATION.PLAY_URL,e.a(2);case 1:return n&&""!==n.trim()||(logger.error("Invalid character:",n),n="boba"),e.p=2,logger.debug("Sending request to:",window.API_ENDPOINTS.START_GAME),r=new AbortController,o=setTimeout(function(){return r.abort()},1e4),e.n=3,fetch(window.API_ENDPOINTS.START_GAME,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t,selected_character:n}),signal:r.signal});case 3:if(a=e.v,clearTimeout(o),logger.debug("Response status:",a.status),a.ok){e.n=4;break}throw new Error("HTTP error! status: ".concat(a.status));case 4:return e.n=5,a.json();case 5:i=e.v,logger.debug("Start game result:",i),i.success?(logger.debug("Game started successfully, redirecting to /play"),setTimeout(function(){window.location.href="/play"},100)):(logger.error("Failed to start game:",i.error),"Invalid map ID"===i.error?alert("This map is no longer available. Redirecting to map selection."):alert("Failed to start game: "+i.error),window.location.href=E.w.NAVIGATION.PLAY_URL),e.n=7;break;case 6:e.p=6,c=e.v,logger.error("Error starting game:",c),"AbortError"===c.name?alert("Request timed out. Please check your connection and try again."):alert("Unable to start game. Please try again."),window.location.href=E.w.NAVIGATION.PLAY_URL;case 7:return e.a(2)}},e,null,[[2,6]])})),je.apply(this,arguments)}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=document.querySelector(window.UI_SELECTORS.HEADER_INFO);if(o){switch(o.dataset.originalContent||(o.dataset.originalContent=o.innerHTML),o.className="header-info",o.style.cssText="",r&&o.classList.add("key-instruction"),t){case"blocked":o.classList.add("banner-blocked");break;case"pearl":o.classList.add("banner-pearl");break;case"correct":o.classList.add("banner-correct");break;case"error":o.classList.add("banner-error")}o.innerHTML=e,o.dataset.hasBeenModified="true",n>0&&setTimeout(function(){He()},n)}}function He(){var e=document.querySelector(window.UI_SELECTORS.HEADER_INFO);e&&(e.className="header-info",e.style.cssText="",!e.dataset.hasBeenModified&&e.dataset.originalContent?e.innerHTML=e.dataset.originalContent:e.dataset.hasBeenModified||(e.innerHTML="Pressed : '+' tutorial | Pressed : '-' show map"))}function Ye(e){var t=e.includes("You pressed")||e.includes("BLOCKED")||e.includes("to go");Ve(e,"blocked",0,t)}function qe(e){Ve(e,"pearl",0)}function ze(e){var t=e.includes("You pressed")||e.includes("Press ")||e.includes("to go");Ve(e,"correct",2e3,t)}function Ke(e){var t=e.includes("You pressed")||e.includes("Press ")||e.includes("to go");Ve(e,"error",2e3,t)}function We(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.includes("You pressed")||e.includes("Type number:")||e.includes("Press ")||e.includes("to go");Ve(e,"normal",t,n)}var Xe={basicMovement:{h:100,j:100,k:100,l:100},wordMovement:{w:120,W:120,e:120,E:120,b:120,B:120,ge:120,gE:120},lineMovement:{0:120,$:120,"^":130,g_:130},findChar:{f:125,F:125,t:125,T:125},repeatFind:{";":130,",":130},fileJump:{gg:130,G:130},screenMovement:{H:150,M:150,L:150},paragraphMovement:{"{":160,"}":160,"(":160,")":160},matchMovement:{"%":200},arrowPenalty:{ArrowUp:-50,ArrowDown:-50,ArrowLeft:-50,ArrowRight:-50}};function Je(e){var t=function(e){if(Xe.basicMovement[e])return Xe.basicMovement[e];if(Xe.wordMovement[e])return Xe.wordMovement[e];if(Xe.lineMovement[e])return Xe.lineMovement[e];if(Xe.findChar[e])return Xe.findChar[e];if(Xe.repeatFind[e])return Xe.repeatFind[e];if(Xe.fileJump[e])return Xe.fileJump[e];if(Xe.screenMovement[e])return Xe.screenMovement[e];if(Xe.paragraphMovement[e])return Xe.paragraphMovement[e];if(Xe.matchMovement[e])return Xe.matchMovement[e];if(Xe.arrowPenalty[e])return Xe.arrowPenalty[e];if(e.length>1&&"G"===e[e.length-1]){var t=e.slice(0,-1);if(/^\d+$/.test(t))return Xe.fileJump.G}return e.startsWith("find_char_forward_")?Xe.findChar.f:e.startsWith("find_char_backward_")?Xe.findChar.F:e.startsWith("till_char_forward_")?Xe.findChar.t:e.startsWith("till_char_backward_")?Xe.findChar.T:Xe.basicMovement.h}(e),n=function(e){if(Xe.basicMovement[e])return"Basic Movement";if(Xe.wordMovement[e])return"Word Movement";if(Xe.lineMovement[e])return"Line Movement";if(Xe.findChar[e])return"Find Character";if(Xe.repeatFind[e])return"Repeat Find";if(Xe.fileJump[e])return"File Jump";if(Xe.screenMovement[e])return"Screen Movement";if(Xe.paragraphMovement[e])return"Paragraph Movement";if(Xe.matchMovement[e])return"Match Movement";if(Xe.arrowPenalty[e])return"Arrow Penalty";if(e.length>1&&"G"===e[e.length-1]){var t=e.slice(0,-1);if(/^\d+$/.test(t))return"File Jump"}return e.startsWith("find_char_forward_")||e.startsWith("till_char_forward_")||e.startsWith("find_char_backward_")||e.startsWith("till_char_backward_")?"Find Character":"Basic Movement"}(e);return{score:t,category:n,text:t>0?"+".concat(t):"".concat(t)}}var Ze=n(312);function $e(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return Qe(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Qe(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Qe(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,Qe(d,"constructor",s),Qe(s,"constructor",l),l.displayName="GeneratorFunction",Qe(s,o,"GeneratorFunction"),Qe(d),Qe(d,o,"Generator"),Qe(d,r,function(){return this}),Qe(d,"toString",function(){return"[object Generator]"}),($e=function(){return{w:a,m:p}})()}function Qe(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Qe=function(e,t,n,r){function a(t,n){Qe(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Qe(e,t,n,r)}function et(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function tt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){et(a,r,o,i,c,"next",e)}function c(e){et(a,r,o,i,c,"throw",e)}i(void 0)})}}function nt(e,t){if(window.displayModule.updateGameDisplay(e.game_map),window.displayModule.updateScore(e.score),e.moves_requested&&e.moves_executed&&e.moves_requested>e.moves_executed)if("G"===t){var n=e.moves_requested>1;window.feedbackModule.showMovementFeedback(t,e.moves_requested,n)}else{var r;r=["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"].includes(t)?"".concat(e.moves_executed," NOOB space + h (-").concat(50*e.moves_executed,") - executed ").concat(e.moves_executed,"/").concat(e.moves_requested,", then BLOCKED!"):"You pressed ".concat(t," ").concat(e.moves_requested," times - executed ").concat(e.moves_executed,", then BLOCKED!"),window.gameState.tutorialMode||Ye(r)}e.pearl_collected&&rt(t),e.is_completed&&at(e)}function rt(e){var t=Je(e),n="*** PEARL COLLECTED! *** ".concat(t.text," points (").concat(t.category,")!");logger.debug(n),Ze.R.playPearlCollectedSound(),window.gameState.tutorialMode||function(e){var t=Je(e),n="*** PEARL COLLECTED! *** ".concat(t.text," points (").concat(t.category,")!");qe(n)}(e)}function ot(e,t){if(logger.debug("Move blocked:",e.error),e.game_failed)ct(e);else{var n;if(Ze.R.playBlockedMovementSound(),["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"].includes(t))n=e.moves_requested&&e.moves_requested>1?"".concat(e.moves_requested," NOOB (-").concat(50*e.moves_requested,") - BLOCKED!"):"NOOB (-50) - BLOCKED!";else if(e.moves_requested&&e.moves_requested>1)n="G"===t?"You pressed ".concat(e.moves_requested,"G to go to line ").concat(e.moves_requested," - BLOCKED!"):"You pressed ".concat(t," ").concat(e.moves_requested," times - BLOCKED!");else if(!(n=window.BLOCKED_MESSAGES[t]))if(t.startsWith("find_char_forward_")){var r=t.slice(18);n="FIND CHAR '".concat(r,"' → - BLOCKED! (character not found)")}else if(t.startsWith("find_char_backward_")){var o=t.slice(19);n="FIND CHAR '".concat(o,"' ← - BLOCKED! (character not found)")}else if(t.startsWith("till_char_forward_")){var a=t.slice(18);n="TILL CHAR '".concat(a,"' → - BLOCKED! (character not found)")}else if(t.startsWith("till_char_backward_")){var i=t.slice(19);n="TILL CHAR '".concat(i,"' ← - BLOCKED! (character not found)")}else n="You pressed ".concat(t.toUpperCase()," - BLOCKED!");window.gameState.tutorialMode||function(e){Ye(e)}(n)}}function at(e){logger.debug("Game completed! Final score:",e.final_score),Ze.R.playGameCompleteSound(),window.gameCompleted=!0,window.realTimeUpdatesModule&&window.realTimeUpdatesModule.stopGameStatePolling();var t=document.querySelector(window.UI_SELECTORS.HEADER_INFO);if(t){var n=e.completion_time?"Time: ".concat(ce(e.completion_time)):"Time: --:--";t.innerHTML='<strong style="color: #ffd700; font-size: 1.2em; animation: pulse 1s ease-in-out infinite;">\n      *** GAME COMPLETED! ***<br>\n      Final Score: '.concat(e.final_score," | ").concat(n,"\n    </strong>")}!function(){var e=document.createElement("div");e.id="win-animation-overlay",e.style.cssText="\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.3);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 9999;\n    pointer-events: none;\n  ";var t=document.createElement("div");if(t.id="win-text",t.textContent="BOOOOOOOBBAAAA WIIIN !!!",t.style.cssText="\n    font-family: 'Courier New', monospace;\n    font-size: 3em;\n    font-weight: bold;\n    color: #00ff00;\n    text-shadow: \n      0 0 10px #00ff00,\n      0 0 20px #00ff00,\n      0 0 30px #00ff00,\n      2px 2px 0px #000000,\n      -2px -2px 0px #000000,\n      2px -2px 0px #000000,\n      -2px 2px 0px #000000;\n    animation: blink-win 0.5s infinite, glow-pulse 1s ease-in-out infinite alternate;\n    text-align: center;\n    letter-spacing: 0.1em;\n    transform: scale(1);\n  ",!document.getElementById("win-animation-styles")){var n=document.createElement("style");n.id="win-animation-styles",n.textContent="\n      @keyframes blink-win {\n        0%, 50% { opacity: 1; }\n        51%, 100% { opacity: 0.3; }\n      }\n      @keyframes glow-pulse {\n        0% { \n          transform: scale(1);\n          text-shadow: \n            0 0 10px #00ff00,\n            0 0 20px #00ff00,\n            0 0 30px #00ff00,\n            2px 2px 0px #000000,\n            -2px -2px 0px #000000,\n            2px -2px 0px #000000,\n            -2px 2px 0px #000000;\n        }\n        100% { \n          transform: scale(1.1);\n          text-shadow: \n            0 0 15px #00ff00,\n            0 0 25px #00ff00,\n            0 0 35px #00ff00,\n            0 0 45px #00ff00,\n            2px 2px 0px #000000,\n            -2px -2px 0px #000000,\n            2px -2px 0px #000000,\n            -2px 2px 0px #000000;\n        }\n      }\n    ",document.head.appendChild(n)}e.appendChild(t),document.body.appendChild(e)}(),setTimeout(tt($e().m(function t(){return $e().w(function(t){for(;;)switch(t.n){case 0:return it(),t.n=1,ge(e);case 1:return t.a(2)}},t)})),E.w.TIMING.MODAL_DELAY_MS)}function it(){var e=document.getElementById("win-animation-overlay");e&&e.remove()}function ct(e){logger.debug("Game failed:",e.error,"Reason:",e.reason),"timeout"===e.reason?Ze.R.playTimeoutSound():"pearl_mold_collision"===e.reason&&Ze.R.playMoldCollisionSound(),window.gameCompleted=!0,window.realTimeUpdatesModule&&window.realTimeUpdatesModule.stopGameStatePolling();var t,n=document.querySelector(window.UI_SELECTORS.HEADER_INFO);n&&(t="timeout"===e.reason?"Time Limit Exceeded!":"pearl_mold_collision"===e.reason?"Hit Pearl Mold!":"Game Failed!",n.innerHTML='<strong style="color: #e74c3c; font-size: 1.2em; animation: pulse 1s ease-in-out infinite;">\n      *** '.concat(t," ***<br>\n      Final Score: ").concat(e.final_score||e.current_score||0,"\n    </strong>"));"timeout"===e.reason||("pearl_mold_collision"===e.reason||"*** Game failed: ".concat(e.error," ***")),setTimeout(tt($e().m(function t(){return $e().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,de(e);case 1:return t.a(2)}},t)})),E.w.TIMING.MODAL_DELAY_MS)}var lt=n(147),st={MOVE:"/api/move",GAME_STATE:"/api/game-state",PLAY_TUTORIAL:"/api/playtutorial",PLAY_ONLINE:"/api/playonline",SET_USERNAME:"/api/set-username",LEADERBOARD:"/api/leaderboard",LEADERBOARD_BY_MAP:"/api/leaderboard-by-map",PLAYER_STATS:"/api/player-stats",MAPS:"/api/maps",START_GAME:"/api/start-game",QUIT_GAME:"/api/quit-game"};function ut(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return dt(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(dt(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,dt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,dt(d,"constructor",s),dt(s,"constructor",l),l.displayName="GeneratorFunction",dt(s,o,"GeneratorFunction"),dt(d),dt(d,o,"Generator"),dt(d,r,function(){return this}),dt(d,"toString",function(){return"[object Generator]"}),(ut=function(){return{w:a,m:p}})()}function dt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}dt=function(e,t,n,r){function a(t,n){dt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},dt(e,t,n,r)}function pt(e){return function(e){if(Array.isArray(e))return gt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return gt(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gt(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function gt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function mt(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function ft(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){mt(a,r,o,i,c,"next",e)}function c(e){mt(a,r,o,i,c,"throw",e)}i(void 0)})}}var vt=!1,wt=0,yt=new Set,bt=!1,ht={currentRow:0,currentCol:0,preferredColumn:0,gameMap:[],textGrid:[],isInitialized:!1};function Et(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e||(e=function(){try{var e=document.querySelectorAll(".key");if(0===e.length)return logger.debug("No game keys found in DOM"),null;var t=0,n=0,r={row:0,col:0};e.forEach(function(e){var o=parseInt(e.dataset.row),a=parseInt(e.dataset.col),i=parseInt(e.dataset.map);t=Math.max(t,o),n=Math.max(n,a),1===i&&(r={row:o,col:a})});var o=Array(t+1).fill().map(function(){return Array(n+1).fill(0)}),a=Array(t+1).fill().map(function(){return Array(n+1).fill(" ")});return e.forEach(function(e){var t=parseInt(e.dataset.row),n=parseInt(e.dataset.col),r=parseInt(e.dataset.map),i=e.dataset.letter||" ";o[t][n]=r,a[t][n]=i}),{player_pos:r,game_map:o,text_grid:a}}catch(e){return logger.error("Error extracting initial game state from DOM:",e),null}}()),e?(xt(e),window.displayModule&&window.displayModule.cleanupOrphanedPlayerSprites&&e.game_map&&window.displayModule.cleanupOrphanedPlayerSprites(e.game_map),logger.debug("Client game state initialized successfully"),!0):(logger.debug("Failed to initialize client game state"),!1)}function St(e){return Mt.apply(this,arguments)}function Mt(){return Mt=ft(ut().m(function e(t){var n,r,o,a,i,c,l,s=arguments;return ut().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:1,r=s.length>2&&void 0!==s[2]&&s[2],!window.gameCompleted){e.n=1;break}return logger.debug("Game is completed, movement disabled"),e.a(2);case 1:if(!vt){e.n=2;break}return logger.debug("Move already pending, ignoring"),e.a(2);case 2:if(window.realTimeUpdatesModule&&window.realTimeUpdatesModule.notifyMovementActivity&&window.realTimeUpdatesModule.notifyMovementActivity(),window.responsiveScaling&&window.responsiveScaling.disableScaling&&window.responsiveScaling.disableScaling(),!((o=Date.now())-wt<(n>1?30:50))){e.n=3;break}return e.a(2);case 3:if(vt=!0,wt=o,e.p=4,a=Lt()){e.n=6;break}return logger.debug("Cannot get current game state for prediction, falling back to server-only"),e.n=5,At(t,n,r);case 5:case 8:case 11:return e.a(2,e.v);case 6:if(!(i=(0,lt.Rb)(t,a.currentRow,a.currentCol,a.gameMap,a.textGrid,a.preferredColumn,n,r)).success||!i.finalPosition){e.n=7;break}c="pred_".concat(Date.now(),"_").concat(Math.random()),yt.add(c),Pt(i.finalPosition,a.gameMap),bt=!0,_t(t,n,i,r,c),e.n=9;break;case 7:return logger.debug("Client prediction blocked, checking with server"),e.n=8,At(t,n,r);case 9:e.n=12;break;case 10:return e.p=10,l=e.v,logger.error("Error in movement prediction:",l),e.n=11,At(t,n,r);case 12:return e.p=12,vt=!1,e.f(12);case 13:return e.a(2)}},e,null,[[4,10,12,13]])})),Mt.apply(this,arguments)}function At(e,t,n){return Tt.apply(this,arguments)}function Tt(){return(Tt=ft(ut().m(function e(t,n,r){var o,a,i;return ut().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(st.MOVE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({direction:t,count:n,has_explicit_count:r})});case 1:return o=e.v,e.n=2,o.json();case 2:xt(a=e.v),a.success?nt(a,t):"G"===t?(window.displayModule.updateGameDisplay(a.game_map),window.displayModule.updateScore(a.score),window.feedbackModule.showMovementFeedback(t,n,r)):ot(a,t),e.n=4;break;case 3:e.p=3,i=e.v,logger.error("Error moving player:",i);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function _t(e,t,n,r,o){return It.apply(this,arguments)}function It(){return(It=ft(ut().m(function e(t,n,r,o,a){var i,c,l,s,u,d;return ut().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(st.MOVE,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({direction:t,count:n,has_explicit_count:o})});case 1:return i=e.v,e.n=2,i.json();case 2:if(c=e.v,yt.delete(a),bt){e.n=3;break}return e.a(2);case 3:c.success&&r.success?(l=c.player_pos,s=r.finalPosition,l.row===s.newRow&&l.col===s.newCol||(xt(c),null!==(u=window.displayModule)&&void 0!==u&&u.updateGameDisplay&&window.displayModule.updateGameDisplay(c.game_map)),Ot(c,t)):c.success||(xt(c),c.success?nt(c,t):ot(c,t)),e.n=5;break;case 4:e.p=4,d=e.v,logger.error("Prediction validation error:",d),yt.delete(a);case 5:return e.p=5,bt=!1,e.f(5);case 6:return e.a(2)}},e,null,[[0,4,5,6]])}))).apply(this,arguments)}function Lt(){try{return ht.isInitialized?{currentRow:ht.currentRow,currentCol:ht.currentCol,preferredColumn:ht.preferredColumn,gameMap:ht.gameMap,textGrid:ht.textGrid}:(logger.debug("Client game state not initialized, falling back to server-only movement"),null)}catch(e){return logger.error("Error getting current game state:",e),null}}function Pt(e,t){try{var n;ht.currentRow=e.newRow,ht.currentCol=e.newCol,ht.preferredColumn=e.preferredColumn;for(var r=t.map(function(e){return pt(e)}),o=0;o<r.length;o++)for(var a=0;a<r[o].length;a++)1===r[o][a]&&(r[o][a]=0);r[e.newRow][e.newCol]=1,null===(n=window.displayModule)||void 0===n||n.updateGameDisplay(r)}catch(e){logger.error("Prediction UI update error:",e)}}function xt(e){try{e.player_pos&&(ht.currentRow=e.player_pos.row,ht.currentCol=e.player_pos.col,void 0!==e.preferred_column?ht.preferredColumn=e.preferred_column:ht.isInitialized||(ht.preferredColumn=e.player_pos.col)),e.game_map&&(ht.gameMap=e.game_map.map(function(e){return pt(e)})),e.text_grid?ht.textGrid=e.text_grid.map(function(e){return pt(e)}):e.game_map&&!ht.textGrid.length&&(ht.textGrid=e.game_map.map(function(e){return e.map(function(e){switch(e){case 0:default:return" ";case 1:return"@";case 2:return"#";case 3:return"*"}})})),ht.isInitialized=!0,logger.debug("Client game state initialized/updated:",ht)}catch(e){logger.error("Error updating client game state:",e)}}function Ot(e,t){try{xt(e),window.displayModule&&(void 0!==e.score&&window.displayModule.updateScore(e.score),e.game_map&&window.displayModule.updateGameDisplay(e.game_map)),e.pearl_collected&&(rt(t),window.scoreAnimations&&window.scoreAnimations.showScoreUpdate&&window.scoreAnimations.showScoreUpdate()),e.is_completed&&at(e)}catch(e){logger.error("Error handling server sync success:",e)}}function Nt(){window.gameBanner&&window.gameBanner.resetGameBanner&&window.gameBanner.resetGameBanner()}function kt(){window.gameBanner&&window.gameBanner.resetGameBanner&&window.gameBanner.resetGameBanner()}var Ct=!1;function Rt(){return Ct}function Dt(e){Ct=e}function Gt(){var e=document.querySelectorAll(".boba-character, .pearl, .enemy");return Ct?(e.forEach(function(e){e.style.opacity="1",e.style.transition="opacity 0.3s ease"}),Ct=!1,"Sprites Visible"):(e.forEach(function(e){e.style.opacity="0",e.style.transition="opacity 0.3s ease"}),Ct=!0,"Sprites Hidden")}function Bt(e){Ct?(e.style.opacity="0",e.style.transition="none",e.offsetHeight,e.style.transition="opacity 0.3s ease"):(e.style.opacity="1",e.style.transition="opacity 0.3s ease")}function Ft(){Ct||Gt()}function Ut(){Ct&&Gt()}function jt(){var e=null,t=!0,n=!1,r=null,o=!1,a="",i=!1,c=!1,l=null;document.addEventListener("keydown",function(s){var u,d=s.key;if(c)switch(clearTimeout(l),c=!1,d.toLowerCase()){case"enter":var p=Gt();if(window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback(p,1),window.userPreferencesModule&&window.spriteVisibilityModule){var g=!window.spriteVisibilityModule.areSpritesHidden();window.userPreferencesModule.updatePreference("characterVisible",g)}return void s.preventDefault();case"h":if(window.vimManualModule&&window.vimManualModule.animateHelpText){var m=document.getElementById("helpText");m?(window.vimManualModule.animateHelpText(m),window.tutorialHintsModule&&window.tutorialHintsModule.toggleHint&&window.tutorialHintsModule.toggleHint()):logger.debug("Help text element not found")}else logger.debug("VimManual module not available");return void s.preventDefault();case"m":return window.mapModule&&window.mapModule.handleMapToggle&&window.mapModule.handleMapToggle(),void s.preventDefault();case"t":if(window.tutorialModule&&window.tutorialModule.toggleTutorialMode){window.tutorialModule.toggleTutorialMode();var f=window.gameState.tutorialMode?"ACTIVATED":"DEACTIVATED";window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback("TUTORIAL MODE ".concat(f),1)}return void s.preventDefault();case"n":if(window.lineNumbersModule&&window.lineNumbersModule.toggleLineNumbers){window.relativeLineNumbersModule&&window.relativeLineNumbersModule.areRelativeLineNumbersVisible()&&(window.relativeLineNumbersModule.hideRelativeLineNumbers(),window.userPreferencesModule&&window.userPreferencesModule.updatePreference("relativeLineNumbers",!1));var v=window.lineNumbersModule.toggleLineNumbers();if(window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback(v,1),window.userPreferencesModule){var w=window.lineNumbersModule.areLineNumbersVisible();window.userPreferencesModule.updatePreference("lineNumbers",w)}}return void s.preventDefault();case"r":if(window.relativeLineNumbersModule&&window.relativeLineNumbersModule.toggleRelativeLineNumbers){window.lineNumbersModule&&window.lineNumbersModule.areLineNumbersVisible()&&(window.lineNumbersModule.hideLineNumbers(),window.userPreferencesModule&&window.userPreferencesModule.updatePreference("lineNumbers",!1));var y=window.relativeLineNumbersModule.toggleRelativeLineNumbers();if(window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback(y,1),window.userPreferencesModule){var b=window.relativeLineNumbersModule.areRelativeLineNumbersVisible();window.userPreferencesModule.updatePreference("relativeLineNumbers",b)}}return void s.preventDefault();case" ":if(window.spaceHighlightModule&&window.spaceHighlightModule.toggleSpaceHighlight){var h=window.spaceHighlightModule.toggleSpaceHighlight();if(window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback(h,1),window.userPreferencesModule){var E=window.spaceHighlightModule.isSpaceHighlightActive();window.userPreferencesModule.updatePreference("spaceHighlighting",E)}}return void s.preventDefault();case"f":return window.fullscreenModule&&window.fullscreenModule.toggleFullscreen&&window.fullscreenModule.toggleFullscreen(),void s.preventDefault();default:return void s.preventDefault()}if(" "===d&&!n&&!o)return c=!0,l=setTimeout(function(){c=!1},1e3),void s.preventDefault();if(!n&&!o&&/^[0-9]$/.test(d))return"0"===d&&""===a?(window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(d):window.feedbackModule.showMovementFeedback(d),St(d,1),void s.preventDefault()):(a.length>=4||(a+=d,i=!0,window.feedbackModule&&window.feedbackModule.showNumberPrefix&&window.feedbackModule.showNumberPrefix(a)),void s.preventDefault());if(n)if(1===d.length){var S=(u=d,"".concat({f:"find_char_forward",F:"find_char_backward",t:"till_char_forward",T:"till_char_backward"}[r],"_").concat(u)),M=""===a?1:parseInt(a);n=!1,r=null,Nt();var A=M>1?"".concat(M).concat(S):S;a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(A):window.feedbackModule.showMovementFeedback(A,M),St(S,M),s.preventDefault()}else"Escape"===d&&(n=!1,r=null,Nt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),s.preventDefault());else if(o){if(["Shift","Control","Alt","Meta"].includes(d))return;if("g"===d){var T=""===a?1:parseInt(a),_=T>1?"".concat(T,"gg"):"gg";o=!1,kt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(_):window.feedbackModule.showMovementFeedback(_,T),St("gg",T),s.preventDefault()}else if("_"===d){var I=""===a?1:parseInt(a),L=I>1?"".concat(I,"g_"):"g_";o=!1,kt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(L):window.feedbackModule.showMovementFeedback(L,I),St("g_",I),s.preventDefault()}else if("e"===d){var P=""===a?1:parseInt(a),x=P>1?"".concat(P,"ge"):"ge";o=!1,kt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(x):window.feedbackModule.showMovementFeedback(x,P),St("ge",P),s.preventDefault()}else if("E"===d){var O=""===a?1:parseInt(a),N=O>1?"".concat(O,"gE"):"gE";o=!1,kt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(N):window.feedbackModule.showMovementFeedback(N,O),St("gE",O),s.preventDefault()}else if("Escape"===d)o=!1,kt(),a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),s.preventDefault();else{if(o=!1,kt(),window.gameState.tutorialMode){var k="g".concat(d);window.tutorialModule.handleTutorialMovement(k)}a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix()}}else{if(["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"].includes(d)){if(s.repeat||e===d&&!t)return void s.preventDefault();if(o)return;e=d,t=!1;var C=""===a?1:parseInt(a),R=C>1?"".concat(C).concat(d):d;return a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(R):window.feedbackModule.showMovementFeedback(R,C),St(d,C),void s.preventDefault()}if(window.VALID_MOVEMENT_KEYS.includes(d)){if(s.repeat||e===d&&!t)return void s.preventDefault();if(o)return;if(e=d,t=!1,["f","F","t","T"].includes(d))return n=!0,r=d,window.gameState.tutorialMode||function(e){window.gameBanner&&window.gameBanner.showNormalBanner&&window.gameBanner.showNormalBanner({f:"FIND CHAR → (type character)",F:"FIND CHAR ← (type character)",t:"TILL CHAR → (type character)",T:"TILL CHAR ← (type character)"}[e],0)}(d),void s.preventDefault();if("g"===d)return o=!0,window.gameState.tutorialMode||window.gameBanner&&window.gameBanner.showNormalBanner&&window.gameBanner.showNormalBanner("g-COMMAND (press g, _, e, or E)",0),void s.preventDefault();var D=""===a?1:parseInt(a),G=""!==a,B=D>1?"".concat(D).concat(d):d;a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),window.gameState.tutorialMode?window.tutorialModule.handleTutorialMovement(B):window.feedbackModule.showMovementFeedback(B,D,G),St(d,D,G),s.preventDefault()}"Escape"===d&&i&&(a="",i=!1,window.feedbackModule&&window.feedbackModule.clearNumberPrefix&&window.feedbackModule.clearNumberPrefix(),s.preventDefault())}}),document.addEventListener("keyup",function(n){var r=n.key;window.VALID_MOVEMENT_KEYS.includes(r)&&e===r&&(t=!0)})}function Vt(){}function Ht(){var e=document.getElementById(window.MAP_CONFIG.DISPLAY_ELEMENT_ID);return e&&"none"!==e.style.display&&""!==e.style.display}function Yt(){var e=document.getElementById(window.MAP_CONFIG.DISPLAY_ELEMENT_ID);if(e){var t="none"!==e.style.display&&""!==e.style.display;e.style.display=t?"none":"block"}}function qt(e){}function zt(){Ht();Yt();var e=Ht()?window.MAP_CONFIG.MESSAGES.SHOWN:window.MAP_CONFIG.MESSAGES.HIDDEN,t="".concat(window.MAP_CONFIG.MESSAGES.TOGGLE," | ").concat(e);window.gameState.tutorialMode||We(t,0)}function Kt(){document.addEventListener("keydown",qt)}function Wt(){return Yt()}function Xt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return Jt(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Jt(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Jt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,Jt(d,"constructor",s),Jt(s,"constructor",l),l.displayName="GeneratorFunction",Jt(s,o,"GeneratorFunction"),Jt(d),Jt(d,o,"Generator"),Jt(d,r,function(){return this}),Jt(d,"toString",function(){return"[object Generator]"}),(Xt=function(){return{w:a,m:p}})()}function Jt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Jt=function(e,t,n,r){function a(t,n){Jt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Jt(e,t,n,r)}function Zt(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function $t(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Zt(a,r,o,i,c,"next",e)}function c(e){Zt(a,r,o,i,c,"throw",e)}i(void 0)})}}function Qt(e){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(e)}function en(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,tn(r.key),r)}}function tn(e){var t=function(e,t){if("object"!=Qt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=Qt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==Qt(t)?t:t+""}var nn=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isScaling=!1,this.resizeTimeout=null,this.lastDimensions={width:0,height:0,rows:0,cols:0}},(t=[{key:"applyIntelligentScaling",value:function(){if(!this.isScaling){this.isScaling=!0;try{var e=this.calculateOptimalLayout();e&&this.applyLayout(e)}catch(e){logger.error("Intelligent scaling error:",e)}finally{this.isScaling=!1}}}},{key:"calculateOptimalLayout",value:function(){var e=document.querySelector(".game-board"),t=document.querySelector(".keyboard-map");if(!e||!t)return null;var n=e.getBoundingClientRect(),r=document.body.classList.contains("fullscreen-mode"),o=this.getMapDimensions(t);if(!o)return null;var a,i,c,l,s=o.rows,u=o.cols,d=s*u;d>500?(a=r?30:20,i=60,c=30,l=40):d>200?(a=r?40:30,i=70,c=35,l=60):(a=r?50:40,i=80,c=40,l=30);var p=n.width-2*a-i-c-l,g=n.height-2*a-c;logger.debug("🔍 LAYOUT DEBUG: boardRect=".concat(n.width,"x").concat(n.height,", usableArea=").concat(p,"x").concat(g));var m,f=o.hasEmptyRows,v=this.calculateOptimalGapSize(s,u),w=(p-v*(u-1))/u,y=(g-v*(s-1))/s,b=Math.floor(Math.min(w,y));m=d<100?r?100:80:d<200?r?140:110:d<500?r?180:140:r?140:100;var h=(b=Math.max(8,Math.min(m,b)))*u+v*(u-1),E=b*s+v*(s-1);return h>p&&(logger.debug("🚨 KEYBOARD OVERFLOW PREVENTION: ".concat(h,"px > ").concat(p,"px - Reducing key size")),b=Math.floor((p-v*(u-1))/u),h=(b=Math.max(8,b))*u+v*(u-1),logger.debug("🔧 FIXED KEY SIZE: ".concat(b,"px → total width: ").concat(h,"px"))),logger.debug("🔍 KEY SIZE: ".concat(d," cells (").concat(s,"x").concat(u,") → ").concat(b,"px (total: ").concat(h,"px / ").concat(p,"px available)")),{keySize:b,gapSize:v,totalMapWidth:h,totalMapHeight:E,mapStartX:i+20,targetFirstLetterX:Math.min(.25*n.width,i+50),rows:s,cols:u,complexity:d,hasEmptyRows:f,isFullscreen:r,boardWidth:n.width,usableWidth:p,fontSize:this.calculateOptimalFontSize(b),spriteScale:this.calculateOptimalSpriteScale(b,s,u)}}},{key:"getMapDimensions",value:function(e){var t=e.querySelectorAll(".keyboard-row");if(0===t.length)return null;var n=0,r=!1;return t.forEach(function(e){var t=e.querySelectorAll(".key"),o=t.length;n=Math.max(n,o),(0===o||Array.from(t).every(function(e){var t=e.getAttribute("data-letter");return!t||""===t.trim()}))&&(r=!0)}),{rows:t.length,cols:n,hasEmptyRows:r}}},{key:"calculateOptimalGapSize",value:function(e,t){var n=e*t;return n>1e3?1:n>500?2:n>200?3:4}},{key:"calculateOptimalFontSize",value:function(e){var t=.5*e;return Math.max(8,Math.min(32,t))}},{key:"calculateOptimalSpriteScale",value:function(e,t,n){var r,o=t*n;if(r=o<50?e/80:o<250?e/50:o<500?e/25:e/18,o>1e3)r*=1.4;else if(o>500)r*=1.3;else if(o>200)r*=1.2;else if(o>100)r*=1.1;else if(o<50){var a=r;r*=.6,logger.debug("🔍 TINY MAP SCALE: ".concat(o," cells, baseScale ").concat(a.toFixed(3)," → ").concat(r.toFixed(3)," (multiplier: 0.6)"))}else if(o<150){var i=r;r*=.8,logger.debug("🔍 SMALL MAP SCALE: ".concat(o," cells, baseScale ").concat(i.toFixed(3)," → ").concat(r.toFixed(3)," (multiplier: 0.8)"))}var c,l=window.innerWidth;c=o<250?l>1800?.5:l>1400?.6:1:o<500?l>1800?.6:l>1400?.8:1:l>1800?.8:l>1400?1:1.5;var s=Math.max(.3,Math.min(c,r));return logger.debug("🎮 SPRITE SCALE: ".concat(o," cells → ").concat(s.toFixed(2),"x (keySize: ").concat(e,"px, screen: ").concat(l,"px, maxScale: ").concat(c,")")),s}},{key:"applyLayout",value:function(e){var t=e.keySize,n=e.gapSize,r=e.totalMapWidth,o=(e.mapStartX,e.targetFirstLetterX,e.rows),a=e.cols,i=e.complexity,c=e.fontSize,l=e.spriteScale,s=(e.isFullscreen,e.boardWidth),u=e.usableWidth,d=document.documentElement;d.style.setProperty("--key-size","".concat(t,"px")),d.style.setProperty("--key-gap","".concat(n,"px")),d.style.setProperty("--key-font-size","".concat(c,"px")),d.style.setProperty("--sprite-scale",l),d.style.setProperty("--map-rows",o),d.style.setProperty("--map-cols",a);var p=document.querySelector(".game-board"),g=document.querySelector(".keyboard-map");if(p&&(p.classList.remove("small-map","medium-map","large-map"),i<250?(p.classList.add("small-map"),d.style.setProperty("--sprite-multiplier","0.8"),logger.debug("🔍 SMALL MAP CSS: Applied .small-map class for ".concat(i," cells (").concat(o,"x").concat(a,")")),logger.debug("🔍 SPRITE SCALE DEBUG: --sprite-scale=".concat(d.style.getPropertyValue("--sprite-scale"),", --sprite-multiplier=0.8"))):i<500?(p.classList.add("medium-map"),d.style.setProperty("--sprite-multiplier","0.9"),logger.debug("🔍 MEDIUM MAP CSS: Applied .medium-map class for ".concat(i," cells (").concat(o,"x").concat(a,")")),logger.debug("🔍 SPRITE SCALE DEBUG: --sprite-scale=".concat(d.style.getPropertyValue("--sprite-scale"),", --sprite-multiplier=0.9"))):(p.classList.add("large-map"),d.style.setProperty("--sprite-multiplier","1.05"),logger.debug("🔍 LARGE MAP CSS: Applied .large-map class for ".concat(i," cells (").concat(o,"x").concat(a,")")),logger.debug("🔍 SPRITE SCALE DEBUG: --sprite-scale=".concat(d.style.getPropertyValue("--sprite-scale"),", --sprite-multiplier=1.05")))),p&&g){p.style.paddingLeft="",p.style.paddingRight="",p.style.justifyContent="",p.style.alignItems="center";var m=s-80-200-r;if(i<100)p.style.justifyContent="center",p.style.paddingLeft="".concat(80,"px"),p.style.paddingRight="20px",logger.debug("🎯 SMALL MAP CENTERED: ".concat(i," cells, centered positioning"));else if(m>=50){var f=.25*s,v=Math.max(280,f);p.style.paddingLeft="".concat(v,"px"),p.style.justifyContent="flex-start",logger.debug("✅ LARGE MAP POSITIONED: at ".concat(v,"px (25% area, preventing overflow), ").concat(m,"px space available"))}else r<=s-300-40?(p.style.paddingLeft="".concat(300,"px"),p.style.justifyContent="flex-start",logger.debug("✅ SAFE POSITIONING: at ".concat(300,"px, avoiding manual and overflow"))):(p.style.justifyContent="center",p.style.paddingLeft="".concat(Math.min(80,40),"px"),p.style.paddingRight="40px",logger.debug("⚠️ OVERFLOW PREVENTION: centering with minimal padding"));g.style.maxWidth="".concat(u,"px"),g.style.width="fit-content"}this.updateKeySizes(t,n),this.updateRowWidths(a,t,n),logger.debug("🧠 INTELLIGENT SCALING: ".concat(o,"x").concat(a," → ").concat(t,"px keys, total width: ").concat(r,"px"))}},{key:"updateKeySizes",value:function(e,t){var n=document.querySelector(".keyboard-map");n&&(n.style.gap="".concat(t,"px"),n.querySelectorAll(".key").forEach(function(t){t.style.width="".concat(e,"px"),t.style.height="".concat(e,"px")}),n.querySelectorAll(".keyboard-row").forEach(function(e){e.style.gap="".concat(t,"px")}))}},{key:"updateRowWidths",value:function(e,t,n){var r=document.querySelector(".keyboard-map");if(r){var o=e*t+(e-1)*n;r.querySelectorAll(".keyboard-row").forEach(function(e){e.style.width="".concat(o,"px"),e.style.minWidth="".concat(o,"px")})}}},{key:"needsUpdate",value:function(){var e=document.querySelector(".game-board"),t=document.querySelector(".keyboard-map");if(!e||!t)return!1;var n=e.getBoundingClientRect(),r=this.getMapDimensions(t);return!(!r||n.width===this.lastDimensions.width&&n.height===this.lastDimensions.height&&r.rows===this.lastDimensions.rows&&r.cols===this.lastDimensions.cols||(this.lastDimensions={width:n.width,height:n.height,rows:r.rows,cols:r.cols},0))}},{key:"initialize",value:function(){var e=this;setTimeout(function(){e.applyIntelligentScaling()},100),window.addEventListener("resize",function(){clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(function(){e.needsUpdate()&&e.applyIntelligentScaling()},100)}),window.addEventListener("orientationchange",function(){clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(function(){e.applyIntelligentScaling()},300)}),this.setupMapChangeObserver(),logger.debug("🧠 Intelligent Responsive System initialized")}},{key:"setupMapChangeObserver",value:function(){var e=this,t=document.querySelector(".keyboard-map");t&&new MutationObserver(function(){clearTimeout(e.resizeTimeout),e.resizeTimeout=setTimeout(function(){e.needsUpdate()&&e.applyIntelligentScaling()},50)}).observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-map","data-letter"]})}},{key:"forceUpdate",value:function(){clearTimeout(this.resizeTimeout),this.applyIntelligentScaling()}}])&&en(e.prototype,t),n&&en(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}());function rn(){nn.forceUpdate()}var on=!0;function an(){return on}function cn(e){on=e}var ln={SCALING:{SAFETY_MARGIN:30,MAX_SCALE:1,FULLSCREEN_MAX_SCALE:2,MIN_SCALE:.1,SAFETY_FACTOR:.9},TIMING:{RESIZE_DEBOUNCE_MS:100,INITIAL_DELAY_MS:50,FULLSCREEN_DELAY_MS:150},SELECTORS:{GAME_BOARD:".game-board",KEYBOARD_MAP:".keyboard-map",GAME_CONTAINER:".game-container"},CSS_PROPERTIES:{TRANSITION:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",NO_TRANSITION:"none",FAST_TRANSITION:"transform 0.2s ease-out"},ADAPTIVE_SCALING:{MARGINS:{NORMAL_TOP_BOTTOM:20,NORMAL_SIDES:10,FULLSCREEN_TOP_BOTTOM:30,FULLSCREEN_SIDES:15},KEY_SIZES:{NORMAL:{MASSIVE_MAPS_MIN:25,MASSIVE_MAPS_MAX:70,LARGE_MAPS_MIN:30,LARGE_MAPS_MAX:80,MEDIUM_MAPS_MIN:35,MEDIUM_MAPS_MAX:90,SMALL_MAPS_MIN:35,SMALL_MAPS_MAX:100},FULLSCREEN:{MASSIVE_MAPS_MIN:35,MASSIVE_MAPS_MAX:120,LARGE_MAPS_MIN:40,LARGE_MAPS_MAX:140,MEDIUM_MAPS_MIN:45,MEDIUM_MAPS_MAX:160,SMALL_MAPS_MIN:50,SMALL_MAPS_MAX:180}},GAPS:{MASSIVE_MAPS:1,LARGE_MAPS:2,MEDIUM_MAPS:4,SMALL_MAPS:6},SAFETY_FACTORS:{MASSIVE_MAPS:.85,LARGE_MAPS:.9,MEDIUM_MAPS:.92,SMALL_MAPS:.95,EMERGENCY:.8},COMPLEXITY_THRESHOLDS:{MASSIVE:1500,LARGE:800,MEDIUM:400}}};ln.ADAPTIVE_SCALING.SAFETY_FACTORS.MASSIVE_MAPS=.35,ln.ADAPTIVE_SCALING.SAFETY_FACTORS.LARGE_MAPS=.4,ln.ADAPTIVE_SCALING.SAFETY_FACTORS.MEDIUM_MAPS=.5,ln.ADAPTIVE_SCALING.SAFETY_FACTORS.SMALL_MAPS=.65,ln.ADAPTIVE_SCALING.KEY_SIZES.NORMAL.MASSIVE_MAPS_MAX=70,ln.ADAPTIVE_SCALING.KEY_SIZES.NORMAL.LARGE_MAPS_MAX=80,ln.ADAPTIVE_SCALING.KEY_SIZES.NORMAL.MEDIUM_MAPS_MAX=90,ln.ADAPTIVE_SCALING.KEY_SIZES.NORMAL.SMALL_MAPS_MAX=100,ln.ADAPTIVE_SCALING.KEY_SIZES.FULLSCREEN.MASSIVE_MAPS_MAX=120,ln.ADAPTIVE_SCALING.KEY_SIZES.FULLSCREEN.LARGE_MAPS_MAX=140,ln.ADAPTIVE_SCALING.KEY_SIZES.FULLSCREEN.MEDIUM_MAPS_MAX=160,ln.ADAPTIVE_SCALING.KEY_SIZES.FULLSCREEN.SMALL_MAPS_MAX=180;var sn=!1;function un(){if(!sn){var e=document.querySelector(ln.SELECTORS.GAME_BOARD),t=document.querySelector(ln.SELECTORS.KEYBOARD_MAP);e&&t&&(sn=!0,requestAnimationFrame(function(){requestAnimationFrame(function(){try{!function(e,t){var n=e.getBoundingClientRect(),r=document.body.classList.contains("fullscreen-mode"),o=t.querySelectorAll(".keyboard-row");if(0===o.length)return;var a=o.length,i=0;if(o.forEach(function(e){var t=e.querySelectorAll(".key").length;i=Math.max(i,t)}),54===i&&18===o.length){logger.debug("🎯 BRACKET STORY MAP DETECTED! Using optimal fixed sizing");var c=.7*n.width,l=Math.floor(c/54)-1,s=Math.max(16,Math.min(22,l)),u=document.documentElement;u.style.setProperty("--key-size","".concat(s,"px")),u.style.setProperty("--key-gap","1px"),u.style.setProperty("--key-font-size","".concat(.6*s,"px")),u.style.setProperty("--sprite-scale","0.7");var d=document.querySelector(".game-board");return void(d&&(d.style.paddingLeft="25%",d.style.paddingRight="2%",d.style.justifyContent="flex-start",logger.debug("🎯 BRACKET STORY positioning: 25% from left, keySize: ".concat(s,"px"))))}var p=Array.from(o).filter(function(e){var t=e.querySelectorAll(".key");return 0===t.length||Array.from(t).every(function(e){var t=e.getAttribute("data-letter");return!t||""===t.trim()})}).length;if(p>0&&i>35){logger.debug("🎯 PARAGRAPH MAP DETECTED! ".concat(p," empty rows, ").concat(i," max cols"));var g=.75*n.width,m=Math.floor(g/i)-1,f=Math.max(14,Math.min(20,m)),v=document.documentElement;v.style.setProperty("--key-size","".concat(f,"px")),v.style.setProperty("--key-gap","1px"),v.style.setProperty("--key-font-size","".concat(.6*f,"px")),v.style.setProperty("--sprite-scale","0.6");var w=document.querySelector(".game-board");return void(w&&(w.style.paddingLeft="10%",w.style.paddingRight="2%",w.style.justifyContent="flex-start",logger.debug("🎯 PARAGRAPH MAP positioning: 10% from left, keySize: ".concat(f,"px"))))}var y=ln.ADAPTIVE_SCALING,b=r?y.MARGINS.FULLSCREEN_TOP_BOTTOM:y.MARGINS.NORMAL_TOP_BOTTOM,h=r?y.MARGINS.FULLSCREEN_SIDES:y.MARGINS.NORMAL_SIDES,E=n.width-2*h,S=n.height-2*b;if(E<=0||S<=0)return;var M,A=i,T=a*A;M=T>=1e3?y.GAPS.MASSIVE_MAPS:T>=500?y.GAPS.LARGE_MAPS:T>=200?y.GAPS.MEDIUM_MAPS:y.GAPS.SMALL_MAPS;var _,I,L=E-M*(A-1),P=S-M*(a-1),x=Math.floor(L/A),O=Math.floor(P/a),N=Math.min(x,O),k=A/a;A>=50?(logger.debug("🚨 EXTREMELY WIDE MAP: ".concat(A," letters detected, forcing very tiny keys")),N=Math.min(N,.4*x)):A>=45?(logger.debug("🚨 VERY WIDE MAP: ".concat(A," letters detected, forcing small keys")),N=Math.min(N,.5*x)):k>3||A>30?(logger.debug("🔧 VERY WIDE MAP: ".concat(A," letters (ratio: ").concat(k.toFixed(2),"), forcing width fit")),N=Math.min(N,.6*x)):A>25?(logger.debug("🔧 WIDE MAP: ".concat(A," letters, using aggressive width constraint")),N=Math.min(N,.65*x)):k<.5?(logger.debug("🔧 TALL MAP: ratio: ".concat(k.toFixed(2),", prioritizing height")),N=Math.min(N,.8*O)):A>20?(logger.debug("🔧 MEDIUM WIDE MAP: ".concat(A," letters, prioritizing width")),N=Math.min(N,.75*x)):N=Math.min(N,.9*x,.9*O);var C,R=r?y.KEY_SIZES.FULLSCREEN:y.KEY_SIZES.NORMAL;T>=y.COMPLEXITY_THRESHOLDS.MASSIVE?(_=R.MASSIVE_MAPS_MIN,I=R.MASSIVE_MAPS_MAX):T>=y.COMPLEXITY_THRESHOLDS.LARGE?(_=R.LARGE_MAPS_MIN,I=R.LARGE_MAPS_MAX):T>=y.COMPLEXITY_THRESHOLDS.MEDIUM?(_=R.MEDIUM_MAPS_MIN,I=R.MEDIUM_MAPS_MAX):(_=R.SMALL_MAPS_MIN,I=R.SMALL_MAPS_MAX);C=T>=y.COMPLEXITY_THRESHOLDS.MASSIVE?y.SAFETY_FACTORS.MASSIVE_MAPS:T>=y.COMPLEXITY_THRESHOLDS.LARGE?y.SAFETY_FACTORS.LARGE_MAPS:T>=y.COMPLEXITY_THRESHOLDS.MEDIUM?y.SAFETY_FACTORS.MEDIUM_MAPS:y.SAFETY_FACTORS.SMALL_MAPS;var D=Math.max(_,Math.min(I,N*C));logger.debug("🔍 DEBUG: mapComplexity=".concat(T,", mapRows=").concat(a,", mapCols=").concat(A)),45===T&&5===a&&9===A&&(logger.debug("🎯 HJKL MAP DETECTED! Original finalKeySize: ".concat(D)),D=Math.min(D,60),logger.debug("🎯 HJKL MAP: New finalKeySize: ".concat(D)));var G=D*A+M*(A-1),B=D*a+M*(a-1);if(G>E||B>S){logger.warn("Map overflow detected: ".concat(G,"x").concat(B," > ").concat(E,"x").concat(S));var F,U=E/G,j=S/B;F=A/a>3?.85*U:.9*Math.min(U,j),G=(D=Math.max(_,D*F))*A+M*(A-1),B=D*a+M*(a-1)}if(G>E||B>S){logger.warn("Map still overflows, reducing gaps"),G=D*A+(M=A/a>3&&G>E?0:Math.max(0,M-1))*(A-1),B=D*a+M*(a-1)}if(G>E||B>S){logger.warn("Emergency scaling required");var V=E/G,H=S/B,Y=.85*Math.min(V,H);G=(D=Math.max(.7*_,D*Y))*A+M*(A-1),B=D*a+M*(a-1),logger.debug("Final emergency size: ".concat(D,"px, total: ").concat(G,"x").concat(B))}if(G>E||B>S){logger.error("CRITICAL OVERFLOW: Forcing aggressive key size reduction"),logger.error("Map: ".concat(G,"x").concat(B,", Available: ").concat(E,"x").concat(S));var q=.85,z=.85;(A>25||k>3)&&(q=.7,logger.error("Very wide map detected, using aggressive width safety factor: ".concat(q)));var K=Math.floor((E-M*(A-1))/A*q),W=Math.floor((S-M*(a-1))/a*z);D=Math.min(K,W),D=Math.max(.15*_,D),logger.error("Emergency scaling: width-based=".concat(K,", height-based=").concat(W,", final=").concat(D))}G=D*A+M*(A-1),B=D*a+M*(a-1),logger.debug("🔍 SCALING DEBUG: ".concat(a,"x").concat(A," map (").concat(T," cells)")),logger.debug("🔍 ASPECT RATIO: ".concat((A/a).toFixed(2)," | MAX LETTERS IN ROW: ").concat(A)),logger.debug("🔍 AVAILABLE SPACE: ".concat(E.toFixed(1),"x").concat(S.toFixed(1))),logger.debug("🔍 KEY SIZE: ".concat(D.toFixed(1),"px | GAP: ").concat(M,"px")),logger.debug("Final map size: ".concat(G.toFixed(1),"x").concat(B.toFixed(1)," in ").concat(E,"x").concat(S," available")),(G>E||B>S)&&(logger.error("CRITICAL: Map still overflows after all scaling attempts!"),logger.error("Map: ".concat(G,"x").concat(B,", Available: ").concat(E,"x").concat(S)),logger.error("Aspect ratio: ".concat((A/a).toFixed(2),", Key size: ").concat(D,", Gap: ").concat(M)));dn(t,D,M,r,a,A),function(e,t){var n=document.querySelector(".game-board");if(!n)return;var r=ln.ADAPTIVE_SCALING,o=document.body.classList.contains("fullscreen-mode");o?t>=45?(n.style.paddingLeft="0.5%",n.style.paddingRight="0.5%",logger.debug("🚨 FULLSCREEN - EXTREME MAP: ".concat(t," letters, almost edge (0.5% padding)"))):e>=r.COMPLEXITY_THRESHOLDS.LARGE||t>30?(n.style.paddingLeft="1%",n.style.paddingRight="1%",logger.debug("🔄 FULLSCREEN - VERY LARGE MAP: ".concat(t," letters, far left (1% padding)"))):t>25?(n.style.paddingLeft="2%",n.style.paddingRight="1%",logger.debug("🔄 FULLSCREEN - LARGE MAP: ".concat(t," letters, left (2% padding)"))):t>16?(n.style.paddingLeft="3%",n.style.paddingRight="2%",logger.debug("🔄 FULLSCREEN - MEDIUM LARGE: ".concat(t," letters, left (3% padding)"))):t>12?(n.style.paddingLeft="8%",n.style.paddingRight="3%",logger.debug("🔄 FULLSCREEN - MEDIUM MAP: ".concat(t," letters, moderate left (8% padding)"))):(n.style.paddingLeft="20%",n.style.paddingRight="5%",logger.debug("🔄 FULLSCREEN - SMALL MAP: ".concat(t," letters, 20% from left"))):t>=45?(n.style.paddingLeft="25%",n.style.paddingRight="2%",logger.debug("🚨 NORMAL - EXTREME MAP: ".concat(t," letters, 25% from left (quarter screen)"))):e>=r.COMPLEXITY_THRESHOLDS.LARGE||t>30?(n.style.paddingLeft="1%",n.style.paddingRight="1%",logger.debug("🔄 NORMAL - VERY LARGE MAP: ".concat(t," letters, far left (1% padding)"))):t>25?(n.style.paddingLeft="2%",n.style.paddingRight="2%",logger.debug("🔄 NORMAL - LARGE MAP: ".concat(t," letters, left (2% padding)"))):t>18?(n.style.paddingLeft="5%",n.style.paddingRight="3%",logger.debug("🔄 NORMAL - MEDIUM LARGE: ".concat(t," letters, moderate left (5% padding)"))):t>12?(n.style.paddingLeft="8%",n.style.paddingRight="5%",logger.debug("🔄 NORMAL - MEDIUM MAP: ".concat(t," letters, moderate left (8% padding)"))):(n.style.paddingLeft="",n.style.paddingRight="",n.style.justifyContent="center",logger.debug("🔄 NORMAL - SMALL MAP: ".concat(t," letters, centered (CSS default)")))}(T,A)}(e,t)}catch(e){logger.error("Error in proportional scaling:",e)}finally{sn=!1}})}))}}function dn(e,t,n,r,o,a){e.style.transform="none";var i=document.documentElement;i.style.setProperty("--key-size","".concat(t,"px")),i.style.setProperty("--key-gap","".concat(n,"px"));var c,l,s=.35*t,u=o*a;r?(c=Math.max(14,55/Math.sqrt(u)),l=Math.min(42,160/Math.sqrt(u))):(c=Math.max(12,45/Math.sqrt(u)),l=Math.min(32,120/Math.sqrt(u)));var d=Math.max(c,Math.min(l,s));i.style.setProperty("--key-font-size","".concat(d,"px"));var p=Math.max(.5,Math.min(3,t/50));if(logger.debug("🔍 SPRITE DEBUG: mapComplexity=".concat(u,", mapRows=").concat(o,", mapCols=").concat(a,", spriteScale=").concat(p)),45===u&&5===o&&9===a&&(logger.debug("🎯 HJKL MAP SPRITE DETECTED! Original spriteScale: ".concat(p)),p=.8,logger.debug("🎯 HJKL MAP SPRITE: New spriteScale: ".concat(p))),45!==u||5!==o||9!==a){var g=window.innerWidth,m=g>1400;u>=ln.ADAPTIVE_SCALING.COMPLEXITY_THRESHOLDS.MASSIVE?p*=1.4:u>=ln.ADAPTIVE_SCALING.COMPLEXITY_THRESHOLDS.LARGE?p*=1.3:u>=ln.ADAPTIVE_SCALING.COMPLEXITY_THRESHOLDS.MEDIUM?p*=1.2:m&&u<100?(p*=.7,logger.debug("🖥️ LARGE SCREEN: Reducing character size for small map (".concat(u," cells)"))):p*=1,logger.debug("🎮 HETEROGENEOUS SCALING: mapComplexity=".concat(u,", screenWidth=").concat(g,", final spriteScale=").concat(p))}i.style.setProperty("--sprite-scale",p),e.querySelectorAll(".key").forEach(function(e){e.style.width="".concat(t,"px"),e.style.height="".concat(t,"px")}),e.style.gap="".concat(n,"px"),keyboardRows.forEach(function(e){e.style.gap="".concat(n,"px")}),i.style.setProperty("--map-rows",o),i.style.setProperty("--map-cols",a),i.style.setProperty("--map-complexity",u),keyboardRows.forEach(function(e){e.style.width="calc(".concat(a," * (").concat(t,"px + ").concat(n,"px) - ").concat(n,"px)"),e.style.minWidth=e.style.width}),window.paragraphModule&&window.paragraphModule.updateParagraphSeparationAfterMapChange&&window.paragraphModule.updateParagraphSeparationAfterMapChange(),window.lineNumbersModule&&window.lineNumbersModule.updateLineNumbersScaling&&window.lineNumbersModule.updateLineNumbersScaling(),window.relativeLineNumbersModule&&window.relativeLineNumbersModule.updateRelativeLineNumbersScaling&&window.relativeLineNumbersModule.updateRelativeLineNumbersScaling(),e.style.alignItems="flex-start"}function pn(){var e=document.documentElement;e.style.setProperty("--key-size","50px"),e.style.setProperty("--key-gap","4px"),e.style.setProperty("--key-font-size","1.2rem"),e.style.setProperty("--sprite-scale","1"),e.style.setProperty("--sprite-multiplier","1.05")}function gn(){cn(!1);var e=document.querySelector(ln.SELECTORS.KEYBOARD_MAP);if(e){e.style.transition="none";var t=e.style.transform;e.style.transform=t}}function mn(){cn(!0);var e=document.querySelector(ln.SELECTORS.KEYBOARD_MAP);e&&(e.style.transition=ln.CSS_PROPERTIES.TRANSITION),un()}function fn(){logger.debug("🧠 Initializing Intelligent Responsive Scaling System"),nn.initialize()}function vn(){nn.forceUpdate()}function wn(){rn()}function yn(){rn()}function bn(){rn()}var hn=0,En=!1,Sn=null,Mn=[],An={terms:[{selector:".close-button",column:0,row:0,type:"close"}],loveLetter:[{selector:".letter-header .close-btn.retro-btn",column:0,row:0,type:"close"},{selector:".letter-footer .close-btn.secondary",column:0,row:1,type:"button"}],manual:{"page-1":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#showKeymapBtn",column:0,row:1,type:"button"}],"page-2":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#showMotionsBtn",column:0,row:1,type:"button"}],"page-3":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#toScoreAttributionBtn",column:0,row:1,type:"button"}],"page-4":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#backToCommandsBtn",column:0,row:1,type:"button"},{selector:"#backToConfigBtn",column:0,row:2,type:"button"}]}};function Tn(e){switch(e){case"terms":return document.getElementById("termsModal");case"loveLetter":return document.getElementById("loveLetterModal");case"manual":return document.getElementById("vimManualModal");default:return null}}function _n(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Mn=[],t="manual"===e&&n?An.manual[n]||An.manual["page-1"]:An[e]){var r=Tn(e);logger.debug("Modal container for search:",r),t.forEach(function(t){logger.debug("Modal: Processing navigation element with selector: ".concat(t.selector));var n=document.querySelector(t.selector);if(!n&&r&&(n=r.querySelector(t.selector),logger.debug("Modal: Trying modal-scoped search for ".concat(t.selector,":"),n?"FOUND":"NOT FOUND")),logger.debug("Modal: Looking for element with selector: ".concat(t.selector),n?"FOUND":"NOT FOUND"),n)logger.debug("Modal: Element found:",n),logger.debug("Modal: Element classes:",n.className),logger.debug("Modal: Element content:",n.textContent),logger.debug("Modal: Element onclick:",n.onclick),logger.debug("Modal: Element parent:",n.parentElement);else if(logger.debug("Modal: Element NOT FOUND with selector: ".concat(t.selector)),"terms"===e){var o=document.querySelectorAll("button");logger.debug("T&C: All buttons in document:",Array.from(o).map(function(e){return{className:e.className,content:e.textContent,onclick:e.onclick?"has onclick":"no onclick",id:e.id}}));var a=document.querySelectorAll('[class*="close"]');logger.debug("T&C: All elements with 'close' in class:",Array.from(a).map(function(e){return{tagName:e.tagName,className:e.className,content:e.textContent,id:e.id}}))}n&&function(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect(),r="none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden");return logger.debug("Modal: Visibility check for ".concat(e.className,":"),{display:t.display,visibility:t.visibility,opacity:t.opacity,width:n.width,height:n.height,disabled:e.hasAttribute("disabled"),hiddenClass:e.classList.contains("hidden"),result:r}),r}catch(e){return logger.debug("Modal: Error checking visibility:",e),!1}}(n)?(Mn.push(t),logger.debug("Modal: Added element ".concat(t.selector," to navigation"))):n?logger.debug("Modal: Element ".concat(t.selector," found but not visible")):logger.debug("Modal: Element ".concat(t.selector," not found at all"))}),logger.debug("Available modal elements:",Mn.length)}else logger.warn("Unknown modal type:",e)}function In(){for(var e=0;e<Mn.length;e++){if("close"===Mn[e].type)return e}return 0}function Ln(){if(hn<0||hn>=Mn.length)return null;var e=Mn[hn];if(!e)return null;try{return document.querySelector(e.selector)}catch(e){return null}}function Pn(e){if(En&&(Tn(Sn)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable))switch(e.key.toLowerCase()){case"h":case"l":e.preventDefault();break;case"j":e.preventDefault(),function(){if(Mn.length<=1)return;hn=hn<Mn.length-1?hn+1:0,xn(),Nn()}();break;case"k":e.preventDefault(),function(){if(Mn.length<=1)return;hn=hn>0?hn-1:Mn.length-1,xn(),Nn()}();break;case"enter":e.preventDefault(),function(){var e=Ln();if(logger.debug("Modal activating element:",e),!e)return void logger.debug("No element to activate in modal");try{e.click()}catch(e){logger.debug("Error clicking modal element:",e)}}();break;case"escape":e.preventDefault(),function(){var e=Mn.find(function(e){return"close"===e.type});if(e){var t=document.querySelector(e.selector);t&&t.click()}}()}}function xn(){logger.debug("Modal updateCursor called"),On();var e=Ln();logger.debug("Modal current element for cursor:",e),e?function(e){if(!e)return;var t=document.createElement("div");t.className="modal-vim-cursor",t.textContent="🧋",t.style.cssText="\n    position: fixed;\n    font-size: 20px;\n    z-index: 99999;\n    pointer-events: none;\n    animation: modal-vim-cursor-pulse 1s ease-in-out infinite alternate;\n    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n    background: rgba(255, 165, 0, 0.8);\n    border: 2px solid white;\n    border-radius: 50%;\n    width: 35px;\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n  ";var n=e.getBoundingClientRect(),r=-10,o=-10;("closeManual"===e.id||e.classList.contains("retro-close-btn"))&&(r=-5,o=-5);if(t.style.top=n.top+r+"px",t.style.left=n.left+o+"px",document.body.appendChild(t),!document.getElementById("modal-vim-cursor-styles")){var a=document.createElement("style");a.id="modal-vim-cursor-styles",a.textContent="\n      @keyframes modal-vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(a)}}(e):logger.debug("No element found for modal cursor")}function On(){document.querySelectorAll(".modal-vim-cursor").forEach(function(e){e.remove()}),document.querySelectorAll("[data-original-modal-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-modal-text"),e.removeAttribute("data-original-modal-text")})}function Nn(){var e=Ln();if(e){var t=e.getBoundingClientRect(),n=window.innerHeight,r=window.innerWidth;(t.top<0||t.bottom>n||t.left<0||t.right>r)&&(logger.debug("Modal: Element is out of view, scrolling into view"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}))}}function kn(e,t,n){logger.debug("Opening retro vim manual book"),e.classList.remove("hidden"),!(!window.hideCursor||!window.disableVimNavigation)?(window.hideCursor(),window.disableVimNavigation(),logger.debug("Main vim navigation disabled for manual")):logger.debug("Manual opened in game mode - no vim navigation to disable"),setTimeout(function(){t&&t.classList.add("open"),Rn("page-1"),setTimeout(function(){!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;logger.debug("=== INITIALIZING MODAL VIM ==="),logger.debug("Modal type:",e,t?"page: ".concat(t):"");var n=Tn(e);if(logger.debug("Modal element:",n),n){var r=window.getComputedStyle(n);if(logger.debug("Modal display:",r.display),logger.debug("Modal visibility:",r.visibility),"terms"===e){logger.debug("=== T&C MODAL SPECIAL DEBUG ===");var o=document.querySelector(".close-button"),a=n.querySelector(".close-button");logger.debug("Global .close-button search:",o),logger.debug("Modal .close-button search:",a),logger.debug("Modal innerHTML preview:",n.innerHTML.substring(0,500))}Sn=e,t&&t,_n(e,t),hn=In(),En=!0,logger.debug("Modal vim starting at element index: ".concat(hn)),logger.debug("Available elements:",Mn),xn(),document.addEventListener("keydown",Pn),logger.debug("=== MODAL VIM NAVIGATION INITIALIZED ===")}else logger.warn("No modal found for modal vim navigation")}("manual","page-1"),setTimeout(function(){En&&Sn&&xn()},300)},200)},300)}function Cn(e,t){logger.debug("Closing retro vim manual book"),En=!1,On(),document.removeEventListener("keydown",Pn),Sn=null,logger.debug("Modal vim navigation disabled"),t&&t.classList.remove("open"),!(!window.showCursor||!window.enableVimNavigation)?(window.showCursor(),window.enableVimNavigation(),logger.debug("Main vim navigation re-enabled for manual")):logger.debug("Manual closed in game mode - no vim navigation to re-enable"),setTimeout(function(){e.classList.add("hidden"),Rn("page-1")},600)}function Rn(e){logger.debug("Showing page: ".concat(e)),document.querySelectorAll(".book-page").forEach(function(e){e.classList.remove("active"),e.classList.add("hidden")});var t=document.querySelector(".".concat(e));t&&setTimeout(function(){var n;t.classList.remove("hidden"),t.classList.add("active"),n=e,"manual"===Sn&&En&&(_n("manual",n),hn=In(),setTimeout(function(){xn()},250),logger.debug("Modal vim updated for page:",n))},200)}var Dn=!1;function Gn(e){logger.debug("Changing header message (space+h key)"),e.textContent="READ THE FUCKING MANUAL 😡",Bn()}function Bn(){var e=document.getElementById("instructionsBook");if(e){Fn(),Dn=!0;var t=document.createElement("style");t.id="book-animation-style",t.textContent="\n    @keyframes bookPulse {\n      0% { \n        transform: scale(1);\n        filter: drop-shadow(0 0 5px #FFD700);\n      }\n      50% { \n        transform: scale(1.3);\n        filter: drop-shadow(0 0 15px #FFD700) drop-shadow(0 0 25px #FFD700);\n      }\n      100% { \n        transform: scale(1);\n        filter: drop-shadow(0 0 5px #FFD700);\n      }\n    }\n    \n    .book-pulsing {\n      animation: bookPulse 1.5s ease-in-out infinite;\n      color: #FFD700 !important;\n    }\n  ",document.head.appendChild(t),e.classList.add("book-pulsing")}else logger.warn("Book icon not found")}function Fn(){var e=document.getElementById("instructionsBook"),t=document.getElementById("book-animation-style");e&&(e.classList.remove("book-pulsing"),e.style.transform="",e.style.filter="",e.style.color=""),t&&t.remove(),Dn=!1}function Un(){return Dn}function jn(){if(window.IS_MULTIPLAYER)logger.debug("Skipping vim manual initialization - multiplayer mode detected");else{var e=!(!window.hideCursor||!window.disableVimNavigation);logger.debug("Initializing retro vim manual book...",{isIndexPage:e});var t={bookIcon:document.getElementById("instructionsBook"),modal:document.getElementById("vimManualModal"),closeBtn:document.getElementById("closeManual"),helpText:document.getElementById("helpText"),bookContent:document.querySelector(".book-content"),bookCover:document.querySelector(".book-cover")},n=t.bookIcon,r=t.modal,o=t.closeBtn,a=t.bookContent;n&&r&&o?(n.addEventListener("click",function(){Fn(),kn(r,a)}),o.addEventListener("click",function(){return Cn(r,a)}),r.addEventListener("click",function(e){e.target===r&&(logger.debug("Closing retro vim manual (clicked outside)"),Cn(r,a))}),function(){var e=document.getElementById("showKeymapBtn");e&&e.addEventListener("click",function(){logger.debug("Showing keymap guide"),Rn("page-2")});var t=document.getElementById("showMotionsBtn");t&&t.addEventListener("click",function(){logger.debug("Showing vim motions"),Rn("page-3")});var n=document.getElementById("backToConfigBtn");n&&n.addEventListener("click",function(){logger.debug("Going back to config"),Rn("page-2")});var r=document.getElementById("toScoreAttributionBtn");r&&r.addEventListener("click",function(){logger.debug("Going to score attribution"),Rn("page-4")});var o=document.getElementById("backToCommandsBtn");o&&o.addEventListener("click",function(){logger.debug("Going back to commands"),Rn("page-3")})}(),document.addEventListener("keydown",function(e){return function(e,t,n){"Escape"!==e.key||t.classList.contains("hidden")||(logger.debug("Closing retro vim manual (escape key)"),Cn(t,n))}(e,r,a)}),logger.debug("Retro vim manual book initialized successfully")):logger.warn("Vim manual elements not found")}}var Vn=0,Hn=!1,Yn=[],qn=[{selector:"#resumeGameBtn",column:0,row:0,type:"button",action:"resume"},{selector:"#restartGameBtn",column:0,row:1,type:"button",action:"restart"},{selector:"#exitToMenuBtn",column:0,row:2,type:"button",action:"exit"}];function zn(){logger.debug("Initializing pause menu vim navigation..."),Yn=[],logger.debug("Updating available elements for pause menu"),qn.forEach(function(e){var t=document.querySelector(e.selector);logger.debug("Looking for element with selector: ".concat(e.selector),t?"FOUND":"NOT FOUND"),t&&function(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden")}catch(e){return logger.debug("Pause menu: Error checking visibility:",e),!1}}(t)&&(Yn.push(e),logger.debug("Added element ".concat(e.selector," to navigation")))}),logger.debug("Available pause menu elements:",Yn.length),Vn=1,Hn=!0,logger.debug("Pause menu vim starting at element index: ".concat(Vn)),Xn(),document.addEventListener("keydown",Wn,!0),logger.debug("Pause menu vim navigation initialized")}function Kn(){if(Vn<0||Vn>=Yn.length)return null;var e=Yn[Vn];if(!e)return null;try{return document.querySelector(e.selector)}catch(e){return null}}function Wn(e){if(Hn){var t=document.getElementById("pauseMenuModal");if(t&&!t.classList.contains("hidden")){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable)switch(logger.debug("Pause menu: Key pressed:",e.key),e.key.toLowerCase()){case"j":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),function(){if(Yn.length<=1)return;Vn=Vn<Yn.length-1?Vn+1:0,Xn(),logger.debug("Pause menu: Moved down to index ".concat(Vn))}();break;case"k":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),function(){if(Yn.length<=1)return;Vn=Vn>0?Vn-1:Yn.length-1,Xn(),logger.debug("Pause menu: Moved up to index ".concat(Vn))}();break;case"enter":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),function(){var e=Kn(),t=Yn[Vn];if(!e||!t)return void logger.debug("Pause menu: No element to activate");switch(logger.debug("Pause menu: Activating element:",t.action),t.action){case"resume":Zn();break;case"restart":logger.debug("Pause menu: Restarting game"),window.pauseMenuSystem&&window.pauseMenuSystem.restartGame&&window.pauseMenuSystem.restartGame();break;case"exit":logger.debug("Pause menu: Exiting to menu"),window.pauseMenuSystem&&window.pauseMenuSystem.exitToMenu&&window.pauseMenuSystem.exitToMenu();break;default:e.click()}}();break;case"escape":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),Zn();break;case"h":case"l":e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}}else logger.debug("Pause menu: Key ignored - modal not visible")}}function Xn(){logger.debug("Pause menu: updateCursor called"),Jn();var e=Kn();logger.debug("Pause menu: Current element for cursor:",e),e?e.classList.add("vim-selected"):logger.debug("No element found for pause menu cursor")}function Jn(){document.querySelectorAll(".pause-btn").forEach(function(e){e.classList.remove("vim-selected")})}function Zn(){logger.debug("Pause menu: Resuming game"),window.pauseMenuSystem&&window.pauseMenuSystem.resumeGame&&window.pauseMenuSystem.resumeGame()}function $n(e){return $n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$n(e)}function Qn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return er(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(er(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,er(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,er(d,"constructor",s),er(s,"constructor",l),l.displayName="GeneratorFunction",er(s,o,"GeneratorFunction"),er(d),er(d,o,"Generator"),er(d,r,function(){return this}),er(d,"toString",function(){return"[object Generator]"}),(Qn=function(){return{w:a,m:p}})()}function er(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}er=function(e,t,n,r){function a(t,n){er(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},er(e,t,n,r)}function tr(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function nr(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){tr(a,r,o,i,c,"next",e)}function c(e){tr(a,r,o,i,c,"throw",e)}i(void 0)})}}function rr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,or(r.key),r)}}function or(e){var t=function(e,t){if("object"!=$n(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=$n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==$n(t)?t:t+""}const ar=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isPaused=!1,this.pauseStartTime=null,this.totalPausedTime=0,this.gameStartTime=null,this.currentMapId=null,this.originalKeyHandlers=new Map,this.isInitialized=!1},t=[{key:"initialize",value:function(){this.isInitialized||(logger.debug("Initializing pause menu system"),window.pauseMenuSystem=this,document.addEventListener("keydown",this.handleEscapeKey.bind(this),!0),this.setupPauseMenuButtons(),this.storeCurrentMapInfo(),this.isInitialized=!0,logger.debug("Pause menu system initialized"))}},{key:"storeCurrentMapInfo",value:function(){var e=document.querySelector(".game-board");e&&e.dataset.mapId?this.currentMapId=e.dataset.mapId:window.gameState&&window.gameState.currentMap?this.currentMapId=window.gameState.currentMap:window.currentMapId&&(this.currentMapId=window.currentMapId),logger.debug("Stored current map ID:",this.currentMapId)}},{key:"handleEscapeKey",value:function(e){if(logger.debug("Escape key pressed, event key:",e.key,"isPaused:",this.isPaused),"Escape"===e.key&&!this.isPaused){var t=document.getElementById("pauseMenuModal");logger.debug("Found pause modal:",!!t);var n=document.querySelector(".modal:not(#pauseMenuModal):not(.hidden)")||document.querySelector(".vim-manual-modal:not(.hidden)");if(logger.debug("Is in other modal:",!!n),n)return void logger.debug("Not showing pause menu - in other modal");e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),logger.debug("About to show pause menu"),this.showPauseMenu()}}},{key:"setupPauseMenuButtons",value:function(){var e=this,t=document.getElementById("resumeGameBtn"),n=document.getElementById("restartGameBtn"),r=document.getElementById("exitToMenuBtn");t&&t.addEventListener("click",function(){return e.resumeGame()}),n&&n.addEventListener("click",function(){return e.restartGame()}),r&&r.addEventListener("click",function(){return e.exitToMenu()})}},{key:"showPauseMenu",value:(l=nr(Qn().m(function e(){var t;return Qn().w(function(e){for(;;)switch(e.n){case 0:if(!this.isPaused){e.n=1;break}return logger.debug("Already paused, returning"),e.a(2);case 1:return logger.debug("Showing pause menu"),this.isPaused=!0,this.pauseStartTime=Date.now(),e.n=2,this.pauseGameState();case 2:this.disableGameControls(),t=document.getElementById("pauseMenuModal"),logger.debug("Pause modal element:",t),logger.debug("Pause modal classes before:",t?t.className:"null"),t?(t.classList.remove("hidden"),logger.debug("Pause modal classes after:",t.className),logger.debug("Pause modal computed style display:",window.getComputedStyle(t).display),setTimeout(function(){zn()},100)):logger.error("Pause modal not found in DOM!"),this.pauseGameTimers(),logger.debug("Pause menu shown, game paused");case 3:return e.a(2)}},e,this)})),function(){return l.apply(this,arguments)})},{key:"pauseGameState",value:(c=nr(Qn().m(function e(){var t;return Qn().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/pause-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pauseTime:Date.now()})});case 1:logger.debug("Game state paused on backend"),e.n=3;break;case 2:e.p=2,t=e.v,logger.warn("Failed to pause game on backend:",t);case 3:return e.a(2)}},e,null,[[0,2]])})),function(){return c.apply(this,arguments)})},{key:"resumeGameState",value:(i=nr(Qn().m(function e(){var t,n;return Qn().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=this.pauseStartTime?Date.now()-this.pauseStartTime:0,this.totalPausedTime+=t,e.n=1,fetch("/api/resume-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({resumeTime:Date.now(),pauseDuration:t,totalPausedTime:this.totalPausedTime})});case 1:logger.debug("Game state resumed on backend"),e.n=3;break;case 2:e.p=2,n=e.v,logger.warn("Failed to resume game on backend:",n);case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return i.apply(this,arguments)})},{key:"disableGameControls",value:function(){var e=document.querySelector(".game-container");e&&(e.style.pointerEvents="none");var t=document.createElement("div");t.id="game-pause-overlay",t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      z-index: 9999;\n      pointer-events: none;\n    ",document.body.appendChild(t)}},{key:"enableGameControls",value:function(){var e=document.querySelector(".game-container");e&&(e.style.pointerEvents="");var t=document.getElementById("game-pause-overlay");t&&t.remove()}},{key:"pauseGameTimers",value:function(){window.gameTimers&&window.gameTimers.forEach(function(e){e.pause&&e.pause()}),document.querySelectorAll(".game-container *").forEach(function(e){e.style.animationPlayState="paused"})}},{key:"resumeGameTimers",value:function(){window.gameTimers&&window.gameTimers.forEach(function(e){e.resume&&e.resume()}),document.querySelectorAll(".game-container *").forEach(function(e){e.style.animationPlayState=""})}},{key:"hidePauseMenu",value:function(){var e=document.getElementById("pauseMenuModal");e&&e.classList.add("hidden"),Hn=!1,Jn(),document.removeEventListener("keydown",Wn,!0),logger.debug("Pause menu vim navigation disabled")}},{key:"resumeGame",value:(a=nr(Qn().m(function e(){return Qn().w(function(e){for(;;)switch(e.n){case 0:if(this.isPaused){e.n=1;break}return e.a(2);case 1:return logger.debug("Resuming game"),this.hidePauseMenu(),e.n=2,this.resumeGameState();case 2:this.enableGameControls(),this.resumeGameTimers(),this.isPaused=!1,this.pauseStartTime=null,logger.debug("Game resumed");case 3:return e.a(2)}},e,this)})),function(){return a.apply(this,arguments)})},{key:"restartGame",value:(o=nr(Qn().m(function e(){var t;return Qn().w(function(e){for(;;)switch(e.p=e.n){case 0:return logger.debug("Restarting game"),this.hidePauseMenu(),e.p=1,e.n=2,fetch("/api/restart-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mapId:this.currentMapId})});case 2:e.v.ok||logger.error("Failed to restart game on backend"),window.location.reload(),e.n=4;break;case 3:e.p=3,t=e.v,logger.error("Error restarting game:",t),window.location.reload();case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return o.apply(this,arguments)})},{key:"exitToMenu",value:(r=nr(Qn().m(function e(){var t;return Qn().w(function(e){for(;;)switch(e.p=e.n){case 0:return logger.debug("Exiting to menu"),this.hidePauseMenu(),e.p=1,e.n=2,fetch("/api/quit-game",{method:"POST",headers:{"Content-Type":"application/json"}});case 2:window.location.href="/",e.n=4;break;case 3:e.p=3,t=e.v,logger.error("Error quitting game:",t),window.location.href="/";case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return r.apply(this,arguments)})},{key:"cleanup",value:function(){this.hidePauseMenu(),this.enableGameControls(),this.isInitialized&&document.removeEventListener("keydown",this.handleEscapeKey.bind(this),!0),this.isPaused=!1,this.pauseStartTime=null,this.totalPausedTime=0,this.isInitialized=!1,logger.debug("Pause menu system cleaned up")}},{key:"getIsPaused",value:function(){return this.isPaused}},{key:"getTotalPausedTime",value:function(){return this.totalPausedTime}}],t&&rr(e.prototype,t),n&&rr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o,a,i,c,l}());var ir=null;function cr(){return ir}function lr(e,t){var n="normal";t===window.TUTORIAL_CONFIG.COLORS.CORRECT?n="correct":t===window.TUTORIAL_CONFIG.COLORS.WRONG&&(n="error");var r=e.includes("Press ")||e.includes("to go")||e.includes("You pressed");Ve(e,n,0,r)}function sr(){if(window.gameState.tutorialMode){var e=Math.floor(Math.random()*window.TUTORIAL_COMMANDS.length),t=window.TUTORIAL_COMMANDS[e];!function(e){ir=e}(t),lr(t.message,window.TUTORIAL_CONFIG.COLORS.INSTRUCTION)}}function ur(e){var t=cr();if(t)if(e.startsWith("find_char_")||e.startsWith("till_char_")){var n=e.includes("find_char_forward")?"f":e.includes("find_char_backward")?"F":e.includes("till_char_forward")?"t":e.includes("till_char_backward")?"T":null;n&&n===t.key?dr():pr(n||e)}else["gg","ge","gE","g_"].includes(e),e===t.key?dr():pr(e)}function dr(){var e=cr();lr("✓ CORRECT! ".concat(e.message),window.TUTORIAL_CONFIG.COLORS.CORRECT),setTimeout(function(){sr()},window.TUTORIAL_CONFIG.TIMINGS.NEXT_COMMAND_DELAY)}function pr(e){var t=cr();window.TUTORIAL_COMMANDS.find(function(t){return t.key===e})&&(lr("✗ Wrong! Expected: ".concat(t.message),window.TUTORIAL_CONFIG.COLORS.WRONG),setTimeout(function(){lr(t.message,window.TUTORIAL_CONFIG.COLORS.INSTRUCTION)},window.TUTORIAL_CONFIG.TIMINGS.WRONG_ANSWER_DISPLAY))}function gr(){window.gameState.tutorialMode=!window.gameState.tutorialMode,window.gameState.tutorialMode?(lr(window.TUTORIAL_CONFIG.MESSAGES.ACTIVATED,window.TUTORIAL_CONFIG.COLORS.ACTIVATED),setTimeout(function(){sr()},window.TUTORIAL_CONFIG.TIMINGS.ACTIVATION_DELAY)):(ir=null,lr(window.TUTORIAL_CONFIG.MESSAGES.DEACTIVATED,window.TUTORIAL_CONFIG.COLORS.ACTIVATED),setTimeout(function(){He()},2e3))}var mr={find_char_forward_:{label:"FIND CHAR",arrow:"→"},find_char_backward_:{label:"FIND CHAR",arrow:"←"},till_char_forward_:{label:"TILL CHAR",arrow:"→"},till_char_backward_:{label:"TILL CHAR",arrow:"←"}};function fr(e){for(var t in mr)if(e.startsWith(t)){var n=mr[t],r=n.label,o=n.arrow,a=e.slice(t.length);return"".concat(r," '").concat(a,"' ").concat(o)}return"You pressed ".concat(e||"(unknown key)")}function vr(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o="0"===e?"0":e.replace(/^\d+/,"");if(["ArrowLeft","ArrowDown","ArrowUp","ArrowRight"].includes(o))t=n>1?"".concat(n," NOOB space + h (-").concat(50*n,")"):"NOOB space + h (-50)";else if("G"===o)t=r?"You pressed ".concat(n,"G to go to line ").concat(n):window.MOVEMENT_MESSAGES&&window.MOVEMENT_MESSAGES[o]?window.MOVEMENT_MESSAGES[o]:fr(o);else if(n>1){var a=window.MOVEMENT_MESSAGES&&window.MOVEMENT_MESSAGES[o]?window.MOVEMENT_MESSAGES[o]:fr(o);t="".concat(a," (").concat(n," times)")}else t=window.MOVEMENT_MESSAGES&&window.MOVEMENT_MESSAGES[o]?window.MOVEMENT_MESSAGES[o]:fr(o);We(t,0)}function wr(e){We("Type number: ".concat(e),0)}function yr(){He()}function br(){He()}var hr=n(275);function Er(e,t){if(t===hr.e.MAP_VALUES.BOBA){var n=function(){var e=document.createElement("div");e.className=hr.e.CSS_CLASSES.BOBA_CHARACTER;var t=window.selectedCharacter||"boba",n=(0,q.o$)(t);return e.innerHTML='\n    <div class="'.concat(hr.e.CSS_CLASSES.BOBA_SHADOW,'"></div>\n    <img src="').concat(n,'" alt="').concat(t,' Boba" class="').concat(hr.e.CSS_CLASSES.BOBA_SPRITE,'">\n  '),e}();Bt(n),e.appendChild(n)}else if(t===hr.e.MAP_VALUES.ENEMY){var r=((l=document.createElement("div")).className=hr.e.CSS_CLASSES.ENEMY,l.innerHTML='\n    <div class="'.concat(hr.e.CSS_CLASSES.ENEMY_SHADOW,'"></div>\n    <img src="').concat(hr.e.SPRITES.ENEMY,'" alt="Enemy" class="').concat(hr.e.CSS_CLASSES.ENEMY_SPRITE,'">\n  '),l);Bt(r),e.appendChild(r)}else if(t===hr.e.MAP_VALUES.PEARL){var o=((c=document.createElement("div")).className=hr.e.CSS_CLASSES.PEARL,c.innerHTML='\n    <div class="'.concat(hr.e.CSS_CLASSES.PEARL_SHADOW,'"></div>\n    <img src="').concat(hr.e.SPRITES.PEARL,'" alt="Pearl" class="').concat(hr.e.CSS_CLASSES.PEARL_SPRITE,'">\n  '),c);Bt(o),e.appendChild(o)}else if(t===hr.e.MAP_VALUES.PEARL_MOLD){var a=((i=document.createElement("div")).className=hr.e.CSS_CLASSES.PEARL_MOLD,i.innerHTML='\n    <div class="'.concat(hr.e.CSS_CLASSES.PEARL_MOLD_SHADOW,'"></div>\n    <img src="').concat(hr.e.SPRITES.PEARL_MOLD,'" alt="Pearl Mold" class="').concat(hr.e.CSS_CLASSES.PEARL_MOLD_SPRITE,'">\n  '),i);Bt(a),e.appendChild(a)}var i,c,l}function Sr(e){for(var t=-1,n=-1,r=0;r<e.length;r++){for(var o=0;o<e[r].length;o++)if(e[r][o]===hr.e.MAP_VALUES.BOBA){t=r,n=o;break}if(-1!==t)break}document.querySelectorAll(".key").forEach(function(e){var r=parseInt(e.dataset.row),o=parseInt(e.dataset.col),a=e.querySelector(".key-top");if(a){var i=a.querySelectorAll(".boba-character");if(i.length>0&&(r!==t||o!==n)&&(logger.debug("Removing orphaned player sprite at (".concat(r,", ").concat(o,"), player should be at (").concat(t,", ").concat(n,")")),i.forEach(function(e){return e.remove()})),i.length>1){logger.debug("Removing ".concat(i.length-1," duplicate player sprites at (").concat(r,", ").concat(o,")"));for(var c=1;c<i.length;c++)i[c].remove()}}})}var Mr=!1;function Ar(){return Mr}function Tr(e){Mr=e}function _r(){var e=document.querySelector(".keyboard-map");if(e){var t=e.querySelectorAll('.key[data-letter=" "]');logger.debug("Found ".concat(t.length," space characters to highlight")),t.forEach(function(e){var t=e.querySelector(".key-top");t&&(t.classList.add("space-highlighted"),t.style.setProperty("--space-background","linear-gradient(145deg, #868e96, #6c757d)"),t.style.setProperty("--space-border","#495057"),t.style.setProperty("--space-shadow","\n        0 6px 0 #343a40,\n        0 8px 12px rgba(0, 0, 0, 0.4),\n        inset 0 2px 0 rgba(255, 255, 255, 0.3),\n        inset 0 -2px 0 rgba(0, 0, 0, 0.2)\n      "),e.setAttribute("data-space-highlighted","true"))}),Tr(!0)}else logger.debug("Keyboard map container not found")}function Ir(){var e=document.querySelector(".keyboard-map");if(e){var t=e.querySelectorAll('[data-space-highlighted="true"]');logger.debug("Removing highlight from ".concat(t.length," space characters")),t.forEach(function(e){var t=e.querySelector(".key-top");t&&(t.classList.remove("space-highlighted"),t.style.removeProperty("--space-background"),t.style.removeProperty("--space-border"),t.style.removeProperty("--space-shadow")),e.removeAttribute("data-space-highlighted")}),Tr(!1)}}function Lr(e,t){var n=parseInt(e.getAttribute("data-row")),r=parseInt(e.getAttribute("data-col")),o=parseInt(e.getAttribute("data-map")),a=t[n][r];if(o!==a){e.setAttribute("data-map",a);var i=e.querySelector(hr.e.CSS_CLASSES.KEY_TOP);!function(e){e.querySelectorAll(hr.e.SELECTORS.GAME_ELEMENTS).forEach(function(e){e.remove()})}(i),requestAnimationFrame(function(){var t,o;a===hr.e.MAP_VALUES.BOBA&&(t=n,o=r,document.querySelectorAll(".key").forEach(function(e){var n=parseInt(e.getAttribute("data-row")),r=parseInt(e.getAttribute("data-col"));if(n!==t||r!==o){var a=e.querySelector(hr.e.CSS_CLASSES.KEY_TOP);a&&a.querySelectorAll(".boba-character").forEach(function(e){return e.remove()})}}),document.dispatchEvent(new CustomEvent("playerMoved",{detail:{row:n,col:r}}))),Er(i,a),function(e){if(Ar()){var t=e.querySelector(".key-top");t&&" "===e.getAttribute("data-letter")&&(t.style.setProperty("--space-background","linear-gradient(145deg, #868e96, #6c757d)"),t.style.setProperty("--space-border","#495057"),t.style.setProperty("--space-shadow","\n    0 6px 0 #343a40,\n    0 8px 12px rgba(0, 0, 0, 0.4),\n    inset 0 2px 0 rgba(255, 255, 255, 0.3),\n    inset 0 -2px 0 rgba(0, 0, 0, 0.2)\n  "))}}(e)})}}function Pr(e){var t=document.getElementById(window.UI_SELECTORS.SCORE_ELEMENT.replace("#",""));t&&(t.textContent=e,t.style.color="#4ecdc4",t.style.transform="scale(1.2)",setTimeout(function(){t.style.color="#333",t.style.transform="scale(1)"},window.FEEDBACK_CONFIG.ANIMATION_DURATION))}var xr=0;function Or(e){document.querySelectorAll(window.UI_SELECTORS.GAME_KEYS).forEach(function(t){Lr(t,e)}),++xr>=5&&(Sr(e),xr=0)}var Nr=!1,kr=[];function Cr(e){Nr=e}function Rr(){return kr}function Dr(){var e=document.querySelector(".keyboard-map");if(e){var t=e.querySelectorAll(".keyboard-row");t.length?(Gr(),logger.debug("Found ".concat(t.length," keyboard rows for line numbering")),t.forEach(function(e,t){var n=document.createElement("div");n.className="line-number",n.textContent=(t+1).toString();var r,o=document.documentElement,a=parseFloat(o.style.getPropertyValue("--key-font-size"))||14,i=parseFloat(o.style.getPropertyValue("--key-size"))||50,c=Math.max(8,.85*a),l=Math.max(25,.7*i),s=Math.max(2,.08*i),u=Math.max(2,.08*i),d=Math.max(12,.4*i);n.style.cssText="\n      position: absolute;\n      left: -".concat(l,"px;\n      top: 50%;\n      transform: translateY(-50%);\n      color: #FFD700;\n      font-family: 'Courier New', monospace;\n      font-size: ").concat(c,"px;\n      font-weight: bold;\n      background: rgba(0,0,0,0.8);\n      padding: ").concat(s,"px ").concat(s+2,"px;\n      border-radius: ").concat(u,"px;\n      min-width: ").concat(d,"px;\n      text-align: center;\n      user-select: none;\n      z-index: 100;\n      border: 1px solid #FFD700;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n      white-space: nowrap;\n    "),"static"===getComputedStyle(e).position&&(e.style.position="relative"),e.appendChild(n),r=n,kr.push(r)}),Cr(!0),logger.debug("Added ".concat(Rr().length," line numbers to keyboard rows"))):logger.debug("No keyboard rows found")}else logger.debug("Keyboard map container not found")}function Gr(){Rr().forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),kr=[],Cr(!1)}function Br(){return Nr}function Fr(){Br()&&(Rr().length>0&&Dr())}function Ur(){return Br()?(Gr(),"Line numbers HIDDEN"):(Dr(),"Line numbers SHOWN")}function jr(){Br()&&Dr()}function Vr(){window.addEventListener("resize",jr)}var Hr=!1,Yr=[];function qr(e){Hr=e}function zr(){return Yr}function Kr(){var e=document.querySelector(".keyboard-map");if(e){var t=e.querySelectorAll(".keyboard-row");if(t.length){Wr();var n=function(){var e=document.querySelector(".keyboard-map");if(!e)return null;var t=e.querySelector('[data-map="1"]');return t?{row:parseInt(t.getAttribute("data-row")),col:parseInt(t.getAttribute("data-col"))}:null}(),r=n?n.row:0;logger.debug("Found ".concat(t.length," keyboard rows for relative line numbering, player at row ").concat(r)),t.forEach(function(e,t){var n=document.createElement("div");n.className="relative-line-number";var o=Math.abs(t-r);n.textContent=0===o?(t+1).toString():o.toString();var a,i=document.documentElement,c=parseFloat(i.style.getPropertyValue("--key-font-size"))||14,l=parseFloat(i.style.getPropertyValue("--key-size"))||50,s=Math.max(8,.85*c),u=Math.max(25,.7*l),d=Math.max(2,.08*l),p=Math.max(2,.08*l),g=Math.max(12,.4*l),m=0===o?"rgba(255, 215, 0, 0.9)":"rgba(0, 100, 0, 0.8)",f=0===o?"#000":"#90EE90",v=0===o?"#FFD700":"#90EE90";n.style.cssText="\n      position: absolute;\n      left: -".concat(u,"px;\n      top: 50%;\n      transform: translateY(-50%);\n      color: ").concat(f,";\n      font-family: 'Courier New', monospace;\n      font-size: ").concat(s,"px;\n      font-weight: bold;\n      background: ").concat(m,";\n      padding: ").concat(d,"px ").concat(d+2,"px;\n      border-radius: ").concat(p,"px;\n      min-width: ").concat(g,"px;\n      text-align: center;\n      user-select: none;\n      z-index: 100;\n      border: 1px solid ").concat(v,";\n      box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n      white-space: nowrap;\n    "),"static"===getComputedStyle(e).position&&(e.style.position="relative"),e.appendChild(n),a=n,Yr.push(a)}),qr(!0),logger.debug("Added ".concat(zr().length," relative line numbers to keyboard rows"))}else logger.debug("No keyboard rows found")}else logger.debug("Keyboard map container not found")}function Wr(){zr().forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),Yr=[],qr(!1)}function Xr(){return Hr}function Jr(){Xr()&&(zr().length>0&&Kr())}function Zr(){return Xr()?(Wr(),"Relative line numbers HIDDEN"):(Kr(),"Relative line numbers SHOWN")}function $r(){Xr()&&Kr()}function Qr(){window.addEventListener("resize",$r),document.addEventListener("playerMoved",eo),logger.debug("Relative line numbers module initialized")}function eo(){Xr()&&Kr()}function to(){return Ar()?(Ir(),"Space highlighting HIDDEN"):(_r(),"Space highlighting SHOWN")}function no(){Ar()&&_r()}function ro(){var e=document.createElement("style");e.id="space-highlight-style",e.textContent='\n    /* Space highlighting for empty spaces */\n    .key[data-space-highlighted="true"] .key-top {\n      background: var(--space-background) !important;\n      border-color: var(--space-border) !important;\n      box-shadow: var(--space-shadow) !important;\n    }\n    \n    /* Player on space characters - keep grey background with orange border */\n    .key[data-map="1"][data-space-highlighted="true"] .key-top {\n      background: linear-gradient(145deg, #868e96, #6c757d) !important;\n      border-color: #ff6b35 !important;\n      box-shadow: \n        0 6px 0 #e55100,\n        0 8px 12px rgba(0, 0, 0, 0.3),\n        inset 0 2px 0 rgba(255, 255, 255, 0.3),\n        inset 0 -2px 0 rgba(0, 0, 0, 0.2),\n        0 0 20px rgba(255, 107, 53, 0.8) !important;\n    }\n    \n    /* Pearl on space characters - keep grey background with blue border */\n    .key[data-map="3"][data-space-highlighted="true"] .key-top {\n      background: linear-gradient(145deg, #868e96, #6c757d) !important;\n      border-color: #2196f3 !important;\n      box-shadow: \n        0 6px 0 #1976d2,\n        0 8px 12px rgba(0, 0, 0, 0.3),\n        inset 0 2px 0 rgba(255, 255, 255, 0.3),\n        inset 0 -2px 0 rgba(0, 0, 0, 0.2),\n        0 0 15px rgba(33, 150, 243, 0.5) !important;\n    }\n    \n    /* Enemy on space characters - keep grey background with red border */\n    .key[data-map="2"][data-space-highlighted="true"] .key-top {\n      background: linear-gradient(145deg, #868e96, #6c757d) !important;\n      border-color: #f44336 !important;\n      box-shadow: \n        0 6px 0 #d32f2f,\n        0 8px 12px rgba(0, 0, 0, 0.3),\n        inset 0 2px 0 rgba(255, 255, 255, 0.3),\n        inset 0 -2px 0 rgba(0, 0, 0, 0.2),\n        0 0 20px rgba(244, 67, 54, 0.8) !important;\n    }\n    \n    /* Pearl mold on space characters - keep grey background with green border */\n    .key[data-map="4"][data-space-highlighted="true"] .key-top {\n      background: linear-gradient(145deg, #868e96, #6c757d) !important;\n      border-color: #4caf50 !important;\n      box-shadow: \n        0 6px 0 #388e3c,\n        0 8px 12px rgba(0, 0, 0, 0.3),\n        inset 0 2px 0 rgba(255, 255, 255, 0.3),\n        inset 0 -2px 0 rgba(0, 0, 0, 0.2),\n        0 0 15px rgba(76, 175, 80, 0.8) !important;\n    }\n  ',document.head.appendChild(e),window.addEventListener("resize",no)}var oo=!1;function ao(){oo?co():io()}function io(){var e=document.querySelector(".game-container"),t=document.body;e&&t&&(t.classList.add("fullscreen-mode"),[".game-header"].forEach(function(e){var t=document.querySelector(e);t&&(t.style.display="none")}),setTimeout(function(){window.intelligentScaling?window.intelligentScaling.forceUpdate():window.responsiveScaling&&window.responsiveScaling.triggerScaling?window.responsiveScaling.triggerScaling():window.responsiveScaling&&window.responsiveScaling.applyScaling&&window.responsiveScaling.applyScaling()},150),window.userPreferencesModule&&window.userPreferencesModule.updatePreference("fullscreen",!0),window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback("Fullscreen mode ENABLED",1),oo=!0)}function co(){var e=document.body;e&&(e.classList.remove("fullscreen-mode"),[{selector:".game-header",display:"flex"}].forEach(function(e){var t=e.selector,n=e.display,r=document.querySelector(t);r&&(r.style.display=n)}),setTimeout(function(){window.intelligentScaling?window.intelligentScaling.forceUpdate():window.responsiveScaling&&window.responsiveScaling.triggerScaling?window.responsiveScaling.triggerScaling():window.responsiveScaling&&window.responsiveScaling.applyScaling&&window.responsiveScaling.applyScaling()},150),window.userPreferencesModule&&window.userPreferencesModule.updatePreference("fullscreen",!1),window.feedbackModule&&window.feedbackModule.showMovementFeedback&&window.feedbackModule.showMovementFeedback("Fullscreen mode DISABLED",1),oo=!1)}function lo(){return oo}function so(){window.userPreferencesModule&&(window.userPreferencesModule.getUserPreferences().fullscreen||!1?io():co())}function uo(e){return uo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},uo(e)}function po(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function go(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?po(Object(n),!0).forEach(function(t){mo(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):po(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function mo(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=uo(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=uo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==uo(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fo="boba-vim-preferences",vo={lineNumbers:!1,relativeLineNumbers:!1,characterVisible:!0,spaceHighlighting:!1,fullscreen:!1};function wo(){try{var e=localStorage.getItem(fo);if(e){var t=JSON.parse(e);return go(go({},vo),t)}}catch(e){logger.error("Error loading user preferences:",e)}return go({},vo)}function yo(e){try{localStorage.setItem(fo,JSON.stringify(e)),logger.debug("User preferences saved:",e)}catch(e){logger.error("Error saving user preferences:",e)}}function bo(e,t){var n=wo();return n[e]=t,yo(n),n}function ho(e){var t=wo();return t[e]=!t[e],yo(t),t[e]}function Eo(){try{return localStorage.removeItem(fo),logger.debug("User preferences cleared"),go({},vo)}catch(e){return logger.error("Error clearing user preferences:",e),go({},vo)}}function So(){var e=wo();return logger.debug("Applying saved preferences:",e),e.lineNumbers&&window.lineNumbersModule&&window.lineNumbersModule.showLineNumbers(),e.relativeLineNumbers&&window.relativeLineNumbersModule&&window.relativeLineNumbersModule.showRelativeLineNumbers(),e.characterVisible||window.spriteVisibilityModule&&window.spriteVisibilityModule.hideSprites&&window.spriteVisibilityModule.hideSprites(),e.spaceHighlighting&&window.spaceHighlightModule&&window.spaceHighlightModule.showSpaceHighlight(),e.fullscreen&&window.fullscreenModule&&window.fullscreenModule.applyFullscreenPreference(),e}var Mo={1:["Well, well, well... Hello, son. I'm Uncle Boba — but call me Uncle. Before teaching noobs like you Vim, I had a peaceful life as a senior developer. Sadly, those damn LLMs replaced me, and now I'm stuck here helping noobs like you. I wrote a very useful manual you can read about Vim, by the way.","Listen, son — use the h, j, k, l keys to move around. h = left, j = down, k = up, l = right. And for the love of Dijkstra, avoid those arrow keys! For the next map, comeback to me, i have more tips for you. ","Ok, listen, noob— I mean, son, pardon me. The more tapioca pearls you collect, the more boba we can produce in our factory. So, when your score increases with each boba, and you reach a certain amount, we’ll let you off and you can rest. Back in my day, we didn’t have fancy IDEs. We had Vim, and we LIKED it! Repeat after me: we LIKED IT!"],2:["Oh, I'm surprised you're still here. You want me to teach you how to quit Vim, or are you actually serious about learning?!","Use `w` to jump to the next word, `b` to go back, `e` to go to the end of a word. Try capital `W`, `B`, and `E` for bigger jumps! There's a difference between `w` and `W`, just like there's a difference between... oops, I forgot, son.","I used to train senior developers at Google. Now I'm stuck teaching noobs. What kind of Boba deserves that?!"],3:["Time for search motions, grasshopper! 🥋","Let's learn search motion — target your character and reload with `;` and `,`! Search motion works only on the same line. Forward sometimes, backward others. f...f...f...","I bet those fancy AI assistants can't... ah no, they can. You know, son, maybe you should quit Vim and enjoy life."],4:["Woah, you're the first player I've seen reach this level. I have to admire you — you're a crazy guy like me who never gives up. I like it, son!","A sentence ends with `.`, `?`, or `!` (find the odd one out — hint: one of these doesn't belong in proper sentences).","These days, kids just ask ChatGPT to write their comments. In my time, we wrote self-documenting code AND proper sentences — and that was marvelous. MARVELOUS!"],5:["Plot twist time! This one's gonna blow your mind!","Here's something totally worth knowing if you haven't figured it out: a number before your keymap will make it go on steroids! Try `3j` or `5w`!","That's right! Multipliers, son. You're exceptional!"],6:["Alright kiddo, Uncle Boba's gotta bounce... for some boba cheeks 🧋","Maybe read the manual now? I can't be here for you all the time, you know? Be an adult! Oh, and press Ctrl+T for random practice tutorials. Now I gotta see if I’ve got something more interesting to do.","It's been real — you made it! Ok son, hope to see you in Boba.vim 2!"],10:["Woh, as i see some people are on strike now. Ok listen son, boba_stop is not so bad, they just block you the access but they will not kill you.","Just continue working and don't listening to them to much, ok son ?","Remember son, strikes come and go, but your vim skills are forever! Keep moving around those boba_stop protesters and collect those pearls!"],14:["woah NOW be careful, boba mold is really killing people.","Listen son, if you meet one you just die. So please don't play around with boba mold, we don't want them.","These pearl molds are deadly, son! Stay away from them at all costs. One touch and it's game over - no second chances, no mercy. Now go out there and show those containers who's boss!"]},Ao=["Hey noob. Son perdon you know your score decreasing ? No panic uncle boba is here to get you better at this game.","Listen carefully, son! You're using those arrow keys too much - they're costing you 50 points each! Use h, j, k, l instead. Remember: h = left, j = down, k = up, l = right. Trust me, I've been coding since before you were born!","Now stop being a noob and start playing like a real vim user! Remember: every arrow key press makes Uncle Boba cry a single tear... and that's 50 points down the drain!"];function To(e){var t=Mo[e];return Array.isArray(t)?t:["💡 No hint available for this map."]}var _o=null,Io=null,Lo=null;function Po(){return _o}function xo(e){_o=e}function Oo(){return Io}function No(e){Io=e}function ko(e){0}function Co(){return Lo}function Ro(e){Lo=e}function Do(e){var t=document.createElement("div");t.id="tutorial-hint-container",t.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: 20px;\n    z-index: 100;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    gap: 10px;\n    max-width: 350px;\n    pointer-events: none;\n  ";var n=document.createElement("button");n.id="tutorial-hint-button",n.style.cssText="\n    background: transparent;\n    border: none;\n    width: 60px;\n    height: 60px;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    pointer-events: auto;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    position: relative;\n    border-radius: 50%;\n  ";var r=document.createElement("img");r.src="/static/sprites/character/boba_uncle.png",r.alt="Boba Uncle",r.style.cssText="\n    width: 60px;\n    height: 60px;\n    border-radius: 50%;\n    border: 3px solid #8B4513;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    transition: all 0.3s ease;\n  ",n.appendChild(r);var o=document.createElement("div");o.id="speech-bubble",o.style.cssText="\n    background: white;\n    border: 3px solid #8B4513;\n    border-radius: 20px;\n    padding: 15px;\n    font-size: 14px;\n    line-height: 1.5;\n    max-width: 300px;\n    position: relative;\n    display: none;\n    pointer-events: auto;\n    color: #2c1810;\n    font-family: 'Comic Sans MS', cursive, sans-serif;\n    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);\n    margin-right: 10px;\n  ";var a=document.createElement("div");a.style.cssText="\n    position: absolute;\n    top: 20px;\n    right: -12px;\n    width: 0;\n    height: 0;\n    border-left: 15px solid #8B4513;\n    border-top: 10px solid transparent;\n    border-bottom: 10px solid transparent;\n  ";var i=document.createElement("div");i.style.cssText="\n    position: absolute;\n    top: -7px;\n    left: -12px;\n    width: 0;\n    height: 0;\n    border-left: 12px solid white;\n    border-top: 7px solid transparent;\n    border-bottom: 7px solid transparent;\n  ",a.appendChild(i),o.appendChild(a);var c=document.createElement("div");c.id="speech-text",c.style.cssText="\n    margin-bottom: 10px;\n    min-height: 40px;\n  ";var l=document.createElement("div");l.id="speech-navigation",l.style.cssText="\n    display: none;\n    align-items: center;\n    justify-content: space-between;\n    border-top: 2px solid #8B4513;\n    padding-top: 10px;\n    margin-top: 10px;\n  ";var s=document.createElement("span");s.id="speech-progress",s.style.cssText="\n    font-size: 12px;\n    color: #8B4513;\n    font-weight: bold;\n  ";var u=document.createElement("button");u.id="speech-next",u.textContent="→",u.style.cssText="\n    background: #8B4513;\n    color: white;\n    border: none;\n    border-radius: 50%;\n    width: 30px;\n    height: 30px;\n    cursor: pointer;\n    font-size: 16px;\n    font-weight: bold;\n    transition: all 0.2s ease;\n  ",l.appendChild(s),l.appendChild(u),o.appendChild(c),o.appendChild(l),n.addEventListener("mouseenter",function(){r.style.transform="scale(1.1)",r.style.boxShadow="0 6px 20px rgba(139, 69, 19, 0.5)"}),n.addEventListener("mouseleave",function(){r.style.transform="scale(1)",r.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"}),n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),Vo(e)}),u.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),qo()}),document.addEventListener("keydown",Wo,!0),t.setAttribute("data-keyboard-added","true"),u.addEventListener("mouseenter",function(){u.style.background="#A0522D",u.style.transform="scale(1.1)"}),u.addEventListener("mouseleave",function(){u.style.background="#8B4513",u.style.transform="scale(1)"}),t.appendChild(o),t.appendChild(n);var d=document.querySelector(".game-board");d&&(d.style.position="relative",d.appendChild(t)),xo(t),No(e)}var Go=0,Bo=[],Fo=!1,Uo=!1,jo=null;function Vo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tutorial";Co()&&zo();var n=To(e);if(n&&Array.isArray(n)){Bo=n,Go=0,Fo=!0,Ro(t);var r=document.getElementById("speech-bubble"),o=document.getElementById("speech-text"),a=document.getElementById("speech-navigation");document.getElementById("speech-progress");r&&o&&(r.style.display="block",Ho(),Bo.length>1&&(a.style.display="flex",Ko()),ko(!0))}}function Ho(){var e=document.getElementById("speech-text"),t=document.getElementById("speech-navigation");e&&Bo[Go]&&(Yo(),e.textContent="",t&&(t.style.display="none"),function(e,t,n){if(!e||!t)return;Uo=!0;var r=0;jo=setInterval(function(){r<e.length?(t.textContent+=e[r],r++):(Yo(),n&&n())},30)}(Bo[Go],e,function(){Bo.length>1&&t&&(t.style.display="flex"),Ko()}))}function Yo(){jo&&(clearInterval(jo),jo=null),Uo=!1}function qo(){if(Uo){Yo();var e=document.getElementById("speech-text"),t=document.getElementById("speech-navigation");return e&&Bo[Go]&&(e.textContent=Bo[Go]),Bo.length>1&&t&&(t.style.display="flex"),void Ko()}!Fo||Go>=Bo.length-1?zo():(Go++,Ho())}function zo(){var e=document.getElementById("speech-bubble"),t=document.getElementById("speech-navigation");Yo(),e&&(e.style.display="none"),t&&(t.style.display="none");var n=document.getElementById("tutorial-hint-container");n&&n.getAttribute("data-keyboard-added")&&(document.removeEventListener("keydown",Wo,!0),n.removeAttribute("data-keyboard-added")),Go=0,Bo=[],Fo=!1,ko(!1),Lo=null}function Ko(){var e=document.getElementById("speech-progress"),t=document.getElementById("speech-next");if(e&&t){var n=Go+1,r=Bo.length;e.textContent="".concat(n,"/").concat(r),Uo?(t.textContent="⏭",t.title="Skip typing"):n===r?(t.textContent="✓",t.title="Close"):(t.textContent="→",t.title="Next")}}function Wo(e){if(Fo)return"Space"===e.code||"Enter"===e.code?(e.preventDefault(),e.stopPropagation(),void qo()):"Escape"===e.code?(e.preventDefault(),e.stopPropagation(),void zo()):void 0}function Xo(){var e=Co(),t=Oo();"lowscore"===e?(zo(),t&&Vo(t,"tutorial")):"tutorial"===e?zo():t&&!Fo&&Vo(t,"tutorial")}function Jo(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return Zo(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(Zo(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Zo(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,Zo(d,"constructor",s),Zo(s,"constructor",l),l.displayName="GeneratorFunction",Zo(s,o,"GeneratorFunction"),Zo(d),Zo(d,o,"Generator"),Zo(d,r,function(){return this}),Zo(d,"toString",function(){return"[object Generator]"}),(Jo=function(){return{w:a,m:p}})()}function Zo(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Zo=function(e,t,n,r){function a(t,n){Zo(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Zo(e,t,n,r)}function $o(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function Qo(){!function(){ea.apply(this,arguments)}()}function ea(){var e;return e=Jo().m(function e(){var t,n,r,o;return Jo().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(window.API_ENDPOINTS.GAME_STATE);case 1:if(!(t=e.v).ok){e.n=3;break}return e.n=2,t.json();case 2:(n=e.v).success&&n.current_map&&(No((r=n.current_map).id),"tutorial"!==r.difficulty&&10!==r.id&&14!==r.id||Do(r.id));case 3:e.n=5;break;case 4:e.p=4,o=e.v,logger.error("Failed to fetch game state for tutorial hints:",o);case 5:return e.a(2)}},e,null,[[0,4]])}),ea=function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){$o(a,r,o,i,c,"next",e)}function c(e){$o(a,r,o,i,c,"throw",e)}i(void 0)})},ea.apply(this,arguments)}function ta(){var e=Po();e&&e.parentNode&&(e.parentNode.removeChild(e),xo(null),No(null),ko(!1))}function na(e,t){Mo[e]=t;var n=document.getElementById("tutorial-hint-text");n&&Oo()===e&&(n.textContent=t)}function ra(e){return To(e)}function oa(){"tutorial"===Co()&&zo(),document.getElementById("tutorial-hint-container")||Do("low-score"),function(){Co()&&zo();var e=document.getElementById("speech-bubble"),t=document.getElementById("speech-text"),n=document.getElementById("speech-navigation");if(!e||!t)return;Ro("lowscore"),e.style.display="block",n&&(n.style.display="none");!function(){var e=document.getElementById("speech-text");if(!e)return;var t=0;function n(t,n){e.textContent="";var r=0;function o(){r<t.length?(e.textContent+=t.charAt(r),r++,setTimeout(o,30)):n&&setTimeout(n,1500)}o()}function r(){t<Ao.length&&n(Ao[t],function(){++t<Ao.length?r():setTimeout(function(){zo()},3e3)})}r()}()}()}var aa=null,ia=0;function ca(){return aa}function la(e){aa=e}function sa(e){ia=e}function ua(){var e=ca();e&&(e.classList.add("score-penalty"),setTimeout(function(){e.classList.remove("score-penalty")},600))}function da(){var e=ca();e&&(e.classList.add("score-pearl"),setTimeout(function(){e.classList.remove("score-pearl")},800))}var pa=!1;function ga(){var e=document.getElementById("score");if(la(e),e){var t=parseInt(e.textContent)||0;sa(t),logger.debug("Score animations initialized with score:",t)}}function ma(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",n=ca();if(n||(la(n=document.getElementById("score")),n)){var r=ia,o=e-r;n.textContent=e,sa(e),n.classList.remove("score-penalty","score-pearl"),"pearl"===t||o>0&&o>=100?da():("penalty"===t||o<0)&&ua(),logger.debug("Score updated: ".concat(r," → ").concat(e," (").concat(o>0?"+":"").concat(o,") [").concat(t,"]"))}}function fa(){ga();var e=ca()||document.getElementById("score");if(e){la(e);var t=parseInt(e.textContent)||0;sa(t);var n=setInterval(function(){var n=parseInt(e.textContent)||0;if(n!==t){var r=n-t,o="external";r>0&&r>=100?o="pearl":r<0&&(o="penalty"),ma(n,o),t=n,n<=-200&&!pa&&(pa=!0,logger.debug("Low score triggered at:",n),window.tutorialHintsModule&&window.tutorialHintsModule.triggerLowScoreMessage&&setTimeout(function(){window.tutorialHintsModule.triggerLowScoreMessage()},1e3)),n>-100&&pa&&(pa=!1,logger.debug("Low score trigger reset, score improved to:",n))}},100);logger.debug("Score monitoring started with initial score:",t),window.scoreMonitoringInterval=n}else logger.warn("Score element not found, cannot start monitoring")}function va(){pa=!1,logger.debug("Low score trigger manually reset")}function wa(){return pa}function ya(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var l=r&&r.prototype instanceof c?r:c,s=Object.create(l.prototype);return ba(s,"_invoke",function(n,r,o){var a,c,l,s=0,u=o||[],d=!1,p={p:0,n:0,v:e,a:g,f:g.bind(e,4),d:function(t,n){return a=t,c=0,l=e,p.n=n,i}};function g(n,r){for(c=n,l=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],g=p.p,m=a[2];n>3?(o=m===r)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=g&&((o=n<2&&g<a[1])?(c=0,p.v=r,p.n=a[1]):g<m&&(o=n<3||a[0]>r||r>m)&&(a[4]=n,a[5]=r,p.n=m,c=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,m){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&g(u,m),c=u,l=m;(t=c<2?e:l)||!d;){a||(c?c<3?(c>1&&(p.n=-1),g(c,l)):p.n=l:p.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(d=p.n<0)?l:n.call(r,p))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(ba(t={},r,function(){return this}),t),d=s.prototype=c.prototype=Object.create(u);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,ba(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=s,ba(d,"constructor",s),ba(s,"constructor",l),l.displayName="GeneratorFunction",ba(s,o,"GeneratorFunction"),ba(d),ba(d,o,"Generator"),ba(d,r,function(){return this}),ba(d,"toString",function(){return"[object Generator]"}),(ya=function(){return{w:a,m:p}})()}function ba(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ba=function(e,t,n,r){function a(t,n){ba(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},ba(e,t,n,r)}function ha(e,t,n,r,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,o)}function Ea(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){ha(a,r,o,i,c,"next",e)}function c(e){ha(a,r,o,i,c,"throw",e)}i(void 0)})}}var Sa=null,Ma=null,Aa=0,Ta=2e3,_a="idle",Ia=!1,La=0;function Pa(){Sa||(logger.debug("Starting optimized real-time game state polling..."),xa())}function xa(){Sa&&clearTimeout(Sa),Sa=setTimeout(Ea(ya().m(function e(){return ya().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Oa();case 1:Sa&&(ka(),xa());case 2:return e.a(2)}},e)})),Ta)}function Oa(){return Na.apply(this,arguments)}function Na(){return Na=Ea(ya().m(function e(){var t,n,r,o;return ya().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(window.playerMovement&&window.playerMovement.isPredictionActive&&window.playerMovement.isPredictionActive())){e.n=1;break}return La++,e.a(2);case 1:return e.n=2,fetch(st.GAME_STATE);case 2:return t=e.v,e.n=3,t.json();case 3:(n=e.v).success?(r=JSON.stringify(n.game_map),n.game_map&&(Ia=n.game_map.some(function(e){return e.includes(4)})),Ma!==r?window.playerMovement&&window.playerMovement.isPredictionActive&&window.playerMovement.isPredictionActive()||(window.displayModule.updateGameDisplay(n.game_map),Ma=r,logger.debug("Game map updated due to real-time changes"),_a="critical",La=0):La++,(n.is_completed||n.game_failed)&&(logger.debug("Game ended detected, stopping polling"),Ra(),n.game_failed&&ct(n))):"Invalid or expired game session"===n.error&&(logger.debug("Game session expired, stopping polling"),Ra()),e.n=5;break;case 4:e.p=4,o=e.v,logger.error("Error polling game state:",o);case 5:return e.a(2)}},e,null,[[0,4]])})),Na.apply(this,arguments)}function ka(){var e=Date.now()-Aa,t=window.playerMovement&&window.playerMovement.isPredictionActive&&window.playerMovement.isPredictionActive();if("critical"===_a)Ta=t?1e3:500,e>1e4&&(_a="active");else if("active"===_a){var n=Ia?1200:2e3;Ta=t?1.5*n:n,e>3e4&&(_a="idle")}else{var r;r=Ia?2500:La>10?5e3:3e3,Ta=t?2*r:r}}function Ca(){Aa=Date.now(),"idle"===_a&&(_a="active",logger.debug("Switched to active polling mode due to movement"))}function Ra(){Sa&&(logger.debug("Stopping game state polling"),clearTimeout(Sa),Sa=null,Ma=null,_a="idle",Ta=2e3,Ia=!1,La=0)}function Da(){Ma=null,Aa=Date.now(),_a="active",Ta=1500,Ia=!1,La=0,Pa(),window.addEventListener("beforeunload",Ra),logger.debug("Optimized real-time updates module initialized")}function Ga(){return Ba.apply(this,arguments)}function Ba(){return Ba=Ea(ya().m(function e(){var t,n,r;return ya().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(st.GAME_STATE);case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success){e.n=3;break}return window.displayModule.updateGameDisplay(n.game_map),Ma=JSON.stringify(n.game_map),logger.debug("Forced game state refresh completed"),e.a(2,!0);case 3:e.n=5;break;case 4:e.p=4,r=e.v,logger.error("Error in forced game state refresh:",r);case 5:return e.a(2,!1)}},e,null,[[0,4]])})),Ba.apply(this,arguments)}function Fa(){return null!==Sa}function Ua(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ja(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ja(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(c)throw a}}}}function ja(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Va(){setTimeout(function(){Ha()},100)}function Ha(){var e=document.querySelector(".keyboard-map");if(e){var t=e.querySelectorAll(".keyboard-row");0!==t.length&&(logger.debug("Analyzing ".concat(t.length," rows for paragraph separation")),t.forEach(function(e,t){!function(e){var t=e.querySelectorAll(".key");if(0===t.length)return!0;var n,r=Ua(t);try{for(r.s();!(n=r.n()).done;){var o=n.value.getAttribute("data-letter");if(o&&""!==o.trim())return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(e)?e.classList.remove("empty-row","visible-empty"):(e.classList.add("empty-row"),logger.debug("Row ".concat(t," marked as empty paragraph separator")))}))}}function Ya(){setTimeout(function(){Ha()},50)}function qa(){document.querySelectorAll(".keyboard-row.empty-row").forEach(function(e){e.classList.toggle("visible-empty")});var e=null!==document.querySelector(".keyboard-row.empty-row.visible-empty");return logger.debug("Empty rows ".concat(e?"visible":"hidden")),e}var za=n(812),Ka=za.Cs.filter(function(e){return"g"!==e}).map(function(e){return{key:e,message:"Press ".concat(e," to go ").concat(za.Ve[e].description)}});window.gameState={tutorialMode:!1},window.tutorialModule=l,window.feedbackModule=s,window.displayModule=u,window.responsiveScaling=i,window.gameBanner=r,window.vimManualModule=c,window.mapModule=a,window.lineNumbersModule=d,window.relativeLineNumbersModule=p,window.spaceHighlightModule=g,window.fullscreenModule=m,window.userPreferencesModule=f,window.spriteVisibilityModule=o,window.tutorialHintsModule=v,window.scoreAnimationsModule=w,window.realTimeUpdatesModule=y,window.paragraphModule=b,window.intelligentScaling=nn,window.pauseMenuSystem=ar,(0,Ze.G)(),window.MOVEMENT_KEYS=za.Ve,window.MOVEMENT_MESSAGES=za.rf,window.BLOCKED_MESSAGES=za.Mx,window.VALID_MOVEMENT_KEYS=za.Cs,window.TUTORIAL_CONFIG={TOGGLE_KEY:"+",COLORS:{ACTIVATED:"#9b59b6",INSTRUCTION:"#3498db",CORRECT:"#27ae60",WRONG:"#e74c3c"},TIMINGS:{ACTIVATION_DELAY:1e3,NEXT_COMMAND_DELAY:1e3,WRONG_ANSWER_DISPLAY:1e3},MESSAGES:{ACTIVATED:"TUTORIAL MODE ACTIVATED",DEACTIVATED:"TUTORIAL MODE DEACTIVATED",DEFAULT_WELCOME:"Welcome! Use HJKL to move | Space+M map | Space+T tutorial | Space+H help | Space+N numbers | Space+C chat | Space+Space highlight spaces"}},window.TUTORIAL_COMMANDS=Ka,window.MAP_CONFIG={TOGGLE_KEY:"-",MESSAGES:{SHOWN:"Map SHOWN",HIDDEN:"Map HIDDEN",TOGGLE:"A map appear"},DISPLAY_ELEMENT_ID:"mapDisplay",FEEDBACK_TIMEOUT:2e3,FEEDBACK_COLOR:"#FFFFFF"},window.FEEDBACK_CONFIG={MOVEMENT_COLOR:"#ff6b6b",ANIMATION_DURATION:300,ANIMATION_TYPE:"pulse 0.3s ease-in-out"},window.API_ENDPOINTS=st,window.UI_SELECTORS={HEADER_INFO:".header-info",SCORE_ELEMENT:"#score",BACK_MENU_BUTTON:"#backMenu",GAME_KEYS:".key",MAP_DISPLAY:"#mapDisplay",MAP_GRID:"#mapGrid"},window.GAME_STATE_DEFAULT={TUTORIAL_MODE:!1},document.addEventListener("DOMContentLoaded",function(){if(pn(),document.documentElement.offsetHeight,fn(),window.IS_MULTIPLAYER)return logger.debug("Skipping solo game initialization - multiplayer mode detected"),void setTimeout(function(){fn()},100);var e;h(),(e=document.getElementById(window.UI_SELECTORS.BACK_MENU_BUTTON.replace("#","")))&&(e.addEventListener("click",$t(Xt().m(function t(){var n;return Xt().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!window.pauseMenuSystem||window.pauseMenuSystem.getIsPaused()){t.n=1;break}return window.pauseMenuSystem.showPauseMenu(),t.a(2);case 1:return e.disabled=!0,t.p=2,t.n=3,fetch(window.API_ENDPOINTS.QUIT_GAME,{method:"POST",headers:{"Content-Type":"application/json"}});case 3:window.location.href="/",t.n=5;break;case 4:t.p=4,n=t.v,logger.error("Error going back to menu:",n),window.location.href="/";case 5:return t.a(2)}},t,null,[[2,4]])}))),e.addEventListener("mouseenter",function(){e.textContent="🧋"}),e.addEventListener("mouseleave",function(){e.textContent="Menu"})),Et(),jt(),Kt(),jn(),ar.initialize(),Vr(),Qr(),ro(),Qo(),ga(),Da(),Va(),setTimeout(function(){So(),fa()},100)})}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var i=1/0;for(u=0;u<e.length;u++){for(var[n,o,a]=e[u],c=!0,l=0;l<n.length;l++)(!1&a||i>=a)&&Object.keys(r.O).every(e=>r.O[e](n[l]))?n.splice(l--,1):(c=!1,a<i&&(i=a));if(c){e.splice(u--,1);var s=o();void 0!==s&&(t=s)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,o,a]},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.e=()=>Promise.resolve(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.j=485,(()=>{var e={485:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[i,c,l]=n,s=0;if(i.some(t=>0!==e[t])){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(l)var u=l(r)}for(t&&t(n);s<i.length;s++)a=i[s],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(u)},n=self.webpackChunkboba_vim=self.webpackChunkboba_vim||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[76],()=>r(993));o=r.O(o)})();