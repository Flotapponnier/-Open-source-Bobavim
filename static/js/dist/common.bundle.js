/*! For license information please see common.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkboba_vim=self.webpackChunkboba_vim||[]).push([[76],{147:(e,t,n)=>{n.d(t,{Rb:()=>y});var r=n(275),o=(n(812),r.e.MAP_VALUES),a=(o.EMPTY,o.BOBA,o.ENEMY),i=(o.PEARL,{h:"left",j:"down",k:"up",l:"right",ArrowLeft:"left",ArrowDown:"down",ArrowUp:"up",ArrowRight:"right",w:"word_forward",W:"word_forward_space",b:"word_backward",B:"word_backward_space",e:"word_end",E:"word_end_space",ge:"word_end_prev",gE:"word_end_prev_space",$:"line_end",0:"line_start","^":"line_first_non_blank",g_:"line_last_non_blank",gg:"file_start",G:"file_end",H:"screen_top",M:"screen_middle",L:"screen_bottom","{":"paragraph_prev","}":"paragraph_next","(":"sentence_prev",")":"sentence_next",f:"find_char_forward",F:"find_char_backward",t:"till_char_forward",T:"till_char_backward",";":"repeat_char_search_same",",":"repeat_char_search_opposite","%":"match_bracket"}),l={left:!0,right:!0,up:!0,down:!0,word_forward:!0,word_forward_space:!0,word_backward:!0,word_backward_space:!0,word_end:!0,word_end_space:!0,word_end_prev:!0,word_end_prev_space:!0,line_end:!0,line_start:!0,line_first_non_blank:!0,line_last_non_blank:!0,file_start:!0,file_end:!0,screen_top:!0,screen_middle:!0,screen_bottom:!0,paragraph_prev:!0,paragraph_next:!0,sentence_prev:!0,sentence_next:!0,find_char_forward:!0,find_char_backward:!0,till_char_forward:!0,till_char_backward:!0,repeat_char_search_same:!0,repeat_char_search_opposite:!0,match_bracket:!0};function c(e){return!!l[e]||(!(19!==e.length||!e.startsWith("find_char_forward")||"_"!==e[17])||(!(20!==e.length||!e.startsWith("find_char_backward")||"_"!==e[18])||(!(19!==e.length||!e.startsWith("till_char_forward")||"_"!==e[17])||!(20!==e.length||!e.startsWith("till_char_backward")||"_"!==e[18]))))}var s=n(477),u=n(307),d=n(459),f={command:"",character:"",isTill:!1};function h(e,t,n,r){var o=t,a=n,i=0;if("paragraph_prev"===e){var l=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var r=e;if(r--,r<0)return{newRow:e,newCol:t};for(;r>=0&&!g(n[r]);)r--;if(r<0)return{newRow:e,newCol:t};for(;r>=0&&g(n[r]);)r--;if(r>=0)return{newRow:r,newCol:0};return{newRow:e,newCol:t}}(t,n,r);o=l.newRow,i=a=l.newCol}else if("paragraph_next"===e){var c=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var r=e;if(r++,r>=n.length)return{newRow:e,newCol:t};for(;r<n.length&&!g(n[r]);)r++;if(r>=n.length)return{newRow:e,newCol:t};for(;r<n.length&&g(n[r]);)r++;if(r<n.length)return{newRow:r,newCol:0};return{newRow:e,newCol:t}}(t,n,r);o=c.newRow,i=a=c.newCol}return{newRow:o,newCol:a,newPreferredColumn:i}}function g(e){return 0===e.length||e.every(function(e){return" "===e||"\t"===e})}function p(e,t,n,r){var o=t,a=n;return"sentence_prev"===e?function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t,newPreferredColumn:t};var r=e,o=t;if(o--,o<0){if(!(r>0))return{newRow:e,newCol:t,newPreferredColumn:t};--r>=0&&r<n.length&&(o=n[r].length-1)}for(;r>=0;){for(;o>=0;){if(r<n.length&&o<n[r].length){var a=n[r][o];if("."===a||"!"===a||"?"===a){for(var i=r,l=o+1;i<n.length&&l<n[i].length;){var c=n[i][l];if(")"!==c&&"]"!==c&&"}"!==c&&'"'!==c&&"'"!==c)break;l++}var u=!1;if(i<n.length&&l<n[i].length?(0,s.xC)(n[i][l])&&(u=!0):l>=n[i].length&&(u=!0),u){for(var d=r,f=o-1;d>=0;){for(;f>=0;){if(d<n.length&&f<n[d].length){var h=n[d][f];if("."===h||"!"===h||"?"===h){if(++f>=n[d].length&&(f=0,++d>=n.length))break;for(;d<n.length;)if(f>=n[d].length){if(f=0,++d>=n.length)break}else{if(!(0,s.xC)(n[d][f])&&""!==n[d][f]&&(d!==e||f!==t))return{newRow:d,newCol:f,newPreferredColumn:f};f++}return{newRow:e,newCol:t,newPreferredColumn:t}}}f--}--d>=0&&d<n.length&&(f=n[d].length-1)}for(var g=0;g<n.length;g++)for(var p=0;p<n[g].length;p++)if(!(0,s.xC)(n[g][p])&&""!==n[g][p])return g!==e||p!==t?{newRow:g,newCol:p,newPreferredColumn:p}:{newRow:e,newCol:t,newPreferredColumn:t}}}}o--}--r>=0&&r<n.length&&(o=n[r].length-1)}return{newRow:e,newCol:t,newPreferredColumn:t}}(t,n,r):"sentence_next"===e?function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t,newPreferredColumn:t};var r=e,o=t;for(;r<n.length;){for(;o<n[r].length;){var a=n[r][o];if("."===a||"!"===a||"?"===a){for(var i=r,l=o+1;i<n.length&&l<n[i].length;){var c=n[i][l];if(")"!==c&&"]"!==c&&"}"!==c&&'"'!==c&&"'"!==c)break;l++}var u=!1;if(i<n.length&&l<n[i].length?(0,s.xC)(n[i][l])&&(u=!0):l>=n[i].length&&(u=!0),u)for(;i<n.length;)if(l>=n[i].length){if(l=0,++i>=n.length)break}else{if(!(0,s.xC)(n[i][l])&&""!==n[i][l]&&(i!==e||l!==t))return{newRow:i,newCol:l,newPreferredColumn:l};l++}}o++}r++,o=0}return{newRow:e,newCol:t,newPreferredColumn:t}}(t,n,r):{newRow:o,newCol:a,newPreferredColumn:a}}function v(e,t,n,r){var o=t,a=n;if(logger.debug("Character search debug:",{direction:e,currentRow:t,currentCol:n,lastCharSearch:JSON.stringify(f)}),"repeat_char_search_same"===e)if(f.command&&f.character){logger.debug("Repeating same direction:",f.command,f.character);var i=f.character;switch(f.command){case"f":for(var l=n+1;l<r[t].length;l++)if(r[t][l]===i){a=l;break}break;case"F":for(var c=n-1;c>=0;c--)if(r[t][c]===i){a=c;break}break;case"t":for(var s=n+1;s<r[t].length;s++)if(r[t][s]===i){a=s-1;break}break;case"T":for(var u=n-1;u>=0;u--)if(r[t][u]===i){a=u+1;break}}}else logger.debug("No last char search found for repeat_char_search_same");else if("repeat_char_search_opposite"===e)if(f.command&&f.character){logger.debug("Repeating opposite direction:",f.command,f.character);var d=f.character;switch(f.command){case"f":for(var h=n-1;h>=0;h--)if(r[t][h]===d){a=h;break}break;case"F":for(var g=n+1;g<r[t].length;g++)if(r[t][g]===d){a=g;break}break;case"t":for(var p=n-1;p>=0;p--)if(r[t][p]===d){a=p+1;break}break;case"T":for(var v=n+1;v<r[t].length;v++)if(r[t][v]===d){a=v-1;break}}}else logger.debug("No last char search found for repeat_char_search_opposite");else if(e.startsWith("find_char_forward_")){var m=e.slice(-1);logger.debug("Setting lastCharSearch for find_char_forward:",m),f={command:"f",character:m,isTill:!1};for(var b=n+1;b<r[t].length;b++)if(r[t][b]===m){a=b,logger.debug("Found char at col:",b);break}}else if(e.startsWith("find_char_backward_")){var w=e.slice(-1);logger.debug("Setting lastCharSearch for find_char_backward:",w),f={command:"F",character:w,isTill:!1};for(var y=n-1;y>=0;y--)if(r[t][y]===w){a=y,logger.debug("Found char at col:",y);break}}else if(e.startsWith("till_char_forward_")){var _=e.slice(-1);logger.debug("Setting lastCharSearch for till_char_forward:",_),f={command:"t",character:_,isTill:!0};for(var k=n+1;k<r[t].length;k++)if(r[t][k]===_){a=k-1,logger.debug("Found char at col:",k,"stopping at:",k-1);break}}else if(e.startsWith("till_char_backward_")){var C=e.slice(-1);logger.debug("Setting lastCharSearch for till_char_backward:",C),f={command:"T",character:C,isTill:!0};for(var x=n-1;x>=0;x--)if(r[t][x]===C){a=x+1,logger.debug("Found char at col:",x,"stopping at:",x+1);break}}return logger.debug("Character search result:",{newRow:o,newCol:a,newPreferredColumn:a}),{newRow:o,newCol:a,newPreferredColumn:a}}function m(e,t,n){var r=function(e,t,n){if(e<0||e>=n.length||t<0||t>=n[e].length)return{newRow:e,newCol:t};var r,o,a=n[e][t];switch(a){case"(":r=")",o=!0;break;case")":r="(",o=!1;break;case"{":r="}",o=!0;break;case"}":r="{",o=!1;break;case"[":r="]",o=!0;break;case"]":r="[",o=!1;break;default:return{newRow:e,newCol:t}}return o?function(e,t,n,r,o){var a=1,i=e,l=t+1;for(;i<o.length;){for(;l<o[i].length;){var c=o[i][l];if(c===n)a++;else if(c===r&&0===--a)return{newRow:i,newCol:l};l++}i++,l=0}return{newRow:e,newCol:t}}(e,t,a,r,n):function(e,t,n,r,o){var a=1,i=e,l=t-1;for(;i>=0;){for(;l>=0;){var c=o[i][l];if(c===n)a++;else if(c===r&&0===--a)return{newRow:i,newCol:l};l--}--i>=0&&i<o.length&&(l=o[i].length-1)}return{newRow:e,newCol:t}}(e,t,a,r,n)}(e,t,n);return{newRow:r.newRow,newCol:r.newCol,newPreferredColumn:r.newCol}}function b(e,t,n,r,o,i,l){var f=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!c(e))throw new Error("invalid direction: ".concat(e));var g=t,b=n,w=i;if("left"===e||"right"===e||"up"===e||"down"===e){var y=(0,u.oi)(e,t,n,i,r);g=y.newRow,b=y.newCol,w=y.newPreferredColumn}else if("line_end"===e||"line_start"===e||"line_first_non_blank"===e||"line_last_non_blank"===e){var _=(0,u.w9)(e,t,n,r,o);g=_.newRow,b=_.newCol,w=_.newPreferredColumn}else if("file_start"===e||"file_end"===e){var k=(0,u.P6)(e,t,n,i,r,l,f);g=k.newRow,b=k.newCol,w=k.newPreferredColumn}else if("screen_top"===e||"screen_middle"===e||"screen_bottom"===e){var C=(0,u.GJ)(e,t,n,i,r);g=C.newRow,b=C.newCol,w=C.newPreferredColumn}else if("word_forward"===e||"word_forward_space"===e||"word_backward"===e||"word_backward_space"===e||"word_end"===e||"word_end_space"===e||"word_end_prev"===e||"word_end_prev_space"===e){var x=(0,d.gk)(e,t,n,o);g=x.newRow,b=x.newCol,w=x.newPreferredColumn}else if("paragraph_prev"===e||"paragraph_next"===e){var M=h(e,t,n,o);g=M.newRow,b=M.newCol,w=M.newPreferredColumn}else if("sentence_prev"===e||"sentence_next"===e){var S=p(e,t,n,o);g=S.newRow,b=S.newCol,w=S.newPreferredColumn}else if("repeat_char_search_same"===e||"repeat_char_search_opposite"===e||e.length>17&&(e.startsWith("find_char_forward")||e.startsWith("till_char_forward"))||e.length>18&&(e.startsWith("find_char_backward")||e.startsWith("till_char_backward"))){var E=v(e,t,n,o);g=E.newRow,b=E.newCol,w=E.newPreferredColumn}else{if("match_bracket"!==e)throw new Error("unknown direction: ".concat(e));var T=m(t,n,o);g=T.newRow,b=T.newCol,w=T.newPreferredColumn}var L=(0,s.u1)(g,b,r),R=L;return L&&r[g][b]===a&&(R=!1),L&&g===t&&b===n&&"paragraph_prev"!==e&&"paragraph_next"!==e&&(R=!1),{newRow:g,newCol:b,preferredColumn:w,isValid:R}}function w(e,t,n,r,o,i){if(!c(e))throw new Error("invalid direction: ".concat(e));var l=t,f=n,g=i;if("left"===e||"right"===e||"up"===e||"down"===e){var b=(0,u.oi)(e,t,n,i,r);l=b.newRow,f=b.newCol,g=b.newPreferredColumn}else if("line_end"===e||"line_start"===e||"line_first_non_blank"===e||"line_last_non_blank"===e){var w=(0,u.w9)(e,t,n,r,o);l=w.newRow,f=w.newCol,g=w.newPreferredColumn}else if("file_start"===e||"file_end"===e){var y=(0,u.es)(e,t,n,i,r);l=y.newRow,f=y.newCol,g=y.newPreferredColumn}else if("screen_top"===e||"screen_middle"===e||"screen_bottom"===e){var _=(0,u.GJ)(e,t,n,i,r);l=_.newRow,f=_.newCol,g=_.newPreferredColumn}else if("word_forward"===e||"word_forward_space"===e||"word_backward"===e||"word_backward_space"===e||"word_end"===e||"word_end_space"===e||"word_end_prev"===e||"word_end_prev_space"===e){var k=(0,d.gk)(e,t,n,o);l=k.newRow,f=k.newCol,g=k.newPreferredColumn}else if("paragraph_prev"===e||"paragraph_next"===e){var C=h(e,t,n,o);l=C.newRow,f=C.newCol,g=C.newPreferredColumn}else if("sentence_prev"===e||"sentence_next"===e){var x=p(e,t,n,o);l=x.newRow,f=x.newCol,g=x.newPreferredColumn}else if("repeat_char_search_same"===e||"repeat_char_search_opposite"===e||e.length>17&&(e.startsWith("find_char_forward")||e.startsWith("till_char_forward"))||e.length>18&&(e.startsWith("find_char_backward")||e.startsWith("till_char_backward"))){var M=v(e,t,n,o);l=M.newRow,f=M.newCol,g=M.newPreferredColumn}else{if("match_bracket"!==e)throw new Error("unknown direction: ".concat(e));var S=m(t,n,o);l=S.newRow,f=S.newCol,g=S.newPreferredColumn}var E=(0,s.u1)(l,f,r),T=E;return E&&r[l][f]===a&&(T=!1),E&&l===t&&f===n&&"paragraph_prev"!==e&&"paragraph_next"!==e&&(T=!1),{newRow:l,newCol:f,preferredColumn:g,isValid:T}}function y(e,t,n,r,o,a){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];try{var s,u=function(e){if(e.length>17&&e.startsWith("find_char_forward")||e.length>18&&e.startsWith("find_char_backward")||e.length>17&&e.startsWith("till_char_forward")||e.length>18&&e.startsWith("till_char_backward"))return e;for(var t=e,n=0;n<e.length;n++){var r=e[n];if(r<"0"||r>"9"){t=e.slice(n);break}}var o=i[t];if(!o)throw new Error("invalid movement key");return o}(e),d=0,f=null;if(1===l)(s="file_end"===u||"file_start"===u?b(u,t,n,r,o,a,l,c):w(u,t,n,r,o,a)).isValid&&(d=1,f=s);else if("file_end"===u||"file_start"===u){var h=b(u,t,n,r,o,a,l,c);h.isValid&&(d=1,f=h)}else for(var g=t,p=n,v=a,m=0;m<l;m++){var y=w(u,g,p,r,o,v);if(!y.isValid)break;g=y.newRow,p=y.newCol,v=y.preferredColumn,f=y,d++}return{success:d>0,finalPosition:f,movesExecuted:d,movesRequested:l}}catch(e){return{success:!1,error:e.message,movesExecuted:0,movesRequested:l}}}},199:(e,t,n)=>{n.r(t),n.d(t,{disableVimNavigation:()=>w,enableVimNavigation:()=>b,hideCursor:()=>_,initializeVimNavigation:()=>f,refreshNavigableElements:()=>y,showCursor:()=>k});var r=0,o=!0,a=!1,i=0,l=!1,c=0,s=[{selector:"#surveyButton",column:0,row:0,type:"button"},{selector:"#newsletterButton",column:0,row:0,type:"button"},{selector:"#musicButton",column:0,row:1,type:"button"},{selector:".instructions-book",column:0,row:2,type:"button"},{selector:".love-letter-image",column:1,row:0,type:"image"},{selector:"#playButton",column:1,row:1,type:"button"},{selector:".character-grid",column:1,row:2,type:"character-grid"},{selector:"#playOnline",column:1,row:3,type:"button"},{selector:"#leaderboardButton",column:1,row:4,type:"button"},{selector:"#loginButton",column:2,row:0,type:"button"},{selector:"#registerButton",column:2,row:0,type:"button"},{selector:"#logoutButton",column:2,row:0,type:"button"},{selector:"#settingsButton",column:2,row:0,type:"button"},{selector:".social-icons .linkedin-icon",column:2,row:1,type:"social-icon"},{selector:".social-icons .github-icon",column:2,row:1,type:"social-icon"},{selector:".social-icons .portfolio-icon",column:2,row:1,type:"social-icon"},{selector:".terms-link",column:2,row:2,type:"button"}],u=[".social-icons .linkedin-icon",".social-icons .github-icon",".social-icons .portfolio-icon"],d=s.findIndex(function(e){return"#playButton"===e.selector});function f(){logger.debug("Initializing simple vim navigation..."),document.body&&document.body.classList.contains("game-page")?logger.debug("Blocked vim navigation initialization - on game page"):(r=d>=0?d:5,a=!1,i=0,logger.debug("Starting at element index: ".concat(r)),v(),document.addEventListener("keydown",p),logger.debug("Simple vim navigation initialized"))}function h(){if(a){var e=document.querySelectorAll(".character-grid .character-box")[i]||null;return logger.debug("Character selection element:",e),e}if(l){var t=u[c];if(t){var n=document.querySelector(t);return logger.debug("Social icon element:",n,"selector:",t,"index:",c),n}}if(r<0||r>=s.length)return logger.debug("Invalid element index:",r),null;var o=s[r];if(!o)return logger.debug("No navigation element found at index:",r),null;try{var d=document.querySelector(o.selector);return logger.debug("Current element (".concat(o.selector,"):"),d),d}catch(e){return logger.debug("Error finding element with selector:",o.selector,e),null}}function g(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden")}catch(e){return!1}}function p(e){if(o&&(!(document.body&&document.body.classList.contains("game-page"))&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable))switch(e.key.toLowerCase()){case"h":e.preventDefault(),logger.debug("H pressed, isInSocialIcons:",l,"currentSocialIndex:",c),function(){if(a)document.querySelectorAll(".character-grid .character-box"),i>0&&(i--,v());else{if(l)return logger.debug("Moving left in social icons, current index:",c),void(c>0&&(c--,logger.debug("New social index:",c),v()));var e=s[r];if(e){if("#newsletterButton"===e.selector){var t=s.findIndex(function(e){return"#surveyButton"===e.selector});if(t>=0)return r=t,void v()}else if("#registerButton"===e.selector){var n=s.findIndex(function(e){return"#loginButton"===e.selector});if(n>=0)return r=n,void v()}else if("#settingsButton"===e.selector){var o=s.findIndex(function(e){return"#logoutButton"===e.selector});if(o>=0)return r=o,void v()}else if(".social-icons .github-icon"===e.selector){var u=s.findIndex(function(e){return".social-icons .linkedin-icon"===e.selector});if(u>=0)return r=u,void v()}else if(".social-icons .portfolio-icon"===e.selector){var d=s.findIndex(function(e){return".social-icons .github-icon"===e.selector});if(d>=0)return r=d,void v()}for(var f=e.column-1,h=f<0?2:f,p=-1,m=1/0,b=0;b<s.length;b++){var w=s[b];if(w.column===h){var y=document.querySelector(w.selector);if(y&&g(y)){var _=Math.abs(w.row-e.row);_<m&&(m=_,p=b)}}}p>=0&&(r=p,v(),logger.debug("Moved left to index ".concat(p)))}}}();break;case"j":e.preventDefault(),function(){if(a){var e=document.querySelectorAll(".character-grid .character-box"),t=Math.min(e.length-1,i+5);if(t!==i)i=t,v();else{a=!1;var n=s.findIndex(function(e){return"#playOnline"===e.selector});r=n>=0?n:r,v()}}else{if(l){l=!1;var o=s.findIndex(function(e){return".terms-link"===e.selector});return r=o>=0?o:r,void v()}var c=s[r];if(c){for(var u=-1,d=1/0,f=0;f<s.length;f++){var h=s[f];if(h.column===c.column&&h.row>c.row&&h.row<d){var p=document.querySelector(h.selector);p&&g(p)&&(d=h.row,u=f)}}u>=0&&(r=u,v(),logger.debug("Moved down to index ".concat(u)))}}}();break;case"k":e.preventDefault(),function(){if(a){document.querySelectorAll(".character-grid .character-box");var e=Math.max(0,i-5);e!==i?(i=e,v()):(a=!1,r=d,v())}else{if(l){l=!1;var t=s.findIndex(function(e){return"#loginButton"===e.selector});return r=t>=0?t:r,void v()}var n=s[r];if(n){for(var o=-1,c=-1,u=0;u<s.length;u++){var f=s[u];if(f.column===n.column&&f.row<n.row&&f.row>c){var h=document.querySelector(f.selector);h&&g(h)&&(c=f.row,o=u)}}o>=0&&(r=o,v(),logger.debug("Moved up to index ".concat(o)))}}}();break;case"l":e.preventDefault(),logger.debug("L pressed, isInSocialIcons:",l,"currentSocialIndex:",c),function(){if(a){var e=document.querySelectorAll(".character-grid .character-box");i<e.length-1&&(i++,v())}else{if(l)return logger.debug("Moving right in social icons, current index:",c,"max:",u.length-1),void(c<u.length-1&&(c++,logger.debug("New social index:",c),v()));var t=s[r];if(t){if("#surveyButton"===t.selector){var n=s.findIndex(function(e){return"#newsletterButton"===e.selector});if(n>=0)return r=n,void v()}else if("#loginButton"===t.selector){var o=s.findIndex(function(e){return"#registerButton"===e.selector});if(o>=0)return r=o,void v()}else if("#logoutButton"===t.selector){var d=s.findIndex(function(e){return"#settingsButton"===e.selector});if(d>=0)return r=d,void v()}else if(".social-icons .linkedin-icon"===t.selector){var f=s.findIndex(function(e){return".social-icons .github-icon"===e.selector});if(f>=0)return r=f,void v()}else if(".social-icons .github-icon"===t.selector){var h=s.findIndex(function(e){return".social-icons .portfolio-icon"===e.selector});if(h>=0)return r=h,void v()}for(var p=t.column+1,m=p>2?0:p,b=-1,w=1/0,y=0;y<s.length;y++){var _=s[y];if(_.column===m){var k=document.querySelector(_.selector);if(k&&g(k)){var C=Math.abs(_.row-t.row);C<w&&(w=C,b=y)}}}b>=0&&(r=b,v(),logger.debug("Moved right to index ".concat(b)))}}}();break;case"enter":e.preventDefault(),function(){var e=h();if(logger.debug("Activating element:",e),!e)return void logger.debug("No element to activate");if(logger.debug("Element details:",{tagName:e.tagName,className:e.className,id:e.id,classList:Array.from(e.classList||[])}),e.classList.contains("character-grid")&&!a)return logger.debug("Entering character selection mode"),a=!0,i=0,void v();logger.debug("Attempting to click element");try{if("BUTTON"===e.tagName||"A"===e.tagName)logger.debug("Clicking button/link"),e.click();else if(e.classList.contains("character-box"))logger.debug("Clicking character box"),e.click();else if(e.classList.contains("love-letter-image"))logger.debug("Clicking love letter image"),e.click();else if("IMG"===e.tagName)logger.debug("Clicking image"),e.click();else{if(e.classList.contains("social-icons")&&!l)return logger.debug("Entering social icons mode"),l=!0,c=0,void v();l?(logger.debug("Clicking social icon"),e.click()):(logger.debug("Generic click attempt"),e.click())}}catch(e){logger.debug("Error clicking element:",e)}}();break;case"escape":e.preventDefault(),function(){document.querySelectorAll(".modal:not(.hidden)").forEach(function(e){e.classList.add("hidden")}),window.closeLoveLetterModal&&window.closeLoveLetterModal();a&&(a=!1,v());l&&(l=!1,v())}()}}function v(){logger.debug("updateCursor called"),m();var e=h();logger.debug("Current element for cursor:",e),e?(!function(e){if(!e)return;if(e.classList.contains("character-box")){var t=document.createElement("div");t.className="vim-cursor",t.textContent="🧋",t.style.cssText="\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      font-size: 20px;\n      z-index: 10000;\n      pointer-events: none;\n      animation: vim-cursor-pulse 1s ease-in-out infinite alternate;\n      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 1)) drop-shadow(0 0 4px rgba(0, 0, 0, 0.8));\n      background: rgba(255, 255, 255, 0.2);\n      border-radius: 50%;\n      width: 30px;\n      height: 30px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ","relative"!==e.style.position&&(e.style.position="relative"),e.appendChild(t)}else{if(e.classList.contains("character-grid"))return a=!0,i=0,void v();if("BUTTON"!==e.tagName||"surveyButton"===e.id||"newsletterButton"===e.id||e.classList.contains("terms-link"))if("IMG"===e.tagName||e.classList.contains("love-letter-image")||"surveyButton"===e.id||"newsletterButton"===e.id||e.classList.contains("terms-link")){var n=document.createElement("div");n.className="vim-cursor",n.textContent="🧋",n.style.cssText="\n      position: fixed;\n      font-size: 20px;\n      z-index: 99999;\n      pointer-events: none;\n      animation: vim-cursor-pulse 1s ease-in-out infinite alternate;\n      filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n      background: rgba(255, 165, 0, 0.8);\n      border: 2px solid white;\n      border-radius: 50%;\n      width: 35px;\n      height: 35px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n    ";var r=e.getBoundingClientRect();n.style.top=r.top-10+"px",n.style.left=r.left-10+"px",document.body.appendChild(n)}else{var o=document.createElement("div");o.className="vim-cursor",o.textContent="🧋",o.style.cssText="\n      position: fixed;\n      font-size: 18px;\n      z-index: 99999;\n      pointer-events: none;\n      animation: vim-cursor-pulse 1s ease-in-out infinite alternate;\n      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 1)) drop-shadow(0 0 4px rgba(0, 0, 0, 0.8));\n      background: rgba(255, 165, 0, 0.9);\n      border: 2px solid white;\n      border-radius: 50%;\n      width: 30px;\n      height: 30px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      box-shadow: 0 0 10px rgba(255, 165, 0, 0.6);\n    ";var l=e.getBoundingClientRect();o.style.top=l.top-15+"px",o.style.left=l.left-15+"px",document.body.appendChild(o)}else{var c=e.textContent;e.setAttribute("data-original-text",c),e.textContent="🧋 "+c}}if(!document.getElementById("vim-cursor-styles")){var s=document.createElement("style");s.id="vim-cursor-styles",s.textContent="\n      @keyframes vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(s)}}(e),e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"})):logger.debug("No element found for cursor")}function m(){document.querySelectorAll(".vim-cursor").forEach(function(e){var t=e.parentElement,n=e.getAttribute("data-original-position"),r=e.getAttribute("data-original-top"),o=e.getAttribute("data-original-left"),a=e.getAttribute("data-original-transform");t&&null!==n&&(t.style.position="static"===n?"":n,t.style.top=r||"",t.style.left=o||"",t.style.transform=a||""),e.remove()}),document.querySelectorAll("[data-original-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-text"),e.removeAttribute("data-original-text")})}function b(){document.body&&document.body.classList.contains("game-page")?logger.warn("Blocked enableVimNavigation - on game page"):(logger.debug("Main vim navigation enabled, isVimNavigationActive:",!0),o=!0,v())}function w(){logger.debug("Main vim navigation disabled"),o=!1,m(),document.querySelectorAll(".vim-cursor, .auth-vim-cursor, .modal-vim-cursor").forEach(function(e){e.remove()})}function y(){v()}function _(){m()}function k(){document.body&&document.body.classList.contains("game-page")?logger.warn("Blocked showCursor - on game page"):(logger.debug("Main vim showCursor called, isVimNavigationActive:",o),o&&v())}},275:(e,t,n)=>{n.d(t,{e:()=>r});var r={MAP_VALUES:{EMPTY:0,BOBA:1,ENEMY:2,PEARL:3,PEARL_MOLD:4},SPRITES:{BOBA:"/static/sprites/character/boba.png",ENEMY:"/static/sprites/character/stop_boba.png",PEARL:"/static/sprites/character/pearl.png",PEARL_MOLD:"/static/sprites/character/pearl_mold.png",DIRECTORY:"/static/sprites/character/",SUFFIX:"_boba.png"},CSS_CLASSES:{BOBA_CHARACTER:"boba-character",BOBA_SHADOW:"boba-shadow",BOBA_SPRITE:"boba-sprite",ENEMY:"enemy",ENEMY_SHADOW:"enemy-shadow",ENEMY_SPRITE:"enemy-sprite",PEARL:"pearl",PEARL_SHADOW:"pearl-shadow",PEARL_SPRITE:"pearl-sprite",PEARL_MOLD:"pearl-mold",PEARL_MOLD_SHADOW:"pearl-mold-shadow",PEARL_MOLD_SPRITE:"pearl-mold-sprite",KEY_TOP:".key-top"},SELECTORS:{GAME_ELEMENTS:".boba-character, .enemy, .pearl, .pearl-mold"}}},282:(e,t,n)=>{n.d(t,{NL:()=>i,_s:()=>l,jZ:()=>a,o$:()=>o});var r={boba:"boba",pinky:"pinky_boba",golden:"golden_boba",black:"black_boba",boba_diamond:"boba_diamond",boba_uncle:"boba_uncle",boss_boba:"boss_boba"};function o(e){var t=r[e]||e;return"/static/sprites/character/".concat(t,".png")}function a(e){var t=function(e){switch(e){case"pinky":return"/static/sprites/avatar/pinky_boba_avatar.png";case"golden":return"/static/sprites/avatar/golden_boba_avatar.png";case"black":return"/static/sprites/avatar/black_boba_avatar.png";case"boba_diamond":return"/static/sprites/avatar/diamond_boba_avatar.png";default:return"/static/sprites/avatar/boba_avatar.png"}}(e);return'\n    <img \n      src="'.concat(t,'" \n      alt="').concat(e,' avatar" \n      style="\n        width: 24px; \n        height: 24px; \n        border-radius: 4px;\n        border: 1px solid #654321;\n        box-shadow: \n          inset 1px 1px 2px rgba(255, 255, 255, 0.15),\n          inset -1px -1px 2px rgba(0, 0, 0, 0.4),\n          0 2px 4px rgba(0, 0, 0, 0.3);\n        background: linear-gradient(145deg, #8b4513, #a0522d, #d2691e);\n        padding: 1px;\n      "\n    />\n  ')}function i(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(e){case"pinky":t="Pinky Boba";break;case"golden":t="Golden Boba";break;case"black":t="Black Boba";break;case"boba_diamond":t="Boba Diamond";break;default:t="Boba"}if(n){if("boba_diamond"===e)return"".concat(t," Level ").concat(n);if(n>1)return"".concat(t," Level ").concat(n)}return t}function l(e){switch(e){case"pinky":return"#FEBDD3";case"golden":return"#FECF35";case"black":return"#170E02";case"boba_diamond":return"#6bcfc6";default:return"#FFA25B"}}},307:(e,t,n)=>{if(n.d(t,{GJ:()=>c,P6:()=>l,es:()=>i,oi:()=>o,w9:()=>a}),!/^(57|980)$/.test(n.j))var r=n(477);function o(e,t,n,o,a){var i=t,l=n,c=o;switch(e){case"left":n>0&&(l=n-1),c=l;break;case"right":n<a[t].length-1&&(l=n+1),c=l;break;case"up":t>0&&(i=t-1,l=(0,r.Zf)(o,i,a));break;case"down":t<a.length-1&&(i=t+1,l=(0,r.Zf)(o,i,a))}return{newRow:i,newCol:l,newPreferredColumn:c}}function a(e,t,n,o,a){var i=t,l=n,c=0;switch(e){case"line_end":o[t].length>0&&(l=o[t].length-1),c=l;break;case"line_start":c=l=0;break;case"line_first_non_blank":c=l=(0,r.TW)(t,a);break;case"line_last_non_blank":c=l=(0,r.DN)(t,a)}return{newRow:i,newCol:l,newPreferredColumn:c}}function i(e,t,n,o,a){var i=t,l=n,c=0;switch(e){case"file_start":i=0,c=l=0;break;case"file_end":i=a.length-1,c=l=(0,r.Zf)(n,i,a)}return{newRow:i,newCol:l,newPreferredColumn:c}}function l(e,t,n,o,a,i){var l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=t,s=n,u=0;switch(e){case"file_start":c=0,u=s=0;break;case"file_end":l?((c=i-1)>=a.length&&(c=a.length-1),c<0&&(c=0)):c=a.length-1,u=s=(0,r.Zf)(n,c,a)}return{newRow:c,newCol:s,newPreferredColumn:u}}function c(e,t,n,o,a){var i=t,l=n,c=o;switch(e){case"screen_top":i=0,l=(0,r.Zf)(o,i,a);break;case"screen_middle":i=Math.floor(a.length/2),l=(0,r.Zf)(o,i,a);break;case"screen_bottom":i=a.length-1,l=(0,r.Zf)(o,i,a)}return{newRow:i,newCol:l,newPreferredColumn:c}}},312:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,l=[],c=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){s=!0,o=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}n.d(t,{G:()=>s,R:()=>c});var c=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sounds={},this.isEnabled=!0,this.storageKey="boba-vim-sound-effects-enabled",this.soundBasePath="/static/music/game/game_effect/",this.init()},t=[{key:"init",value:function(){this.initializeSounds(),this.loadSoundPreference(),logger.debug("Game sound effects initialized")}},{key:"initializeSounds",value:function(){for(var e=this,t=function(){var t=o(r[n],2),a=t[0],i=t[1];e.sounds[a]=new Audio(e.soundBasePath+i),e.sounds[a].volume=.6,e.sounds[a].preload="auto",e.sounds[a].addEventListener("error",function(e){logger.error("Error loading sound effect ".concat(a,":"),e)})},n=0,r=Object.entries({timeout:"time_out.mp3",pearlCollected:"pearl_collected.mp3",moldCollision:"mold_over.mp3",gameComplete:"game_complete.mp3",blockedMovement:"blocked_,movement.mp3"});n<r.length;n++)t()}},{key:"loadSoundPreference",value:function(){var e=localStorage.getItem(this.storageKey);this.isEnabled=null===e||"true"===e,logger.debug("Sound effects preference loaded:",this.isEnabled)}},{key:"saveSoundPreference",value:function(e){this.isEnabled=e,localStorage.setItem(this.storageKey,e.toString()),logger.debug("Sound effects preference saved:",e)}},{key:"playSound",value:function(e){if(this.isEnabled){var t=this.sounds[e];if(t)try{t.currentTime=0;var n=t.play();void 0!==n&&n.then(function(){logger.debug("Sound effect played: ".concat(e))}).catch(function(t){logger.error("Error playing sound effect ".concat(e,":"),t)})}catch(t){logger.error("Error playing sound effect ".concat(e,":"),t)}else logger.warn("Sound effect not found: ".concat(e))}else logger.debug("Sound effects disabled - not playing ".concat(e))}},{key:"playTimeoutSound",value:function(){this.playSound("timeout")}},{key:"playPearlCollectedSound",value:function(){this.playSound("pearlCollected")}},{key:"playMoldCollisionSound",value:function(){this.playSound("moldCollision")}},{key:"playGameCompleteSound",value:function(){this.playSound("gameComplete")}},{key:"playBlockedMovementSound",value:function(){this.playSound("blockedMovement")}},{key:"toggleSoundEffects",value:function(){return this.saveSoundPreference(!this.isEnabled),this.isEnabled}},{key:"enableSoundEffects",value:function(){this.saveSoundPreference(!0)}},{key:"disableSoundEffects",value:function(){this.saveSoundPreference(!1)}},{key:"isSoundEnabled",value:function(){return this.isEnabled}}],t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}());function s(){return c}window.gameSoundEffectsManager=c},409:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function a(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}n.d(t,{g:()=>s});var i,l,c,s=980!=n.j?(i=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=t,this.close=n},l=[{key:"setupGuestEventListeners",value:function(){var e=this;this.modal.addEventListener("click",function(t){"guest-login-btn"===t.target.id?e.handleGuestAction("login"):"guest-register-btn"===t.target.id&&e.handleGuestAction("register")})}},{key:"handleGuestAction",value:function(e){var t=this;this.close(),setTimeout(function(){if(window.showAuthModal)window.showAuthModal(e);else{var n=t.findAuthButton();n?(n.click(),setTimeout(function(){var n=t.findAuthTab(e);n&&n.click()},100)):document.dispatchEvent(new CustomEvent("openAuthModal",{detail:{mode:e}}))}},100)}},{key:"findAuthButton",value:function(){for(var e=0,t=["#loginButton",".auth-button",'[data-auth-modal="true"]',".user-auth-btn","#authButton"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r)return r}return null}},{key:"findAuthTab",value:function(e){for(var t=0,n="login"===e?['.auth-tab[data-tab="login"]',".login-tab",'[data-tab="login"]']:['.auth-tab[data-tab="register"]',".register-tab",'[data-tab="register"]'];t<n.length;t++){var r=n[t],o=document.querySelector(r);if(o)return o}return null}}],l&&o(i.prototype,l),c&&o(i,c),Object.defineProperty(i,"prototype",{writable:!1}),i):null},459:(e,t,n)=>{if(n.d(t,{gk:()=>o}),!/^(57|980)$/.test(n.j))var r=n(477);function o(e,t,n,o){var a=t,i=n,l=0;switch(e){case"word_forward":case"word_forward_space":var c=function(e,t,n,o){if(e<0||e>=n.length)return{newRow:e,newCol:t};var a=e,i=t,l=t<n[e].length?n[e][t]:"";if(logger.debug("findWordForward debug:",{startRow:e,startCol:t,spaceSeparated:o,currentChar:t<n[e].length?'"'.concat(l,'"'):"end-of-line",currentCharCode:l?l.charCodeAt(0):"n/a",lineContent:'"'.concat(n[e].join(""),'"'),isSpace:t<n[e].length&&(0,r.xC)(l),isWordChar:t<n[e].length&&(0,r.x8)(l),isPunctuation:t<n[e].length&&(0,r.Bx)(l)}),o)for(;a<n.length&&i<n[a].length;){var c=n[a][i];if((0,r.xC)(c))break;i++}else if(i<n[a].length){var s=n[a][i];if((0,r.x8)(s))for(;a<n.length&&i<n[a].length;){var u=n[a][i];if(!(0,r.x8)(u))break;i++}else(0,r.Bx)(s)&&(i++,logger.debug("Punctuation: moved to position",i,"continuing to whitespace/line-wrap logic"))}for(;a<n.length&&i<n[a].length;){var d=n[a][i];if(!(0,r.xC)(d))break;i++}if(a<n.length&&i>=n[a].length)for(a++,i=0;a<n.length&&i<n[a].length;){var f=n[a][i];if(!(0,r.xC)(f))break;i++}a>=n.length?i=n[a=n.length-1].length-1:a>=0&&i>=n[a].length&&(i=n[a].length-1);return logger.debug("findWordForward result:",{originalPos:"".concat(e,",").concat(t),newPos:"".concat(a,",").concat(i),moved:a!==e||i!==t}),{newRow:a,newCol:i}}(t,n,o,"word_forward_space"===e);a=c.newRow,l=i=c.newCol;break;case"word_backward":case"word_backward_space":var s=function(e,t,n,o){if(e<0||e>=n.length)return{newRow:e,newCol:t};var a=e,i=t;if(i--,i<0){if(!(a>0))return{newRow:0,newCol:0};--a>=0&&a<n.length&&(i=n[a].length-1)}if(a<0||i<0)return{newRow:0,newCol:0};for(;a>=0&&i>=0&&!(a>=n.length||i>=n[a].length);){var l=n[a][i];if(!(0,r.xC)(l))break;--i<0&&a>0&&--a>=0&&a<n.length&&(i=n[a].length-1)}if(a>=0&&i>=0&&a<n.length&&i<n[a].length){var c=n[a][i];if(o)for(;i>0;){var s=n[a][i-1];if((0,r.xC)(s))break;i--}else if((0,r.x8)(c))for(;i>0;){var u=n[a][i-1];if(!(0,r.x8)(u))break;i--}else(0,r.Bx)(c)}a<0?(a=0,i=0):i<0&&(i=0);return{newRow:a,newCol:i}}(t,n,o,"word_backward_space"===e);a=s.newRow,l=i=s.newCol;break;case"word_end":var u=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var o=e,a=t;if(a<n[o].length&&(0,r.xC)(n[o][a])){for(;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++;if(o<n.length&&a>=n[o].length)for(o++,a=0;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++}if(o<n.length&&a<n[o].length){var i=n[o][a];if((0,r.x8)(i))if(a===n[o].length-1||a+1<n[o].length&&!(0,r.x8)(n[o][a+1])){for(a++;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++;if(o<n.length&&a>=n[o].length)for(o++,a=0;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++;if(o<n.length&&a<n[o].length)if(i=n[o][a],(0,r.x8)(i))for(;a<n[o].length-1;){var l=n[o][a+1];if(!(0,r.x8)(l))break;a++}else(0,r.Bx)(i)}else for(;a<n[o].length-1;){var c=n[o][a+1];if(!(0,r.x8)(c))break;a++}else if((0,r.Bx)(i)){if(a===n[o].length-1||a+1<n[o].length&&!(0,r.Bx)(n[o][a+1])){for(a++;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++;if(o<n.length&&a>=n[o].length)for(o++,a=0;o<n.length&&a<n[o].length&&(0,r.xC)(n[o][a]);)a++;if(o<n.length&&a<n[o].length&&(i=n[o][a],(0,r.x8)(i)))for(;a<n[o].length-1;){var s=n[o][a+1];if(!(0,r.x8)(s))break;a++}}else for(;a<n[o].length-1;){var u=n[o][a+1];if(!(0,r.Bx)(u))break;a++}}}o>=n.length?a=n[o=n.length-1].length-1:o>=0&&a>=n[o].length&&(a=n[o].length-1);return{newRow:o,newCol:a}}(t,n,o);a=u.newRow,l=i=u.newCol;break;case"word_end_space":var d=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var o=e,a=t;if(a<n[o].length){var i=n[o][a];if(!(0,r.xC)(i)){for(;o<n.length&&a<n[o].length;){var l=n[o][a];if((0,r.xC)(l))break;a++}for(;o<n.length&&a<n[o].length;){var c=n[o][a];if(!(0,r.xC)(c))break;a++}if(o<n.length&&a>=n[o].length)for(o++,a=0;o<n.length&&a<n[o].length;){var s=n[o][a];if(!(0,r.xC)(s))break;a++}}}if(o<n.length&&a<n[o].length)for(;a<n[o].length-1;){var u=n[o][a+1];if((0,r.xC)(u))break;a++}o>=n.length?a=n[o=n.length-1].length-1:o>=0&&a>=n[o].length&&(a=n[o].length-1);return{newRow:o,newCol:a}}(t,n,o);a=d.newRow,l=i=d.newCol;break;case"word_end_prev":var f=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var o=e,a=t;if(a<n[o].length){var i=n[o][a];if((0,r.x8)(i))for(;a>0;){var l=n[o][a-1];if(!(0,r.x8)(l))break;a--}else if((0,r.Bx)(i))for(;a>0;){var c=n[o][a-1];if(!(0,r.Bx)(c))break;a--}}if(a--,a<0){if(!(o>0))return{newRow:e,newCol:t};--o>=0&&o<n.length&&(a=n[o].length-1)}if(o<0||a<0)return{newRow:e,newCol:t};for(;o>=0&&a>=0&&!(o>=n.length||a>=n[o].length);){var s=n[o][a];if(!(0,r.xC)(s))break;--a<0&&o>0&&--o>=0&&o<n.length&&(a=n[o].length-1)}if(o>=0&&a>=0&&o<n.length&&a<n[o].length){var u=n[o][a];if((0,r.x8)(u))for(;a<n[o].length-1;){var d=n[o][a+1];if(!(0,r.x8)(d))break;a++}else if((0,r.Bx)(u))for(;a<n[o].length-1;){var f=n[o][a+1];if(!(0,r.Bx)(f))break;a++}}o<0?(o=0,a=0):a<0?a=0:o>=0&&a>=n[o].length&&(a=n[o].length-1);if(o!==e||a!==t)return{newRow:o,newCol:a};return{newRow:e,newCol:t}}(t,n,o);a=f.newRow,l=i=f.newCol;break;case"word_end_prev_space":var h=function(e,t,n){if(e<0||e>=n.length)return{newRow:e,newCol:t};var o=e,a=t;if(a<n[o].length){var i=n[o][a];if(!(0,r.xC)(i))for(;a>0;){var l=n[o][a-1];if((0,r.xC)(l))break;a--}}if(a--,a<0){if(!(o>0))return{newRow:e,newCol:t};--o>=0&&o<n.length&&(a=n[o].length-1)}if(o<0||a<0)return{newRow:e,newCol:t};for(;o>=0&&a>=0&&!(o>=n.length||a>=n[o].length);){var c=n[o][a];if(!(0,r.xC)(c))break;--a<0&&o>0&&--o>=0&&o<n.length&&(a=n[o].length-1)}if(o>=0&&a>=0&&o<n.length&&a<n[o].length)for(;a<n[o].length-1;){var s=n[o][a+1];if((0,r.xC)(s))break;a++}o<0?(o=0,a=0):a<0?a=0:o>=0&&a>=n[o].length&&(a=n[o].length-1);if(o!==e||a!==t)return{newRow:o,newCol:a};return{newRow:e,newCol:t}}(t,n,o);a=h.newRow,l=i=h.newCol}return{newRow:a,newCol:i,newPreferredColumn:l}}},477:(e,t,n)=>{function r(e){if(!e||0===e.length)return!1;var t=e.charCodeAt(0);return t>=97&&t<=122||t>=65&&t<=90||t>=48&&t<=57||95===t}function o(e){return" "===e||"\t"===e}function a(e){return!(!e||0===e.length)&&(!r(e)&&!o(e))}function i(e,t,n){if(t<0||t>=n.length)return e;var r=n[t].length-1;return e<0?0:e>r?r:e}function l(e,t,n){return e>=0&&e<n.length&&t>=0&&t<n[e].length&&!(!(r=n[e])||0===r.length||r.every(function(e){return o(e)||""===e}));var r}function c(e,t){if(e<0||e>=t.length)return 0;for(var n=0;n<t[e].length;n++){var r=t[e][n];if(!o(r)&&""!==r)return n}return 0}function s(e,t){if(e<0||e>=t.length)return 0;if(0===t[e].length)return 0;for(var n=t[e].length-1;n>=0;n--){var r=t[e][n];if(!o(r)&&""!==r)return n}return 0}n.d(t,{Bx:()=>a,DN:()=>s,TW:()=>c,Zf:()=>i,u1:()=>l,x8:()=>r,xC:()=>o})},597:(e,t,n)=>{n.d(t,{w:()=>r});var r={MODAL:{Z_INDEX:1e3,LEADERBOARD_Z_INDEX:1001},COLORS:{TITLE:"#ffd700",MODAL_BG:"#2c3e50",OVERLAY:"rgba(0, 0, 0, 0.8)",BORDER:"#34495e",BUTTON_GRAY:"#95a5a6"},GRADIENTS:{LEADERBOARD:"linear-gradient(45deg, #f39c12, #e67e22)",PLAY_SAME_MAP:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",PREVIOUS_MAP:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",NEXT_MAP:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",BACK_MENU:"linear-gradient(45deg, #9b59b6, #8e44ad)"},SHADOWS:{BUTTON:"0 8px 20px rgba(0, 0, 0, 0.2)",MODAL:"0 0 20px rgba(255, 215, 0, 0.5)"},MESSAGES:{COMPLETION_TITLE:"Game Completed!",FINAL_SCORE:"Final Score:",COMPLETION_TIME:"Completion Time:",TIME_FALLBACK:"--:--",LEADERBOARD_TITLE:"🏆 Leaderboard 🏆",RANK_HEADER:"Rank",PLAYER_HEADER:"Player",TIME_HEADER:"Time",CLOSE:"Close"},BUTTONS:{LEADERBOARD:"🏆 Leaderboard",PLAY_SAME_MAP:"Play Same Map",PREVIOUS_MAP:"⬅️ Previous Map",NEXT_MAP:"➡️ Next Map",BACK_MENU:"Back to Menu",HOVER_ICON:"🧋"},ELEMENT_IDS:{COMPLETION_MODAL:"completionModal",LEADERBOARD_MODAL:"leaderboardModal",VIEW_LEADERBOARD:"viewLeaderboard",PLAY_SAME_MAP:"playSameMap",PREVIOUS_MAP:"previousMap",NEXT_MAP:"nextMap",BACK_TO_MENU:"backToMenu",CLOSE_LEADERBOARD:"closeLeaderboard"},NAVIGATION:{PLAY_URL:"/play",MENU_URL:"/"},TIMING:{MODAL_DELAY_MS:2e3}}},630:(e,t,n)=>{function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{H:()=>ee});var a=0,i=!1,l=980!=n.j?[]:null,c=[{selector:"#leaderboardModeToggle",column:1,row:0,type:"button"},{selector:".close-modal-footer",column:1,row:2,type:"button"}],s=980!=n.j?[]:null;function u(){i=!1,m(),document.removeEventListener("keydown",g),logger.debug("Leaderboard vim navigation disabled")}function d(e){l=[],s=[],c.forEach(function(t){var n=e.querySelector(t.selector);n&&function(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden")}catch(e){return!1}}(n)&&l.push(t)}),e.querySelectorAll(".footer-map-btn").forEach(function(e,t){var n={selector:'.footer-map-btn[data-map="'.concat(e.dataset.map,'"]'),column:t%4,row:1+Math.floor(t/4),type:"map-button"};s.push(n),l.push(n)}),l.sort(function(e,t){return e.row!==t.row?e.row-t.row:e.column-t.column}),logger.debug("Available leaderboard elements:",l.length)}function f(){for(var e=0;e<l.length;e++)if(".close-modal-footer"===l[e].selector)return e;return Math.max(0,l.length-1)}function h(e){if(a<0||a>=l.length)return null;var t=l[a];if(!t)return null;try{return e.querySelector(t.selector)}catch(e){return null}}function g(e){if(i){var t=document.querySelector(".leaderboard-modal-overlay");if(t&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable)switch(e.key.toLowerCase()){case"h":e.preventDefault(),function(e){var t=l[a];if(!t)return;if("map-button"===t.type){var n=l.filter(function(e){return"map-button"===e.type}),r=n.findIndex(function(e){return e===t});if(r>0){var o=n[r-1],i=l.findIndex(function(e){return e===o});if(i>=0)return a=i,void v(e)}else{var c=n[n.length-1],s=l.findIndex(function(e){return e===c});if(s>=0)return a=s,void v(e)}}for(var u=t.column-1,d=u<0?p():u,f=-1,h=1/0,g=0;g<l.length;g++){var m=l[g];if(m.column===d&&"map-button"!==m.type){var b=Math.abs(m.row-t.row);b<h&&(h=b,f=g)}}f>=0&&(a=f,v(e))}(t);break;case"j":e.preventDefault(),function(e){var t=l[a];if(!t)return;if("#leaderboardModeToggle"===t.selector){var n=l.find(function(e){return"map-button"===e.type});if(n){var r=l.findIndex(function(e){return e===n});if(r>=0)return a=r,void v(e)}var o=l.findIndex(function(e){return".close-modal-footer"===e.selector});if(o>=0)a=o,v(e)}else if("map-button"===t.type){var i=l.findIndex(function(e){return".close-modal-footer"===e.selector});if(i>=0)a=i,v(e)}else if(".close-modal-footer"===t.selector){var c=l.findIndex(function(e){return"#leaderboardModeToggle"===e.selector});if(c>=0)a=c,v(e)}}(t);break;case"k":e.preventDefault(),function(e){var t=l[a];if(!t)return;if(".close-modal-footer"===t.selector){var n=l.findIndex(function(e){return"#leaderboardModeToggle"===e.selector});if(n>=0)a=n,v(e)}else if("map-button"===t.type){var r=l.findIndex(function(e){return"#leaderboardModeToggle"===e.selector});if(r>=0)a=r,v(e)}else if("#leaderboardModeToggle"===t.selector){var o=l.findIndex(function(e){return".close-modal-footer"===e.selector});if(o>=0)a=o,v(e)}}(t);break;case"l":e.preventDefault(),function(e){var t=l[a];if(!t)return;if("map-button"===t.type){var n=l.filter(function(e){return"map-button"===e.type}),r=n.findIndex(function(e){return e===t});if(r<n.length-1){var o=n[r+1],i=l.findIndex(function(e){return e===o});if(i>=0)return a=i,void v(e)}else{var c=n[0],s=l.findIndex(function(e){return e===c});if(s>=0)return a=s,void v(e)}}for(var u=t.column+1,d=p(),f=u>d?0:u,h=-1,g=1/0,m=0;m<l.length;m++){var b=l[m];if(b.column===f&&"map-button"!==b.type){var w=Math.abs(b.row-t.row);w<g&&(g=w,h=m)}}h>=0&&(a=h,v(e))}(t);break;case"enter":e.preventDefault(),function(e){var t=h(e);if(logger.debug("Leaderboard activating element:",t),!t)return void logger.debug("No element to activate in leaderboard");try{t.click()}catch(e){logger.debug("Error clicking leaderboard element:",e)}}(t);break;case"escape":e.preventDefault();var n=t.querySelector(".close-modal-footer");n&&n.click()}}}function p(){return Math.max.apply(Math,r(l.map(function(e){return e.column})))}function v(e){logger.debug("Leaderboard updateCursor called"),m();var t=h(e);logger.debug("Leaderboard current element for cursor:",t),t?function(e){if(!e)return;var t=document.createElement("div");t.className="leaderboard-vim-cursor",t.textContent="🧋",t.style.cssText="\n    position: fixed;\n    font-size: 20px;\n    z-index: 99999;\n    pointer-events: none;\n    animation: leaderboard-vim-cursor-pulse 1s ease-in-out infinite alternate;\n    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n    background: rgba(255, 165, 0, 0.8);\n    border: 2px solid white;\n    border-radius: 50%;\n    width: 35px;\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n  ";var n=e.getBoundingClientRect();if(t.style.top=n.top-10+"px",t.style.left=n.left-10+"px",document.body.appendChild(t),!document.getElementById("leaderboard-vim-cursor-styles")){var r=document.createElement("style");r.id="leaderboard-vim-cursor-styles",r.textContent="\n      @keyframes leaderboard-vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(r)}}(t):logger.debug("No element found for leaderboard cursor")}function m(){document.querySelectorAll(".leaderboard-vim-cursor").forEach(function(e){e.remove()}),document.querySelectorAll("[data-original-leaderboard-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-leaderboard-text"),e.removeAttribute("data-original-leaderboard-text")})}function b(e){i&&e&&(d(e),a=f(),v(e))}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_(r.key),r)}}function _(e){var t=function(e,t){if("object"!=w(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==w(t)?t:t+""}var k,C,x,M=980!=n.j?(k=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null},(C=[{key:"createModalOverlay",value:function(){var e=document.createElement("div");e.className="leaderboard-modal-overlay";var t=document.querySelector(".completion-modal")||document.querySelector("#completionModal")||document.querySelector('[id*="completion"]')?10001:1e3;if(e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      z-index: ".concat(t,";\n      animation: fadeIn 0.3s ease;\n    "),window.hideCursor)window.hideCursor(),setTimeout(function(){try{n.e(76).then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}},0);else try{n.e(76).then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}return setTimeout(function(){var t;t=e,logger.debug("Initializing leaderboard vim navigation..."),t?(d(t),a=f(),i=!0,logger.debug("Leaderboard vim starting at element index: ".concat(a)),v(t),document.addEventListener("keydown",g),logger.debug("Leaderboard vim navigation initialized")):logger.warn("No modal provided for leaderboard vim navigation")},100),e}},{key:"createModalContent",value:function(e,t){var n=document.createElement("div");n.className="leaderboard-modal";var r=window.innerWidth<=768,o=window.innerWidth<=480;return n.style.cssText="\n      background: #2c3e50;\n      color: white;\n      border-radius: 10px;\n      padding: ".concat(o?"0.8rem":r?"1rem":"1.2rem",";\n      max-width: ").concat(o?"98%":r?"95%":"950px",";\n      width: ").concat(o?"98%":r?"95%":"96%",";\n      height: ").concat(o?"95vh":r?"93vh":"92vh",";\n      max-height: ").concat(o?"95vh":r?"93vh":"92vh",";\n      display: flex;\n      flex-direction: column;\n      box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n      animation: slideIn 0.3s ease;\n      position: relative;\n      overflow: hidden;\n    "),n.innerHTML='\n      <div class="modal-header">\n        <h2 class="leaderboard-title">'.concat(e,"</h2>\n        ").concat(t?'\n          <div class="toggle-container">\n            <button id="leaderboardModeToggle" class="eightbit-btn">\n              🏆 Normal Mode\n            </button>\n          </div>\n        ':"",'\n        <div class="player-position-section"></div>\n      </div>\n      <div class="main-content">\n        <div class="leaderboard-content">\n          <div class="loading-spinner">\n            <div>Loading leaderboard...</div>\n          </div>\n        </div>\n      </div>\n    '),n}},{key:"createMapNavigationFooter",value:function(e){return'\n      <div class="modal-footer">\n        <div class="footer-map-buttons">\n          <div class="map-grid">\n            '.concat(e.map(function(e){return'\n              <button class="footer-map-btn eightbit-leaderboard-btn" data-map="'.concat(e.id,'">\n                ').concat(e.name,"\n              </button>\n            ")}).join(""),'\n          </div>\n        </div>\n        <div style="text-align: center; flex-shrink: 0;">\n          <button class="close-modal-footer eightbit-btn eightbit-close-btn">Close</button>\n        </div>\n      </div>\n    ')}},{key:"createSimpleFooter",value:function(){return'\n      <div class="modal-footer">\n        <div style="text-align: center;">\n          <button class="close-modal-footer eightbit-btn eightbit-close-btn">Close</button>\n        </div>\n      </div>\n    '}},{key:"closeModal",value:function(){var e=this;if(this.modal){this.modal.style.animation="fadeOut 0.3s ease",u(),window.showCursor&&window.showCursor();try{n.e(76).then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){})}catch(e){}setTimeout(function(){e.modal&&e.modal.parentNode&&e.modal.parentNode.removeChild(e.modal)},300)}}}])&&y(k.prototype,C),x&&y(k,x),Object.defineProperty(k,"prototype",{writable:!1}),k):null;function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function E(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof l?r:l,s=Object.create(c.prototype);return T(s,"_invoke",function(n,r,o){var a,l,c,s=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,l=0,c=e,f.n=n,i}};function h(n,r){for(l=n,c=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],h=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=n<2&&h<a[1])?(l=0,f.v=r,f.n=a[1]):h<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,l=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,g){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,g),l=u,c=g;(t=l<2?e:c)||!d;){a||(l?l<3?(l>1&&(f.n=-1),h(l,c)):f.n=c:f.v=c);try{if(s=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,l=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function l(){}function c(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(T(t={},r,function(){return this}),t),d=s.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,T(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=s,T(d,"constructor",s),T(s,"constructor",c),c.displayName="GeneratorFunction",T(s,o,"GeneratorFunction"),T(d),T(d,o,"Generator"),T(d,r,function(){return this}),T(d,"toString",function(){return"[object Generator]"}),(E=function(){return{w:a,m:f}})()}function T(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}T=function(e,t,n,r){function a(t,n){T(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},T(e,t,n,r)}function L(e,t,n,r,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function R(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){L(a,r,o,i,l,"next",e)}function l(e){L(a,r,o,i,l,"throw",e)}i(void 0)})}}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function P(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var N=function(){return function(e,t,n){return t&&A(e.prototype,t),n&&A(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.multiplayerMode=t},[{key:"fetchLeaderboardData",value:(n=R(E().m(function e(t){var n,r,o,a,i,l,c,s,u;return E().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=this.multiplayerMode?"/api/multiplayer/leaderboard?limit=20":"/api/leaderboard-by-map?map_id=".concat(t&&t>0?t:1),e.n=1,fetch(n,{method:"GET",credentials:"include"});case 1:if((r=e.v).ok){e.n=2;break}throw new Error("HTTP ".concat(r.status,": ").concat(r.statusText));case 2:return e.n=3,r.json();case 3:return o=e.v,e.n=4,fetch("/api/auth/me",{credentials:"include"});case 4:if(!(a=e.v).ok){e.n=10;break}return e.n=5,a.json();case 5:if(!(i=e.v).success||!i.authenticated){e.n=9;break}return l=this.multiplayerMode?"/api/multiplayer/player-position":"/api/leaderboard-by-map?map_id=".concat(t&&t>0?t:1,"&player_position=true"),e.n=6,fetch(l,{credentials:"include"});case 6:if(!(c=e.v).ok){e.n=8;break}return e.n=7,c.json();case 7:(s=e.v).success&&s.player_position?o.player_position=s.player_position:"Confirm your account to get in the leaderboard"===s.error&&(o.unconfirmed_user=!0);case 8:e.n=10;break;case 9:o.is_guest=!0;case 10:return e.a(2,o);case 11:throw e.p=11,u=e.v,logger.error("Error fetching leaderboard:",u),u;case 12:return e.a(2)}},e,this,[[0,11]])})),function(e){return n.apply(this,arguments)})},{key:"fetchMaps",value:(t=R(E().m(function e(){var t,n,r;return E().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/maps");case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.maps){e.n=3;break}return e.a(2,n.maps);case 3:return e.a(2,[]);case 4:return e.p=4,r=e.v,logger.error("Error fetching maps:",r),e.a(2,[])}},e,null,[[0,4]])})),function(){return t.apply(this,arguments)})},{key:"resendConfirmationEmail",value:(e=R(E().m(function e(){var t,n,r,o;return E().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.querySelector('button[onclick="resendConfirmationFromLeaderboard()"]')){e.n=1;break}return e.a(2);case 1:return n=t.textContent,e.p=2,t.disabled=!0,t.textContent="Sending...",e.n=3,fetch("/api/auth/resend-confirmation",{method:"POST",headers:{"Content-Type":"application/json"}});case 3:return r=e.v,e.n=4,r.json();case 4:e.v.success?this.updateButtonState(t,"Email sent!","#27ae60",n):this.updateButtonState(t,"Failed to send","#e74c3c",n),e.n=6;break;case 5:e.p=5,o=e.v,logger.error("Error resending confirmation:",o),this.updateButtonState(t,"Network error","#e74c3c",n);case 6:return e.a(2)}},e,this,[[2,5]])})),function(){return e.apply(this,arguments)})},{key:"updateButtonState",value:function(e,t,n,r){e.textContent=t,e.style.background=n,setTimeout(function(){e.disabled=!1,e.textContent=r,e.style.background="#f39c12"},3e3)}}]);var e,t,n}(),B=n(282);function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,j(r.key),r)}}function j(e){var t=function(e,t){if("object"!=O(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==O(t)?t:t+""}var D=980!=n.j?function(e,t,n){return t&&I(e.prototype,t),n&&I(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.multiplayerMode=t},[{key:"createLeaderboardTableHTML",value:function(e){if(!e||0===e.length)return'<div class="empty-state">No players found</div>';var t=this.deduplicateLeaderboard(e);return this.multiplayerMode?this.createMultiplayerTableHTML(t):this.createSoloTableHTML(t)}},{key:"deduplicateLeaderboard",value:function(e){var t=this,n=new Map;return e.forEach(function(e){var r=e.username;if(r)if(n.has(r)){var o=n.get(r);if(t.multiplayerMode){var a=t.calculateMultiplayerScore(o);t.calculateMultiplayerScore(e)>a&&n.set(r,e)}else{var i=o.completion_time||1/0;(e.completion_time||1/0)<i&&n.set(r,e)}}else n.set(r,e)}),Array.from(n.values())}},{key:"calculateMultiplayerScore",value:function(e){var t=e.win_rate||0,n=e.total_games_played||0;return t+Math.min(.5*n,25)+(n>0?5:0)}},{key:"createMultiplayerTableHTML",value:function(e){var t=this;return'\n      <table class="leaderboard-table">\n        <thead>\n          <tr>\n            <th class="rank-col">#</th>\n            <th class="player-col">Player</th>\n            <th class="winrate-col">Win Rate</th>\n            <th class="wins-col">Wins</th>\n            <th class="defeats-col">Defeats</th>\n            <th class="games-col">Games</th>\n          </tr>\n        </thead>\n        <tbody>\n          '.concat(e.map(function(e,n){return t.createTableRow(e,n+1)}).join(""),"\n        </tbody>\n      </table>\n    ")}},{key:"createSoloTableHTML",value:function(e){var t=this;return'\n      <table class="leaderboard-table solo-table">\n        <thead>\n          <tr>\n            <th class="rank-col">#</th>\n            <th class="player-col solo">Player</th>\n            <th class="time-col">Time</th>\n            <th class="moves-col">Moves</th>\n          </tr>\n        </thead>\n        <tbody>\n          '.concat(e.map(function(e,n){return t.createTableRow(e,n+1)}).join(""),"\n        </tbody>\n      </table>\n    ")}},{key:"createTableRow",value:function(e,t){if(this.multiplayerMode){var n=e.win_rate?e.win_rate.toFixed(1):"0.0",r=e.total_games_played-e.total_wins;return'\n        <tr>\n          <td class="rank-cell">'.concat(t,'</td>\n          <td class="player-cell">\n            <div class="player-info">\n              ').concat((0,B.jZ)(e.selected_character),'\n              <div class="player-name-container">\n                <div class="player-name" style="color: ').concat((0,B._s)(e.selected_character),'">\n                  ').concat(e.username||"Unknown Player",'\n                </div>\n                <div class="player-character">\n                  ').concat((0,B.NL)(e.selected_character,e.character_level),'\n                </div>\n              </div>\n            </div>\n          </td>\n          <td class="winrate-cell">').concat(n,'%</td>\n          <td class="wins-cell">').concat(e.total_wins||0,'</td>\n          <td class="defeats-cell">').concat(r||0,'</td>\n          <td class="games-cell">').concat(e.total_games_played||0,"</td>\n        </tr>\n      ")}return'\n        <tr>\n          <td class="rank-cell">'.concat(t,'</td>\n          <td class="player-cell solo">\n            <div class="player-info">\n              ').concat((0,B.jZ)(e.selected_character),'\n              <div class="player-name-container">\n                <div class="player-name" style="color: ').concat((0,B._s)(e.selected_character),'">\n                  ').concat(e.username||"Unknown Player",'\n                </div>\n                <div class="player-character">\n                  ').concat((0,B.NL)(e.selected_character,e.character_level),'\n                </div>\n              </div>\n            </div>\n          </td>\n          <td class="time-cell">').concat(e.completion_time_formatted||this.formatTime(e.completion_time),'</td>\n          <td class="moves-cell">').concat(e.total_moves||e.move_count||e.moves||"--","</td>\n        </tr>\n      ")}},{key:"createPlayerPositionHTML",value:function(e,t){if(!e)return"";var n=this.multiplayerMode,r=n?"".concat((e.wins/e.total_games*100).toFixed(1),"%"):e.completion_time_formatted||this.formatTime(e.completion_time),o=n?"Win Rate":"Best Time";return'\n      <div class="player-position-card">\n        <h3 class="player-position-header">Your Position</h3>\n        <div class="player-position-info">\n          <div class="player-position-left">\n            <span class="player-rank">#'.concat(e.rank,"</span>\n            ").concat((0,B.jZ)(e.selected_character),'\n            <span class="player-position-name" style="color: ').concat((0,B._s)(e.selected_character),'">\n              ').concat(e.username||"You",'\n            </span>\n            <span class="player-position-character">\n              ').concat((0,B.NL)(e.selected_character,e.character_level),'\n            </span>\n          </div>\n          <div class="player-position-right">\n            <div class="player-stat-value">').concat(r,'</div>\n            <div class="player-stat-label">').concat(o,"</div>\n          </div>\n        </div>\n      </div>\n    ")}},{key:"createUnconfirmedUserHTML",value:function(e){return'\n      <div style="\n        background: linear-gradient(45deg, #e67e22, #d35400);\n        padding: 0.8rem;\n        border-radius: 8px;\n        margin: 0.6rem auto 0 auto;\n        border: 1px solid #f39c12;\n        box-shadow: 0 3px 6px rgba(0,0,0,0.3);\n        text-align: center;\n        max-width: 450px;\n        position: relative;\n      ">\n        <div style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.6rem;">\n          <img \n            src="/static/sprites/avatar/boba_avatar.png" \n            alt="Boba Avatar" \n            style="\n              width: 22px; \n              height: 22px; \n              border-radius: 50%;\n              border: 2px solid #f39c12;\n            "\n          />\n          <h4 style="color: #fff; margin: 0; font-size: 1rem; text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">\n            📧 Email Confirmation Required\n          </h4>\n        </div>\n        <p style="color: #ecf0f1; margin: 0 0 0.8rem 0; font-size: 0.85rem; line-height: 1.4;">\n          Confirm your account to get in the leaderboard\n        </p>\n        <div style="display: flex; justify-content: center;">\n          <button \n            onclick="resendConfirmationFromLeaderboard()" \n            style="\n              background: #f39c12;\n              color: white;\n              border: none;\n              padding: 0.5rem 1.2rem;\n              border-radius: 6px;\n              cursor: pointer;\n              font-size: 0.8rem;\n              transition: all 0.3s ease;\n              box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n              font-weight: bold;\n              text-transform: uppercase;\n              letter-spacing: 0.5px;\n            "\n            onmouseover="this.style.background=\'#e67e22\'; this.style.transform=\'translateY(-2px)\'; this.style.boxShadow=\'0 4px 8px rgba(0,0,0,0.4)\'"\n            onmouseout="this.style.background=\'#f39c12\'; this.style.transform=\'translateY(0)\'; this.style.boxShadow=\'0 2px 4px rgba(0,0,0,0.3)\'"\n          >\n            Resend Confirmation Email\n          </button>\n        </div>\n      </div>\n    '}},{key:"createGuestSuggestionHTML",value:function(e){return 0!==e?this.createCompactGuestHTML():this.createFullGuestHTML()}},{key:"createCompactGuestHTML",value:function(){return'\n      <div class="guest-actions compact">\n        <h4 class="auth-title">🔒 Join the Leaderboard!</h4>\n        <p class="auth-description">Create an account to get in leaderboard</p>\n        <div class="auth-buttons">\n          <button id="guest-login-btn" class="auth-button">Login</button>\n          <button id="guest-register-btn" class="auth-button">Register</button>\n        </div>\n      </div>\n    '}},{key:"createFullGuestHTML",value:function(){return'\n      <div class="guest-actions">\n        <h4 class="auth-title">🔒 Authentication Required</h4>\n        <p class="auth-description">Create an account to get in leaderboard</p>\n        <div class="auth-prompt">\n          <button id="guest-login-btn" class="auth-button">Login</button>\n          <button id="guest-register-btn" class="auth-button">Register</button>\n        </div>\n      </div>\n    '}},{key:"createEmptyLeaderboardHTML",value:function(e){var t;return t=this.multiplayerMode?"No multiplayer games yet! Challenge other players to see rankings!":0===e?"No scores yet! Be the first to complete any map!":"No scores yet for this map! Be the first to complete it!",'\n      <div class="empty-state">\n        <div class="empty-icon-container">\n          <div class="empty-icon">🏆</div>\n        </div>\n        <h3 class="empty-title">No Scores Yet</h3>\n        <p class="empty-message">'.concat(t,'</p>\n        <p class="empty-subtitle">Start playing to see your name here!</p>\n      </div>\n    ')}},{key:"createErrorHTML",value:function(e){return'\n      <div class="error-state">\n        <div class="error-icon-container">\n          <div class="error-icon">⚠️</div>\n        </div>\n        <h3 class="error-title">Unable to Load Leaderboard</h3>\n        <p class="error-message">'.concat(e,'</p>\n        <p class="error-subtitle">Please try again later or contact support if the problem persists.</p>\n      </div>\n    ')}},{key:"formatTime",value:function(e){if(null==e)return"N/A";var t=Number(e)/1e3;if(t<60)return t.toFixed(2);var n=Math.floor(t/60),r=t-60*n;return"".concat(n,":").concat(r.toFixed(2).padStart(5,"0"))}}]):null;function H(e){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},H(e)}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,q(r.key),r)}}function q(e){var t=function(e,t){if("object"!=H(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=H(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==H(t)?t:t+""}var F=980!=n.j?function(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=t,this.multiplayerMode=n.multiplayerMode||!1,this.showMapNavigation=n.showMapNavigation||!1,this.showModeToggle=n.showModeToggle||!1,this.onClose=n.onClose||null,this.loadLeaderboard=n.loadLeaderboard||function(){},this.updateMode=n.updateMode||function(){}},[{key:"setupEventHandlers",value:function(){this.setupCloseHandlers(),this.setupModalClickHandler(),this.setupEscapeKeyHandler(),this.showMapNavigation&&!this.multiplayerMode&&this.setupMapNavigation(),this.showMapNavigation&&this.showModeToggle&&this.setupToggleButton()}},{key:"setupCloseHandlers",value:function(){var e=this,t=this.modal.querySelector(".close-modal-footer");t&&(t.onclick=function(){return e.close(),!1},t.addEventListener("click",function(){return e.close()}))}},{key:"setupModalClickHandler",value:function(){var e=this;this.modal.addEventListener("click",function(t){t.target===e.modal&&e.close()})}},{key:"setupEscapeKeyHandler",value:function(){var e=this,t=function(n){"Escape"===n.key&&(e.close(),document.removeEventListener("keydown",t))};document.addEventListener("keydown",t)}},{key:"setupMapNavigation",value:function(){var e=this;this.modal.addEventListener("click",function(t){if(t.target.classList.contains("footer-map-btn")){var n=parseInt(t.target.dataset.map);n&&(e.loadLeaderboard(n),setTimeout(function(){b(e.modal.closest(".leaderboard-modal-overlay"))},100))}})}},{key:"setupToggleButton",value:function(){var e=this,t=this.modal.querySelector("#leaderboardModeToggle");if(t){var n=function(e){e?(t.textContent="🎮 Multiplayer Mode",t.style.background="#e67e22"):(t.textContent="🏆 Normal Mode",t.style.background="#3498db")};n(this.multiplayerMode),t.addEventListener("click",function(){e.multiplayerMode=!e.multiplayerMode,n(e.multiplayerMode),e.updateMode(e.multiplayerMode);var t=e.modal.querySelector(".leaderboard-title");if(t){var r=t.textContent.split(" - ")[1]||"Map 1";t.textContent=e.multiplayerMode?"🏆 Multiplayer Leaderboard":"🏆 Leaderboard - ".concat(r)}var o=e.modal.querySelector(".footer-map-buttons");o&&(o.style.display=e.multiplayerMode?"none":"block");var a=e.getCurrentMapId();e.loadLeaderboard(a),setTimeout(function(){b(e.modal.closest(".leaderboard-modal-overlay"))},100)})}}},{key:"getCurrentMapId",value:function(){var e=this.modal.querySelector(".leaderboard-title");return e&&(e.textContent.includes("Map 1")||e.textContent.includes("Welcome to Boba")),1}},{key:"close",value:function(){var e=this;if(this.modal){if(this.modal.style.animation="fadeOut 0.3s ease",u(),window.showCursor&&window.showCursor(),window.enableVimNavigation)window.enableVimNavigation();else try{n.e(76).then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){})}catch(e){}setTimeout(function(){e.modal&&e.modal.parentNode&&e.modal.parentNode.removeChild(e.modal),e.onClose&&e.onClose()},300)}}}]):null;if(980!=n.j)var W=n(409);function U(e){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U(e)}function V(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof l?r:l,s=Object.create(c.prototype);return z(s,"_invoke",function(n,r,o){var a,l,c,s=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return a=t,l=0,c=e,f.n=n,i}};function h(n,r){for(l=n,c=r,t=0;!d&&s&&!o&&t<u.length;t++){var o,a=u[t],h=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(l=a[4])?5:(l=3,3)],a[4]=a[5]=e):a[0]<=h&&((o=n<2&&h<a[1])?(l=0,f.v=r,f.n=a[1]):h<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,l=0))}if(o||n>1)return i;throw d=!0,r}return function(o,u,g){if(s>1)throw TypeError("Generator is already running");for(d&&1===u&&h(u,g),l=u,c=g;(t=l<2?e:c)||!d;){a||(l?l<3?(l>1&&(f.n=-1),h(l,c)):f.n=c:f.v=c);try{if(s=2,a){if(l||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,l<2&&(l=0)}else 1===l&&(t=a.return)&&t.call(a),l<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),l=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,l=1,c=t}finally{s=1}}return{value:t,done:d}}}(n,o,a),!0),s}var i={};function l(){}function c(){}function s(){}t=Object.getPrototypeOf;var u=[][r]?t(t([][r]())):(z(t={},r,function(){return this}),t),d=s.prototype=l.prototype=Object.create(u);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,z(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=s,z(d,"constructor",s),z(s,"constructor",c),c.displayName="GeneratorFunction",z(s,o,"GeneratorFunction"),z(d),z(d,o,"Generator"),z(d,r,function(){return this}),z(d,"toString",function(){return"[object Generator]"}),(V=function(){return{w:a,m:f}})()}function z(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}z=function(e,t,n,r){function a(t,n){z(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},z(e,t,n,r)}function Y(e,t,n,r,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function Z(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Y(a,r,o,i,l,"next",e)}function l(e){Y(a,r,o,i,l,"throw",e)}i(void 0)})}}function K(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,X(r.key),r)}}function X(e){var t=function(e,t){if("object"!=U(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=U(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==U(t)?t:t+""}var $,J,Q,ee=980!=n.j?function(e,t,n){return t&&K(e.prototype,t),n&&K(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.modal=null,this.currentMapInfo=null,this.availableMaps=[],this.showMapNavigation=!1,this.onClose=null,this.multiplayerMode=!1,this.showModeToggle=!0,this.modalManager=new M,this.dataFetcher=null,this.htmlGenerator=null,this.eventHandlers=null,this.authHandlers=null},[{key:"show",value:(Q=Z(V().m(function e(){var t,n,r,o,a,i,l,c,s,u,d,f,h,g=arguments;return V().w(function(e){for(;;)switch(e.n){case 0:if(n=(t=g.length>0&&void 0!==g[0]?g[0]:{}).currentMapInfo,r=void 0===n?null:n,o=t.availableMaps,a=void 0===o?[]:o,i=t.showMapNavigation,l=void 0!==i&&i,c=t.onClose,s=void 0===c?null:c,u=t.multiplayerMode,d=void 0!==u&&u,f=t.showModeToggle,h=void 0===f||f,this.currentMapInfo=r,this.availableMaps=a,this.showMapNavigation=l,this.onClose=s,this.multiplayerMode=d,this.showModeToggle=h,this.dataFetcher=new N(this.multiplayerMode),this.htmlGenerator=new D(this.multiplayerMode),!this.showMapNavigation||this.availableMaps.length){e.n=2;break}return e.n=1,this.dataFetcher.fetchMaps();case 1:this.availableMaps=e.v;case 2:return e.n=3,this.createAndShowModal();case 3:return e.a(2)}},e,this)})),function(){return Q.apply(this,arguments)})},{key:"createAndShowModal",value:(J=Z(V().m(function e(){var t,n,r,o,a,i,l,c=this;return V().w(function(e){for(;;)switch(e.n){case 0:if(t=this.modalManager.createModalOverlay(),n=this.generateTitle(),r=this.modalManager.createModalContent(n,this.showMapNavigation&&this.showModeToggle),o=this.showMapNavigation&&!this.multiplayerMode?this.modalManager.createMapNavigationFooter(this.availableMaps):this.modalManager.createSimpleFooter(),r.innerHTML+=o,t.appendChild(r),document.body.appendChild(t),this.modal=t,this.eventHandlers=new F(this.modal,{multiplayerMode:this.multiplayerMode,showMapNavigation:this.showMapNavigation,showModeToggle:this.showModeToggle,onClose:this.onClose,loadLeaderboard:function(e){return c.loadLeaderboard(e)},updateMode:function(e){return c.updateMode(e)}}),this.authHandlers=new W.g(this.modal,function(){return c.close()}),this.setupEventHandlers(),this.showMapNavigation&&this.multiplayerMode&&(a=this.modal.querySelector(".footer-map-buttons"))&&(a.style.display="none"),!this.showMapNavigation){e.n=2;break}return e.n=1,this.loadLeaderboard((null===(i=this.currentMapInfo)||void 0===i?void 0:i.id)||1);case 1:e.n=3;break;case 2:return e.n=3,this.loadLeaderboard(null===(l=this.currentMapInfo)||void 0===l?void 0:l.id);case 3:return e.a(2)}},e,this)})),function(){return J.apply(this,arguments)})},{key:"updateMode",value:function(e){this.multiplayerMode=e,this.dataFetcher=new N(this.multiplayerMode),this.htmlGenerator=new D(this.multiplayerMode)}},{key:"generateTitle",value:function(){var e,t;return this.multiplayerMode?"🏆 Multiplayer Leaderboard":this.showMapNavigation?"🏆 Leaderboard - ".concat((null===(e=this.currentMapInfo)||void 0===e?void 0:e.name)||"Map 1"):"🏆 ".concat((null===(t=this.currentMapInfo)||void 0===t?void 0:t.name)||"Leaderboard"," - Leaderboard")}},{key:"setupEventHandlers",value:function(){this.eventHandlers.setupEventHandlers(),this.authHandlers.setupGuestEventListeners()}},{key:"loadLeaderboard",value:($=Z(V().m(function e(t){var n,r,o,a,i,l,c,s,u=this;return V().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=this.modal.querySelector(".leaderboard-content"),r=this.modal.querySelector(".modal-header"),o=r.querySelector(".player-position-section"),t&&this.availableMaps.length>0&&(a=this.availableMaps.find(function(e){return e.id===t}))&&(this.currentMapInfo=a,(i=this.modal.querySelector(".leaderboard-title"))&&!this.multiplayerMode&&(i.textContent="🏆 Leaderboard - ".concat(a.name))),n.innerHTML='<div class="loading-spinner"><div>Loading leaderboard...</div></div>',o&&(o.innerHTML=""),(l=r.querySelector(".unconfirmed-user-message"))&&l.remove(),e.p=1,e.n=2,this.dataFetcher.fetchLeaderboardData(t);case 2:(c=e.v).success?(0===(s=this.multiplayerMode?c.data||[]:c.leaderboard||[]).length?n.innerHTML=this.htmlGenerator.createEmptyLeaderboardHTML(t):n.innerHTML=this.htmlGenerator.createLeaderboardTableHTML(s),c.player_position?o.innerHTML=this.htmlGenerator.createPlayerPositionHTML(c.player_position,t):c.unconfirmed_user?this.addDiscreteAuthMessage("Confirm your account to get in the leaderboard"):c.is_guest&&this.addDiscreteAuthMessage("Create an account to get in leaderboard"),setTimeout(function(){b(u.modal)},100)):n.innerHTML=this.htmlGenerator.createErrorHTML(c.message||"Unknown error occurred"),e.n=4;break;case 3:e.p=3,e.v.message.includes("HTTP 404")?n.innerHTML=this.htmlGenerator.createEmptyLeaderboardHTML(t):n.innerHTML=this.htmlGenerator.createErrorHTML("Unable to load leaderboard. Please try again later.");case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return $.apply(this,arguments)})},{key:"addDiscreteAuthMessage",value:function(e){var t=this.modal.querySelector(".modal-footer");if(t||(t=this.modal.querySelector(".leaderboard-footer")),t){var n=t.querySelector(".discrete-auth-message");n&&n.remove();var r=document.createElement("div");r.className="discrete-auth-message",r.style.cssText="\n        position: absolute;\n        top: -25px;\n        right: 10px;\n        background: linear-gradient(45deg, #e67e22, #d35400);\n        color: white;\n        padding: 6px 12px;\n        border-radius: 6px;\n        font-size: 12px;\n        font-weight: 600;\n        text-shadow: 1px 1px 2px rgba(0,0,0,0.7);\n        border: 2px solid #f39c12;\n        box-shadow: 0 3px 8px rgba(0,0,0,0.4);\n        z-index: 1000;\n        white-space: nowrap;\n        animation: fadeIn 0.3s ease;\n      ",r.textContent=e,t.style.position="relative",t.appendChild(r)}else{var o=this.modal.querySelector(".modal-header");if(o){var a=document.createElement("div");a.className="discrete-auth-message",a.style.cssText="\n          position: absolute;\n          top: 10px;\n          right: 10px;\n          background: linear-gradient(45deg, #e67e22, #d35400);\n          color: white;\n          padding: 6px 12px;\n          border-radius: 6px;\n          font-size: 12px;\n          font-weight: 600;\n          text-shadow: 1px 1px 2px rgba(0,0,0,0.7);\n          border: 2px solid #f39c12;\n          box-shadow: 0 3px 8px rgba(0,0,0,0.4);\n          z-index: 1000;\n          white-space: nowrap;\n        ",a.textContent=e,o.style.position="relative",o.appendChild(a)}}}},{key:"close",value:function(){var e=this;this.modal&&(this.modal.style.animation="fadeOut 0.3s ease",u(),setTimeout(function(){e.modal&&e.modal.parentNode&&e.modal.parentNode.removeChild(e.modal),e.onClose&&e.onClose()},300))}}]):null;window.resendConfirmationFromLeaderboard=Z(V().m(function e(){var t;return V().w(function(e){for(;;)switch(e.n){case 0:return t=new N,e.n=1,t.resendConfirmationEmail();case 1:return e.a(2)}},e)}))}}]);