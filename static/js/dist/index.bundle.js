/*! For license information please see index.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t,n,r={35:(e,t,n)=>{function r(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,a,i){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return o(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(o(t={},a,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,o(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,o(p,"constructor",d),o(d,"constructor",l),l.displayName="GeneratorFunction",o(d,i,"GeneratorFunction"),o(p),o(p,i,"Generator"),o(p,a,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(r=function(){return{w:s,m:g}})()}function o(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,n,r){function i(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},o(e,t,n,r)}function a(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)})}}n.r(t),n.d(t,{clearAllCaches:()=>f,clearUserVote:()=>b,getCommunityData:()=>m,getUserSurveyData:()=>p,submitUserChoice:()=>E,submitUserRating:()=>v,submitUserText:()=>x});var s=null,c=null,u=null;function l(){return d.apply(this,arguments)}function d(){return(d=i(r().m(function e(){var t,n,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!u){e.n=1;break}return e.a(2,u);case 1:return e.p=1,e.n=2,fetch("/api/surveys/");case 2:return t=e.v,e.n=3,t.json();case 3:if(!((n=e.v).success&&n.surveys&&n.surveys.length>0)){e.n=4;break}return u=n.surveys[0].id,e.a(2,u);case 4:e.n=6;break;case 5:e.p=5,o=e.v,logger.error("Error fetching current survey ID:",o);case 6:return e.a(2,null)}},e,null,[[1,5]])}))).apply(this,arguments)}function f(){s=null,c=null,u=null}function p(){return g.apply(this,arguments)}function g(){return(g=i(r().m(function e(){var t,n,o,a,i,s;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!c){e.n=1;break}return e.a(2,c);case 1:return e.n=2,l();case 2:if(t=e.v){e.n=3;break}return e.a(2,{userRating:null,hasVoted:!1,voteTimestamp:null});case 3:return e.n=4,fetch("/api/surveys/".concat(t,"/votes"));case 4:return n=e.v,e.n=5,n.json();case 5:if(!(o=e.v).success||!o.votes){e.n=6;break}return a=Object.keys(o.votes).length>0,i=a?parseInt(Object.values(o.votes)[0]):null,c={userRating:i,hasVoted:a,voteTimestamp:a?Date.now():null},e.a(2,c);case 6:e.n=8;break;case 7:e.p=7,s=e.v,logger.error("Error loading survey data:",s);case 8:return e.a(2,{userRating:null,hasVoted:!1,voteTimestamp:null})}},e,null,[[0,7]])}))).apply(this,arguments)}function m(){return h.apply(this,arguments)}function h(){return(h=i(r().m(function e(){var t,n,o,a,i;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!s){e.n=1;break}return e.a(2,s);case 1:return e.n=2,l();case 2:if(t=e.v){e.n=3;break}return e.a(2,{totalVotes:0,totalScore:0,average:0});case 3:return e.n=4,fetch("/api/surveys/".concat(t,"/results"));case 4:return n=e.v,e.n=5,n.json();case 5:if(!(o=e.v).success||!o.results){e.n=6;break}if(!(a=Object.values(o.results)[0])||"rating"!==a.type){e.n=6;break}return s={totalVotes:a.total_votes,totalScore:a.total_score,average:a.average},e.a(2,s);case 6:e.n=8;break;case 7:e.p=7,i=e.v,logger.error("Error loading community data:",i);case 8:return e.a(2,{totalVotes:0,totalScore:0,average:0})}},e,null,[[0,7]])}))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=i(r().m(function e(t){var n,o,a,i,u,l,d,f,g;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/surveys/");case 1:return n=e.v,e.n=2,n.json();case 2:if((o=e.v).success&&o.surveys.length){e.n=3;break}throw new Error("No active surveys found");case 3:return a=o.surveys[0],i=a.questions[0],e.n=4,fetch("/api/surveys/vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_id:a.id,question_id:i.id,answer:t.toString()})});case 4:return u=e.v,e.n=5,u.json();case 5:if((l=e.v).success){e.n=6;break}throw new Error(l.error||"Failed to submit vote");case 6:return c=null,s=null,e.n=7,p();case 7:return d=e.v,e.n=8,m();case 8:return f=e.v,e.a(2,{userData:d,communityData:f});case 9:throw e.p=9,g=e.v,logger.error("Error submitting rating:",g),g;case 10:return e.a(2)}},e,null,[[0,9]])}))).apply(this,arguments)}function b(){return w.apply(this,arguments)}function w(){return(w=i(r().m(function e(){var t,n,o,a,i,u,l,d,f;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/surveys/");case 1:return t=e.v,e.n=2,t.json();case 2:if((n=e.v).success&&n.surveys.length){e.n=3;break}throw new Error("No active surveys found");case 3:return o=n.surveys[0],a=o.questions[0],e.n=4,fetch("/api/surveys/vote/".concat(a.id),{method:"DELETE"});case 4:return i=e.v,e.n=5,i.json();case 5:if((u=e.v).success){e.n=6;break}throw new Error(u.error||"Failed to delete vote");case 6:return c=null,s=null,e.n=7,p();case 7:return l=e.v,e.n=8,m();case 8:return d=e.v,e.a(2,{userData:l,communityData:d});case 9:throw e.p=9,f=e.v,logger.error("Error clearing vote:",f),f;case 10:return e.a(2)}},e,null,[[0,9]])}))).apply(this,arguments)}function E(e){return S.apply(this,arguments)}function S(){return(S=i(r().m(function e(t){var n,o,a,i,u,l,d,f,g;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/surveys/");case 1:return n=e.v,e.n=2,n.json();case 2:if((o=e.v).success&&o.surveys.length){e.n=3;break}throw new Error("No active surveys found");case 3:return a=o.surveys[0],i=a.questions[0],e.n=4,fetch("/api/surveys/vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_id:a.id,question_id:i.id,answer:t})});case 4:return u=e.v,e.n=5,u.json();case 5:if((l=e.v).success){e.n=6;break}throw new Error(l.error||"Failed to submit vote");case 6:return c=null,s=null,e.n=7,p();case 7:return d=e.v,e.n=8,m();case 8:return f=e.v,e.a(2,{userData:d,communityData:f});case 9:throw e.p=9,g=e.v,logger.error("Error submitting choice:",g),g;case 10:return e.a(2)}},e,null,[[0,9]])}))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=i(r().m(function e(t){var n,o,a,i,u,l,d,f,g;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/surveys/");case 1:return n=e.v,e.n=2,n.json();case 2:if((o=e.v).success&&o.surveys.length){e.n=3;break}throw new Error("No active surveys found");case 3:return a=o.surveys[0],i=a.questions[0],e.n=4,fetch("/api/surveys/vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({survey_id:a.id,question_id:i.id,answer:t})});case 4:return u=e.v,e.n=5,u.json();case 5:if((l=e.v).success){e.n=6;break}throw new Error(l.error||"Failed to submit vote");case 6:return c=null,s=null,e.n=7,p();case 7:return d=e.v,e.n=8,m();case 8:return f=e.v,e.a(2,{userData:d,communityData:f});case 9:throw e.p=9,g=e.v,logger.error("Error submitting text:",g),g;case 10:return e.a(2)}},e,null,[[0,9]])}))).apply(this,arguments)}},98:(e,t,n)=>{n.r(t),n.d(t,{getSelectedCharacter:()=>d,initializeCharacterSelection:()=>u,loadPlayerCharacters:()=>h,lockPaidCharacters:()=>g,lockPremiumCharacters:()=>p,unlockAllCharacters:()=>f});var r=n(626);function o(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,o,i){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return a(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,i),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(a(t={},r,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,a(p,"constructor",d),a(d,"constructor",l),l.displayName="GeneratorFunction",a(d,i,"GeneratorFunction"),a(p),a(p,i,"Generator"),a(p,r,function(){return this}),a(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:s,m:g}})()}function a(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}a=function(e,t,n,r){function i(t,n){a(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},a(e,t,n,r)}function i(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}var s="boba_vim_selected_character",c=function(){try{var e=localStorage.getItem(s);if(e&&["boba","pinky","golden","black","boba_diamond"].includes(e))return logger.debug("Loaded saved character: ".concat(e)),e}catch(e){logger.warn("Failed to load character from localStorage:",e)}return r.R.DEFAULT}();function u(){logger.debug("Initializing character selection..."),m(),h(),document.querySelectorAll(r.R.SELECTORS.CHARACTER_BOXES).forEach(function(e){e.addEventListener("click",function(){var t=e.dataset.character;e.classList.contains(r.R.CSS_CLASSES.LOCKED)?"boba_diamond"===t?fetch("/api/auth/me",{credentials:"include"}).then(function(e){return e.json()}).then(function(e){e.authenticated?Promise.resolve().then(n.bind(n,422)).then(function(e){e.showPaymentModal(t)}):Promise.resolve().then(n.bind(n,763)).then(function(e){e.showAuthModal("register")})}).catch(function(e){logger.error("Error checking auth status:",e),Promise.resolve().then(n.bind(n,763)).then(function(e){e.showAuthModal("register")})}):Promise.resolve().then(n.bind(n,763)).then(function(e){e.showAuthModal("register")}):(e.classList.contains(r.R.CSS_CLASSES.UNLOCKED)||e.classList.contains(r.R.CSS_CLASSES.SELECTED))&&l(t)})})}function l(e){logger.debug("=== CHARACTER SELECTION PROCESS ==="),logger.debug("Attempting to select character:",e),logger.debug("Previous selected character:",c),document.querySelectorAll(r.R.SELECTORS.CHARACTER_BOXES).forEach(function(e){e.classList.remove(r.R.CSS_CLASSES.SELECTED)});var t=document.querySelector('[data-character="'.concat(e,'"]'));t?(logger.debug("Found character box for:",e),logger.debug("Character box classes:",t.classList.toString()),t.classList.add(r.R.CSS_CLASSES.SELECTED),c=e,function(e){try{localStorage.setItem(s,e),logger.debug("Saved character to localStorage: ".concat(e))}catch(e){logger.warn("Failed to save character to localStorage:",e)}}(e),logger.debug("Character successfully selected:",e),logger.debug("Updated selectedCharacter variable:",c)):logger.warn("Character box not found for:",e)}function d(){return c}function f(){logger.debug("unlockAllCharacters called - keeping boba_diamond locked - v2");var e=[document.querySelector(r.R.SELECTORS.GOLDEN_BOX),document.querySelector(r.R.SELECTORS.BLACK_BOX)].filter(function(e){return e});logger.debug("Premium boxes found:",e.length),e.forEach(function(e){e.classList.remove(r.R.CSS_CLASSES.LOCKED),e.classList.add(r.R.CSS_CLASSES.UNLOCKED);var t=e.querySelector(r.R.SELECTORS.LOCK_ICON);t&&t.remove()}),h(),m()}function p(){[document.querySelector(r.R.SELECTORS.GOLDEN_BOX),document.querySelector(r.R.SELECTORS.BLACK_BOX)].forEach(function(e){if(e&&(e.classList.remove(r.R.CSS_CLASSES.UNLOCKED,r.R.CSS_CLASSES.SELECTED),e.classList.add(r.R.CSS_CLASSES.LOCKED),!e.querySelector(r.R.SELECTORS.LOCK_ICON))){var t=document.createElement("span");t.className=r.R.CSS_CLASSES.LOCK_ICON,t.textContent=r.R.ICONS.LOCK,e.appendChild(t)}}),r.R.PREMIUM.includes(c)&&l(r.R.DEFAULT)}function g(){var e=document.querySelector(r.R.SELECTORS.DIAMOND_BOX);if(e){if(e.classList.remove(r.R.CSS_CLASSES.UNLOCKED,r.R.CSS_CLASSES.SELECTED),e.classList.add(r.R.CSS_CLASSES.LOCKED),!e.querySelector(r.R.SELECTORS.LOCK_ICON)){var t=document.createElement("span");t.className=r.R.CSS_CLASSES.LOCK_ICON,t.textContent=r.R.ICONS.DIAMOND,e.appendChild(t)}var n=e.querySelector(".character-level");n&&n.remove(),e.setAttribute("title","Diamond Boba - Coming soon")}"boba_diamond"===c&&l(r.R.DEFAULT)}function m(){var e=c;document.querySelectorAll(r.R.SELECTORS.CHARACTER_BOXES).forEach(function(e){e.classList.remove(r.R.CSS_CLASSES.SELECTED)});var t=document.querySelector('[data-character="'.concat(e,'"]'));if(t)t.classList.add(r.R.CSS_CLASSES.SELECTED),logger.debug("Applied saved character selection immediately: ".concat(e));else{var n=document.querySelector('[data-character="'.concat(r.R.DEFAULT,'"]'));n&&n.classList.add(r.R.CSS_CLASSES.SELECTED)}}function h(){return v.apply(this,arguments)}function v(){var e;return e=o().m(function e(){var t,n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/player/characters",{credentials:"include"});case 1:if(!(t=e.v).ok){e.n=3;break}return e.n=2,t.json();case 2:y(e.v.characters),e.n=5;break;case 3:if(401!==t.status){e.n=4;break}return e.a(2);case 4:logger.error("Failed to load player characters:",t.status);case 5:e.n=7;break;case 6:e.p=6,n=e.v,logger.error("Error loading player characters:",n);case 7:return e.a(2)}},e,null,[[0,6]])}),v=function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function s(e){i(a,r,o,s,c,"next",e)}function c(e){i(a,r,o,s,c,"throw",e)}s(void 0)})},v.apply(this,arguments)}function y(e){e&&0!==e.length&&e.forEach(function(e){var t=document.querySelector('[data-character="'.concat(e.character_name,'"]'));if(t){t.classList.remove(r.R.CSS_CLASSES.LOCKED),t.classList.add(r.R.CSS_CLASSES.UNLOCKED);var n=t.querySelector(r.R.SELECTORS.LOCK_ICON);if(n&&n.remove(),"boba_diamond"===e.character_name||e.level>1){var o=t.querySelector(".character-level");o||((o=document.createElement("div")).className="character-level",t.appendChild(o)),o.textContent="Level ".concat(e.level)}if("boba_diamond"===e.character_name||e.level>1){var a=e.character_name.replace("_"," ").replace(/\b\w/g,function(e){return e.toUpperCase()});t.setAttribute("title","".concat(a," Level ").concat(e.level))}}})}},195:(e,t,n)=>{n.r(t),n.d(t,{hideNewsGameArea:()=>u,hideNewsletterPanel:()=>s,setupNewsletterEventListeners:()=>l,showNewsGameArea:()=>c,showNewsletterPanel:()=>i,toggleNewsletterPanel:()=>a});var r=!1,o=!1;function a(){var e=document.getElementById("newsletterPanel"),t=document.getElementById("newsletterButton");e&&t&&(r?s():i())}function i(){var e=document.getElementById("newsletterPanel"),t=document.getElementById("newsletterButton");e&&t&&(e.classList.remove("hidden"),e.classList.add("visible"),t.classList.add("active"),window.hideCursor&&window.hideCursor(),r=!0)}function s(){var e=document.getElementById("newsletterPanel"),t=document.getElementById("newsletterButton");e&&t&&(e.classList.remove("visible"),e.classList.add("hidden"),t.classList.remove("active"),window.showCursor&&window.showCursor(),r=!1)}function c(){var e=document.getElementById("newsGameArea");e&&(e.classList.remove("hidden"),s(),o=!0)}function u(){var e=document.getElementById("newsGameArea");e&&(e.classList.add("hidden"),o=!1)}function l(){var e=document.getElementById("closeNewsBtn");e&&e.addEventListener("click",function(e){e.stopPropagation(),logger.debug("Close news button clicked - closing 2D game area"),u()}),document.addEventListener("click",function(e){var t=document.querySelector(".survey-system"),n=document.getElementById("newsGameArea");r&&t&&!t.contains(e.target)&&s(),o&&n&&!n.contains(e.target)&&u()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&(o?u():r&&s())})}},247:(e,t,n)=>{var r=n(98),o=n(658);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var i=r&&r.prototype instanceof u?r:u,l=Object.create(i.prototype);return s(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(s(t={},r,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,s(p,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,o,"GeneratorFunction"),s(p),s(p,o,"Generator"),s(p,r,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:g}})()}function s(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}s=function(e,t,n,r){function a(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},s(e,t,n,r)}function c(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){c(a,r,o,i,s,"next",e)}function s(e){c(a,r,o,i,s,"throw",e)}i(void 0)})}}function l(){var e,t=document.getElementById("playButton");t?(logger.debug("Initializing play button..."),(e=t).addEventListener("click",u(i().m(function t(){return i().w(function(t){for(;;)switch(t.p=t.n){case 0:return logger.debug("Play button clicked"),d(e,!0),t.p=1,t.n=2,f();case 2:t.n=4;break;case 3:t.p=3,h(t.v,e);case 4:return t.a(2)}},t,null,[[1,3]])})))):logger.debug("playButton not found")}function d(e,t){t?(e.disabled=!0,e.textContent="üöÄ Starting..."):(e.disabled=!1,e.textContent="Play")}function f(){return p.apply(this,arguments)}function p(){return(p=u(i().m(function e(){var t,n,r;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=document.getElementById("playButton"),e.p=1,d(t,!1),e.n=2,(0,o.showMapSelectionModal)();case 2:if(n=e.v,logger.debug("Selected map:",n),n){e.n=3;break}return logger.debug("Map selection cancelled by user"),d(t,!1),e.a(2);case 3:return d(t,!0),e.n=4,g(n);case 4:e.n=6;break;case 5:throw e.p=5,r=e.v,logger.debug("Map selection cancelled or failed:",r.message),d(t,!1),r;case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u(i().m(function e(t){var n,o,s,c;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=(0,r.getSelectedCharacter)(),logger.debug("=== CHARACTER SELECTION DEBUG ==="),logger.debug("Selected character:",n),logger.debug("Character type:",a(n)),logger.debug("Is premium character:",["golden","black"].includes(n)),logger.debug("Selected map:",t.name,"(ID:",t.id,")"),e.p=1,e.n=2,fetch("/api/start-game",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t.id,selected_character:n})});case 2:return o=e.v,e.n=3,o.json();case 3:if(!(s=e.v).success){e.n=4;break}logger.debug("Game session created successfully for map:",t.name),window.location.href="/play",e.n=5;break;case 4:throw new Error(s.error||"Failed to start game");case 5:e.n=7;break;case 6:throw e.p=6,c=e.v,logger.error("Error starting game with map:",c),c;case 7:return e.a(2)}},e,null,[[1,6]])}))).apply(this,arguments)}function h(e,t){logger.error("Error starting game:",e),d(t,!1)}var v=n(630);function y(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return b(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(b(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,b(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,b(d,"constructor",u),b(u,"constructor",c),c.displayName="GeneratorFunction",b(u,o,"GeneratorFunction"),b(d),b(d,o,"Generator"),b(d,r,function(){return this}),b(d,"toString",function(){return"[object Generator]"}),(y=function(){return{w:a,m:f}})()}function b(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}b=function(e,t,n,r){function a(t,n){b(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},b(e,t,n,r)}function w(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function E(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){w(a,r,o,i,s,"next",e)}function s(e){w(a,r,o,i,s,"throw",e)}i(void 0)})}}function S(){var e,t=document.getElementById("leaderboardButton");t?(logger.debug("Initializing map-aware leaderboard button..."),(e=t).addEventListener("mouseenter",function(){e.textContent="üèÜ"}),e.addEventListener("mouseleave",function(){e.textContent="üèÜ Leaderboard"}),function(e){e.addEventListener("click",E(y().m(function t(){var n;return y().w(function(t){for(;;)switch(t.p=t.n){case 0:return logger.debug("Map leaderboard button clicked"),x(e,!0),t.p=1,t.n=2,k();case 2:t.n=4;break;case 3:t.p=3,n=t.v,logger.error("Error showing map leaderboard:",n),L("Failed to load leaderboard. Please try again.");case 4:return t.p=4,x(e,!1),t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])})))}(t)):logger.debug("leaderboardButton not found")}function x(e,t){t?(e.disabled=!0,e.textContent="Loading..."):(e.disabled=!1,e.textContent="üèÜ Leaderboard")}function k(){return C.apply(this,arguments)}function C(){return(C=E(y().m(function e(){var t,n;return y().w(function(e){for(;;)switch(e.n){case 0:if(t=(0,o.getCachedMaps)()){e.n=2;break}return e.n=1,T();case 1:t=e.v;case 2:return n=new v.H,e.n=3,n.show({currentMapInfo:t.find(function(e){return 1===e.id}),availableMaps:t,showMapNavigation:!0});case 3:return e.a(2)}},e)}))).apply(this,arguments)}function T(){return O.apply(this,arguments)}function O(){return(O=E(y().m(function e(){var t,n,r;return y().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/maps");case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.maps){e.n=3;break}return e.a(2,n.maps);case 3:throw new Error("Failed to fetch maps");case 4:e.n=6;break;case 5:return e.p=5,r=e.v,logger.error("Error fetching maps:",r),e.a(2,[]);case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function L(e){alert(e)}var P=n(282),I=0,_=!1,M=null,A=[],B={guest:[{selector:"#registerNowBtn",column:0,row:0,type:"button"},{selector:"#closeRegistrationModal",column:1,row:0,type:"button"}],match:[{selector:"#acceptMatch",column:0,row:0,type:"button"},{selector:"#rejectMatch",column:1,row:0,type:"button"}]};function N(e){logger.debug("Initializing multiplayer vim navigation for:",e),F(e)?(M=e,G(e),I=function(){for(var e=0;e<A.length;e++){if(1===A[e].column)return e}return Math.max(0,A.length-1)}(),_=!0,logger.debug("Multiplayer vim starting at element index: ".concat(I)),U(),document.addEventListener("keydown",q),"match"===e&&function(){var e=document.getElementById("matchActions");if(e){var t=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&"style"===e.attributeName&&("none"===e.target.style.display&&_&&(logger.debug("Match actions hidden, disabling vim navigation"),R()))})});t.observe(e,{attributes:!0,attributeFilter:["style"]});window.multiplayerObserver=t}}(),logger.debug("Multiplayer vim navigation initialized")):logger.warn("No modal found for multiplayer vim navigation")}function j(){_=!1,z(),document.removeEventListener("keydown",q),M=null,window.multiplayerObserver&&(window.multiplayerObserver.disconnect(),window.multiplayerObserver=null),logger.debug("Multiplayer vim navigation disabled")}function R(){z(),_=!1,logger.debug("Multiplayer vim cursor hidden immediately")}function F(e){switch(e){case"guest":return document.getElementById("registrationModal");case"match":return document.getElementById("matchFoundModal");default:return null}}function G(e){A=[],B[e]?(B[e].forEach(function(e){var t=document.querySelector(e.selector);t&&D(t)&&A.push(e)}),logger.debug("Available multiplayer elements:",A.length)):logger.warn("Unknown modal type:",e)}function D(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect();return"none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden")}catch(e){return!1}}function V(){if(I<0||I>=A.length)return null;var e=A[I];if(!e)return null;try{return document.querySelector(e.selector)}catch(e){return null}}function q(e){if(_&&(F(M)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable))switch(e.key.toLowerCase()){case"h":e.preventDefault(),function(){for(var e=0;e<A.length;e++)if(0===A[e].column)return I=e,void U()}();break;case"j":case"k":e.preventDefault();break;case"l":e.preventDefault(),function(){for(var e=0;e<A.length;e++)if(1===A[e].column)return I=e,void U()}();break;case"enter":e.preventDefault(),function(){var e=V();if(logger.debug("Multiplayer activating element:",e),!e)return void logger.debug("No element to activate in multiplayer");try{e.click()}catch(e){logger.debug("Error clicking multiplayer element:",e)}}();break;case"escape":e.preventDefault(),function(){var e=A.find(function(e){return 1===e.column});if(e){var t=document.querySelector(e.selector);t&&t.click()}}()}}function U(){logger.debug("Multiplayer updateCursor called"),z();var e=A.filter(function(e){var t=document.querySelector(e.selector);return t&&D(t)});if(0===e.length)return logger.debug("No visible elements, hiding multiplayer vim"),void R();var t=V();logger.debug("Multiplayer current element for cursor:",t),t?function(e){if(!e)return;var t=document.createElement("div");t.className="multiplayer-vim-cursor",t.textContent="üßã",t.style.cssText="\n    position: fixed;\n    font-size: 20px;\n    z-index: 99999;\n    pointer-events: none;\n    animation: multiplayer-vim-cursor-pulse 1s ease-in-out infinite alternate;\n    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n    background: rgba(255, 165, 0, 0.8);\n    border: 2px solid white;\n    border-radius: 50%;\n    width: 35px;\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n  ";var n=e.getBoundingClientRect();if(t.style.top=n.top-10+"px",t.style.left=n.left-10+"px",document.body.appendChild(t),!document.getElementById("multiplayer-vim-cursor-styles")){var r=document.createElement("style");r.id="multiplayer-vim-cursor-styles",r.textContent="\n      @keyframes multiplayer-vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(r)}}(t):logger.debug("No element found for multiplayer cursor")}function z(){document.querySelectorAll(".multiplayer-vim-cursor").forEach(function(e){e.remove()}),document.querySelectorAll("[data-original-multiplayer-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-multiplayer-text"),e.removeAttribute("data-original-multiplayer-text")})}function H(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return W(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(W(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,W(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,W(d,"constructor",u),W(u,"constructor",c),c.displayName="GeneratorFunction",W(u,o,"GeneratorFunction"),W(d),W(d,o,"Generator"),W(d,r,function(){return this}),W(d,"toString",function(){return"[object Generator]"}),(H=function(){return{w:a,m:f}})()}function W(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}W=function(e,t,n,r){function a(t,n){W(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},W(e,t,n,r)}function K(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Y(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){K(a,r,o,i,s,"next",e)}function s(e){K(a,r,o,i,s,"throw",e)}i(void 0)})}}var J=null,X=!1,$=null,Z=null,Q=null;function ee(){var e,t=document.getElementById("playOnline");t?(logger.debug("Initializing WebSocket online button..."),(e=t).addEventListener("mouseenter",function(){X&&(e.textContent="‚ùå Cancel search")}),e.addEventListener("mouseleave",function(){e.textContent=X?"Finding opponent...":"Play online"}),function(e){e.addEventListener("click",Y(H().m(function t(){return H().w(function(t){for(;;)switch(t.n){case 0:if(logger.debug("Online button clicked"),!X){t.n=2;break}return t.n=1,pe(e);case 1:case 3:return t.a(2);case 2:return t.n=3,te(e)}},t)})))}(t)):logger.debug("playOnline button not found")}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=Y(H().m(function e(t){var n,o,a;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,we(t,"connecting"),e.n=1,fetch("/api/playonline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected_character:(0,r.getSelectedCharacter)()})});case 1:return n=e.v,e.n=2,n.json();case 2:if(!(o=e.v).success){e.n=4;break}return e.n=3,re(t,o.websocket_url);case 3:e.n=5;break;case 4:o.requires_registration?(we(t,"idle"),Te(o.message)):(we(t,"idle"),Le(o.message));case 5:e.n=7;break;case 6:e.p=6,a=e.v,logger.error("Error starting matchmaking:",a),we(t,"idle"),Le("Failed to connect to matchmaking. Please try again.");case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}function re(e,t){return oe.apply(this,arguments)}function oe(){return(oe=Y(H().m(function e(t,n){var r,o;return H().w(function(e){for(;;)switch(e.n){case 0:try{r="https:"===window.location.protocol?"wss:":"ws:",o="".concat(r,"//").concat(window.location.host).concat(n),logger.debug("Connecting to WebSocket:",o),(J=new WebSocket(o)).onopen=function(e){logger.debug("WebSocket connected"),we(t,"connected"),ye(),ie()},J.onmessage=function(e){try{ae(JSON.parse(e.data),t)}catch(e){logger.error("Error parsing WebSocket message:",e)}},J.onclose=function(e){logger.debug("WebSocket disconnected:",e.code,e.reason),be(),X&&(we(t,"idle"),Le("Connection lost. Please try again."),X=!1),1e3!==e.code&&X&&he(t)},J.onerror=function(e){logger.error("WebSocket error:",e),we(t,"idle"),Le("Connection error. Please try again.")}}catch(e){logger.error("Error connecting to WebSocket:",e),we(t,"idle"),Le("Failed to connect to matchmaking. Please try again.")}case 1:return e.a(2)}},e)}))).apply(this,arguments)}function ae(e,t){switch(logger.debug("Received WebSocket message:",e),e.type){case"queue_joined":we(t,"searching"),X=!0;break;case"queue_left":we(t,"idle"),X=!1;break;case"queue_timeout":we(t,"idle"),X=!1,Le("Matchmaking timeout. No opponent found after 45 seconds."),me();break;case"match_found":$=e.data.match_id,e.data,we(t,"match_found"),function(e){var t='\n    <div id="matchFoundModal" class="match-modal-overlay">\n      <div class="match-modal">\n        <div class="match-header">\n          <h2>Match Found!</h2>\n          <div class="match-timer">\n            <span id="acceptTimer">30</span>s\n          </div>\n        </div>\n        \n        <div class="match-vs-content">\n          <div class="player-section">\n            <div class="player-character">\n              <img src="'.concat((0,P.o$)(e.player_character),'" alt="').concat(e.player_character,'" class="match-character-sprite">\n            </div>\n            <div class="player-username">').concat(e.player_username,'</div>\n            <div class="player-status" id="playerStatus">\n              <span class="status-icon">‚è≥</span>\n              <span class="status-text">Waiting...</span>\n            </div>\n          </div>\n          \n          <div class="vs-section">\n            <div class="vs-text">VS</div>\n          </div>\n          \n          <div class="opponent-section">\n            <div class="opponent-character">\n              <img src="').concat((0,P.o$)(e.opponent_character),'" alt="').concat(e.opponent_character,'" class="match-character-sprite">\n            </div>\n            <div class="opponent-username">').concat(e.opponent_username,'</div>\n            <div class="opponent-status" id="opponentStatus">\n              <span class="status-icon">‚è≥</span>\n              <span class="status-text">Waiting...</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class="match-actions" id="matchActions">\n          <button id="acceptMatch" class="btn accept-btn">Accept</button>\n          <button id="rejectMatch" class="btn reject-btn">Reject</button>\n        </div>\n        \n        <div class="countdown-section" id="countdownSection" style="display: none;">\n          <div class="countdown-text">Get ready! Game starts in</div>\n          <div class="countdown-number" id="countdownNumber">3</div>\n        </div>\n      </div>\n    </div>\n  ');if(document.body.insertAdjacentHTML("beforeend",t),window.hideCursor)window.hideCursor(),setTimeout(function(){try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}},0);else try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}setTimeout(function(){N("match")},100);var r=Math.floor(e.accept_timeout_ms/1e3),o=document.getElementById("acceptTimer"),a=setInterval(function(){r--,o.textContent=r,r<=0&&(clearInterval(a),ke(),de())},1e3);document.getElementById("acceptMatch").addEventListener("click",function(){clearInterval(a),j(),Ee("accepted"),xe(),function(){le.apply(this,arguments)}()}),document.getElementById("rejectMatch").addEventListener("click",function(){clearInterval(a),j(),Ee("rejected"),xe(),de()})}(e.data);break;case"match_accepted":we(t,"waiting_accept"),Ee("accepted"),xe();break;case"opponent_accepted":Se("accepted");break;case"match_rejected":we(t,"idle"),X=!1,$=null,Ee("rejected"),xe(),setTimeout(function(){Ce(),Le(e.message),me()},2e3);break;case"opponent_rejected":we(t,"idle"),X=!1,$=null,Se("rejected"),setTimeout(function(){Ce(),Le(e.message),me()},2e3);break;case"match_started":we(t,"match_started"),X=!1,$=null,function(e){var t=document.getElementById("countdownSection"),n=document.getElementById("countdownNumber");if(t&&n){t.style.display="block";var r=3,o=setInterval(function(){r>0?(n.textContent=r,r--):(clearInterval(o),window.location.href="/play?multiplayer=true&match_id="+e.match_id)},1e3)}}(e.data),me();break;case"match_cancelled":we(t,"idle"),X=!1,$=null,Ce(),Le(e.message),me();break;case"error":logger.error("Matchmaking error:",e.message),we(t,"idle"),Le(e.message);break;case"heartbeat":break;default:logger.warn("Unknown message type:",e.type)}}function ie(){return se.apply(this,arguments)}function se(){return(se=Y(H().m(function e(){var t,n,o;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/matchmaking/queue/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected_character:(0,r.getSelectedCharacter)()})});case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success?logger.debug("Successfully joined matchmaking queue"):(logger.error("Failed to join queue:",n.error),Le(n.error||"Failed to join matchmaking queue")),e.n=4;break;case 3:e.p=3,o=e.v,logger.error("Error joining queue:",o),Le("Failed to join matchmaking queue");case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function ce(){return ue.apply(this,arguments)}function ue(){return(ue=Y(H().m(function e(){var t,n,r;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/matchmaking/queue/leave",{method:"POST",headers:{"Content-Type":"application/json"}});case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success?logger.debug("Successfully left matchmaking queue"):logger.error("Failed to leave queue:",n.error),e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Error leaving queue:",r);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function le(){return(le=Y(H().m(function e(){var t,n,r;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:if($){e.n=1;break}return logger.error("No current match ID"),e.a(2);case 1:return e.p=1,e.n=2,fetch("/api/matchmaking/match/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({match_id:$,accepted:!0})});case 2:return t=e.v,e.n=3,t.json();case 3:(n=e.v).success?logger.debug("Successfully accepted match"):(logger.error("Failed to accept match:",n.error),Le(n.error||"Failed to accept match")),e.n=5;break;case 4:e.p=4,r=e.v,logger.error("Error accepting match:",r),Le("Failed to accept match");case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function de(){return fe.apply(this,arguments)}function fe(){return(fe=Y(H().m(function e(){var t,n,r;return H().w(function(e){for(;;)switch(e.p=e.n){case 0:if($){e.n=1;break}return logger.error("No current match ID"),e.a(2);case 1:return e.p=1,e.n=2,fetch("/api/matchmaking/match/respond",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({match_id:$,accepted:!1})});case 2:return t=e.v,e.n=3,t.json();case 3:(n=e.v).success?logger.debug("Successfully rejected match"):logger.error("Failed to reject match:",n.error),e.n=5;break;case 4:e.p=4,r=e.v,logger.error("Error rejecting match:",r);case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function pe(e){return ge.apply(this,arguments)}function ge(){return(ge=Y(H().m(function e(t){return H().w(function(e){for(;;)switch(e.n){case 0:try{ce(),me(),we(t,"idle"),X=!1,$=null,Ce()}catch(e){logger.error("Error canceling matchmaking:",e)}case 1:return e.a(2)}},e)}))).apply(this,arguments)}function me(){J&&(J.close(1e3,"User disconnected"),J=null),be(),ve()}function he(e){ve(),Z=setTimeout(function(){X&&(logger.debug("Attempting to reconnect..."),re(e,"/api/matchmaking/ws"))},3e3)}function ve(){Z&&(clearTimeout(Z),Z=null)}function ye(){be(),Q=setInterval(function(){J&&J.readyState===WebSocket.OPEN&&J.send(JSON.stringify({type:"heartbeat"}))},3e4)}function be(){Q&&(clearInterval(Q),Q=null)}function we(e,t){switch(e.classList.remove("idle","connecting","connected","searching","match_found","waiting_accept","match_started"),e.classList.add(t),t){case"idle":e.disabled=!1,e.textContent="Play online";break;case"connecting":e.disabled=!0,e.textContent="Connecting...";break;case"connected":e.disabled=!0,e.textContent="Joining queue...";break;case"searching":e.disabled=!1,e.textContent="Finding opponent...";break;case"match_found":e.disabled=!0,e.textContent="Match found!";break;case"waiting_accept":e.disabled=!0,e.textContent="Waiting for opponent...";break;case"match_started":e.disabled=!0,e.textContent="Match starting..."}}function Ee(e){var t=document.getElementById("playerStatus");if(t){var n=t.querySelector(".status-icon"),r=t.querySelector(".status-text");"accepted"===e?(n.textContent="‚úÖ",r.textContent="Accepted",t.classList.add("accepted")):"rejected"===e&&(n.textContent="‚ùå",r.textContent="Rejected",t.classList.add("rejected"))}}function Se(e){var t=document.getElementById("opponentStatus");if(t){var n=t.querySelector(".status-icon"),r=t.querySelector(".status-text");if("accepted"===e){n.textContent="‚úÖ",r.textContent="Accepted",t.classList.add("accepted");var o=document.getElementById("playerStatus");o&&o.classList.contains("accepted")}else if("rejected"===e){n.textContent="‚ùå",r.textContent="Rejected",t.classList.add("rejected");var a=document.querySelector(".match-modal");if(a){var i=document.createElement("div");i.className="rejection-message",i.innerHTML='\n          <div class="rejection-icon">‚ùå</div>\n          <div class="rejection-text">Game refused by the other player</div>\n        ',a.appendChild(i)}}}}function xe(){var e=document.getElementById("matchActions");e&&(e.style.display="none")}function ke(){j();var e=document.getElementById("matchFoundModal");if(e){e.remove(),window.showCursor&&window.showCursor();try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){})}catch(e){}}}function Ce(){ke(),Oe()}function Te(e){if(document.body.insertAdjacentHTML("beforeend",'\n    <div id="registrationModal" class="guest-modal-overlay">\n      <div class="guest-modal">\n        <div class="guest-modal-header">\n          <div class="guest-modal-title">üîí MULTIPLAYER LOCKED</div>\n        </div>\n        <div class="guest-modal-content">\n          <div class="guest-modal-message">\n            <div class="guest-message-title">Registration Required</div>\n            <div class="guest-message-text">Please register to play online</div>\n          </div>\n          <div class="guest-modal-buttons">\n            <button id="registerNowBtn" class="guest-btn guest-btn-primary">\n              REGISTER\n            </button>\n            <button id="closeRegistrationModal" class="guest-btn guest-btn-secondary">\n              CLOSE\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),function(){if(document.getElementById("guestModalStyles"))return;var e="\n    <style id=\"guestModalStyles\">\n      .guest-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.85);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 1000;\n        padding: 20px;\n        box-sizing: border-box;\n      }\n      \n      .guest-modal {\n        background: #1a1a1a;\n        border: 3px solid #00ff00;\n        border-radius: 8px;\n        box-shadow: 0 0 25px rgba(0, 255, 0, 0.4);\n        text-align: center;\n        max-width: 400px;\n        width: 100%;\n        font-family: 'Courier New', monospace;\n        color: #00ff00;\n        overflow: hidden;\n      }\n      \n      .guest-modal-header {\n        background: #333333;\n        padding: 20px;\n        border-bottom: 2px solid #00ff00;\n      }\n      \n      .guest-modal-title {\n        color: #ffff00;\n        font-size: 18px;\n        font-weight: bold;\n        letter-spacing: 2px;\n        text-shadow: 0 0 8px #ffff00;\n        margin: 0;\n      }\n      \n      .guest-modal-content {\n        padding: 30px 25px;\n      }\n      \n      .guest-modal-message {\n        margin-bottom: 30px;\n      }\n      \n      .guest-message-title {\n        font-size: 20px;\n        font-weight: bold;\n        color: #ffffff;\n        margin-bottom: 10px;\n        text-shadow: 0 0 5px #ffffff;\n      }\n      \n      .guest-message-text {\n        font-size: 14px;\n        color: #00ffff;\n        text-shadow: 0 0 5px #00ffff;\n        line-height: 1.4;\n      }\n      \n      .guest-modal-buttons {\n        display: flex;\n        gap: 15px;\n        justify-content: center;\n        flex-wrap: wrap;\n      }\n      \n      .guest-btn {\n        background: #000000;\n        border: 2px solid;\n        padding: 12px 24px;\n        font-family: 'Courier New', monospace;\n        font-size: 13px;\n        font-weight: bold;\n        cursor: pointer;\n        text-transform: uppercase;\n        letter-spacing: 1px;\n        transition: all 0.2s ease;\n        border-radius: 4px;\n        min-width: 100px;\n        flex: 1;\n        max-width: 150px;\n      }\n      \n      .guest-btn-primary {\n        border-color: #ffff00;\n        color: #ffff00;\n        box-shadow: 0 0 10px rgba(255, 255, 0, 0.3);\n      }\n      \n      .guest-btn-secondary {\n        border-color: #ff00ff;\n        color: #ff00ff;\n        box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);\n      }\n      \n      .guest-btn:hover {\n        transform: translateY(-2px);\n        text-shadow: 0 0 10px currentColor;\n        box-shadow: 0 0 15px currentColor;\n      }\n      \n      .guest-btn:active {\n        transform: translateY(0);\n      }\n      \n      /* Mobile Responsive */\n      @media (max-width: 480px) {\n        .guest-modal-overlay {\n          padding: 15px;\n        }\n        \n        .guest-modal {\n          max-width: none;\n        }\n        \n        .guest-modal-header {\n          padding: 15px;\n        }\n        \n        .guest-modal-title {\n          font-size: 16px;\n          letter-spacing: 1px;\n        }\n        \n        .guest-modal-content {\n          padding: 25px 20px;\n        }\n        \n        .guest-message-title {\n          font-size: 18px;\n        }\n        \n        .guest-message-text {\n          font-size: 13px;\n        }\n        \n        .guest-modal-buttons {\n          flex-direction: column;\n          gap: 12px;\n        }\n        \n        .guest-btn {\n          max-width: none;\n          width: 100%;\n          padding: 12px 20px;\n          font-size: 12px;\n        }\n      }\n      \n      /* Tablet Responsive */\n      @media (max-width: 768px) and (min-width: 481px) {\n        .guest-modal {\n          max-width: 350px;\n        }\n        \n        .guest-modal-content {\n          padding: 25px 20px;\n        }\n      }\n    </style>\n  ";document.head.insertAdjacentHTML("beforeend",e)}(),window.hideCursor)window.hideCursor(),setTimeout(function(){try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}},0);else try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})}catch(e){}setTimeout(function(){N("guest")},100),document.getElementById("closeRegistrationModal").addEventListener("click",Oe),document.getElementById("registerNowBtn").addEventListener("click",function(){if(Oe(),"function"==typeof showAuthModal)showAuthModal("register");else{var e=document.getElementById("registerButton");e&&e.click()}}),document.getElementById("registrationModal").addEventListener("click",function(e){"registrationModal"===e.target.id&&Oe()})}function Oe(){j();var e=document.getElementById("registrationModal");if(e){e.remove(),window.showCursor&&window.showCursor();try{Promise.resolve().then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){})}catch(e){}}var t=document.getElementById("guestModalStyles");t&&t.remove()}function Le(e){alert(e)}window.addEventListener("beforeunload",function(){J&&me()});var Pe=n(763),Ie=n(532);function _e(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Me(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Me(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Me(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Me(d,"constructor",u),Me(u,"constructor",c),c.displayName="GeneratorFunction",Me(u,o,"GeneratorFunction"),Me(d),Me(d,o,"Generator"),Me(d,r,function(){return this}),Me(d,"toString",function(){return"[object Generator]"}),(_e=function(){return{w:a,m:f}})()}function Me(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Me=function(e,t,n,r){function a(t,n){Me(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Me(e,t,n,r)}function Ae(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Be(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Ae(a,r,o,i,s,"next",e)}function s(e){Ae(a,r,o,i,s,"throw",e)}i(void 0)})}}var Ne=null;function je(){logger.debug("Initializing user settings...");var e=document.getElementById("settingsButton"),t=document.getElementById("userSettingsModal"),n=document.getElementById("deleteConfirmModal"),r=document.getElementById("closeSettingsModal"),o=document.getElementById("closeDeleteModal"),a=document.getElementById("changePasswordForm"),i=document.getElementById("deleteAccountBtn"),s=document.getElementById("confirmDeleteBtn"),c=document.getElementById("cancelDeleteBtn"),u=document.getElementById("deleteConfirmation");e&&e.addEventListener("click",Re),r&&r.addEventListener("click",Ge),o&&o.addEventListener("click",Ve),t&&t.addEventListener("click",function(e){e.target===t&&Ge()}),n&&n.addEventListener("click",function(e){e.target===n&&Ve()}),a&&a.addEventListener("submit",Ue),i&&i.addEventListener("click",De),s&&s.addEventListener("click",He),c&&c.addEventListener("click",Ve),u&&u.addEventListener("input",qe);var l=document.getElementById("newPassword"),d=document.getElementById("confirmNewPassword");d&&l&&d.addEventListener("input",function(){this.value&&l.value!==this.value?this.style.borderColor="#e53e3e":this.style.borderColor="#ddd"})}function Re(){return Fe.apply(this,arguments)}function Fe(){return(Fe=Be(_e().m(function e(){var t,r,o,a,i,s,c,u,l;return _e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(Ie.s.ENDPOINTS.ME);case 1:return t=e.v,e.n=2,t.json();case 2:if(!(r=e.v).success||!r.authenticated){e.n=7;break}o=r.user,document.getElementById("settingsUsername").textContent=o.username,document.getElementById("settingsEmail").textContent=o.email||"Not provided",Qe(o.email_confirmed),a=localStorage.getItem("boba_vim_selected_character")||"boba",u=a,e.n="boba_diamond"===u?3:"boba"===u?4:5;break;case 3:return i="/static/sprites/avatar/diamond_boba_avatar.png",s="Boba Diamond",e.a(3,6);case 4:return i="/static/sprites/avatar/boba_avatar.png",s="Boba",e.a(3,6);case 5:i="/static/sprites/avatar/".concat(a,"_boba_avatar.png"),s=a.charAt(0).toUpperCase()+a.slice(1)+" Boba";case 6:document.getElementById("userAvatar").src=i,(c=document.getElementById("characterName"))&&(c.textContent=s),document.getElementById("userSettingsModal").classList.remove("hidden"),window.hideCursor&&(window.hideCursor(),setTimeout(function(){window.disableVimNavigation&&window.disableVimNavigation()},0)),setTimeout(function(){if(logger.debug("Settings: About to initialize settings vim, module available:",!!Ne),Ne)try{logger.debug("Settings: Calling initializeSettingsVim with mode: main"),Ne.initializeSettingsVim("main"),logger.debug("Settings: initializeSettingsVim called successfully"),setTimeout(function(){logger.debug("Settings: About to refresh cursor"),Ne.refreshSettingsCursor()},200)}catch(e){logger.error("Settings: Error initializing settings vim:",e)}else logger.warn("Settings: settingsVimModule not loaded yet, trying dynamic import"),n.e(544).then(n.bind(n,544)).then(function(e){logger.debug("Settings: Module imported successfully, calling initializeSettingsVim");try{e.initializeSettingsVim("main"),logger.debug("Settings: initializeSettingsVim called successfully"),setTimeout(function(){e.refreshSettingsCursor()},200)}catch(e){logger.error("Settings: Error initializing settings vim:",e)}}).catch(function(e){logger.error("Settings: Failed to import settings vim navigation:",e)})},150),Xe();case 7:e.n=9;break;case 8:e.p=8,l=e.v,logger.error("Error loading user settings:",l),Ye("Failed to load user settings");case 9:return e.a(2)}},e,null,[[0,8]])}))).apply(this,arguments)}function Ge(){logger.debug("Settings: closeSettings called");var e=document.getElementById("userSettingsModal"),t=window.settingsModalClosingViaCancel;window.settingsModalClosingViaCancel=!1,Ne?(logger.debug("Settings: Calling disableSettingsVim on preloaded module"),Ne.disableSettingsVim()):(logger.debug("Settings: settingsVimModule not available, trying dynamic import for disable"),n.e(544).then(n.bind(n,544)).then(function(e){logger.debug("Settings: Calling disableSettingsVim"),e.disableSettingsVim()}).catch(function(){})),e.classList.add("hidden"),t&&setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.empty&&e.empty()}document.body.focus(),logger.debug("Settings: Cleared selections and focus for cancel close")},50),setTimeout(function(){logger.debug("Settings: Re-enabling main vim navigation after modal close"),Promise.resolve().then(n.bind(n,199)).then(function(e){t?(logger.debug("Settings: Was closed via cancel - doing full reset"),e.disableVimNavigation(),e.hideCursor(),document.querySelectorAll(".vim-cursor, .settings-vim-cursor").forEach(function(e){return e.remove()}),document.querySelectorAll("[data-original-text], [data-original-settings-text]").forEach(function(e){var t=e.getAttribute("data-original-text")||e.getAttribute("data-original-settings-text");t&&(e.textContent=t,e.removeAttribute("data-original-text"),e.removeAttribute("data-original-settings-text"))}),setTimeout(function(){e.enableVimNavigation(),e.showCursor(),logger.debug("Settings: Main vim navigation fully reset and re-enabled")},50)):(logger.debug("Settings: Normal close - simple re-enable"),e.enableVimNavigation(),e.showCursor())}).catch(function(){})},100),Xe(),Ke()}function De(){logger.debug("Settings: Opening delete confirmation modal"),document.getElementById("deleteConfirmModal").classList.remove("hidden"),document.getElementById("deleteConfirmation").value="",document.getElementById("confirmDeleteBtn").disabled=!0,setTimeout(function(){if(logger.debug("Settings: About to initialize delete confirm vim navigation"),Ne)try{logger.debug("Settings: Calling updateSettingsVimForMode with deleteConfirm"),Ne.updateSettingsVimForMode("deleteConfirm"),logger.debug("Settings: Delete confirm vim navigation updated successfully"),setTimeout(function(){Ne.refreshSettingsCursor()},100)}catch(e){logger.error("Settings: Error updating to delete confirm vim:",e)}else logger.warn("Settings: settingsVimModule not available for delete confirm"),n.e(544).then(n.bind(n,544)).then(function(e){try{e.initializeSettingsVim("deleteConfirm"),setTimeout(function(){e.refreshSettingsCursor()},100)}catch(e){logger.error("Settings: Error initializing delete confirm vim:",e)}}).catch(function(e){logger.error("Settings: Failed to import settings vim navigation for delete confirm:",e)})},100)}function Ve(){logger.debug("Settings: Closing delete confirmation modal"),document.getElementById("deleteConfirmModal").classList.add("hidden"),document.getElementById("deleteConfirmation").value="",document.getElementById("confirmDeleteBtn").disabled=!0,setTimeout(function(){if(logger.debug("Settings: About to return to main settings vim navigation"),Ne)try{logger.debug("Settings: Calling updateSettingsVimForMode with main"),Ne.updateSettingsVimForMode("main"),logger.debug("Settings: Main settings vim navigation restored successfully"),setTimeout(function(){Ne.refreshSettingsCursor()},100)}catch(e){logger.error("Settings: Error returning to main settings vim:",e)}},100)}function qe(){var e=document.getElementById("deleteConfirmation"),t=document.getElementById("confirmDeleteBtn");"boba"===e.value.trim().toLowerCase()?t.disabled=!1:t.disabled=!0}function Ue(e){return ze.apply(this,arguments)}function ze(){return(ze=Be(_e().m(function e(t){var n,r,o,a,i,s,c,u;return _e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.preventDefault(),Xe(),n=document.querySelector('#changePasswordForm button[type="submit"]'),r=n.textContent,n.disabled=!0,n.textContent="Updating...",$e("Updating password...","info"),o=document.getElementById("currentPassword").value,a=document.getElementById("newPassword").value,i=document.getElementById("confirmNewPassword").value,!(a.length<8)){e.n=1;break}return $e("New password must be at least 8 characters long","error"),Ze(n,r),e.a(2);case 1:if(a===i){e.n=2;break}return $e("New passwords do not match","error"),Ze(n,r),e.a(2);case 2:if(o!==a){e.n=3;break}return $e("New password must be different from current password","error"),Ze(n,r),e.a(2);case 3:return e.p=3,e.n=4,fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:o,newPassword:a})});case 4:return s=e.v,e.n=5,s.json();case 5:(c=e.v).success?($e("Password updated successfully!","success"),Ke()):$e(c.error||"Failed to update password","error"),e.n=7;break;case 6:e.p=6,u=e.v,logger.error("Change password error:",u),$e("Network error. Please try again.","error");case 7:return e.p=7,Ze(n,r),e.f(7);case 8:return e.a(2)}},e,null,[[3,6,7,8]])}))).apply(this,arguments)}function He(){return We.apply(this,arguments)}function We(){return(We=Be(_e().m(function e(){var t,n,r;return _e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/delete-account",{method:"DELETE",headers:{"Content-Type":"application/json"}});case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success?(alert("Account deleted successfully. You will be redirected to the home page."),window.location.href="/"):Ye(n.error||"Failed to delete account"),e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Delete account error:",r),Ye("Network error. Please try again.");case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Ke(){document.getElementById("currentPassword").value="",document.getElementById("newPassword").value="",document.getElementById("confirmNewPassword").value=""}function Ye(e){var t=document.getElementById("settingsError"),n=document.getElementById("settingsSuccess");t.textContent=e,t.classList.remove("hidden"),n.classList.add("hidden")}function Je(e){var t=document.getElementById("settingsError"),n=document.getElementById("settingsSuccess");n.textContent=e,n.classList.remove("hidden"),t.classList.add("hidden")}function Xe(){document.getElementById("settingsError").classList.add("hidden"),document.getElementById("settingsSuccess").classList.add("hidden");var e=document.getElementById("passwordChangeStatus");e&&e.classList.add("hidden")}function $e(e,t){var n=document.getElementById("passwordChangeStatus");n&&(n.textContent=e,n.className="status-message ".concat(t),n.classList.remove("hidden"))}function Ze(e,t){e.disabled=!1,e.textContent=t}function Qe(e){var t=document.getElementById("emailConfirmationStatus");if(t)if(e)t.innerHTML='\n      <div style="color: #2ecc71; font-size: 0.9rem; margin-top: 0.5rem;">\n        ‚úÖ Email confirmed\n      </div>\n    ';else{t.innerHTML='\n      <div style="color: #e74c3c; font-size: 0.9rem; margin-top: 0.5rem;">\n        ‚ùå Please confirm your account\n        <button \n          id="resendConfirmationBtn"\n          style="\n            background: #e67e22;\n            color: white;\n            border: none;\n            padding: 0.3rem 0.6rem;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 0.8rem;\n            margin-left: 0.5rem;\n            transition: background 0.3s;\n          "\n          onmouseover="this.style.background=\'#d35400\'"\n          onmouseout="this.style.background=\'#e67e22\'"\n        >\n          Resend confirmation email\n        </button>\n      </div>\n    ';var n=document.getElementById("resendConfirmationBtn");n&&n.addEventListener("click",et)}}function et(){return tt.apply(this,arguments)}function tt(){return(tt=Be(_e().m(function e(){var t,n,r,o,a;return _e().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=document.getElementById("resendConfirmationBtn"),n=t.textContent,e.p=1,t.disabled=!0,t.textContent="Sending...",e.n=2,fetch("/api/auth/resend-confirmation",{method:"POST",headers:{"Content-Type":"application/json"}});case 2:return r=e.v,e.n=3,r.json();case 3:(o=e.v).success?(Je(o.message),t.textContent="Email sent!",setTimeout(function(){t.disabled=!1,t.textContent=n},3e3)):(Ye(o.error||"Failed to send confirmation email"),Ze(t,n)),e.n=5;break;case 4:e.p=4,a=e.v,logger.error("Error resending confirmation:",a),Ye("Network error. Please try again."),Ze(t,n);case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}n.e(544).then(n.bind(n,544)).then(function(e){Ne=e,logger.debug("Settings: settingsVimNavigation module loaded at startup")}).catch(function(e){logger.error("Settings: Failed to load settingsVimNavigation module:",e)});var nt=n(724);function rt(e,t){logger.debug("Closing retro vim manual book"),(0,nt.disableModalVim)(),t&&t.classList.remove("open"),!(!window.showCursor||!window.enableVimNavigation)?(window.showCursor(),window.enableVimNavigation(),logger.debug("Main vim navigation re-enabled for manual")):logger.debug("Manual closed in game mode - no vim navigation to re-enable"),setTimeout(function(){e.classList.add("hidden"),ot("page-1")},600)}function ot(e){logger.debug("Showing page: ".concat(e)),document.querySelectorAll(".book-page").forEach(function(e){e.classList.remove("active"),e.classList.add("hidden")});var t=document.querySelector(".".concat(e));t&&setTimeout(function(){t.classList.remove("hidden"),t.classList.add("active"),(0,nt.updateModalVimForPage)(e)},200)}function at(){var e=document.getElementById("instructionsBook"),t=document.getElementById("book-animation-style");e&&(e.classList.remove("book-pulsing"),e.style.transform="",e.style.filter="",e.style.color=""),t&&t.remove()}function it(){if(window.IS_MULTIPLAYER)logger.debug("Skipping vim manual initialization - multiplayer mode detected");else{var e=!(!window.hideCursor||!window.disableVimNavigation);logger.debug("Initializing retro vim manual book...",{isIndexPage:e});var t={bookIcon:document.getElementById("instructionsBook"),modal:document.getElementById("vimManualModal"),closeBtn:document.getElementById("closeManual"),helpText:document.getElementById("helpText"),bookContent:document.querySelector(".book-content"),bookCover:document.querySelector(".book-cover")},n=t.bookIcon,r=t.modal,o=t.closeBtn,a=t.bookContent;n&&r&&o?(n.addEventListener("click",function(){at(),function(e,t){logger.debug("Opening retro vim manual book"),e.classList.remove("hidden"),window.hideCursor&&window.disableVimNavigation?(window.hideCursor(),window.disableVimNavigation(),logger.debug("Main vim navigation disabled for manual")):logger.debug("Manual opened in game mode - no vim navigation to disable"),setTimeout(function(){t&&t.classList.add("open"),ot("page-1"),setTimeout(function(){(0,nt.initializeModalVim)("manual","page-1"),setTimeout(function(){(0,nt.refreshCursorPosition)()},300)},200)},300)}(r,a)}),o.addEventListener("click",function(){return rt(r,a)}),r.addEventListener("click",function(e){e.target===r&&(logger.debug("Closing retro vim manual (clicked outside)"),rt(r,a))}),function(){var e=document.getElementById("showKeymapBtn");e&&e.addEventListener("click",function(){logger.debug("Showing keymap guide"),ot("page-2")});var t=document.getElementById("showMotionsBtn");t&&t.addEventListener("click",function(){logger.debug("Showing vim motions"),ot("page-3")});var n=document.getElementById("backToConfigBtn");n&&n.addEventListener("click",function(){logger.debug("Going back to config"),ot("page-2")});var r=document.getElementById("toScoreAttributionBtn");r&&r.addEventListener("click",function(){logger.debug("Going to score attribution"),ot("page-4")});var o=document.getElementById("backToCommandsBtn");o&&o.addEventListener("click",function(){logger.debug("Going back to commands"),ot("page-3")})}(),document.addEventListener("keydown",function(e){return function(e,t,n){"Escape"!==e.key||t.classList.contains("hidden")||(logger.debug("Closing retro vim manual (escape key)"),rt(t,n))}(e,r,a)}),logger.debug("Retro vim manual book initialized successfully")):logger.warn("Vim manual elements not found")}}var st=n(35);function ct(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return ut(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(ut(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,ut(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,ut(d,"constructor",u),ut(u,"constructor",c),c.displayName="GeneratorFunction",ut(u,o,"GeneratorFunction"),ut(d),ut(d,o,"Generator"),ut(d,r,function(){return this}),ut(d,"toString",function(){return"[object Generator]"}),(ct=function(){return{w:a,m:f}})()}function ut(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}ut=function(e,t,n,r){function a(t,n){ut(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},ut(e,t,n,r)}function lt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function dt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){lt(a,r,o,i,s,"next",e)}function s(e){lt(a,r,o,i,s,"throw",e)}i(void 0)})}}var ft=1,pt=!1;function gt(){var e=document.getElementById("surveyPanel"),t=document.getElementById("surveyButton");document.getElementById("surveyPlus");e&&t&&(pt?ht():function(){mt.apply(this,arguments)}())}function mt(){return(mt=dt(ct().m(function e(){var t,n;return ct().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("surveyPanel"),n=document.getElementById("surveyButton"),document.getElementById("surveyPlus"),t&&n){e.n=1;break}return e.a(2);case 1:return e.n=2,vt();case 2:Ot(),St(),t.classList.remove("hidden"),t.classList.add("visible"),n.classList.add("active"),window.hideCursor&&window.hideCursor(),pt=!0;case 3:return e.a(2)}},e)}))).apply(this,arguments)}function ht(){var e=document.getElementById("surveyPanel"),t=document.getElementById("surveyButton");e&&t&&(e.classList.remove("visible"),e.classList.add("hidden"),t.classList.remove("active"),window.showCursor&&window.showCursor(),pt=!1)}function vt(){return yt.apply(this,arguments)}function yt(){return(yt=dt(ct().m(function e(){var t,n,r,o,a,i,s,c;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/surveys/");case 1:return t=e.v,e.n=2,t.json();case 2:if((n=e.v).success&&n.surveys&&0!==n.surveys.length){e.n=3;break}return logger.error("No active survey found"),e.a(2);case 3:r=n.surveys[0],o=r.questions[0],a=document.getElementById("surveyTitle"),i=document.getElementById("surveyDescription"),a&&(a.textContent=r.title),i&&(i.textContent=r.description||""),(s=document.getElementById("surveyContent"))&&o&&("rating"===o.question_type?s.innerHTML=bt(o):"multiple_choice"===o.question_type?s.innerHTML=wt(o):"text"===o.question_type&&(s.innerHTML=Et(o))),e.n=5;break;case 4:e.p=4,c=e.v,logger.error("Error loading survey content:",c);case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function bt(e){for(var t=e.min_value||1,n=e.max_value||10,r="",o=t;o<=n;o++)r+='<div class="rating-option '.concat(o===t?"selected":"",'" data-rating="').concat(o,'">').concat(o,"</div>");return"\n    <p>".concat(e.question_text,'</p>\n    <div class="rating-container">\n      <div class="rating-scroll" id="ratingScroll">\n        ').concat(r,'\n      </div>\n      <div class="selected-rating">\n        Selected: <span id="selectedRating">').concat(t,"</span>/").concat(n,'\n      </div>\n    </div>\n    <div class="survey-actions">\n      <button id="submitRating" class="submit-btn">Submit Rating</button>\n      <button id="undoRating" class="undo-btn hidden">Vote Again</button>\n    </div>\n  ')}function wt(e){var t=[];try{t=JSON.parse(e.options||"[]")}catch(e){return logger.error("Error parsing multiple choice options:",e),"<p>Error loading survey options</p>"}var n=t.map(function(e){return'<button class="choice-option" data-choice="'.concat(e,'">').concat(e,"</button>")}).join("");return"\n    <p>".concat(e.question_text,'</p>\n    <div class="choice-container">\n      ').concat(n,'\n    </div>\n    <div class="survey-actions">\n      <button id="submitChoice" class="submit-btn" disabled>Submit Choice</button>\n      <button id="undoChoice" class="undo-btn hidden">Vote Again</button>\n    </div>\n  ')}function Et(e){return"\n    <p>".concat(e.question_text,'</p>\n    <div class="text-container">\n      <textarea id="textAnswer" placeholder="Enter your response..." rows="4"></textarea>\n    </div>\n    <div class="survey-actions">\n      <button id="submitText" class="submit-btn">Submit Response</button>\n      <button id="undoText" class="undo-btn hidden">Vote Again</button>\n    </div>\n  ')}function St(){return xt.apply(this,arguments)}function xt(){return(xt=dt(ct().m(function e(){var t,n,r,o,a,i;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,st.getUserSurveyData)();case 1:return t=e.v,e.n=2,(0,st.getCommunityData)();case 2:n=e.v,ft=t.hasVoted?t.userRating:1,kt(),r=document.getElementById("submitRating"),o=document.getElementById("undoRating"),a=document.getElementById("surveyResults"),t.hasVoted?(r.textContent="Update Rating",o.classList.remove("hidden"),a.classList.remove("hidden"),Ct(n)):(r.textContent="Submit Rating",o.classList.add("hidden"),a.classList.add("hidden")),e.n=4;break;case 3:e.p=3,i=e.v,logger.error("Error initializing survey state:",i);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function kt(){document.querySelectorAll(".rating-option").forEach(function(e){parseInt(e.dataset.rating)===ft?e.classList.add("selected"):e.classList.remove("selected")});var e=document.getElementById("selectedRating");e&&(e.textContent=ft)}function Ct(e){var t=document.getElementById("averageScore"),n=document.getElementById("totalVotes");t&&(t.textContent=e.average.toFixed(1)),n&&(n.textContent=e.totalVotes.toLocaleString())}function Tt(){Ot(),document.addEventListener("click",function(e){var t=document.querySelector(".survey-system");pt&&t&&!t.contains(e.target)&&ht()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&pt&&ht()})}function Ot(){document.querySelectorAll(".rating-option").forEach(function(e){e.addEventListener("click",function(){ft=parseInt(e.dataset.rating),kt()})});var e=document.getElementById("submitRating");e&&e.addEventListener("click",Lt);var t=document.getElementById("undoRating");t&&t.addEventListener("click",It);var n=document.querySelectorAll(".choice-option");n.forEach(function(e){e.addEventListener("click",function(){n.forEach(function(e){return e.classList.remove("selected")}),e.classList.add("selected");var t=document.getElementById("submitChoice");t&&(t.disabled=!1,t.dataset.choice=e.dataset.choice)})});var r=document.getElementById("submitChoice");r&&r.addEventListener("click",Mt);var o=document.getElementById("submitText");o&&o.addEventListener("click",Bt)}function Lt(){return Pt.apply(this,arguments)}function Pt(){return(Pt=dt(ct().m(function e(){var t,n,r,o,a;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(ft<1||ft>10)){e.n=1;break}return Ft("Please select a valid rating between 1 and 10","error"),e.a(2);case 1:return e.p=1,e.n=2,(0,st.submitUserRating)(ft);case 2:return t=e.v,n=document.getElementById("submitRating"),r=document.getElementById("undoRating"),o=document.getElementById("surveyResults"),n.textContent="Update Rating",r.classList.remove("hidden"),o.classList.remove("hidden"),Ct(t.communityData),Ft("Thank you for your feedback! üéâ","success"),e.n=3,jt();case 3:e.n=5;break;case 4:e.p=4,a=e.v,logger.error("Error submitting rating:",a),Ft("Failed to submit rating. Please try again.","error");case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function It(){return _t.apply(this,arguments)}function _t(){return(_t=dt(ct().m(function e(){var t,n,r,o;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,st.clearUserVote)();case 1:return e.v,ft=1,kt(),t=document.getElementById("submitRating"),n=document.getElementById("undoRating"),r=document.getElementById("surveyResults"),t.textContent="Submit Rating",n.classList.add("hidden"),r.classList.add("hidden"),Ft("Your vote has been cleared. You can vote again!","info"),e.n=2,jt();case 2:e.n=4;break;case 3:e.p=3,o=e.v,logger.error("Error clearing vote:",o),Ft("Failed to clear vote. Please try again.","error");case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Mt(){return At.apply(this,arguments)}function At(){return(At=dt(ct().m(function e(){var t,n,r;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("submitChoice"),n=null==t?void 0:t.dataset.choice){e.n=1;break}return Ft("Please select an option","error"),e.a(2);case 1:return e.p=1,e.n=2,(0,st.submitUserChoice)(n);case 2:e.v,Ft("Thank you for your feedback! üéâ","success"),e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Error submitting choice:",r),Ft("Failed to submit choice. Please try again.","error");case 4:return e.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}function Bt(){return Nt.apply(this,arguments)}function Nt(){return(Nt=dt(ct().m(function e(){var t,n,r;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("textAnswer"),n=null==t?void 0:t.value.trim()){e.n=1;break}return Ft("Please enter your response","error"),e.a(2);case 1:return e.p=1,e.n=2,(0,st.submitUserText)(n);case 2:e.v,Ft("Thank you for your feedback! üéâ","success"),e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Error submitting text:",r),Ft("Failed to submit response. Please try again.","error");case 4:return e.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}function jt(){return Rt.apply(this,arguments)}function Rt(){return(Rt=dt(ct().m(function e(){var t,n,r,o;return ct().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,st.getUserSurveyData)();case 1:t=e.v,n=document.querySelector(".survey-text"),r=document.querySelector(".survey-plus"),t.hasVoted&&n&&r?(n.textContent="Survey (".concat(t.userRating,"/10)"),r.textContent="‚úì"):n&&r&&(n.textContent="Survey",r.textContent="+"),e.n=3;break;case 2:e.p=2,o=e.v,logger.error("Error updating button appearance:",o);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function Ft(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",n=document.createElement("div");n.className="survey-notification ".concat(t),n.textContent=e,document.body.appendChild(n),setTimeout(function(){n.style.animation="slideOutRight 0.3s ease",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},300)},3e3)}function Gt(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Dt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Dt(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Dt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Dt(d,"constructor",u),Dt(u,"constructor",c),c.displayName="GeneratorFunction",Dt(u,o,"GeneratorFunction"),Dt(d),Dt(d,o,"Generator"),Dt(d,r,function(){return this}),Dt(d,"toString",function(){return"[object Generator]"}),(Gt=function(){return{w:a,m:f}})()}function Dt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Dt=function(e,t,n,r){function a(t,n){Dt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Dt(e,t,n,r)}function Vt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function qt(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Vt(a,r,o,i,s,"next",e)}function s(e){Vt(a,r,o,i,s,"throw",e)}i(void 0)})}}function Ut(){return zt.apply(this,arguments)}function zt(){return(zt=qt(Gt().m(function e(){var t;return Gt().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("surveyButton")){e.n=1;break}return logger.debug("Survey button not found"),e.a(2);case 1:return logger.debug("Initializing survey system..."),t.addEventListener("click",function(e){e.stopPropagation(),logger.debug("Survey button clicked - toggling panel"),gt()}),Tt(),e.n=2,Yt();case 2:Ht(),logger.debug("Survey system initialized successfully");case 3:return e.a(2)}},e)}))).apply(this,arguments)}function Ht(){setInterval(qt(Gt().m(function e(){return Gt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,Wt();case 1:return e.a(2)}},e)})),3e4),document.addEventListener("visibilitychange",qt(Gt().m(function e(){return Gt().w(function(e){for(;;)switch(e.n){case 0:if(document.hidden){e.n=1;break}return e.n=1,Wt();case 1:return e.a(2)}},e)})))}function Wt(){return Kt.apply(this,arguments)}function Kt(){return(Kt=qt(Gt().m(function e(){var t,r;return Gt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,Promise.resolve().then(n.bind(n,35));case 1:return t=e.v,(0,t.clearAllCaches)(),e.n=2,Yt();case 2:logger.debug("Survey data refreshed"),e.n=4;break;case 3:e.p=3,r=e.v,logger.error("Error refreshing survey:",r);case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Yt(){return Jt.apply(this,arguments)}function Jt(){return(Jt=qt(Gt().m(function e(){var t,n,r,o,a,i;return Gt().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,st.getUserSurveyData)();case 1:t=e.v,n=document.querySelector(".survey-text"),r=document.querySelector(".survey-plus"),t.hasVoted&&n&&r?(n.textContent="Survey (".concat(t.userRating,"/10)"),r.textContent="‚úì",(o=document.getElementById("surveyButton"))&&(o.style.boxShadow+=", 0 0 15px rgba(46, 204, 113, 0.3)",o.title="Survey - You rated: ".concat(t.userRating,"/10 (Click to change)"))):n&&r&&(n.textContent="Survey",r.textContent="+",(a=document.getElementById("surveyButton"))&&(a.title="Survey - Rate our game (Click to open)")),e.n=3;break;case 2:e.p=2,i=e.v,logger.error("Error updating button appearance:",i);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}var Xt=n(195);function $t(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Zt(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Zt(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Zt(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Zt(d,"constructor",u),Zt(u,"constructor",c),c.displayName="GeneratorFunction",Zt(u,o,"GeneratorFunction"),Zt(d),Zt(d,o,"Generator"),Zt(d,r,function(){return this}),Zt(d,"toString",function(){return"[object Generator]"}),($t=function(){return{w:a,m:f}})()}function Zt(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Zt=function(e,t,n,r){function a(t,n){Zt(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Zt(e,t,n,r)}function Qt(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function en(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Qt(a,r,o,i,s,"next",e)}function s(e){Qt(a,r,o,i,s,"throw",e)}i(void 0)})}}var tn="/api/newsletters",nn="/api/newsletters";function rn(){return on.apply(this,arguments)}function on(){return(on=en($t().m(function e(){var t,n,r;return $t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(tn);case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success){e.n=3;break}return e.a(2,n.newsletters);case 3:return logger.error("Failed to load newsletters:",n.error),e.a(2,[]);case 4:e.n=6;break;case 5:return e.p=5,r=e.v,logger.error("Error loading newsletters:",r),e.a(2,[]);case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function an(e){return sn.apply(this,arguments)}function sn(){return(sn=en($t().m(function e(t){var n,r,o;return $t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(nn,"/").concat(t));case 1:return n=e.v,e.n=2,n.json();case 2:if(!(r=e.v).success){e.n=3;break}return e.a(2,r.newsletter);case 3:return logger.error("Failed to load newsletter:",r.error),e.a(2,null);case 4:e.n=6;break;case 5:return e.p=5,o=e.v,logger.error("Error loading newsletter:",o),e.a(2,null);case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function cn(e){var t=document.querySelector(".news-list");t&&(e&&0!==e.length?(t.innerHTML=e.map(function(e){return'\n    <div class="news-item" data-news-id="'.concat(e.id,'">\n      <h4>\n        ').concat(pn(e.title),"\n        ").concat(e.is_read?"":'<span class="unread-indicator">!</span>',"\n      </h4>\n      <p>").concat(pn(e.summary||e.content.substring(0,100)+"..."),'</p>\n      <button class="read-more-btn" data-newsletter-id="').concat(e.id,'">Click to read more</button>\n    </div>\n  ')}).join(""),t.querySelectorAll(".read-more-btn").forEach(function(e){e.addEventListener("click",function(t){t.preventDefault();var n=e.getAttribute("data-newsletter-id");!function(e){un.apply(this,arguments)}(parseInt(n))})})):t.innerHTML='\n      <div class="news-item">\n        <h4>No news available</h4>\n        <p>Check back later for updates from Boba Boss!</p>\n      </div>\n    ')}function un(){return(un=en($t().m(function e(t){var r,o,a;return $t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,an(t);case 1:if(r=e.v){e.n=2;break}return logger.error("Newsletter not found:",t),e.a(2);case 2:o=document.getElementById("newsTitle"),a=document.getElementById("newsContent"),o&&(o.textContent=r.title),a&&(a.innerHTML=r.content),fn(t),ln(t),Promise.resolve().then(n.bind(n,195)).then(function(e){e.showNewsGameArea()});case 3:return e.a(2)}},e)}))).apply(this,arguments)}function ln(e){return dn.apply(this,arguments)}function dn(){return(dn=en($t().m(function e(t){var n;return $t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("".concat(nn,"/").concat(t,"/read"),{method:"POST",headers:{"Content-Type":"application/json"}});case 1:e.v.ok?(logger.debug("Newsletter marked as read"),fn(t)):logger.error("Failed to mark newsletter as read"),e.n=3;break;case 2:e.p=2,n=e.v,logger.error("Error marking newsletter as read:",n);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}function fn(e){var t=document.querySelector('[data-news-id="'.concat(e,'"]'));if(t){var n=t.querySelector(".unread-indicator");n&&(n.style.transition="opacity 0.3s ease",n.style.opacity="0",setTimeout(function(){n.remove()},300),logger.debug("Unread indicator removed for newsletter:",e))}}function pn(e){if(!e)return"";var t=document.createElement("div");return t.textContent=e,t.innerHTML}function gn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return mn(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(mn(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,mn(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,mn(d,"constructor",u),mn(u,"constructor",c),c.displayName="GeneratorFunction",mn(u,o,"GeneratorFunction"),mn(d),mn(d,o,"Generator"),mn(d,r,function(){return this}),mn(d,"toString",function(){return"[object Generator]"}),(gn=function(){return{w:a,m:f}})()}function mn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}mn=function(e,t,n,r){function a(t,n){mn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},mn(e,t,n,r)}function hn(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function vn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){hn(a,r,o,i,s,"next",e)}function s(e){hn(a,r,o,i,s,"throw",e)}i(void 0)})}}function yn(){return bn.apply(this,arguments)}function bn(){return(bn=vn(gn().m(function e(){var t;return gn().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("newsletterButton")){e.n=1;break}return logger.debug("Newsletter button not found"),e.a(2);case 1:return logger.debug("Initializing newsletter system..."),e.n=2,wn();case 2:t.addEventListener("click",function(e){e.stopPropagation(),logger.debug("Newsletter button clicked - toggling panel"),(0,Xt.toggleNewsletterPanel)()}),(0,Xt.setupNewsletterEventListeners)(),logger.debug("Newsletter system initialized successfully");case 3:return e.a(2)}},e)}))).apply(this,arguments)}function wn(){return En.apply(this,arguments)}function En(){return(En=vn(gn().m(function e(){var t,n;return gn().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,logger.debug("Loading newsletters from API..."),e.n=1,rn();case 1:t=e.v,logger.debug("Loaded newsletters:",t),cn(t),e.n=3;break;case 2:e.p=2,n=e.v,logger.error("Error loading newsletters:",n),cn([]);case 3:return e.a(2)}},e,null,[[0,2]])}))).apply(this,arguments)}var Sn=n(422);function xn(e){return xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xn(e)}function kn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Cn(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Cn(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Cn(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Cn(d,"constructor",u),Cn(u,"constructor",c),c.displayName="GeneratorFunction",Cn(u,o,"GeneratorFunction"),Cn(d),Cn(d,o,"Generator"),Cn(d,r,function(){return this}),Cn(d,"toString",function(){return"[object Generator]"}),(kn=function(){return{w:a,m:f}})()}function Cn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Cn=function(e,t,n,r){function a(t,n){Cn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Cn(e,t,n,r)}function Tn(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function On(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){Tn(a,r,o,i,s,"next",e)}function s(e){Tn(a,r,o,i,s,"throw",e)}i(void 0)})}}function Ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Pn(r.key),r)}}function Pn(e){var t=function(e,t){if("object"!=xn(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=xn(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==xn(t)?t:t+""}new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.audio=null,this.musicButton=null,this.stopOverlay=null,this.isPlaying=!1,this.storageKey="boba-vim-music-enabled",this.init()},t=[{key:"init",value:function(){var e=this;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){return e.setupMusic()}):this.setupMusic()}},{key:"setupMusic",value:function(){var e=this;logger.debug("Setting up music..."),this.audio=document.getElementById("backgroundMusic"),this.musicButton=document.getElementById("musicButton"),this.stopOverlay=document.getElementById("stopOverlay"),logger.debug("Music elements found:",{audio:!!this.audio,musicButton:!!this.musicButton,stopOverlay:!!this.stopOverlay}),this.audio&&this.musicButton?(this.musicButton.addEventListener("click",function(){return e.toggleMusic()}),this.audio.addEventListener("loadstart",function(){return logger.debug("Audio loading started")}),this.audio.addEventListener("canplay",function(){return logger.debug("Audio can play")}),this.audio.addEventListener("play",function(){return logger.debug("Audio started playing")}),this.audio.addEventListener("pause",function(){return logger.debug("Audio paused")}),this.audio.addEventListener("error",function(e){return logger.error("Audio error:",e)}),this.initializeMusic()):logger.debug("Music elements not found - music functionality disabled")}},{key:"getMusicPreference",value:function(){var e=localStorage.getItem(this.storageKey);return null===e||"true"===e}},{key:"saveMusicPreference",value:function(e){localStorage.setItem(this.storageKey,e.toString())}},{key:"initializeMusic",value:(i=On(kn().m(function e(){var t;return kn().w(function(e){for(;;)switch(e.n){case 0:if(t=this.getMusicPreference(),logger.debug("Music preference from localStorage:",t),this.isPlaying=!1,this.updateButtonState(),!t){e.n=2;break}return e.n=1,this.startMusic();case 1:e.n=3;break;case 2:logger.debug("Music disabled by user preference");case 3:return e.a(2)}},e,this)})),function(){return i.apply(this,arguments)})},{key:"startMusic",value:(a=On(kn().m(function e(){var t,n;return kn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.audio){e.n=1;break}return logger.error("No audio element available"),e.a(2);case 1:if(e.p=1,logger.debug("Attempting to start music..."),this.audio.volume=.3,void 0===(t=this.audio.play())){e.n=3;break}return e.n=2,t;case 2:this.isPlaying=!0,logger.debug("Music started successfully");case 3:this.updateButtonState(),e.n=5;break;case 4:e.p=4,n=e.v,logger.info("Autoplay prevented by browser policy. User interaction required.",n),this.isPlaying=!1,this.updateButtonState(),this.addAutoplayFallback();case 5:return e.a(2)}},e,this,[[1,4]])})),function(){return a.apply(this,arguments)})},{key:"addAutoplayFallback",value:function(){var e=this;logger.debug("Adding autoplay fallback - music will start on next user interaction");var t=function(){var n=On(kn().m(function n(){var r;return kn().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e.isPlaying||!e.getMusicPreference()){n.n=4;break}return n.p=1,logger.debug("Attempting to start music after user interaction..."),n.n=2,e.audio.play();case 2:e.isPlaying=!0,e.updateButtonState(),logger.debug("Music started successfully after user interaction"),n.n=4;break;case 3:n.p=3,r=n.v,logger.error("Failed to start music even after user interaction:",r);case 4:document.removeEventListener("click",t),document.removeEventListener("keydown",t),document.removeEventListener("touchstart",t);case 5:return n.a(2)}},n,null,[[1,3]])}));return function(){return n.apply(this,arguments)}}();document.addEventListener("click",t,{once:!0}),document.addEventListener("keydown",t,{once:!0}),document.addEventListener("touchstart",t,{once:!0})}},{key:"toggleMusic",value:(o=On(kn().m(function e(){var t;return kn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.audio){e.n=1;break}return logger.error("No audio element for toggle"),e.a(2);case 1:if(logger.debug("Toggling music. Current state:",this.isPlaying),e.p=2,!this.isPlaying){e.n=3;break}this.audio.pause(),this.isPlaying=!1,logger.debug("Music paused"),e.n=5;break;case 3:return logger.debug("Attempting to start music from button click..."),this.audio.currentTime=0,this.audio.volume=.3,e.n=4,this.audio.play();case 4:this.isPlaying=!0,logger.debug("Music started from button click");case 5:this.saveMusicPreference(this.isPlaying),this.updateButtonState(),e.n=7;break;case 6:e.p=6,t=e.v,logger.error("Error toggling music:",t),this.updateButtonState();case 7:return e.a(2)}},e,this,[[2,6]])})),function(){return o.apply(this,arguments)})},{key:"updateButtonState",value:function(){if(this.musicButton){logger.debug("Updating button state. Playing:",this.isPlaying);var e=this.musicButton.closest(".music-button");this.isPlaying?(e&&e.classList.remove("stopped"),this.musicButton.classList.remove("stopped"),this.musicButton.title="Stop Music",logger.debug("Button set to playing state (normal color)")):(e&&e.classList.add("stopped"),this.musicButton.classList.add("stopped"),this.musicButton.title="Play Music",logger.debug("Button set to stopped state (should be grey with pause icon)")),e&&e.offsetHeight}else logger.error("No music button element for state update")}},{key:"stopMusic",value:function(){this.audio&&this.isPlaying&&(this.audio.pause(),this.isPlaying=!1,this.saveMusicPreference(!1),this.updateButtonState())}},{key:"playMusic",value:(r=On(kn().m(function e(){var t;return kn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.audio||this.isPlaying){e.n=4;break}return e.p=1,e.n=2,this.audio.play();case 2:this.isPlaying=!0,this.saveMusicPreference(!0),this.updateButtonState(),e.n=4;break;case 3:e.p=3,t=e.v,logger.error("Error starting music:",t);case 4:return e.a(2)}},e,this,[[1,3]])})),function(){return r.apply(this,arguments)})}],t&&Ln(e.prototype,t),n&&Ln(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,o,a,i}());var In=["d g_ ‚Üí delete from the cursor to the last non-blank character.","Press space + f to see the game in full-screen","% ‚Üí find an opening bracket { } or ( ) or [] and use % to jump beetwen the two","increase your speed with putting a number before your command","V G_ ‚Üí Visually select until the last non-blank character.","%s/word/newword/g‚Üí replace in your file all the word by newword","5dd ‚Üí You will cut 5 lines that you could paste in your file with p.","When you programming with vim, you should forget about your mouse or the arrow","You can change in your ~/.vimrc lot of things (syntax, color, set number), including changing a keymap to one that fit you better.","G$ ‚Üí You will arrive at the last character of the file","d$ ‚Üí delete everything after your cursor","di' -> stand for delete inside, delete everything inside quotes, parentheses","Have you try the tutorial mode with space + t?","You can open the map with space + m ","If you use a search motion (f, F, t, T you can use , ; that will repeat forward or backward your search motion.","In vim, is recommended to not use your mouse or the arrow to have your hand configure in the best position for typing","If you meet a bracket { [ ( )]}, you could use % to jump to the closing one.","Vim was created by Bram Moolenaar, a Dutch software engineer. He released the first version of Vim in 1991. Bram Moolenaar passed away in 2023.","Vim enhances Vi by offering multi-level undo, syntax highlighting, extensive configuration options, plugin support, and cross-platform compatibility."];function _n(){logger.debug("Initializing display tips..."),Mn()}function Mn(){var e=Math.floor(Math.random()*In.length),t=document.getElementById("randomTip");t?t.textContent=In[e]:logger.debug("randomTip element not found")}var An=n(199);function Bn(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return Nn(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Nn(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Nn(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,Nn(d,"constructor",u),Nn(u,"constructor",c),c.displayName="GeneratorFunction",Nn(u,o,"GeneratorFunction"),Nn(d),Nn(d,o,"Generator"),Nn(d,r,function(){return this}),Nn(d,"toString",function(){return"[object Generator]"}),(Bn=function(){return{w:a,m:f}})()}function Nn(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Nn=function(e,t,n,r){function a(t,n){Nn(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},Nn(e,t,n,r)}function jn(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function Rn(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){jn(a,r,o,i,s,"next",e)}function s(e){jn(a,r,o,i,s,"throw",e)}i(void 0)})}}function Fn(){return(Fn=Rn(Bn().m(function e(){var t,n,r,o,a,i,s;return Bn().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.querySelector(".supporters-loading"),n=document.querySelector(".supporters-list"),t&&n){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,fetch("/api/supporters");case 2:return r=e.v,e.n=3,r.json();case 3:(o=e.v).success&&o.supporters.length>0?(a=o.supporters.sort(function(e,t){var n=parseInt(e.level)||0;return(parseInt(t.level)||0)-n}),i='<div class="supporters-container">',a.forEach(function(e){var t=parseInt(e.level)||0;i+='\n          <div class="supporter-entry">\n            <div class="supporter-info">\n              <div class="supporter-avatar-section">\n                <img src="/static/sprites/avatar/diamond_boba_avatar.png" class="supporter-avatar" alt="Diamond Boba Avatar">\n                <div>\n                  <div class="supporter-name">'.concat(Gn(e.username),'</div>\n                  <div class="supporter-level">LEVEL ').concat(t,'</div>\n                </div>\n              </div>\n              <div class="level-badge">LVL ').concat(t,"</div>\n            </div>\n            ").concat(e.message?'<div class="supporter-message"><p>'.concat(Gn(e.message),"</p></div>"):"","\n          </div>\n        ")}),i+="</div>",n.innerHTML=i):n.innerHTML='<div class="no-supporters">No supporters yet. Be the first to support Boba.vim!</div>',t.classList.add("hidden"),n.classList.remove("hidden"),e.n=5;break;case 4:e.p=4,s=e.v,logger.error("Error loading supporters:",s),n.innerHTML='<div class="error-message">Error loading supporters. Please try again later.</div>',t.classList.add("hidden"),n.classList.remove("hidden");case 5:return e.a(2)}},e,null,[[1,4]])}))).apply(this,arguments)}function Gn(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function Dn(){var e=new URLSearchParams(window.location.search);if(e.has("confirmed"))Vn("‚úÖ Email confirmed successfully!","success"),window.history.replaceState({},document.title,window.location.pathname);else if(e.has("error")){var t="‚ùå Error confirming email";switch(e.get("error")){case"missing_token":t="‚ùå Missing confirmation token";break;case"invalid_token":t="‚ùå Invalid confirmation token";break;case"expired_token":t="‚ùå Confirmation token has expired";break;case"server_error":t="‚ùå Server error during confirmation"}Vn(t,"error"),window.history.replaceState({},document.title,window.location.pathname)}}function Vn(e,t){var n=document.createElement("div");if(n.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    padding: 1rem 1.5rem;\n    border-radius: 8px;\n    color: white;\n    font-weight: 500;\n    z-index: 10000;\n    animation: slideIn 0.3s ease-out;\n    max-width: 400px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n    ".concat("success"===t?"background: linear-gradient(45deg, #27ae60, #2ecc71);":"background: linear-gradient(45deg, #e74c3c, #c0392b);","\n  "),n.textContent=e,!document.getElementById("confirmationMessageStyles")){var r=document.createElement("style");r.id="confirmationMessageStyles",r.textContent="\n      @keyframes slideIn {\n        from {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n      @keyframes slideOut {\n        from {\n          transform: translateX(0);\n          opacity: 1;\n        }\n        to {\n          transform: translateX(100%);\n          opacity: 0;\n        }\n      }\n    ",document.head.appendChild(r)}document.body.appendChild(n),setTimeout(function(){n.style.animation="slideOut 0.3s ease-in",setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n)},300)},5e3)}document.addEventListener("DOMContentLoaded",Rn(Bn().m(function e(){return Bn().w(function(e){for(;;)switch(e.n){case 0:return logger.debug("Initializing index page modules..."),_n(),(0,Pe.initializeAuth)(),je(),(0,r.initializeCharacterSelection)(),(0,Sn.initializePaymentModal)(),l(),ee(),S(),it(),e.n=1,Ut();case 1:yn(),Mn(),(0,An.initializeVimNavigation)(),Promise.resolve().then(n.bind(n,199)).then(function(e){window.hideCursor=e.hideCursor,window.showCursor=e.showCursor,window.disableVimNavigation=e.disableVimNavigation,window.enableVimNavigation=e.enableVimNavigation}).catch(function(){}),Dn(),logger.debug("All index modules initialized successfully");case 2:return e.a(2)}},e)}))),window.openLoveLetterModal=function(){var e=document.getElementById("loveLetterModal");e&&(e.classList.remove("hidden"),function(){Fn.apply(this,arguments)}(),window.hideCursor&&(window.hideCursor(),setTimeout(function(){window.disableVimNavigation&&window.disableVimNavigation()},0)),setTimeout(function(){Promise.resolve().then(n.bind(n,724)).then(function(e){e.initializeModalVim("loveLetter")}).catch(function(){logger.debug("Love Letter: Modal vim navigation not available")})},100))},window.closeLoveLetterModal=function(){var e=document.getElementById("loveLetterModal");e&&(Promise.resolve().then(n.bind(n,724)).then(function(e){e.disableModalVim()}).catch(function(){logger.debug("Love Letter: Modal vim navigation not available")}),e.classList.add("hidden"),window.showCursor&&window.showCursor(),window.enableVimNavigation&&window.enableVimNavigation())},document.addEventListener("click",function(e){var t=document.getElementById("loveLetterModal");t&&e.target===t&&window.closeLoveLetterModal()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&window.closeLoveLetterModal()})},422:(e,t,n)=>{n.r(t),n.d(t,{hidePaymentModal:()=>m,initializePaymentModal:()=>p,showPaymentModal:()=>g});n(626);var r=n(98),o=n(763);function a(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(n,r,o,a){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return i(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,i(p,"constructor",d),i(d,"constructor",l),l.displayName="GeneratorFunction",i(d,o,"GeneratorFunction"),i(p),i(p,o,"Generator"),i(p,r,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:g}})()}function i(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,t,n,r){function a(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},i(e,t,n,r)}function s(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)})}}var u=null;n.e(866).then(n.bind(n,485)).then(function(e){u=e,logger.debug("Payment: paymentVimNavigation module loaded at startup")}).catch(function(e){logger.error("Payment: Failed to load paymentVimNavigation module:",e)});var l=null,d=null,f=null;function p(){!function(){(l=document.createElement("div")).id="payment-modal",l.className="payment-modal hidden",l.innerHTML='\n    <div class="payment-modal-content">\n      <div class="payment-modal-header">\n        <h2>Unlock Boba Diamond</h2>\n        <button class="close-payment-modal" aria-label="Close">&times;</button>\n      </div>\n      \n      <div class="payment-modal-body">\n        <div class="character-preview">\n          <div class="character-icon">\n            <img src="/static/sprites/avatar/diamond_boba_avatar.png" alt="Diamond Boba Avatar" class="diamond-avatar">\n          </div>\n          <h3>UNLOCK BOBA DIAMOND</h3>\n          <p class="pixel-text">Support the game and unlock this legendary character!</p>\n          <div class="retro-stats">\n            <div class="stat-item">\n              <span class="stat-label">RARITY:</span>\n              <span class="stat-value">LEGENDARY</span>\n            </div>\n            <div class="stat-item">\n              <span class="stat-label">POWER:</span>\n              <span class="stat-value">MAXIMUM</span>\n            </div>\n          </div>\n        </div>\n        \n        <div class="payment-amount-section">\n          <label for="payment-amount">Choose your support amount (‚Ç¨):</label>\n          <div class="amount-input-container">\n            <input \n              type="number" \n              id="payment-amount" \n              min="1" \n              max="1000" \n              value="5"\n              step="1"\n            >\n            <span class="currency-symbol">‚Ç¨</span>\n          </div>\n          <div class="level-display">\n            <span id="character-level">Level 5</span>\n            <p class="level-description">Your Boba Diamond will be <strong>Level <span id="level-number">5</span></strong></p>\n          </div>\n        </div>\n        \n        <div class="support-message-section">\n          <label for="support-message">Optional message (will be shown in the love letter):</label>\n          <textarea \n            id="support-message" \n            placeholder="Leave a message for the community... (optional, max 130 characters)"\n            maxlength="130"\n            rows="3"\n          ></textarea>\n          <div class="message-counter">\n            <span id="message-count">0</span>/130 characters\n          </div>\n        </div>\n        \n        <div class="payment-form-section">\n          <form id="payment-form">\n            <div id="card-element">\n              \x3c!-- Stripe Elements will create form elements here --\x3e\n            </div>\n            <div id="card-errors" role="alert"></div>\n            \n            <button type="submit" id="submit-payment" class="payment-button">\n              <div class="button-content">\n                <span class="button-icon">üí≥</span>\n                <span id="button-text" class="button-text">\n                  SECURE PAY ‚Ç¨<span id="amount-display">5</span>\n                </span>\n              </div>\n              <div id="payment-spinner" class="payment-spinner hidden">\n                <div class="spinner"></div>\n                <span class="processing-text">PROCESSING...</span>\n              </div>\n            </button>\n          </form>\n        </div>\n        \n        <div id="payment-messages" class="payment-messages">\n          <div id="payment-error" class="payment-error hidden">\n            <div class="error-header">\n              <span class="error-icon">‚ö†</span>\n              <span class="error-title">PAYMENT FAILED</span>\n            </div>\n            <div class="error-content">\n              <p id="error-message" class="error-text">Please check your payment information and try again.</p>\n              <button id="retry-payment" class="retry-button">TRY AGAIN</button>\n            </div>\n          </div>\n          \n          <div id="payment-success" class="payment-success hidden">\n            <div class="success-header">\n              <span class="success-icon">‚úì</span>\n              <span class="success-title">PAYMENT SUCCESSFUL</span>\n            </div>\n            <div class="success-content">\n              <p class="success-text">Diamond Boba unlocked! Welcome to the elite!</p>\n            </div>\n          </div>\n        </div>\n        \n        <div class="payment-info">\n          <div class="security-badge">\n            <span class="security-icon">SECURE</span>\n            <span class="security-text">Payment powered by Stripe</span>\n          </div>\n          <div class="info-item">\n            <span class="info-label">PURPOSE:</span>\n            <span class="info-text">Support game development</span>\n          </div>\n          <div class="info-item">\n            <span class="info-label">DELIVERY:</span>\n            <span class="info-text">Character unlocks immediately</span>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',document.body.appendChild(l);var e=l.querySelector(".close-payment-modal"),t=l.querySelector("#payment-amount"),n=l.querySelector("#payment-form"),r=l.querySelector("#support-message");e.addEventListener("click",m),t.addEventListener("input",h),r.addEventListener("input",v),n.addEventListener("submit",y),l.addEventListener("click",function(e){e.target===l&&m()})}(),window.Stripe&&(d=window.Stripe(window.STRIPE_PUBLISHABLE_KEY||"pk_test_your_publishable_key"))}function g(e){if("boba_diamond"===e){if(!(0,o.isLoggedIn)())return logger.error("User must be logged in to purchase characters"),void alert("Please log in first to purchase characters.");var t;l.classList.remove("hidden"),document.body.classList.add("modal-open"),window.hideCursor&&(window.hideCursor(),setTimeout(function(){window.disableVimNavigation&&window.disableVimNavigation()},0)),d&&!f&&((t=(f=d.elements()).create("card",{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}}}})).mount("#card-element"),t.on("change",function(e){var t=e.error,n=document.getElementById("card-errors");n.textContent=t?t.message:""})),O(),setTimeout(function(){if(logger.debug("Payment: About to initialize payment vim, module available:",!!u),u)try{logger.debug("Payment: Calling initializePaymentVim"),u.initializePaymentVim(),logger.debug("Payment: initializePaymentVim called successfully"),setTimeout(function(){logger.debug("Payment: About to refresh cursor"),u.refreshPaymentCursor()},200)}catch(e){logger.error("Payment: Error initializing payment vim:",e)}else logger.warn("Payment: paymentVimModule not loaded yet, trying dynamic import"),n.e(866).then(n.bind(n,485)).then(function(e){logger.debug("Payment: Module imported successfully, calling initializePaymentVim");try{e.initializePaymentVim(),logger.debug("Payment: initializePaymentVim called successfully"),setTimeout(function(){e.refreshPaymentCursor()},200)}catch(e){logger.error("Payment: Error initializing payment vim:",e)}}).catch(function(e){logger.error("Payment: Failed to import payment vim navigation:",e)})},300)}else logger.warn("Payment modal only supports boba_diamond character")}function m(){logger.debug("Payment: hidePaymentModal called");var e=window.paymentModalClosingViaCancel;window.paymentModalClosingViaCancel=!1,u?(logger.debug("Payment: Calling disablePaymentVim on preloaded module"),u.disablePaymentVim()):(logger.debug("Payment: paymentVimModule not available, trying dynamic import for disable"),n.e(866).then(n.bind(n,485)).then(function(e){logger.debug("Payment: Calling disablePaymentVim"),e.disablePaymentVim()}).catch(function(){})),l.classList.add("hidden"),document.body.classList.remove("modal-open"),e&&setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.empty&&e.empty()}document.body.focus(),logger.debug("Payment: Cleared selections and focus for cancel close")},50),setTimeout(function(){logger.debug("Payment: Re-enabling main vim navigation after modal close"),Promise.resolve().then(n.bind(n,199)).then(function(t){e?(logger.debug("Payment: Was closed via cancel - doing full reset"),t.disableVimNavigation(),t.hideCursor(),document.querySelectorAll(".vim-cursor, .payment-vim-cursor").forEach(function(e){return e.remove()}),document.querySelectorAll("[data-original-text], [data-original-payment-text]").forEach(function(e){var t=e.getAttribute("data-original-text")||e.getAttribute("data-original-payment-text");t&&(e.textContent=t,e.removeAttribute("data-original-text"),e.removeAttribute("data-original-payment-text"))}),setTimeout(function(){t.enableVimNavigation(),t.showCursor(),logger.debug("Payment: Main vim navigation fully reset and re-enabled")},50)):(logger.debug("Payment: Normal close - simple re-enable"),t.enableVimNavigation(),t.showCursor())}).catch(function(){})},100),O()}function h(){var e=document.getElementById("payment-amount"),t=document.getElementById("amount-display"),n=document.getElementById("level-number"),r=document.getElementById("character-level"),o=parseInt(e.value)||1,a=Math.max(1,o);t.textContent=o,n.textContent=a,r.textContent="Level ".concat(a)}function v(){var e=document.getElementById("support-message"),t=document.getElementById("message-count"),n=e.value.length;t.textContent=n,t.style.color=n>120?"#e74c3c":n>100?"#f39c12":"#27ae60"}function y(e){return b.apply(this,arguments)}function b(){return(b=c(a().m(function e(t){var n,r,i,s,c,u,l,p,g,h,v;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.preventDefault(),(0,o.isLoggedIn)()){e.n=1;break}return logger.error("User must be logged in to process payment"),alert("Please log in first to purchase characters."),e.a(2);case 1:return e.n=2,(0,o.verifyAuthenticationStatus)();case 2:if(e.v){e.n=3;break}return logger.error("Authentication check failed - user not authenticated on server"),alert("Your session has expired. Please refresh the page and log in again."),e.a(2);case 3:return logger.debug("Authentication verified, proceeding with payment"),n=document.getElementById("submit-payment"),r=document.getElementById("payment-spinner"),i=document.getElementById("button-text"),n.disabled=!0,r.classList.remove("hidden"),i.style.opacity="0.6",e.p=4,s=parseInt(document.getElementById("payment-amount").value)||1,c=document.getElementById("support-message").value.trim(),e.n=5,w(s,c);case 5:return u=e.v,l=u.clientSecret,p=u.paymentId,e.n=6,d.confirmCardPayment(l,{payment_method:{card:f.getElement("card")}});case 6:if(g=e.v,h=g.error,g.paymentIntent,!h){e.n=7;break}document.getElementById("card-errors").textContent=h.message,e.n=9;break;case 7:return e.n=8,S(p);case 8:return m(),T(),e.n=9,k();case 9:e.n=11;break;case 10:e.p=10,v=e.v,logger.error("Payment error:",v),document.getElementById("card-errors").textContent="Payment failed. Please try again.";case 11:return e.p=11,n.disabled=!1,r.classList.add("hidden"),i.style.opacity="1",e.f(11);case 12:return e.a(2)}},e,null,[[4,10,11,12]])}))).apply(this,arguments)}function w(e){return E.apply(this,arguments)}function E(){return E=c(a().m(function e(t){var n,r,o,i,s=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"",e.n=1,fetch("/api/payment/create-intent",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({amount:100*t,character_name:"boba_diamond",currency:"eur",support_message:n})});case 1:if((r=e.v).ok){e.n=5;break}if(401!==r.status){e.n=2;break}throw logger.error("Payment endpoint returned 401 - session not valid"),new Error("Your session has expired. Please refresh the page and log in again.");case 2:return e.p=2,e.n=3,r.json();case 3:throw o=e.v,new Error(o.error||"Failed to create payment intent");case 4:throw e.p=4,e.v,new Error("Payment failed with status ".concat(r.status,": ").concat(r.statusText));case 5:return e.n=6,r.json();case 6:return i=e.v,e.a(2,{clientSecret:i.client_secret,paymentId:i.payment_id})}},e,null,[[2,4]])})),E.apply(this,arguments)}function S(e){return x.apply(this,arguments)}function x(){return(x=c(a().m(function e(t){var n,r;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,fetch("/api/payment/confirm/".concat(t),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});case 1:if((n=e.v).ok){e.n=3;break}return e.n=2,n.json();case 2:throw r=e.v,new Error(r.error||"Failed to confirm payment");case 3:return e.n=4,n.json();case 4:return e.a(2,e.v)}},e)}))).apply(this,arguments)}function k(){return C.apply(this,arguments)}function C(){return(C=c(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,(0,r.loadPlayerCharacters)();case 1:return e.a(2)}},e)}))).apply(this,arguments)}function T(){var e=document.createElement("div");e.className="payment-success-banner",e.innerHTML='\n    <div class="success-banner-content">\n      ‚úÖ Payment successful! Thank you for your support!\n    </div>\n  ',document.body.insertBefore(e,document.body.firstChild),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},8e3)}function O(){document.getElementById("payment-amount").value="5",h(),document.getElementById("card-errors").textContent="",document.getElementById("submit-payment").disabled=!1,document.getElementById("payment-spinner").classList.add("hidden"),document.getElementById("button-text").style.opacity="1"}},532:(e,t,n)=>{n.d(t,{s:()=>r});var r={ENDPOINTS:{ME:"/api/auth/me",REGISTER:"/api/auth/register",LOGIN:"/api/auth/login",LOGOUT:"/api/auth/logout",FORGOT_PASSWORD:"/api/auth/forgot-password"},MESSAGES:{LOGIN_TITLE:"üîë Login to Your Account",REGISTER_TITLE:"üîí Register to Unlock Premium Characters",FORGOT_PASSWORD_TITLE:"üîì Reset Your Password",REGISTRATION_SUCCESS:"Registration successful! Welcome to the boba community! Please confirm your mail to have all the features !",FORGOT_PASSWORD_SUCCESS:"üìß Password reset link sent to your email!",NETWORK_ERROR:"Network error. Please try again."},ELEMENT_IDS:{MODAL:"authModal",REGISTRATION_FORM:"registrationForm",LOGIN_FORM:"loginForm",FORGOT_PASSWORD_FORM:"forgotPasswordForm",LOGOUT_BUTTON:"logoutButton",LOGIN_BUTTON:"loginButton",REGISTER_BUTTON:"registerButton",SWITCH_TO_LOGIN:"switchToLogin",SWITCH_TO_REGISTER:"switchToRegister",SWITCH_TO_FORGOT_PASSWORD:"switchToForgotPassword",SWITCH_TO_LOGIN_FROM_FORGOT:"switchToLoginFromForgot",MODAL_TITLE:"modalTitle",USER_PANEL:"userPanel",LOGGED_USERNAME:"loggedUsername",AUTH_BUTTONS:"authButtons",AUTH_ERROR:"authError"}}},626:(e,t,n)=>{n.d(t,{R:()=>r});var r={DEFAULT:"boba",PREMIUM:["golden","black"],LOCKED:["boba_diamond"],ICONS:{LOCK:"üîí",DIAMOND:"üíé"},CSS_CLASSES:{CHARACTER_BOX:"character-box",LOCKED:"locked",UNLOCKED:"unlocked",SELECTED:"selected",LOCK_ICON:"lock-icon"},SELECTORS:{CHARACTER_BOXES:".character-box",GOLDEN_BOX:'[data-character="golden"]',BLACK_BOX:'[data-character="black"]',DIAMOND_BOX:'[data-character="boba_diamond"]',LOCK_ICON:".lock-icon"}}},643:(e,t,n)=>{function r(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,a,i){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return o(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,a,i),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][a]?t(t([][a]())):(o(t={},a,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,o(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,o(p,"constructor",d),o(d,"constructor",l),l.displayName="GeneratorFunction",o(d,i,"GeneratorFunction"),o(p),o(p,i,"Generator"),o(p,a,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(r=function(){return{w:s,m:g}})()}function o(e,t,n,r){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}o=function(e,t,n,r){function i(t,n){o(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},o(e,t,n,r)}function a(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,c,"next",e)}function c(e){a(i,r,o,s,c,"throw",e)}s(void 0)})}}n.r(t),n.d(t,{getCompletedMaps:()=>k,getCurrentUser:()=>N,getMapLockReason:()=>A,getNextUnlockedMap:()=>_,getProgressionStats:()=>M,initializeProgression:()=>f,isMapCompleted:()=>b,isMapUnlocked:()=>w,isUserAuthenticated:()=>j,isUserEmailConfirmed:()=>R,markMapCompleted:()=>E,migrateGuestProgressToAccount:()=>O,refreshProgression:()=>P,requiresAccountConfirmation:()=>B});var s=new Set,c=!1,u=!1,l=null,d=!1;function f(){return p.apply(this,arguments)}function p(){return(p=i(r().m(function e(){return r().w(function(e){for(;;)switch(e.n){case 0:if(!d){e.n=1;break}return e.a(2);case 1:return e.n=2,g();case 2:return e.n=3,C();case 3:d=!0;case 4:return e.a(2)}},e)}))).apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return(m=i(r().m(function e(){var t,n,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.user){e.n=4;break}return c=!0,u=n.user.email_confirmed||!1,l=n.user,e.n=3,v();case 3:e.n=5;break;case 4:c=!1,u=!1,l=null,h();case 5:e.n=7;break;case 6:e.p=6,o=e.v,logger.error("Error checking authentication:",o),c=!1,u=!1,l=null,h();case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}function h(){try{var e=localStorage.getItem("boba_vim_completed_maps");if(e){var t=JSON.parse(e);s=new Set(t)}}catch(e){logger.error("Error loading completed maps from localStorage:",e),s=new Set}}function v(){return y.apply(this,arguments)}function y(){return(y=i(r().m(function e(){var t,n,o;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/completed-maps",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:n=e.v,s=n.success?new Set(n.completed_maps||[]):new Set,e.n=4;break;case 3:e.p=3,o=e.v,logger.error("Error loading completed maps from server:",o),s=new Set;case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function b(e){return s.has(e)}function w(e){return e<=6||e>=7&&(c&&u)}function E(e){return S.apply(this,arguments)}function S(){return(S=i(r().m(function e(t){return r().w(function(e){for(;;)switch(e.n){case 0:if(d){e.n=1;break}return e.n=1,f();case 1:logger.debug("Marking map as completed:",t),logger.debug("Current completed maps before:",Array.from(s)),s.has(t)?logger.debug("Map",t,"was already completed"):(s.add(t),logger.debug("Current completed maps after:",Array.from(s)),c?logger.debug("User is authenticated, not saving to localStorage"):(logger.debug("User is guest, saving to localStorage"),x()));case 2:return e.a(2)}},e)}))).apply(this,arguments)}function x(){try{var e=Array.from(s);logger.debug("Saving completed maps to localStorage:",e),localStorage.setItem("boba_vim_completed_maps",JSON.stringify(e)),logger.debug("Successfully saved to localStorage")}catch(e){logger.error("Error saving completed maps to localStorage:",e)}}function k(){return Array.from(s)}function C(){return T.apply(this,arguments)}function T(){return(T=i(r().m(function e(){var t,n;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:n=e.v,(c=n.success&&n.user)?(u=n.user.email_confirmed||!1,l=n.user):(u=!1,l=null),e.n=4;break;case 3:e.p=3,e.v,c=!1,u=!1,l=null;case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function O(){return L.apply(this,arguments)}function L(){return(L=i(r().m(function e(){var t,n,o,a;return r().w(function(e){for(;;)switch(e.p=e.n){case 0:if(c){e.n=1;break}return e.a(2,{success:!1,error:"User not authenticated"});case 1:if(0!==(t=Array.from(s)).length){e.n=2;break}return e.a(2,{success:!0,message:"No progress to migrate"});case 2:return e.p=2,e.n=3,fetch("/api/migrate-guest-progress",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guest_completed_maps:t})});case 3:return n=e.v,e.n=4,n.json();case 4:if(!(o=e.v).success){e.n=5;break}return localStorage.removeItem("boba_vim_completed_maps"),e.n=5,v();case 5:return e.a(2,o);case 6:return e.p=6,a=e.v,logger.error("Error migrating guest progress:",a),e.a(2,{success:!1,error:"Migration failed"})}},e,null,[[2,6]])}))).apply(this,arguments)}function P(){return I.apply(this,arguments)}function I(){return(I=i(r().m(function e(){return r().w(function(e){for(;;)switch(e.n){case 0:return d=!1,e.n=1,g();case 1:return e.n=2,C();case 2:d=!0;case 3:return e.a(2)}},e)}))).apply(this,arguments)}function _(){for(var e=1;e<=19;e++)if(!b(e)&&w(e))return e;return 1}function M(){var e=s.size;return{totalMaps:19,completedCount:e,unlockedCount:Array.from({length:19},function(e,t){return t+1}).filter(function(e){return w(e)}).length,progressPercentage:Math.round(e/19*100)}}function A(e){return e<=6?null:e>=7?c&&u?null:"Create and confirm your account to access all maps":null}function B(e){return e>=7&&(!c||!u)}function N(){return l}function j(){return c}function R(){return u}},658:(e,t,n)=>{function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function s(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return c(l,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),l}var i={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(c(t={},r,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,c(p,"constructor",d),c(d,"constructor",l),l.displayName="GeneratorFunction",c(d,o,"GeneratorFunction"),c(p),c(p,o,"Generator"),c(p,r,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(s=function(){return{w:a,m:g}})()}function c(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,r){function a(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},c(e,t,n,r)}function u(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){u(a,r,o,i,s,"next",e)}function s(e){u(a,r,o,i,s,"throw",e)}i(void 0)})}}n.r(t),n.d(t,{clearMapCache:()=>z,getCachedMaps:()=>H,showMapSelectionModal:()=>D});function d(){var e=localStorage.getItem("boba-vim-favorites");return e?JSON.parse(e):[]}function f(){return(f=l(s().m(function e(t){var n;return s().w(function(e){for(;;)switch(e.n){case 0:if((n=d()).includes(t)){e.n=1;break}return n.push(t),localStorage.setItem("boba-vim-favorites",JSON.stringify(n)),e.n=1,m(t,"add");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function p(){return(p=l(s().m(function e(t){var n,r;return s().w(function(e){for(;;)switch(e.n){case 0:if(n=d(),!((r=n.indexOf(t))>-1)){e.n=1;break}return n.splice(r,1),localStorage.setItem("boba-vim-favorites",JSON.stringify(n)),e.n=1,m(t,"remove");case 1:return e.a(2)}},e)}))).apply(this,arguments)}function g(e){return d().includes(e)}function m(e,t){return h.apply(this,arguments)}function h(){return(h=l(s().m(function e(t,n){var r,o,a;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return r=e.v,e.n=2,r.json();case 2:if((o=e.v).success&&o.authenticated){e.n=3;break}return e.a(2);case 3:if("add"!==n){e.n=5;break}return e.n=4,fetch("/api/user/favorites",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t})});case 4:e.n=6;break;case 5:if("remove"!==n){e.n=6;break}return e.n=6,fetch("/api/user/favorites",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({map_id:t})});case 6:e.n=8;break;case 7:e.p=7,a=e.v,logger.error("Failed to sync favorite to database:",a);case 8:return e.a(2)}},e,null,[[0,7]])}))).apply(this,arguments)}function v(){return y.apply(this,arguments)}function y(){return(y=l(s().m(function e(){var t,n,a,i,c,u,l,f,p,g,h,v;return s().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/auth/me",{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:if((n=e.v).success&&n.authenticated){e.n=3;break}return e.a(2);case 3:return e.n=4,fetch("/api/user/favorites",{credentials:"include"});case 4:return a=e.v,e.n=5,a.json();case 5:if(!(i=e.v).success){e.n=12;break}c=d(),u=i.favorites||[],l=o(new Set([].concat(o(c),o(u)))),localStorage.setItem("boba-vim-favorites",JSON.stringify(l)),f=r(c),e.p=6,f.s();case 7:if((p=f.n()).done){e.n=9;break}if(g=p.value,u.includes(g)){e.n=8;break}return e.n=8,m(g,"add");case 8:e.n=7;break;case 9:e.n=11;break;case 10:e.p=10,h=e.v,f.e(h);case 11:return e.p=11,f.f(),e.f(11);case 12:e.n=14;break;case 13:e.p=13,v=e.v,logger.error("Failed to load favorites from database:",v);case 14:return e.a(2)}},e,null,[[6,10,11,12],[0,13]])}))).apply(this,arguments)}function b(e,t){if("all"===t)return e;if("favorite"===t){var n=d();return e.filter(function(e){return n.includes(e.id)})}return e.filter(function(e){return e.difficulty===t})}function w(e,t,n){var r=e.querySelectorAll(".filter-btn"),o={tutorial:"#9C27B0",easy:"#4CAF50",medium:"#FF9800",hard:"#F44336",favorite:"#FFC107",all:"#6c757d"};r.forEach(function(e){e.addEventListener("click",function(){r.forEach(function(e){e.classList.remove("active"),e.style.background=o[e.dataset.filter]||"#6c757d",e.style.color="white"}),e.classList.add("active"),e.style.background="white",e.style.color="#333";var a=e.dataset.filter,i=b(t,a);n(a,i)})})}function E(){var e=document.createElement("div");return e.className="modal-overlay",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: linear-gradient(45deg, rgba(0, 0, 0, 0.9), rgba(44, 24, 16, 0.8));\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        z-index: 1000;\n        animation: fadeIn 0.3s ease;\n        backdrop-filter: blur(2px);\n    ",window.hideCursor&&window.showCursor?(window.hideCursor(),setTimeout(function(){Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})},0)):Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){}),e}function S(e){var t=document.createElement("div");return t.className="map-selection-modal",t.style.cssText="\n        background: linear-gradient(135deg, #f4f1de 0%, #e9c46a 25%, #f4a261 50%, #e76f51 75%, #264653 100%);\n        border: 4px solid #2c1810;\n        border-radius: 0px;\n        padding: 0;\n        max-width: 1000px;\n        width: 90%;\n        max-height: 90vh;\n        min-height: fit-content;\n        box-shadow: \n            0 0 0 2px #e9c46a,\n            0 0 0 4px #2c1810,\n            8px 8px 0 0 #2c1810,\n            0 20px 60px rgba(44, 24, 16, 0.4);\n        animation: slideIn 0.3s ease;\n        position: relative;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        flex-shrink: 0;\n        image-rendering: pixelated;\n        font-family: 'Press Start 2P', 'Orbitron', monospace;\n    ",t.innerHTML='\n        <div class="modal-header" id="modal-header" style="\n            padding: 20px 25px;\n            text-align: center;\n            color: #f4f1de;\n            background: linear-gradient(90deg, #2c1810 0%, #4a3528 50%, #2c1810 100%);\n            border-bottom: 3px solid #e9c46a;\n            position: relative;\n            text-shadow: 2px 2px 0 #2c1810;\n        ">\n            <h2 class="map-title" style="\n                margin: 0; \n                font-size: 16px; \n                font-family: \'Press Start 2P\', monospace;\n                letter-spacing: 2px;\n                text-transform: uppercase;\n                color: #e9c46a;\n            "></h2>\n            <button class="close-modal" style="\n                position: absolute;\n                top: 12px;\n                right: 15px;\n                background: #e76f51;\n                border: 2px solid #2c1810;\n                color: #f4f1de;\n                font-size: 12px;\n                cursor: pointer;\n                padding: 8px 10px;\n                font-family: \'Press Start 2P\', monospace;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">X</button>\n        </div>\n        \n        <div class="filter-bar" style="\n            display: flex;\n            justify-content: center;\n            gap: 8px;\n            margin: 15px;\n            padding: 15px;\n            background: linear-gradient(135deg, #2c1810 0%, #4a3528 100%);\n            border: 2px solid #e9c46a;\n            flex-wrap: wrap;\n        ">\n            <button class="filter-btn active" data-filter="all" style="\n                background: #464649;\n                color: #f4f1de;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #2c1810;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">All</button>\n            <button class="filter-btn" data-filter="tutorial" style="\n                background: #8B5A3C;\n                color: #f4f1de;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #2c1810;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">Tutorial</button>\n            <button class="filter-btn" data-filter="easy" style="\n                background: #87A330;\n                color: #f4f1de;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #2c1810;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">Easy</button>\n            <button class="filter-btn" data-filter="medium" style="\n                background: #D67C2C;\n                color: #f4f1de;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #2c1810;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">Medium</button>\n            <button class="filter-btn" data-filter="hard" style="\n                background: #C44536;\n                color: #f4f1de;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #2c1810;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">Hard</button>\n            <button class="filter-btn" data-filter="favorite" style="\n                background: #E9C46A;\n                color: #2c1810;\n                border: 2px solid #2c1810;\n                padding: 8px 12px;\n                cursor: pointer;\n                font-size: 10px;\n                font-family: \'Press Start 2P\', monospace;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n                box-shadow: 2px 2px 0 #2c1810;\n                transition: all 0.1s ease;\n                text-shadow: 1px 1px 0 #f4f1de;\n            " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n               onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">‚òÖ Fav</button>\n        </div>\n        \n        <div class="map-display-container" style="\n            flex: 1;\n            display: flex;\n            flex-direction: column;\n            padding: 0 20px 20px 20px;\n            min-height: 0;\n        ">\n            <div class="map-grid-container" style="\n                flex: 1;\n                background: linear-gradient(135deg, #2c1810 0%, #1a1a1a 50%, #2c1810 100%);\n                border: 3px solid #e9c46a;\n                padding: 15px;\n                overflow: hidden;\n                position: relative;\n                min-height: 250px;\n                max-height: 400px;\n                box-shadow: \n                    inset 0 0 20px rgba(0,0,0,0.5),\n                    0 0 0 2px #2c1810;\n                display: flex;\n                flex-direction: column;\n                margin-bottom: 10px;\n            ">\n                <button class="favorite-star" style="\n                    position: absolute;\n                    top: 10px;\n                    right: 10px;\n                    background: #2c1810;\n                    border: 2px solid #e9c46a;\n                    font-size: 16px;\n                    cursor: pointer;\n                    padding: 6px;\n                    z-index: 10;\n                    width: 35px;\n                    height: 35px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    color: #e9c46a;\n                    transition: all 0.1s ease;\n                    font-family: \'Press Start 2P\', monospace;\n                    box-shadow: 2px 2px 0 #2c1810;\n                " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n                   onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">‚òÖ</button>\n                \n                <div class="game-board-preview" style="\n                    flex: 1;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 1px;\n                    overflow: hidden;\n                    padding: 15px;\n                "></div>\n            </div>\n            \n            <div class="map-navigation" style="\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 10px 0;\n                gap: 20px;\n            ">\n                <button class="prev-map-btn" style="\n                    background: #464649;\n                    color: #f4f1de;\n                    border: 2px solid #2c1810;\n                    padding: 10px 15px;\n                    cursor: pointer;\n                    font-size: 10px;\n                    font-family: \'Press Start 2P\', monospace;\n                    transition: all 0.1s ease;\n                    min-width: 110px;\n                    box-shadow: 2px 2px 0 #2c1810;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    text-shadow: 1px 1px 0 #2c1810;\n                " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n                   onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">‚óÑ (h) Prev</button>\n                \n                <button class="play-map-btn" style="\n                    background: linear-gradient(135deg, #E9C46A 0%, #F4A261 50%, #E76F51 100%);\n                    border: 3px solid #2c1810;\n                    color: #2c1810;\n                    cursor: pointer;\n                    font-size: 12px;\n                    font-family: \'Press Start 2P\', monospace;\n                    padding: 12px 20px;\n                    min-width: 160px;\n                    box-shadow: 3px 3px 0 #2c1810;\n                    text-shadow: 1px 1px 0 #f4f1de;\n                    transition: all 0.1s ease;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                " onmouseover="this.style.transform=\'translate(-2px, -2px)\'; this.style.boxShadow=\'5px 5px 0 #2c1810\';" \n                   onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';">‚ñ∫ Play (Enter)</button>\n                \n                <button class="next-map-btn" style="\n                    background: #464649;\n                    color: #f4f1de;\n                    border: 2px solid #2c1810;\n                    padding: 10px 15px;\n                    cursor: pointer;\n                    font-size: 10px;\n                    font-family: \'Press Start 2P\', monospace;\n                    transition: all 0.1s ease;\n                    min-width: 110px;\n                    box-shadow: 2px 2px 0 #2c1810;\n                    text-transform: uppercase;\n                    letter-spacing: 1px;\n                    text-shadow: 1px 1px 0 #2c1810;\n                " onmouseover="this.style.transform=\'translate(-1px, -1px)\'; this.style.boxShadow=\'3px 3px 0 #2c1810\';" \n                   onmouseout="this.style.transform=\'translate(0, 0)\'; this.style.boxShadow=\'2px 2px 0 #2c1810\';">Next (l) ‚ñ∫</button>\n            </div>\n        </div>\n    ',function(e){var t=e.querySelector(".play-map-btn");t.addEventListener("mouseenter",function(){t.style.background="linear-gradient(135deg, #F4A261 0%, #E9C46A 50%, #E76F51 100%)",t.style.transform="translate(-2px, -2px)",t.style.boxShadow="5px 5px 0 #2c1810"}),t.addEventListener("mouseleave",function(){t.style.background="linear-gradient(135deg, #E9C46A 0%, #F4A261 50%, #E76F51 100%)",t.style.transform="translate(0, 0)",t.style.boxShadow="3px 3px 0 #2c1810"})}(t),t}function x(e){e.style.animation="fadeOut 0.3s ease",window.showCursor&&window.showCursor(),Promise.resolve().then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){}),setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},300)}var k=n(643);function C(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function O(e,t,n,r,o){var a={tutorial:"#8B5A3C",easy:"#87A330",medium:"#D67C2C",hard:"#C44536"},i=(0,k.isMapUnlocked)(t.id),s=(0,k.isMapCompleted)(t.id),c=e.querySelector("#modal-header"),u=e.querySelector(".map-title");if(c){var l=a[t.difficulty]||a.tutorial;c.style.background=i?"linear-gradient(90deg, #2c1810 0%, ".concat(l," 50%, #2c1810 100%)"):"linear-gradient(90deg, #2c1810 0%, #464649 50%, #2c1810 100%)"}if(u){var d="";s?d=" ‚òÖ":i||(d=" ‚óº"),u.textContent="Select map : ".concat(t.name.toUpperCase()).concat(d)}var m=e.querySelector(".map-display-container");if(m){var h=(a[t.difficulty]||a.tutorial).replace("#","").match(/.{2}/g).map(function(e){return parseInt(e,16)}).join(", ");i?(m.style.background="rgba(".concat(h,", 0.1)"),m.style.filter="none"):(m.style.background="rgba(108, 117, 125, 0.1)",m.style.filter="grayscale(100%) brightness(0.7)")}!function(e,t,n,r,o){var a=e.querySelector(".prev-map-btn"),i=e.querySelector(".next-map-btn");if(a&&i){var s=o&&n[t.difficulty]||"#464649",c=o&&r[t.difficulty]||"#353538";a.style.background=s,i.style.background=s,a.onmouseenter=function(){a.style.background=c,a.style.transform="translate(-1px, -1px)",a.style.boxShadow="3px 3px 0 #2c1810"},a.onmouseleave=function(){a.style.background=s,a.style.transform="translate(0, 0)",a.style.boxShadow="2px 2px 0 #2c1810"},i.onmouseenter=function(){i.style.background=c,i.style.transform="translate(-1px, -1px)",i.style.boxShadow="3px 3px 0 #2c1810"},i.onmouseleave=function(){i.style.background=s,i.style.transform="translate(0, 0)",i.style.boxShadow="2px 2px 0 #2c1810"}}}(e,t,a,{tutorial:"#6B4A2C",easy:"#67831C",medium:"#B66C1C",hard:"#A43526"},i),function(e,t,n){var r=e.querySelector(".play-map-btn");r&&(n?(r.disabled=!1,r.style.opacity="1",r.style.cursor="pointer",r.style.background="linear-gradient(135deg, #E9C46A 0%, #F4A261 50%, #E76F51 100%)",r.textContent="‚ñ∫ PLAY (Enter)"):(r.disabled=!0,r.style.opacity="0.6",r.style.cursor="not-allowed",r.style.background="#464649",r.textContent="‚óº LOCKED"))}(e,0,i),function(e,t,n,r,o,a){var i=e.querySelector(".favorite-star");if(i){var s=g(t.id);i.textContent=s?"‚òÖ":"‚òÜ",i.style.color=s?"#ffc107":"rgba(255,255,255,0.6)",a?(i.style.opacity="1",i.style.cursor="pointer"):(i.style.opacity="0.3",i.style.cursor="not-allowed");var c=i.cloneNode(!0);i.parentNode.replaceChild(c,i),a&&(c.addEventListener("click",function(){if(g(t.id)?function(e){p.apply(this,arguments)}(t.id):function(e){f.apply(this,arguments)}(t.id),O(e,t,n,r,o),"favorite"===r&&!g(t.id)){var a=b(n,r);0===a.length?(o("all",b(n,"all")),function(e){var t=e.querySelectorAll(".filter-btn"),n={tutorial:"#9C27B0",easy:"#4CAF50",medium:"#FF9800",hard:"#F44336",favorite:"#FFC107",all:"#6c757d"};t.forEach(function(e){e.classList.remove("active"),e.style.background=n[e.dataset.filter]||"#6c757d",e.style.color="white"});var r=e.querySelector('[data-filter="all"]');r.classList.add("active"),r.style.background="white",r.style.color="#333"}(e)):o(r,a)}}),c.addEventListener("mouseenter",function(){c.style.transform="scale(1.1)",c.style.background="rgba(0,0,0,0.7)"}),c.addEventListener("mouseleave",function(){c.style.transform="scale(1)",c.style.background="rgba(0,0,0,0.5)"}))}}(e,t,n,r,o,i),function(e,t,n,r,o){var a=t.split("\n").filter(function(e){return e.trim().length>0}).map(function(e){return e.split("")}),i=e.querySelector(".game-board-preview");if(i.innerHTML="",!n){var s=document.createElement("div");s.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: linear-gradient(135deg, rgba(44, 24, 16, 0.9), rgba(70, 70, 73, 0.8));\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 1000;\n      border: 2px solid #2c1810;\n    ";var c=document.createElement("div");c.style.cssText="\n      font-size: 48px;\n      color: #ffc107;\n      text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n    ",c.textContent="üîí";var u=document.createElement("div");u.style.cssText="\n      color: white;\n      font-size: 16px;\n      font-weight: bold;\n      margin-top: 8px;\n      text-align: center;\n      text-shadow: 0 1px 2px rgba(0,0,0,0.7);\n      max-width: 300px;\n      line-height: 1.3;\n    ",u.textContent=(0,k.getMapLockReason)(o)||"Complete previous map to unlock";var l=document.createElement("div");return l.style.cssText="\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n    ",l.appendChild(c),l.appendChild(u),s.appendChild(l),i.style.position="relative",void i.appendChild(s)}!function(e){var t,n=e.map(function(e){return e.map(function(){return 0})});n.length>0&&n[0].length>0&&(n[0][0]=1);var r=Math.min(5,Math.max(3,Math.floor(e.length*(null===(t=e[0])||void 0===t?void 0:t.length)/20))),o=0;for(;o<r;){var a,i=Math.floor(Math.random()*e.length),s=Math.floor(Math.random()*((null===(a=e[i])||void 0===a?void 0:a.length)||0));!n[i]||0!==n[i][s]||0===i&&0===s||(n[i][s]=3,o++)}}(a);var d=i.getBoundingClientRect(),f=d.width||450,p=d.height||380,g=Math.max.apply(Math,C(a.map(function(e){return e.length}))),m=a.length,h=Math.floor((f-1*(g+1))/g),v=Math.floor((p-1*(m+1))/m),y=Math.min(h,v);y=Math.max(y,8),y=Math.min(y,28);var b=Math.max(Math.floor(.4*y),6);a.forEach(function(e,t){var n=document.createElement("div");n.className="keyboard-row-preview",n.style.cssText="\n            display: flex;\n            gap: 1px;\n            justify-content: center;\n        ",e.forEach(function(e,r){var o=document.createElement("div");o.className="key-preview",o.style.cssText="\n                position: relative;\n                width: ".concat(y,"px;\n                height: ").concat(y,"px;\n                background: linear-gradient(135deg, #f4f1de 0%, #e9c46a 100%);\n                border: 2px solid #2c1810;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-family: 'Press Start 2P', 'Courier New', monospace;\n                font-size: ").concat(Math.max(Math.floor(.8*b),5),"px;\n                color: #2c1810;\n                box-shadow: \n                    1px 1px 0 #2c1810,\n                    inset 1px 1px 0 rgba(244, 241, 222, 0.7);\n                cursor: default;\n                transition: all 0.1s ease;\n                flex-shrink: 0;\n                image-rendering: pixelated;\n                text-shadow: 0.5px 0.5px 0 rgba(44, 24, 16, 0.3);\n            "),o.textContent=" "===e?" ":e,o.addEventListener("mouseenter",function(){o.style.transform="translateY(-1px)",o.style.boxShadow="0 2px 4px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.3)"}),o.addEventListener("mouseleave",function(){o.style.transform="",o.style.boxShadow="0 1px 2px rgba(0,0,0,0.2), inset 0 1px 1px rgba(255,255,255,0.3)"}),0===t&&0===r&&(o.style.background="linear-gradient(145deg, #E9C46A, #F4A261)",o.style.borderColor="#2c1810",o.style.color="#2c1810",o.style.boxShadow="0 0 ".concat(Math.floor(.5*y),"px rgba(233, 196, 106, 0.6), inset 0 1px 1px rgba(255,255,255,0.3)")),n.appendChild(o)}),i.appendChild(n)})}(e,t.text_pattern,i,0,t.id)}function L(e,t,n,r,o){var a=n.length;if(0===a)return r;var i=(r+t+a)%a;return o(i),i}function P(e,t,n,r,o,a,i,s){var c=function(e){switch(e.key){case"h":e.preventDefault(),i(-1);break;case"l":e.preventDefault(),i(1);break;case"Enter":case" ":e.preventDefault(),s();break;case"Escape":e.preventDefault(),a()}};return t.addEventListener("click",a),n.addEventListener("click",function(){return i(-1)}),r.addEventListener("click",function(){return i(1)}),o.addEventListener("click",s),document.addEventListener("keydown",c),c}function I(){var e=document.createElement("div");return e.className="decorative-sprites-outside",e.style.cssText="\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100vw;\n        height: 100vh;\n        pointer-events: none;\n        z-index: 999;\n    ",e.innerHTML="\n        <div class=\"floating-boba-decoration\" style=\"\n            position: absolute;\n            width: 28px;\n            height: 28px;\n            top: 18%;\n            left: 8%;\n            animation: bobaBounce 3s ease-in-out infinite;\n        \">\n            <img src='/static/sprites/character/boba.png' alt='Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pinky-decoration\" style=\"\n            position: absolute;\n            width: 26px;\n            height: 26px;\n            top: 25%;\n            right: 10%;\n            animation: bobaBounce 2.5s ease-in-out infinite 0.3s;\n        \">\n            <img src='/static/sprites/character/pinky_boba.png' alt='Pinky Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-black-decoration\" style=\"\n            position: absolute;\n            width: 24px;\n            height: 24px;\n            bottom: 28%;\n            left: 9%;\n            animation: bobaBounce 2.8s ease-in-out infinite 0.7s;\n        \">\n            <img src='/static/sprites/character/black_boba.png' alt='Black Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-golden-decoration\" style=\"\n            position: absolute;\n            width: 25px;\n            height: 25px;\n            bottom: 22%;\n            right: 12%;\n            animation: bobaBounce 3.2s ease-in-out infinite 1.1s;\n        \">\n            <img src='/static/sprites/character/golden_boba.png' alt='Golden Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-boba-decoration\" style=\"\n            position: absolute;\n            width: 22px;\n            height: 22px;\n            top: 55%;\n            right: 8%;\n            animation: bobaBounce 2.2s ease-in-out infinite 1.5s;\n        \">\n            <img src='/static/sprites/character/boba.png' alt='Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pinky-decoration\" style=\"\n            position: absolute;\n            width: 23px;\n            height: 23px;\n            bottom: 45%;\n            left: 10%;\n            animation: bobaBounce 2.7s ease-in-out infinite 0.9s;\n        \">\n            <img src='/static/sprites/character/pinky_boba.png' alt='Pinky Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-black-decoration\" style=\"\n            position: absolute;\n            width: 24px;\n            height: 24px;\n            top: 70%;\n            left: 7%;\n            animation: bobaBounce 2.4s ease-in-out infinite 1.8s;\n        \">\n            <img src='/static/sprites/character/black_boba.png' alt='Black Boba' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-golden-decoration\" style=\"\n            position: absolute;\n            width: 26px;\n            height: 26px;\n            top: 40%;\n            right: 9%;\n            animation: bobaBounce 3.1s ease-in-out infinite 0.6s;\n        \">\n            <img src='/static/sprites/character/golden_boba.png' alt='Golden Boba' style='width: 100%; height: 100%;' />\n        </div>\n        \n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 18px;\n            height: 18px;\n            top: 12%;\n            left: 30%;\n            animation: pearlSparkle 2s ease-in-out infinite;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 16px;\n            height: 16px;\n            top: 15%;\n            right: 32%;\n            animation: pearlSparkle 1.8s ease-in-out infinite 0.5s;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 17px;\n            height: 17px;\n            bottom: 15%;\n            left: 35%;\n            animation: pearlSparkle 1.9s ease-in-out infinite 0.8s;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 19px;\n            height: 19px;\n            bottom: 12%;\n            right: 33%;\n            animation: pearlSparkle 2.1s ease-in-out infinite 1.2s;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 15px;\n            height: 15px;\n            top: 35%;\n            left: 5%;\n            animation: pearlSparkle 1.7s ease-in-out infinite 0.6s;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-pearl-decoration\" style=\"\n            position: absolute;\n            width: 18px;\n            height: 18px;\n            top: 60%;\n            right: 6%;\n            animation: pearlSparkle 2.3s ease-in-out infinite 1.0s;\n        \">\n            <img src='/static/sprites/character/pearl.png' alt='Pearl' style='width: 100%; height: 100%;' />\n        </div>\n        <div class=\"floating-diamond-decoration\" style=\"\n            position: absolute;\n            width: 27px;\n            height: 27px;\n            top: 32%;\n            left: 15%;\n            animation: bobaBounce 3.5s ease-in-out infinite 2.1s;\n        \">\n            <img src='/static/sprites/character/boba_diamond.png' alt='Diamond Boba' style='width: 100%; height: 100%;' />\n        </div>\n    ",e}function _(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var c=r&&r.prototype instanceof s?r:s,u=Object.create(c.prototype);return M(u,"_invoke",function(n,r,o){var a,s,c,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,s=0,c=e,f.n=n,i}};function p(n,r){for(s=n,c=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(c=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(s=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,s=0))}if(o||n>1)return i;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),s=l,c=g;(t=s<2?e:c)||!d;){a||(s?s<3?(s>1&&(f.n=-1),p(s,c)):f.n=c:f.v=c);try{if(u=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==i)break}catch(t){a=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),u}var i={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(M(t={},r,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,M(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,M(d,"constructor",u),M(u,"constructor",c),c.displayName="GeneratorFunction",M(u,o,"GeneratorFunction"),M(d),M(d,o,"Generator"),M(d,r,function(){return this}),M(d,"toString",function(){return"[object Generator]"}),(_=function(){return{w:a,m:f}})()}function M(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}M=function(e,t,n,r){function a(t,n){M(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},M(e,t,n,r)}function A(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function B(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){A(a,r,o,i,s,"next",e)}function s(e){A(a,r,o,i,s,"throw",e)}i(void 0)})}}var N,j=null,R=0,F=null,G="all";function D(){return V.apply(this,arguments)}function V(){return V=B(_().m(function e(){var t,n,r,o=arguments;return _().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,v();case 1:return e.n=2,(0,k.initializeProgression)();case 2:if(t=E(),j){e.n=4;break}return e.n=3,q();case 3:j=e.v;case 4:return F=b(j,G),R=0,n=S(),t.appendChild(n),r=I(),t.appendChild(r),document.body.appendChild(t),w(n,j,function(e,t){G=e,R=0,(F=t).length>0&&O(n,F[R],j,G,function(e,t){G=e,R=0,(F=t).length>0&&O(n,F[R],j,G,o.callee)})}),O(n,F[R],j,G,function(e,t){G=e,R=0,(F=t).length>0&&O(n,F[R],j,G,o.callee)}),e.a(2,new Promise(function(e,r){var a=P(0,n.querySelector(".close-modal"),n.querySelector(".prev-map-btn"),n.querySelector(".next-map-btn"),n.querySelector(".play-map-btn"),function(){x(t),document.removeEventListener("keydown",a),e(null)},function(e){R=L(0,e,F,R,function(e){O(n,F[R=e],j,G,function(e,t){G=e,R>=(F=t).length&&(R=F.length-1),F.length>0&&O(n,F[R],j,G,o.callee)})})},function(){var n=F[R];(0,k.isMapUnlocked)(n.id)?(x(t),document.removeEventListener("keydown",a),e(n)):logger.debug("Map is locked!")})}))}},e)})),V.apply(this,arguments)}function q(){return U.apply(this,arguments)}function U(){return(U=B(_().m(function e(){var t,n,r;return _().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/maps");case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.maps){e.n=3;break}return e.a(2,n.maps);case 3:throw new Error("Failed to fetch maps");case 4:e.n=6;break;case 5:e.p=5,r=e.v,logger.error("Error fetching maps:",r);case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function z(){j=null,G="all",R=0}function H(){return j}(N=document.createElement("style")).textContent="\n    @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n    \n    @keyframes fadeOut {\n        from { opacity: 1; }\n        to { opacity: 0; }\n    }\n    \n    @keyframes slideIn {\n        from { \n            opacity: 0;\n            transform: translateY(-50px) scale(0.9);\n        }\n        to { \n            opacity: 1;\n            transform: translateY(0) scale(1);\n        }\n    }\n    \n    @keyframes bobaBounce {\n        0%, 100% { \n            transform: translateY(0px) rotate(0deg);\n        }\n        25% { \n            transform: translateY(-3px) rotate(2deg);\n        }\n        50% { \n            transform: translateY(-6px) rotate(0deg);\n        }\n        75% { \n            transform: translateY(-3px) rotate(-2deg);\n        }\n    }\n    \n    @keyframes pearlSparkle {\n        0%, 100% { \n            transform: scale(1) rotate(0deg);\n            opacity: 1;\n        }\n        25% { \n            transform: scale(1.1) rotate(90deg);\n            opacity: 0.8;\n        }\n        50% { \n            transform: scale(1.2) rotate(180deg);\n            opacity: 1;\n        }\n        75% { \n            transform: scale(1.1) rotate(270deg);\n            opacity: 0.8;\n        }\n    }\n    ",document.head.appendChild(N)},724:(e,t,n)=>{n.r(t),n.d(t,{disableModalVim:()=>l,hideModalCursor:()=>b,initializeModalVim:()=>u,refreshCursorPosition:()=>S,showModalCursor:()=>w,updateModalVimForPage:()=>d});var r=0,o=!1,a=null,i=[],s="page-1",c={terms:[{selector:".close-button",column:0,row:0,type:"close"}],loveLetter:[{selector:".letter-header .close-btn.retro-btn",column:0,row:0,type:"close"},{selector:".letter-footer .close-btn.secondary",column:0,row:1,type:"button"}],manual:{"page-1":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#showKeymapBtn",column:0,row:1,type:"button"}],"page-2":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#showMotionsBtn",column:0,row:1,type:"button"}],"page-3":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#toScoreAttributionBtn",column:0,row:1,type:"button"}],"page-4":[{selector:"#closeManual",column:0,row:0,type:"close"},{selector:"#backToCommandsBtn",column:0,row:1,type:"button"},{selector:"#backToConfigBtn",column:0,row:2,type:"button"}]}};function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;logger.debug("=== INITIALIZING MODAL VIM ==="),logger.debug("Modal type:",e,t?"page: ".concat(t):"");var n=f(e);if(logger.debug("Modal element:",n),n){var c=window.getComputedStyle(n);if(logger.debug("Modal display:",c.display),logger.debug("Modal visibility:",c.visibility),"terms"===e){logger.debug("=== T&C MODAL SPECIAL DEBUG ===");var u=document.querySelector(".close-button"),l=n.querySelector(".close-button");logger.debug("Global .close-button search:",u),logger.debug("Modal .close-button search:",l),logger.debug("Modal innerHTML preview:",n.innerHTML.substring(0,500))}a=e,t&&(s=t),p(e,t),r=g(),o=!0,logger.debug("Modal vim starting at element index: ".concat(r)),logger.debug("Available elements:",i),v(),document.addEventListener("keydown",h),logger.debug("=== MODAL VIM NAVIGATION INITIALIZED ===")}else logger.warn("No modal found for modal vim navigation")}function l(){o=!1,y(),document.removeEventListener("keydown",h),a=null,logger.debug("Modal vim navigation disabled")}function d(e){"manual"===a&&o&&(s=e,p("manual",e),r=g(),setTimeout(function(){v()},250),logger.debug("Modal vim updated for page:",e))}function f(e){switch(e){case"terms":return document.getElementById("termsModal");case"loveLetter":return document.getElementById("loveLetterModal");case"manual":return document.getElementById("vimManualModal");default:return null}}function p(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(i=[],t="manual"===e&&n?c.manual[n]||c.manual["page-1"]:c[e]){var r=f(e);logger.debug("Modal container for search:",r),t.forEach(function(t){logger.debug("Modal: Processing navigation element with selector: ".concat(t.selector));var n=document.querySelector(t.selector);if(!n&&r&&(n=r.querySelector(t.selector),logger.debug("Modal: Trying modal-scoped search for ".concat(t.selector,":"),n?"FOUND":"NOT FOUND")),logger.debug("Modal: Looking for element with selector: ".concat(t.selector),n?"FOUND":"NOT FOUND"),n)logger.debug("Modal: Element found:",n),logger.debug("Modal: Element classes:",n.className),logger.debug("Modal: Element content:",n.textContent),logger.debug("Modal: Element onclick:",n.onclick),logger.debug("Modal: Element parent:",n.parentElement);else if(logger.debug("Modal: Element NOT FOUND with selector: ".concat(t.selector)),"terms"===e){var o=document.querySelectorAll("button");logger.debug("T&C: All buttons in document:",Array.from(o).map(function(e){return{className:e.className,content:e.textContent,onclick:e.onclick?"has onclick":"no onclick",id:e.id}}));var a=document.querySelectorAll('[class*="close"]');logger.debug("T&C: All elements with 'close' in class:",Array.from(a).map(function(e){return{tagName:e.tagName,className:e.className,content:e.textContent,id:e.id}}))}n&&function(e){if(!e)return!1;try{var t=window.getComputedStyle(e),n=e.getBoundingClientRect(),r="none"!==t.display&&"hidden"!==t.visibility&&"0"!==t.opacity&&n.width>0&&n.height>0&&!e.hasAttribute("disabled")&&!e.classList.contains("hidden");return logger.debug("Modal: Visibility check for ".concat(e.className,":"),{display:t.display,visibility:t.visibility,opacity:t.opacity,width:n.width,height:n.height,disabled:e.hasAttribute("disabled"),hiddenClass:e.classList.contains("hidden"),result:r}),r}catch(e){return logger.debug("Modal: Error checking visibility:",e),!1}}(n)?(i.push(t),logger.debug("Modal: Added element ".concat(t.selector," to navigation"))):n?logger.debug("Modal: Element ".concat(t.selector," found but not visible")):logger.debug("Modal: Element ".concat(t.selector," not found at all"))}),logger.debug("Available modal elements:",i.length)}else logger.warn("Unknown modal type:",e)}function g(){for(var e=0;e<i.length;e++){if("close"===i[e].type)return e}return 0}function m(){if(r<0||r>=i.length)return null;var e=i[r];if(!e)return null;try{return document.querySelector(e.selector)}catch(e){return null}}function h(e){if(o&&(f(a)&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.isContentEditable))switch(e.key.toLowerCase()){case"h":case"l":e.preventDefault();break;case"j":e.preventDefault(),function(){if(i.length<=1)return;r=r<i.length-1?r+1:0,v(),E()}();break;case"k":e.preventDefault(),function(){if(i.length<=1)return;r=r>0?r-1:i.length-1,v(),E()}();break;case"enter":e.preventDefault(),function(){var e=m();if(logger.debug("Modal activating element:",e),!e)return void logger.debug("No element to activate in modal");try{e.click()}catch(e){logger.debug("Error clicking modal element:",e)}}();break;case"escape":e.preventDefault(),function(){var e=i.find(function(e){return"close"===e.type});if(e){var t=document.querySelector(e.selector);t&&t.click()}}()}}function v(){logger.debug("Modal updateCursor called"),y();var e=m();logger.debug("Modal current element for cursor:",e),e?function(e){if(!e)return;var t=document.createElement("div");t.className="modal-vim-cursor",t.textContent="üßã",t.style.cssText="\n    position: fixed;\n    font-size: 20px;\n    z-index: 99999;\n    pointer-events: none;\n    animation: modal-vim-cursor-pulse 1s ease-in-out infinite alternate;\n    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 1)) drop-shadow(0 0 8px rgba(0, 0, 0, 1));\n    background: rgba(255, 165, 0, 0.8);\n    border: 2px solid white;\n    border-radius: 50%;\n    width: 35px;\n    height: 35px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    box-shadow: 0 0 15px rgba(255, 165, 0, 0.8);\n  ";var n=e.getBoundingClientRect(),r=-10,o=-10;("closeManual"===e.id||e.classList.contains("retro-close-btn"))&&(r=-5,o=-5);if(t.style.top=n.top+r+"px",t.style.left=n.left+o+"px",document.body.appendChild(t),!document.getElementById("modal-vim-cursor-styles")){var a=document.createElement("style");a.id="modal-vim-cursor-styles",a.textContent="\n      @keyframes modal-vim-cursor-pulse {\n        0% { \n          transform: scale(1) rotate(-5deg); \n          opacity: 0.9; \n        }\n        100% { \n          transform: scale(1.15) rotate(5deg); \n          opacity: 1; \n        }\n      }\n    ",document.head.appendChild(a)}}(e):logger.debug("No element found for modal cursor")}function y(){document.querySelectorAll(".modal-vim-cursor").forEach(function(e){e.remove()}),document.querySelectorAll("[data-original-modal-text]").forEach(function(e){e.textContent=e.getAttribute("data-original-modal-text"),e.removeAttribute("data-original-modal-text")})}function b(){y()}function w(){o&&a&&(p(a,"manual"===a?s:null),v())}function E(){var e=m();if(e){var t=e.getBoundingClientRect(),n=window.innerHeight,r=window.innerWidth;(t.top<0||t.bottom>n||t.left<0||t.right>r)&&(logger.debug("Modal: Element is out of view, scrolling into view"),e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}))}}function S(){o&&a&&v()}},763:(e,t,n)=>{n.r(t),n.d(t,{getCurrentUser:()=>d,initializeAuth:()=>m,isLoggedIn:()=>f,showAuthModal:()=>h,verifyAuthenticationStatus:()=>p});var r=n(532),o=n(643);function a(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function s(n,r,o,a){var s=r&&r.prototype instanceof u?r:u,l=Object.create(s.prototype);return i(l,"_invoke",function(n,r,o){var a,i,s,u=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return a=t,i=0,s=e,f.n=n,c}};function p(n,r){for(i=n,s=r,t=0;!d&&u&&!o&&t<l.length;t++){var o,a=l[t],p=f.p,g=a[2];n>3?(o=g===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=n<2&&p<a[1])?(i=0,f.v=r,f.n=a[1]):p<g&&(o=n<3||a[0]>r||r>g)&&(a[4]=n,a[5]=r,f.n=g,i=0))}if(o||n>1)return c;throw d=!0,r}return function(o,l,g){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,g),i=l,s=g;(t=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),p(i,s)):f.n=s:f.v=s);try{if(u=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(d=f.n<0)?s:n.call(r,f))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,o,a),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(i(t={},r,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,i(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,i(p,"constructor",d),i(d,"constructor",l),l.displayName="GeneratorFunction",i(d,o,"GeneratorFunction"),i(p),i(p,o,"Generator"),i(p,r,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:s,m:g}})()}function i(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}i=function(e,t,n,r){function a(t,n){i(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},i(e,t,n,r)}function s(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){s(a,r,o,i,c,"next",e)}function c(e){s(a,r,o,i,c,"throw",e)}i(void 0)})}}var u=null;n.e(613).then(n.bind(n,613)).then(function(e){u=e,logger.debug("Auth: authVimNavigation module loaded at startup")}).catch(function(e){logger.error("Auth: Failed to load authVimNavigation module:",e)});var l=null;function d(){return l}function f(){return null!==l}function p(){return g.apply(this,arguments)}function g(){return(g=c(a().m(function e(){var t,n,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(r.s.ENDPOINTS.ME,{credentials:"include"});case 1:return t=e.v,e.n=2,t.json();case 2:if(!(n=e.v).success||!n.authenticated){e.n=3;break}return l=n.user,e.a(2,!0);case 3:return l=null,e.a(2,!1);case 4:e.n=6;break;case 5:return e.p=5,o=e.v,logger.error("Error verifying auth status:",o),l=null,e.a(2,!1);case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function m(){logger.debug("Initializing authentication...");var e=document.getElementById(r.s.ELEMENT_IDS.MODAL),t=document.getElementById(r.s.ELEMENT_IDS.REGISTRATION_FORM),o=document.getElementById(r.s.ELEMENT_IDS.LOGIN_FORM),a=document.getElementById(r.s.ELEMENT_IDS.LOGOUT_BUTTON),i=document.getElementById(r.s.ELEMENT_IDS.LOGIN_BUTTON),s=document.getElementById(r.s.ELEMENT_IDS.REGISTER_BUTTON),c=document.getElementById(r.s.ELEMENT_IDS.SWITCH_TO_LOGIN),u=document.getElementById(r.s.ELEMENT_IDS.SWITCH_TO_REGISTER),l=document.getElementById(r.s.ELEMENT_IDS.SWITCH_TO_FORGOT_PASSWORD);if(e){var d=document.getElementById(r.s.ELEMENT_IDS.SWITCH_TO_LOGIN_FROM_FORGOT),f=document.getElementById(r.s.ELEMENT_IDS.FORGOT_PASSWORD_FORM);!function(){y.apply(this,arguments)}(),t&&t.addEventListener("submit",E),o&&o.addEventListener("submit",x),f&&f.addEventListener("submit",C),a&&a.addEventListener("click",O),i&&i.addEventListener("click",function(){return h("login")}),s&&s.addEventListener("click",function(){return h("register")}),c&&c.addEventListener("click",function(e){e.preventDefault(),v("login")}),u&&u.addEventListener("click",function(e){e.preventDefault(),v("register")}),l&&l.addEventListener("click",function(e){e.preventDefault(),v("forgotPassword")}),d&&d.addEventListener("click",function(e){e.preventDefault(),v("login")}),window.closeAuthModal=function(){e.classList.add("hidden"),I(),window.showCursor&&window.showCursor(),Promise.resolve().then(n.bind(n,199)).then(function(e){e.enableVimNavigation()}).catch(function(){})},window.showAuthModal=h,e&&e.addEventListener("click",function(t){t.target===e&&_()}),document.addEventListener("showAuthModal",function(e){var t;h((null===(t=e.detail)||void 0===t?void 0:t.tab)||"register")})}else logger.debug("Auth modal not found - skipping auth initialization (likely on game page)")}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"register";logger.debug("Auth: showAuthModal called with mode:",e),document.getElementById(r.s.ELEMENT_IDS.MODAL).classList.remove("hidden"),v(e),window.hideCursor?(window.hideCursor(),setTimeout(function(){Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){})},0)):Promise.resolve().then(n.bind(n,199)).then(function(e){e.disableVimNavigation()}).catch(function(){}),setTimeout(function(){if(logger.debug("Auth: About to initialize auth vim, module available:",!!u),u)try{logger.debug("Auth: Calling initializeAuthVim with mode:",e),u.initializeAuthVim(e),logger.debug("Auth: initializeAuthVim called successfully"),setTimeout(function(){logger.debug("Auth: About to refresh cursor"),u.refreshAuthCursor()},200)}catch(e){logger.error("Auth: Error initializing auth vim:",e)}else logger.warn("Auth: authVimModule not loaded yet, trying dynamic import"),n.e(613).then(n.bind(n,613)).then(function(t){logger.debug("Auth: Module imported successfully, calling initializeAuthVim");try{t.initializeAuthVim(e),logger.debug("Auth: initializeAuthVim called successfully"),setTimeout(function(){t.refreshAuthCursor()},200)}catch(e){logger.error("Auth: Error initializing auth vim:",e)}}).catch(function(e){logger.error("Auth: Failed to import auth vim navigation:",e)})},150)}function v(e){var t=document.getElementById(r.s.ELEMENT_IDS.REGISTRATION_FORM),o=document.getElementById(r.s.ELEMENT_IDS.LOGIN_FORM),a=document.getElementById(r.s.ELEMENT_IDS.FORGOT_PASSWORD_FORM),i=document.getElementById(r.s.ELEMENT_IDS.MODAL_TITLE);t.classList.add("hidden"),o.classList.add("hidden"),a.classList.add("hidden"),"login"===e?(o.classList.remove("hidden"),i.textContent=r.s.MESSAGES.LOGIN_TITLE):"forgotPassword"===e?(a.classList.remove("hidden"),i.textContent=r.s.MESSAGES.FORGOT_PASSWORD_TITLE):(t.classList.remove("hidden"),i.textContent=r.s.MESSAGES.REGISTER_TITLE),u?u.updateAuthVimForMode(e):n.e(613).then(n.bind(n,613)).then(function(t){t.updateAuthVimForMode(e)}).catch(function(){}),I()}function y(){return(y=c(a().m(function e(){var t,n,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(r.s.ENDPOINTS.ME);case 1:return t=e.v,e.n=2,t.json();case 2:(n=e.v).success&&n.authenticated?(l=n.user,b(n.user)):(l=null,w()),e.n=4;break;case 3:e.p=3,o=e.v,logger.error("Error checking auth status:",o),l=null,w();case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function b(e){var t=document.getElementById(r.s.ELEMENT_IDS.USER_PANEL),o=document.getElementById(r.s.ELEMENT_IDS.LOGGED_USERNAME),a=document.getElementById(r.s.ELEMENT_IDS.AUTH_BUTTONS);t&&o&&(o.textContent=e.username,t.classList.remove("hidden")),a&&a.classList.add("hidden"),e.is_registered&&Promise.resolve().then(n.bind(n,98)).then(function(e){e.unlockAllCharacters()})}function w(){var e=document.getElementById(r.s.ELEMENT_IDS.USER_PANEL),t=document.getElementById(r.s.ELEMENT_IDS.AUTH_BUTTONS);e&&e.classList.add("hidden"),t&&t.classList.remove("hidden"),Promise.resolve().then(n.bind(n,98)).then(function(e){e.lockPremiumCharacters(),e.lockPaidCharacters()})}function E(e){return S.apply(this,arguments)}function S(){return(S=c(a().m(function e(t){var i,s,c,u,d,f,p,g,m;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t.preventDefault(),i=new FormData(t.target),s={username:i.get("username"),email:i.get("email"),password:i.get("password")},e.p=1,e.n=2,fetch(r.s.ENDPOINTS.REGISTER,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 2:return c=e.v,e.n=3,c.json();case 3:if(!(u=e.v).success){e.n=13;break}return l=u.user,b(u.user),_(),e.n=4,new Promise(function(e){return setTimeout(e,100)});case 4:return e.n=5,(0,o.refreshProgression)();case 5:return e.p=5,e.n=6,(0,o.migrateGuestProgressToAccount)();case 6:(d=e.v).success&&"No progress to migrate"!==d.message&&logger.info("Guest progress migrated successfully:",d.message),e.n=8;break;case 7:e.p=7,p=e.v,logger.error("Failed to migrate guest progress:",p);case 8:return e.n=9,(0,o.refreshProgression)();case 9:return e.p=9,e.n=10,Promise.resolve().then(n.bind(n,658));case 10:f=e.v,(0,f.clearMapCache)(),e.n=12;break;case 11:e.p=11,g=e.v,logger.error("Failed to clear map cache:",g);case 12:alert(r.s.MESSAGES.REGISTRATION_SUCCESS),e.n=14;break;case 13:P(u.error||"Registration failed");case 14:e.n=16;break;case 15:e.p=15,m=e.v,logger.error("Registration error:",m),P(r.s.MESSAGES.NETWORK_ERROR);case 16:return e.a(2)}},e,null,[[9,11],[5,7],[1,15]])}))).apply(this,arguments)}function x(e){return k.apply(this,arguments)}function k(){return(k=c(a().m(function e(t){var i,s,c,u,d,f,p,g,m;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t.preventDefault(),i=new FormData(t.target),s={username:i.get("username"),password:i.get("password")},e.p=1,e.n=2,fetch(r.s.ENDPOINTS.LOGIN,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 2:return c=e.v,e.n=3,c.json();case 3:if(!(u=e.v).success){e.n=12;break}return l=u.user,b(u.user),_(),e.n=4,(0,o.refreshProgression)();case 4:return e.p=4,e.n=5,(0,o.migrateGuestProgressToAccount)();case 5:(d=e.v).success&&"No progress to migrate"!==d.message&&logger.info("Guest progress migrated successfully:",d.message),e.n=7;break;case 6:e.p=6,p=e.v,logger.error("Failed to migrate guest progress:",p);case 7:return e.n=8,(0,o.refreshProgression)();case 8:return e.p=8,e.n=9,Promise.resolve().then(n.bind(n,658));case 9:f=e.v,(0,f.clearMapCache)(),e.n=11;break;case 10:e.p=10,g=e.v,logger.error("Failed to clear map cache:",g);case 11:e.n=13;break;case 12:P(u.error||"Login failed");case 13:e.n=15;break;case 14:e.p=14,m=e.v,logger.error("Login error:",m),P(r.s.MESSAGES.NETWORK_ERROR);case 15:return e.a(2)}},e,null,[[8,10],[4,6],[1,14]])}))).apply(this,arguments)}function C(e){return T.apply(this,arguments)}function T(){return(T=c(a().m(function e(t){var n,o,i,s,c;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.preventDefault(),n=new FormData(t.target),(o=n.get("email"))&&o.trim()){e.n=1;break}return P("Please enter your email address"),e.a(2);case 1:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){e.n=2;break}return P("Please enter a valid email address"),e.a(2);case 2:return e.p=2,e.n=3,fetch(r.s.ENDPOINTS.FORGOT_PASSWORD,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o.trim()})});case 3:if((i=e.v).ok){e.n=4;break}throw new Error("HTTP error! status: ".concat(i.status));case 4:return e.n=5,i.json();case 5:(s=e.v).success?(P(r.s.MESSAGES.FORGOT_PASSWORD_SUCCESS),setTimeout(function(){v("login")},3e3)):P(s.error||"Failed to send reset email. Please try again later."),e.n=7;break;case 6:e.p=6,c=e.v,logger.error("Forgot password error:",c),P("Network error. Please check your connection and try again.");case 7:return e.a(2)}},e,null,[[2,6]])}))).apply(this,arguments)}function O(){return L.apply(this,arguments)}function L(){return(L=c(a().m(function e(){var t,o,i,s,c,u;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(r.s.ENDPOINTS.LOGOUT,{method:"POST"});case 1:return t=e.v,e.n=2,t.json();case 2:if(!e.v.success){e.n=8;break}return l=null,w(),e.p=3,e.n=4,Promise.resolve().then(n.bind(n,643));case 4:return o=e.v,i=o.refreshProgression,e.n=5,i();case 5:return e.n=6,Promise.resolve().then(n.bind(n,658));case 6:s=e.v,(0,s.clearMapCache)(),e.n=8;break;case 7:e.p=7,c=e.v,logger.error("Failed to refresh progression after logout:",c);case 8:e.n=10;break;case 9:e.p=9,u=e.v,logger.error("Logout error:",u);case 10:return e.a(2)}},e,null,[[3,7],[0,9]])}))).apply(this,arguments)}function P(e){var t=document.getElementById(r.s.ELEMENT_IDS.AUTH_ERROR);t&&(t.textContent=e,t.classList.remove("hidden"),t.style.display="block",t.style.visibility="visible")}function I(){var e=document.getElementById(r.s.ELEMENT_IDS.AUTH_ERROR);e&&(e.classList.add("hidden"),e.style.display="none",e.textContent="")}function _(){logger.debug("Auth: closeAuthModal called");var e=document.getElementById(r.s.ELEMENT_IDS.MODAL),t=window.authModalClosingViaCancel;if(window.authModalClosingViaCancel=!1,t){if(logger.debug("Auth: Modal closed via cancel - doing aggressive cleanup"),window.getSelection){var o=window.getSelection();o.removeAllRanges(),o.empty&&o.empty()}document.querySelectorAll("input, textarea").forEach(function(e){try{e.blur(),e.setSelectionRange&&e.setSelectionRange(0,0),e.style.outline=""}catch(e){}}),document.body.focus()}else logger.debug("Auth: Normal modal close - minimal cleanup");u?(logger.debug("Auth: Calling disableAuthVim on preloaded module"),u.disableAuthVim()):(logger.debug("Auth: authVimModule not available, trying dynamic import for disable"),n.e(613).then(n.bind(n,613)).then(function(e){logger.debug("Auth: Calling disableAuthVim"),e.disableAuthVim()}).catch(function(){})),e.classList.add("hidden"),I(),t&&setTimeout(function(){if(window.getSelection){var e=window.getSelection();e.removeAllRanges(),e.empty&&e.empty()}document.selection&&document.selection.empty(),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),document.body.focus(),document.body.style.display="none",document.body.offsetHeight,document.body.style.display="",document.querySelectorAll("*").forEach(function(e){if(e.style&&(e.style.outline="",e.style.outlineOffset="",e.style.boxShadow=""),e.blur&&"function"==typeof e.blur)try{e.blur()}catch(e){}}),document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"], textarea').forEach(function(e){try{e.blur(),e.setSelectionRange&&e.setSelectionRange(0,0),e.style.outline="",e.style.boxShadow="",e.style.border=""}catch(e){}}),window.getSelection&&setTimeout(function(){window.getSelection().removeAllRanges()},10),logger.debug("Auth: Cleared all selections, focus, and forced repaint")},50),setTimeout(function(){logger.debug("Auth: Re-enabling main vim navigation after modal close"),Promise.resolve().then(n.bind(n,199)).then(function(e){t?(logger.debug("Auth: Was closed via cancel - doing full reset"),e.disableVimNavigation(),e.hideCursor(),document.querySelectorAll(".vim-cursor, .auth-vim-cursor").forEach(function(e){return e.remove()}),document.querySelectorAll("[data-original-text], [data-original-auth-text]").forEach(function(e){var t=e.getAttribute("data-original-text")||e.getAttribute("data-original-auth-text");t&&(e.textContent=t,e.removeAttribute("data-original-text"),e.removeAttribute("data-original-auth-text"))}),setTimeout(function(){e.enableVimNavigation(),e.showCursor(),logger.debug("Auth: Main vim navigation fully reset and re-enabled")},50)):(logger.debug("Auth: Normal close - simple re-enable"),e.enableVimNavigation(),e.showCursor())}).catch(function(){})},100)}}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return r[e](n,n.exports,a),n.exports}a.m=r,e=[],a.O=(t,n,r,o)=>{if(!n){var i=1/0;for(l=0;l<e.length;l++){for(var[n,r,o]=e[l],s=!0,c=0;c<n.length;c++)(!1&o||i>=o)&&Object.keys(a.O).every(e=>a.O[e](n[c]))?n.splice(c--,1):(s=!1,o<i&&(i=o));if(s){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[n,r,o]},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce((t,n)=>(a.f[n](e,t),t),[])),a.u=e=>e+".bundle.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),t={},n="boba-vim:",a.l=(e,r,o,i)=>{if(t[e])t[e].push(r);else{var s,c;if(void 0!==o)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")==n+o){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",n+o),s.src=e),t[e]=[r];var f=(n,r)=>{s.onerror=s.onload=null,clearTimeout(p);var o=t[e];if(delete t[e],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach(e=>e(r)),n)return n(r)},p=setTimeout(f.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=f.bind(null,s.onerror),s.onload=f.bind(null,s.onload),c&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.j=57,(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={57:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var o=new Promise((n,o)=>r=e[t]=[n,o]);n.push(r[2]=o);var i=a.p+a.u(t),s=new Error;a.l(i,n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var o=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+i+")",s.name="ChunkLoadError",s.type=o,s.request=i,r[1](s)}},"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,n)=>{var r,o,[i,s,c]=n,u=0;if(i.some(t=>0!==e[t])){for(r in s)a.o(s,r)&&(a.m[r]=s[r]);if(c)var l=c(a)}for(t&&t(n);u<i.length;u++)o=i[u],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(l)},n=self.webpackChunkboba_vim=self.webpackChunkboba_vim||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var i=a.O(void 0,[76],()=>a(247));i=a.O(i)})();